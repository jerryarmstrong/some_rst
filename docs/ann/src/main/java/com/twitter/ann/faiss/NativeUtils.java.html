<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../" id="documentation_options" src="../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.ann.faiss;</p>
<p>import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;
import java.util.Locale;</p>
<p>public final class NativeUtils {</p>
<blockquote>
<div><p>private static final int MIN_PREFIX_LENGTH = 3;
public static final String NATIVE_FOLDER_PATH_PREFIX = “nativeutils”;</p>
<p>public static File temporaryDir;</p>
<p>private NativeUtils() {
}</p>
<dl>
<dt>private static File unpackLibraryFromJarInternal(String path) throws IOException {</dt><dd><dl class="simple">
<dt>if (null == path || !path.startsWith(“/”)) {</dt><dd><p>throw new IllegalArgumentException(“The path has to be absolute (start with ‘/’).”);</p>
</dd>
</dl>
<p>}</p>
<p>String[] parts = path.split(“/”);
String filename = (parts.length &gt; 1) ? parts[parts.length - 1] : null;</p>
<dl class="simple">
<dt>if (filename == null || filename.length() &lt; MIN_PREFIX_LENGTH) {</dt><dd><p>throw new IllegalArgumentException(“The filename has to be at least 3 characters long.”);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (temporaryDir == null) {</dt><dd><p>temporaryDir = createTempDirectory(NATIVE_FOLDER_PATH_PREFIX);
temporaryDir.deleteOnExit();</p>
</dd>
</dl>
<p>}</p>
<p>File temp = new File(temporaryDir, filename);</p>
<dl class="simple">
<dt>try (InputStream is = NativeUtils.class.getResourceAsStream(path)) {</dt><dd><p>Files.copy(is, temp.toPath(), StandardCopyOption.REPLACE_EXISTING);</p>
</dd>
<dt>} catch (IOException e) {</dt><dd><p>temp.delete();
throw e;</p>
</dd>
<dt>} catch (NullPointerException e) {</dt><dd><p>temp.delete();
throw new FileNotFoundException(“File “ + path + “ was not found inside JAR.”);</p>
</dd>
</dl>
<p>}</p>
<p>return temp;</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Unpack library from JAR into temporary path</p></li>
<li></li>
<li><p>&#64;param path The path of file inside JAR as absolute path (beginning with</p></li>
<li><p>‘/’), e.g. /package/File.ext</p></li>
<li><p>&#64;throws IOException              If temporary file creation or read/write</p></li>
<li><p>operation fails</p></li>
<li><p>&#64;throws IllegalArgumentException If source file (param path) does not exist</p></li>
<li><p>&#64;throws IllegalArgumentException If the path is not absolute or if the</p></li>
<li><p>filename is shorter than three characters</p></li>
<li><p>(restriction of</p></li>
<li><p><a class="reference external" href="mailto:{&#37;&#52;&#48;link">{<span>&#64;</span>link</a> File#createTempFile(java.lang.String, java.lang.String)}).</p></li>
<li><p>&#64;throws FileNotFoundException    If the file could not be found inside the</p></li>
<li><p>JAR.</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
<dt>public static void unpackLibraryFromJar(String path) throws IOException {</dt><dd><p>unpackLibraryFromJarInternal(path);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Loads library from current JAR archive</p></li>
<li><p>&lt;p&gt;</p></li>
<li><p>The file from JAR is copied into system temporary directory and then loaded.</p></li>
<li><p>The temporary file is deleted after</p></li>
<li><p>exiting.</p></li>
<li><p>Method uses String as filename because the pathname is “abstract”, not</p></li>
<li><p>system-dependent.</p></li>
<li></li>
<li><p>&#64;param path The path of file inside JAR as absolute path (beginning with</p></li>
<li><p>‘/’), e.g. /package/File.ext</p></li>
<li><p>&#64;throws IOException              If temporary file creation or read/write</p></li>
<li><p>operation fails</p></li>
<li><p>&#64;throws IllegalArgumentException If source file (param path) does not exist</p></li>
<li><p>&#64;throws IllegalArgumentException If the path is not absolute or if the</p></li>
<li><p>filename is shorter than three characters</p></li>
<li><p>(restriction of</p></li>
<li><p><a class="reference external" href="mailto:{&#37;&#52;&#48;link">{<span>&#64;</span>link</a> File#createTempFile(java.lang.String, java.lang.String)}).</p></li>
<li><p>&#64;throws FileNotFoundException    If the file could not be found inside the</p></li>
<li><p>JAR.</p></li>
</ul>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
</dd>
<dt>public static void loadLibraryFromJar(String path) throws IOException {</dt><dd><p>File temp = unpackLibraryFromJarInternal(path);</p>
<dl class="simple">
<dt>try (InputStream is = NativeUtils.class.getResourceAsStream(path)) {</dt><dd><p>Files.copy(is, temp.toPath(), StandardCopyOption.REPLACE_EXISTING);</p>
</dd>
<dt>} catch (IOException e) {</dt><dd><p>temp.delete();
throw e;</p>
</dd>
<dt>} catch (NullPointerException e) {</dt><dd><p>temp.delete();
throw new FileNotFoundException(“File “ + path + “ was not found inside JAR.”);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>try {</dt><dd><p>System.load(temp.getAbsolutePath());</p>
</dd>
<dt>} finally {</dt><dd><p>temp.deleteOnExit();</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private static File createTempDirectory(String prefix) throws IOException {</dt><dd><p>String tempDir = System.getProperty(“java.io.tmpdir”);
File generatedDir = new File(tempDir, prefix + System.nanoTime());</p>
<dl class="simple">
<dt>if (!generatedDir.mkdir()) {</dt><dd><p>throw new IOException(“Failed to create temp directory “ + generatedDir.getName());</p>
</dd>
</dl>
<p>}</p>
<p>return generatedDir;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public enum OSType {</dt><dd><p>Windows, MacOS, Linux, Other</p>
</dd>
</dl>
<p>}</p>
<p>protected static OSType detectedOS;</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>detect the operating system from the os.name System property and cache</p></li>
<li><p>the result</p></li>
<li></li>
<li><p>&#64;returns - the operating system detected</p></li>
</ul>
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
</dd>
<dt>public static OSType getOperatingSystemType() {</dt><dd><dl>
<dt>if (detectedOS == null) {</dt><dd><p>String osname = System.getProperty(“os.name”, “generic”).toLowerCase(Locale.ENGLISH);
if ((osname.contains(“mac”)) || (osname.contains(“darwin”))) {</p>
<blockquote>
<div><p>detectedOS = OSType.MacOS;</p>
</div></blockquote>
<dl class="simple">
<dt>} else if (osname.contains(“win”)) {</dt><dd><p>detectedOS = OSType.Windows;</p>
</dd>
<dt>} else if (osname.contains(“nux”)) {</dt><dd><p>detectedOS = OSType.Linux;</p>
</dd>
<dt>} else {</dt><dd><p>detectedOS = OSType.Other;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}
return detectedOS;</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../_sources/ann/src/main/java/com/twitter/ann/faiss/NativeUtils.java.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>