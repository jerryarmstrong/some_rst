<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p># pylint: disable=missing-docstring, unused-argument
‘’’ Contains the base classes for CalibrationFeature and Calibrator ‘’’</p>
<p>from collections import defaultdict</p>
<p>import numpy as np
import tensorflow.compat.v1 as tf
import tensorflow_hub as hub
import twml
import twml.util</p>
<dl>
<dt>class CalibrationFeature(object):</dt><dd><p>‘’’
Accumulates values and weights for individual features.
Typically, each unique feature defined in the accumulated SparseTensor or Tensor
would have its own CalibrationFeature instance.
‘’’</p>
<dl>
<dt>def __init__(self, feature_id):</dt><dd><p>‘’’ Constructs a CalibrationFeature</p>
<dl class="simple">
<dt>Arguments:</dt><dd><dl class="simple">
<dt>feature_id:</dt><dd><p>number identifying the feature.</p>
</dd>
</dl>
</dd>
</dl>
<p>‘’’
self.feature_id = feature_id
self._calibrated = False
self._features_dict = defaultdict(list)</p>
</dd>
<dt>def add_values(self, new_features):</dt><dd><p>‘’’
Extends lists to contain the values in this batch
‘’’
for key in new_features:</p>
<blockquote>
<div><p>self._features_dict[key].append(new_features[key])</p>
</div></blockquote>
</dd>
<dt>def _concat_arrays(self):</dt><dd><p>‘’’
This class calls this function after you have added all the values.
It creates a dictionary with the concatanated arrays
‘’’
self._features_dict.update((k, np.concatenate(v)) for k, v in self._features_dict.items())</p>
</dd>
<dt>def calibrate(self, <a href="#id1"><span class="problematic" id="id2">*</span></a>args, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs):</dt><dd><p>raise NotImplementedError</p>
</dd>
</dl>
</dd>
<dt>class Calibrator(object):</dt><dd><p>‘’’
Accumulates features and their respective values for Calibration
The steps for calibration are typically as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>accumulate feature values from batches by calling <code class="docutils literal notranslate"><span class="pre">accumulate()</span></code> and;</p></li>
<li><p>calibrate by calling <code class="docutils literal notranslate"><span class="pre">calibrate()</span></code>;</p></li>
<li><p>convert to a twml.layers layer by calling <code class="docutils literal notranslate"><span class="pre">to_layer()</span></code>.</p></li>
</ol>
</div></blockquote>
<p>Note you can only use one calibrator per Trainer.
‘’’</p>
<dl>
<dt>def __init__(self, calibrator_name=None, <a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs):</dt><dd><p>‘’’
Arguments:</p>
<blockquote>
<div><dl class="simple">
<dt>calibrator_name.</dt><dd><p>Default: if set to None it will be the same as the class name.
Please be reminded that if in the model there are many calibrators
of the same type the calibrator_name should be changed to avoid confusion.</p>
</dd>
</dl>
</div></blockquote>
<p>‘’’
self._calibrated = False
if calibrator_name is None:</p>
<blockquote>
<div><p>calibrator_name = twml.util.to_snake_case(self.__class__.__name__)</p>
</div></blockquote>
<p>self._calibrator_name = calibrator_name
self._kwargs = kwargs</p>
</dd>
</dl>
<p>&#64;property
def is_calibrated(self):</p>
<blockquote>
<div><p>return self._calibrated</p>
</div></blockquote>
<p>&#64;property
def name(self):</p>
<blockquote>
<div><p>return self._calibrator_name</p>
</div></blockquote>
<dl>
<dt>def accumulate(self, <a href="#id7"><span class="problematic" id="id8">*</span></a>args, <a href="#id9"><span class="problematic" id="id10">**</span></a>kwargs):</dt><dd><p>‘’’Accumulates features and their respective values for Calibration.’’’
raise NotImplementedError</p>
</dd>
<dt>def calibrate(self):</dt><dd><p>‘’’Calibrates after the accumulation has ended.’’’
self._calibrated = True</p>
</dd>
<dt>def to_layer(self, name=None):</dt><dd><p>‘’’
Returns a twml.layers.Layer instance with the result of calibrator.</p>
<dl class="simple">
<dt>Arguments:</dt><dd><dl class="simple">
<dt>name:</dt><dd><p>name-scope of the layer</p>
</dd>
</dl>
</dd>
</dl>
<p>‘’’
raise NotImplementedError</p>
</dd>
<dt>def get_layer_args(self):</dt><dd><p>‘’’
Returns layer arguments required to implement multi-phase training.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>dictionary of Layer constructor arguments to initialize the
layer Variables. Typically, this should contain enough information
to initialize empty layer Variables of the correct size, which will then
be filled with the right data using init_map.</p>
</dd>
</dl>
<p>‘’’
raise NotImplementedError</p>
</dd>
<dt>def save(self, save_dir, name=”default”, verbose=False):</dt><dd><p>‘’’Save the calibrator into the given save_directory.
Arguments:</p>
<blockquote>
<div><dl class="simple">
<dt>save_dir:</dt><dd><p>name of the saving directory. Default (string): “default”.</p>
</dd>
<dt>name:</dt><dd><p>name for the calibrator.</p>
</dd>
</dl>
</div></blockquote>
<p>‘’’
if not self._calibrated:</p>
<blockquote>
<div><p>raise RuntimeError(“Expecting prior call to calibrate().Cannot save() prior to calibrate()”)</p>
</div></blockquote>
<p># This module allows for the calibrator to save be saved as part of
# Tensorflow Hub (this will allow it to be used in further steps)
def calibrator_module():</p>
<blockquote>
<div><p># Note that this is usually expecting a sparse_placeholder
inputs = tf.sparse_placeholder(tf.float32)
calibrator_layer = self.to_layer()
output = calibrator_layer(inputs)
# creates the signature to the calibrator module
hub.add_signature(inputs=inputs, outputs=output, name=name)</p>
</div></blockquote>
<p># exports the module to the save_dir
spec = hub.create_module_spec(calibrator_module)
with tf.Graph().as_default():</p>
<blockquote>
<div><p>module = hub.Module(spec)
with tf.Session() as session:</p>
<blockquote>
<div><p>module.export(save_dir, session)</p>
</div></blockquote>
</div></blockquote>
</dd>
<dt>def write_summary(self, writer, sess=None):</dt><dd><p>“””
This method is called by save() to write tensorboard summaries to disk.
See MDLCalibrator.write_summary for an example.
By default, the method does nothing. It can be overloaded by child-classes.</p>
<dl class="simple">
<dt>Arguments:</dt><dd><dl class="simple">
<dt>writer:</dt><dd><p><a class="reference external" href="https://www.tensorflow.org/versions/master/api_docs/python/tf/summary/FileWriter">tf.summary.FilteWriter</a>
instance.
The <code class="docutils literal notranslate"><span class="pre">writer</span></code> is used to add summaries to event files for inclusion in tensorboard.</p>
</dd>
<dt>sess (optional):</dt><dd><p><a class="reference external" href="https://www.tensorflow.org/versions/master/api_docs/python/tf/Session">tf.Session</a>
instance. The <code class="docutils literal notranslate"><span class="pre">sess</span></code> is used to produces summaries for the writer.</p>
</dd>
</dl>
</dd>
</dl>
<p>“””</p>
</dd>
</dl>
</dd>
</dl>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../_sources/twml/twml/contrib/calibrators/calibrator.py.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>