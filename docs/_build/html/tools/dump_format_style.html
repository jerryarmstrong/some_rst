<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/tools/dump_format_style.py &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-tools-dump-format-style-py">
<h1>docs/tools/dump_format_style.py<a class="headerlink" href="#docs-tools-dump-format-style-py" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2018-11-26 16:38:37</p>
<p>Contents:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
</pre></div>
</div>
<p># A tool to parse the FormatStyle struct from Format.h and update the
# documentation in ../ClangFormatStyleOptions.rst automatically.
# Run from the directory in which this file is located to update the docs.</p>
<p>import collections
import os
import re
import urllib2</p>
<p>CLANG_DIR = os.path.join(os.path.dirname(__file__), ‘../..’)
FORMAT_STYLE_FILE = os.path.join(CLANG_DIR, ‘include/clang/Format/Format.h’)
INCLUDE_STYLE_FILE = os.path.join(CLANG_DIR, ‘include/clang/Tooling/Inclusions/IncludeStyle.h’)
DOC_FILE = os.path.join(CLANG_DIR, ‘docs/ClangFormatStyleOptions.rst’)</p>
<dl>
<dt>def substitute(text, tag, contents):</dt><dd><p>replacement = ‘n.. START_%snn%snn.. END_%sn’ % (tag, contents, tag)
pattern = r’n.. START_%sn.*n.. END_%sn’ % (tag, tag)
return re.sub(pattern, ‘%s’, text, flags=re.S) % replacement</p>
</dd>
<dt>def doxygen2rst(text):</dt><dd><p>text = re.sub(r’&lt;tt&gt;s*(.*?)s*&lt;/tt&gt;’, r’<code class="docutils literal notranslate"><span class="pre">\1</span></code>’, text)
text = re.sub(r’\c ([^ ,;.]+)’, r’<code class="docutils literal notranslate"><span class="pre">\1</span></code>’, text)
text = re.sub(r’\w+ ‘, ‘’, text)
return text</p>
</dd>
<dt>def indent(text, columns, indent_first_line=True):</dt><dd><p>indent = ‘ ‘ * columns
s = re.sub(r’n([^n])’, ‘n’ + indent + ‘\1’, text, flags=re.S)
if not indent_first_line or s.startswith(’n’):</p>
<blockquote>
<div><p>return s</p>
</div></blockquote>
<p>return indent + s</p>
</dd>
<dt>class Option:</dt><dd><dl>
<dt>def __init__(self, name, type, comment):</dt><dd><p>self.name = name
self.type = type
self.comment = comment.strip()
self.enum = None
self.nested_struct = None</p>
</dd>
<dt>def __str__(self):</dt><dd><dl class="simple">
<dt>s = ‘<strong>%s</strong> (<code class="docutils literal notranslate"><span class="pre">%s</span></code>)n%s’ % (self.name, self.type,</dt><dd><p>doxygen2rst(indent(self.comment, 2)))</p>
</dd>
<dt>if self.enum:</dt><dd><p>s += indent(’nnPossible values:nn%sn’ % self.enum, 2)</p>
</dd>
<dt>if self.nested_struct:</dt><dd><dl class="simple">
<dt>s += indent(’nnNested configuration flags:nn%sn’ %self.nested_struct,</dt><dd><ol class="arabic simple" start="2">
<li></li>
</ol>
</dd>
</dl>
</dd>
</dl>
<p>return s</p>
</dd>
</dl>
</dd>
<dt>class NestedStruct:</dt><dd><dl class="simple">
<dt>def __init__(self, name, comment):</dt><dd><p>self.name = name
self.comment = comment.strip()
self.values = []</p>
</dd>
<dt>def __str__(self):</dt><dd><p>return ‘n’.join(map(str, self.values))</p>
</dd>
</dl>
</dd>
<dt>class NestedField:</dt><dd><dl class="simple">
<dt>def __init__(self, name, comment):</dt><dd><p>self.name = name
self.comment = comment.strip()</p>
</dd>
<dt>def __str__(self):</dt><dd><dl class="simple">
<dt>return ‘n* <code class="docutils literal notranslate"><span class="pre">%s</span></code> %s’ % (</dt><dd><p>self.name,
doxygen2rst(indent(self.comment, 2, indent_first_line=False)))</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>class Enum:</dt><dd><dl class="simple">
<dt>def __init__(self, name, comment):</dt><dd><p>self.name = name
self.comment = comment.strip()
self.values = []</p>
</dd>
<dt>def __str__(self):</dt><dd><p>return ‘n’.join(map(str, self.values))</p>
</dd>
</dl>
</dd>
<dt>class EnumValue:</dt><dd><dl class="simple">
<dt>def __init__(self, name, comment):</dt><dd><p>self.name = name
self.comment = comment</p>
</dd>
<dt>def __str__(self):</dt><dd><dl class="simple">
<dt>return ‘* <code class="docutils literal notranslate"><span class="pre">%s</span></code> (in configuration: <code class="docutils literal notranslate"><span class="pre">%s</span></code>)n%s’ % (</dt><dd><p>self.name,
re.sub(‘.*_’, ‘’, self.name),
doxygen2rst(indent(self.comment, 2)))</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>def clean_comment_line(line):</dt><dd><p>match = re.match(r’^/// \code({.(w+)})?$’, line)
if match:</p>
<blockquote>
<div><p>lang = match.groups()[1]
if not lang:</p>
<blockquote>
<div><p>lang = ‘c++’</p>
</div></blockquote>
<p>return ‘n.. code-block:: %snn’ % lang</p>
</div></blockquote>
<dl class="simple">
<dt>if line == ‘/// \endcode’:</dt><dd><p>return ‘’</p>
</dd>
</dl>
<p>return line[4:] + ‘n’</p>
</dd>
<dt>def read_options(header):</dt><dd><dl class="simple">
<dt>class State:</dt><dd><p>BeforeStruct, Finished, InStruct, InNestedStruct, InNestedFieldComent, InFieldComment, InEnum, InEnumMemberComment = range(8)</p>
</dd>
</dl>
<p>state = State.BeforeStruct</p>
<p>options = []
enums = {}
nested_structs = {}
comment = ‘’
enum = None
nested_struct = None</p>
<dl>
<dt>for line in header:</dt><dd><p>line = line.strip()
if state == State.BeforeStruct:</p>
<blockquote>
<div><dl class="simple">
<dt>if line == ‘struct FormatStyle {’ or line == ‘struct IncludeStyle {‘:</dt><dd><p>state = State.InStruct</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>elif state == State.InStruct:</dt><dd><dl class="simple">
<dt>if line.startswith(‘///’):</dt><dd><p>state = State.InFieldComment
comment = clean_comment_line(line)</p>
</dd>
<dt>elif line == ‘};’:</dt><dd><p>state = State.Finished
break</p>
</dd>
</dl>
</dd>
<dt>elif state == State.InFieldComment:</dt><dd><dl>
<dt>if line.startswith(‘///’):</dt><dd><p>comment += clean_comment_line(line)</p>
</dd>
<dt>elif line.startswith(‘enum’):</dt><dd><p>state = State.InEnum
name = re.sub(r’enums+(w+)s*{’, ‘\1’, line)
enum = Enum(name, comment)</p>
</dd>
<dt>elif line.startswith(‘struct’):</dt><dd><p>state = State.InNestedStruct
name = re.sub(r’structs+(w+)s*{’, ‘\1’, line)
nested_struct = NestedStruct(name, comment)</p>
</dd>
<dt>elif line.endswith(‘;’):</dt><dd><p>state = State.InStruct
field_type, field_name = re.match(r’([&lt;&gt;:w(,s)]+)s+(w+);’,</p>
<blockquote>
<div><p>line).groups()</p>
</div></blockquote>
<p>option = Option(str(field_name), str(field_type), comment)
options.append(option)</p>
</dd>
<dt>else:</dt><dd><p>raise Exception(‘Invalid format, expected comment, field or enum’)</p>
</dd>
</dl>
</dd>
<dt>elif state == State.InNestedStruct:</dt><dd><dl class="simple">
<dt>if line.startswith(‘///’):</dt><dd><p>state = State.InNestedFieldComent
comment = clean_comment_line(line)</p>
</dd>
<dt>elif line == ‘};’:</dt><dd><p>state = State.InStruct
nested_structs[nested_struct.name] = nested_struct</p>
</dd>
</dl>
</dd>
<dt>elif state == State.InNestedFieldComent:</dt><dd><dl class="simple">
<dt>if line.startswith(‘///’):</dt><dd><p>comment += clean_comment_line(line)</p>
</dd>
<dt>else:</dt><dd><p>state = State.InNestedStruct
nested_struct.values.append(NestedField(line.replace(‘;’, ‘’), comment))</p>
</dd>
</dl>
</dd>
<dt>elif state == State.InEnum:</dt><dd><dl class="simple">
<dt>if line.startswith(‘///’):</dt><dd><p>state = State.InEnumMemberComment
comment = clean_comment_line(line)</p>
</dd>
<dt>elif line == ‘};’:</dt><dd><p>state = State.InStruct
enums[enum.name] = enum</p>
</dd>
<dt>else:</dt><dd><p>raise Exception(‘Invalid format, expected enum field comment or };’)</p>
</dd>
</dl>
</dd>
<dt>elif state == State.InEnumMemberComment:</dt><dd><dl class="simple">
<dt>if line.startswith(‘///’):</dt><dd><p>comment += clean_comment_line(line)</p>
</dd>
<dt>else:</dt><dd><p>state = State.InEnum
enum.values.append(EnumValue(line.replace(‘,’, ‘’), comment))</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>if state != State.Finished:</dt><dd><p>raise Exception(‘Not finished by the end of file’)</p>
</dd>
<dt>for option in options:</dt><dd><dl>
<dt>if not option.type in [‘bool’, ‘unsigned’, ‘int’, ‘std::string’,</dt><dd><blockquote>
<div><p>‘std::vector&lt;std::string&gt;’,
‘std::vector&lt;IncludeCategory&gt;’,
‘std::vector&lt;RawStringFormat&gt;’]:</p>
</div></blockquote>
<dl class="simple">
<dt>if enums.has_key(option.type):</dt><dd><p>option.enum = enums[option.type]</p>
</dd>
<dt>elif nested_structs.has_key(option.type):</dt><dd><p>option.nested_struct = nested_structs[option.type]</p>
</dd>
<dt>else:</dt><dd><p>raise Exception(‘Unknown type: %s’ % option.type)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p>return options</p>
</dd>
</dl>
<p>options = read_options(open(FORMAT_STYLE_FILE))
options += read_options(open(INCLUDE_STYLE_FILE))</p>
<p>options = sorted(options, key=lambda x: x.name)
options_text = ‘nn’.join(map(str, options))</p>
<p>contents = open(DOC_FILE).read()</p>
<p>contents = substitute(contents, ‘FORMAT_STYLE_OPTIONS’, options_text)</p>
<dl class="simple">
<dt>with open(DOC_FILE, ‘wb’) as output:</dt><dd><p>output.write(contents)</p>
</dd>
</dl>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/tools/dump_format_style.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>