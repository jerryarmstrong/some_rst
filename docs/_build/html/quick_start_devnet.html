<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/quick_start_devnet.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-quick-start-devnet-md">
<h1>docs/quick_start_devnet.md<a class="headerlink" href="#docs-quick-start-devnet-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-12-05 19:44:34</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Quick Start</span>
</pre></div>
</div>
<p>## Setup Environment</p>
<ol class="arabic simple">
<li><p>Clone the repository from <a class="reference external" href="https://github.com/solana-labs/farms.git">https://github.com/solana-labs/farms.git</a></p></li>
<li><p>Install the latest Solana tools from <a class="reference external" href="https://docs.solana.com/cli/install-solana-cli-tools">https://docs.solana.com/cli/install-solana-cli-tools</a>. If you already have Solana tools, run <cite>solana-install update</cite> to get the latest compatible version.</p></li>
<li><p>Install the latest Rust stable from <a class="reference external" href="https://rustup.rs/">https://rustup.rs/</a>. If you already have Rust, run <cite>rustup update</cite> to get the latest version.</p></li>
<li><p>Install the <cite>libudev</cite> development package for your distribution (<cite>libudev-dev</cite> on Debian-derived distros, <cite>libudev-devel</cite> on Redhat-derived).</p></li>
<li><p>Install the <cite>libsqlite3</cite> development package for your distribution (<cite>libsqlite3-dev</cite> on Debian-derived distros, <cite>sqlite-devel</cite> on Redhat-derived).</p></li>
<li><p>If you get an error about missing <cite>libssl.so.1.1</cite> file while building on-chain programs, install libssl1.1 package. It is missing in the standard repositories for the most recent versions of Ubuntu, so you might need to install it manually like this:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">wget</span> <span class="pre">http://nz2.archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1l-1ubuntu1.5_amd64.deb</span>
<span class="pre">sudo</span> <span class="pre">dpkg</span> <span class="pre">-i</span> <span class="pre">./libssl1.1_1.1.1l-1ubuntu1.5_amd64.deb</span>
<span class="pre">`</span></code></p>
<p>## Build</p>
<p>Before starting the build, set <cite>MAIN_ROUTER_ID</cite> and <cite>MAIN_ROUTER_ADMIN</cite> environment variables. They should point to the existing Main Router program and admin account or generate a new set of keys if you plan to maintain your own version of the reference database:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">main_admin.json</span>
<span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">main_router.json</span>
<span class="pre">`</span></code></p>
<p>To build all of the off-chain libraries and programs, run the <cite>cargo build</cite> command from the <cite>farms</cite> directory:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">export</span> <span class="pre">MAIN_ROUTER_ID=&quot;replace</span> <span class="pre">this</span> <span class="pre">with</span> <span class="pre">main</span> <span class="pre">router</span> <span class="pre">id</span> <span class="pre">(solana</span> <span class="pre">main_router.json</span> <span class="pre">address)&quot;</span>
<span class="pre">export</span> <span class="pre">MAIN_ROUTER_ADMIN=&quot;replace</span> <span class="pre">this</span> <span class="pre">with</span> <span class="pre">admin</span> <span class="pre">pubkey</span> <span class="pre">(solana</span> <span class="pre">main_admin.json</span> <span class="pre">address)&quot;</span>
<span class="pre">cd</span> <span class="pre">farms</span>
<span class="pre">cargo</span> <span class="pre">build</span> <span class="pre">--release</span>
<span class="pre">`</span></code></p>
<p>Binaries will be placed under <cite>farms/target/release</cite> directory. If you plan on using <cite>solana-farm-ctrl</cite> or <cite>solana-farm-client</cite> tools per the examples below, you might want to add the release path to your environment’s <cite>PATH</cite> variable:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">pushd</span> <span class="pre">target/release</span>
<span class="pre">export</span> <span class="pre">PATH=$PATH:$(pwd)</span>
<span class="pre">popd</span>
<span class="pre">`</span></code></p>
<p>Alternatively, you can execute instructions directly using [HTTP Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/http_client.md">https://github.com/solana-labs/farms/blob/master/docs/http_client.md</a>) or [Rust Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/rust_client.md">https://github.com/solana-labs/farms/blob/master/docs/rust_client.md</a>).</p>
<p>To build on-chain programs, use the standard <cite>cargo build-bpf</cite> command for Solana programs:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>sh
for program in router-<a href="#id5"><span class="problematic" id="id6">*</span></a>; do</p>
<blockquote>
<div><p>pushd $program &amp;&gt;/dev/null
cargo build-bpf
popd &amp;&gt;/dev/null</p>
</div></blockquote>
<p>done
<a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id9"><span class="problematic" id="id10">`</span></a></p>
<p>To build Vaults, specify an additional argument that tells the compiler which strategy needs to be built:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">pushd</span> <span class="pre">vaults</span>
<span class="pre">cargo</span> <span class="pre">build-bpf</span> <span class="pre">--no-default-features</span> <span class="pre">--features</span> <span class="pre">SBR-STAKE-LP-COMPOUND</span>
<span class="pre">popd</span>
<span class="pre">`</span></code></p>
<p>Every time you re-build the vault program with another strategy, it overwrites the same file (target/deploy/solana_vaults.so), so you should build and deploy multiple strategies one by one and specify which address to deploy to, e.g.:</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a>sh
pushd vaults &amp;&gt;/dev/null
for strategy in RDM SBR; do</p>
<blockquote>
<div><p>solana-keygen new -o vault_$strategy.json
cargo build-bpf –no-default-features –features $strategy-STAKE-LP-COMPOUND
solana program deploy –program-id vault_$strategy.json ../target/deploy/solana_vaults.so</p>
</div></blockquote>
<p>done
popd &amp;&gt;/dev/null
<a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">`</span></a></p>
<p>## Test</p>
<p>Tests are executed with the <cite>cargo test</cite> command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">cargo</span> <span class="pre">test</span>
<span class="pre">`</span></code></p>
<p>Integration tests are located in <cite>farm-client/tests</cite> directory and can be started as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">cargo</span> <span class="pre">test</span> <span class="pre">--</span> <span class="pre">--nocapture</span> <span class="pre">--test-threads=1</span> <span class="pre">--ignored</span>
<span class="pre">`</span></code></p>
<p>Remember that integration tests execute transactions on mainnet, which will cost you some SOL, and require on-chain programs and reference database to be deployed beforehand.</p>
<p>## Deploy</p>
<p>To deploy on-chain programs, use the standard <cite>solana program deploy</cite>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">target/deploy/solana_router_raydium.so</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">target/deploy/solana_router_saber.so</span>
<span class="pre">`</span></code></p>
<p>If you generated your own set of keys for Main Router ID and Main Router admin, you need to deploy the Main Router program while specifying the corresponding upgrade authority and program id:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--upgrade-authority</span> <span class="pre">main_admin.json</span> <span class="pre">--program-id</span> <span class="pre">main_router.json</span> <span class="pre">target/deploy/solana_router_main.so</span>
<span class="pre">`</span></code></p>
<p>## Upload Metadata</p>
<p>This project uses an on-chain reference database to store the required metadata. If you plan to maintain your own copy of the database (i.e., generated a new pair of Main Router keys and deployed Main Router), you need to initialize the storage and upload metadata. Otherwise, skip this step.</p>
<p>First, generate PDA addresses for the RefDB indexes:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">print-pda-all</span>
<span class="pre">`</span></code></p>
<p>Update <cite>farm-ctrl/metadata/programs/programs_dev.json</cite> with newly generated addresses and addresses of your deployed programs (anything that has a blank address in that file needs to be updated or deleted if not needed).</p>
<p>Initialize the storage (Note: it will cost you about 5 SOL):</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">--keypair</span> <span class="pre">main_admin.json</span> <span class="pre">init-all</span>
<span class="pre">`</span></code></p>
<p>Metadata for external protocols, like Raydium, needs to be extracted from relative sources. For convenience, scripts for data download and data itself are available in the <cite>farms/farm-ctrl/metadata</cite> directory.
To upload metadata, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Program</span> <span class="pre">farm-ctrl/metadata/programs/programs_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Token</span> <span class="pre">farm-ctrl/metadata/tokens/raydium/tokens_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Token</span> <span class="pre">farm-ctrl/metadata/tokens/raydium/lp_tokens_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Token</span> <span class="pre">farm-ctrl/metadata/tokens/saber/tokens_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Token</span> <span class="pre">farm-ctrl/metadata/pools/saber/pools_and_farms_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Pool</span> <span class="pre">farm-ctrl/metadata/pools/raydium/pools_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Farm</span> <span class="pre">farm-ctrl/metadata/farms/raydium/farms_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Pool</span> <span class="pre">farm-ctrl/metadata/pools/saber/pools_and_farms_dev.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">--skip-existing</span> <span class="pre">Farm</span> <span class="pre">farm-ctrl/metadata/pools/saber/pools_and_farms_dev.json</span>
<span class="pre">`</span></code></p>
<p>Metadata has interdependencies, so it needs to be uploaded sequentially as per the list above, don’t run it in parallel even for the data of the same type. Metadata upload will cost you some SOL, depending on the number of records. You can get the price per record (Target) and max number of records (Target Max) by running this command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">print-size-all</span>
<span class="pre">`</span></code></p>
<p>To generate metadata for all Raydium Vaults, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">./farm-ctrl/metadata/vaults/generate_vaults.py</span> <span class="pre">-v</span> <span class="pre">vaults_rdm.json</span> <span class="pre">-t</span> <span class="pre">tokens_rdm.json</span> <span class="pre">-a</span> <span class="pre">[VAULT_PROG_ID]</span> <span class="pre">-p</span> <span class="pre">RDM</span>
<span class="pre">`</span></code></p>
<p>And then upload it:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">--keypair</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">token</span> <span class="pre">tokens_rdm.json</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">--keypair</span> <span class="pre">main_admin.json</span> <span class="pre">load</span> <span class="pre">vault</span> <span class="pre">vaults_rdm.json</span>
<span class="pre">`</span></code></p>
<p>Similarly, metadata can be generated and uploaded for Saber Vaults. Also, it is possible to generate metadata only for a single Vault with:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">--keypair</span> <span class="pre">main_admin.json</span> <span class="pre">generate</span> <span class="pre">Vault</span> <span class="pre">[VAULT_PROGRAM_ADDRESS]</span> <span class="pre">[VAULT_NAME]</span> <span class="pre">[VAULT_TOKEN_NAME]</span>
<span class="pre">`</span></code></p>
<p>To verify metadata you can run <cite>solana-farm-ctrl list-all vault</cite> or <cite>solana-farm-ctrl get-all vault</cite>.</p>
<p>## Run</p>
<p>After metadata for Vaults and Vault tokens have been uploaded, Vaults need to be initialized with:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">vault-init</span> <span class="pre">all</span> <span class="pre">1</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">vault-init</span> <span class="pre">all</span> <span class="pre">2</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">vault-enable-deposits</span> <span class="pre">all</span>
<span class="pre">solana-farm-ctrl</span> <span class="pre">-k</span> <span class="pre">main_admin.json</span> <span class="pre">vault-enable-withdrawals</span> <span class="pre">all</span>
<span class="pre">`</span></code></p>
<p>And then, you can try one of the client commands to verify the installation:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-client</span> <span class="pre">deposit-vault</span> <span class="pre">[VAULT_NAME]</span> <span class="pre">[TOKEN_A_AMOUNT]</span> <span class="pre">0</span>
<span class="pre">solana-farm-client</span> <span class="pre">crank-vault</span> <span class="pre">[VAULT_NAME]</span> <span class="pre">1</span>
<span class="pre">solana-farm-client</span> <span class="pre">vault-info</span> <span class="pre">[VAULT_NAME]</span>
<span class="pre">solana-farm-client</span> <span class="pre">swap</span> <span class="pre">RDM</span> <span class="pre">SOL</span> <span class="pre">USDC</span> <span class="pre">0.1</span>
<span class="pre">`</span></code></p>
<p>For more information see [Vaults](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/vaults.md">https://github.com/solana-labs/farms/blob/master/docs/vaults.md</a>), for more usage examples see [Rust Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/rust_client.md">https://github.com/solana-labs/farms/blob/master/docs/rust_client.md</a>) or [HTTP Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/http_client.md">https://github.com/solana-labs/farms/blob/master/docs/http_client.md</a>).</p>
<p>To use HTTP RPC service, start it with:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">solana-farm-rpc</span> <span class="pre">--farm-client-url</span> <span class="pre">https://api.mainnet-beta.solana.com</span> <span class="pre">--http-rpc-url</span> <span class="pre">http://0.0.0.0:9090</span>
<span class="pre">`</span></code></p>
<p>Note that RPC service should be adequately scaled and put behind a load balancer and HTTPS proxy for production use.</p>
<p>Open <a class="reference external" href="http://127.0.0.1:9090">http://127.0.0.1:9090</a> in a browser to see available methods. You can also use [SwaggerHub](<a class="reference external" href="https://app.swaggerhub.com/apis-docs/ska22/SolanaFarms/0.1">https://app.swaggerhub.com/apis-docs/ska22/SolanaFarms/0.1</a>) to call any method interactively. Swagger schema is available in <cite>farms/farm-rpc/swagger.yaml</cite>.</p>
<p>## Further Steps</p>
<p>Now, when everything is up and running, you may also consider:</p>
<ul class="simple">
<li><p>Write [HTTP Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/http_client.md">https://github.com/solana-labs/farms/blob/master/docs/http_client.md</a>) or [Rust Client](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/rust_client.md">https://github.com/solana-labs/farms/blob/master/docs/rust_client.md</a>)</p></li>
<li><p>Initialize a decentralized [Fund](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/fund.md">https://github.com/solana-labs/farms/blob/master/docs/fund.md</a>)</p></li>
<li><p>Enable [Multisig](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/multisig.md">https://github.com/solana-labs/farms/blob/master/docs/multisig.md</a>) for admin operations</p></li>
<li><p>Enable [Governance / DAO](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/governance.md">https://github.com/solana-labs/farms/blob/master/docs/governance.md</a>)</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/quick_start_devnet.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>