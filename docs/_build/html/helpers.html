<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/helpers.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-helpers-md">
<h1>docs/helpers.md<a class="headerlink" href="#docs-helpers-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-07-27 15:49:41</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Umi helpers</span>
</pre></div>
</div>
<p>On top of the core interfaces, Umi provides a set of helper functions that can be used to make working with Solana programs easier.</p>
<p>## Amounts</p>
<p>An <cite>Amount</cite> is a special type that allows us to define big decimal numbers. It does this by representing the number in its lowest possible unit (e.g. lamports) and then keeping track of the decimal number of that unit (e.g. 9). This allows for a more accurate representation of the number and avoids JavaScript rounding errors caused by IEEE 754 floating point numbers. It also uses a string identifier to ensure that we are dealing with amounts in the same unit when performing operations. Here’s how the <cite>Amount</cite> generic type is defined:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>ts
type AmountIdentifier = ‘SOL’ | ‘USD’ | ‘%’ | ‘splToken’ | string;
type AmountDecimals = number;
type Amount&lt;</p>
<blockquote>
<div><p>I extends AmountIdentifier = AmountIdentifier,
D extends AmountDecimals = AmountDecimals</p>
</div></blockquote>
<dl class="simple">
<dt>&gt; = {</dt><dd><p>/** The amount in its lower possible unit such that it does not contain decimals. <em>/
basisPoints: bigint;
/*</em> The identifier of the amount. <em>/
identifier: I;
/*</em> The number of decimals in the amount. <a href="#id5"><span class="problematic" id="id6">*</span></a>/
decimals: D;</p>
</dd>
</dl>
<section id="id7">
<h2>};<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h2>
<p>Umi also provides specific versions of this <cite>Amount</cite> type for specific cases like SOLs and USDs.</p>
<p><code class="docutils literal notranslate"><span class="pre">`ts</span>
<span class="pre">type</span> <span class="pre">SolAmount</span> <span class="pre">=</span> <span class="pre">Amount&lt;'SOL',</span> <span class="pre">9&gt;;</span>
<span class="pre">type</span> <span class="pre">UsdAmount</span> <span class="pre">=</span> <span class="pre">Amount&lt;'USD',</span> <span class="pre">2&gt;;</span>
<span class="pre">type</span> <span class="pre">PercentAmount&lt;D</span> <span class="pre">extends</span> <span class="pre">AmountDecimals&gt;</span> <span class="pre">=</span> <span class="pre">Amount&lt;'%',</span> <span class="pre">D&gt;;</span>
<span class="pre">`</span></code></p>
<p>To make it easier for developers to handle amounts, Umi provides a set of helper functions that can be used to create, format, and perform operations on amounts.</p>
<p>You may want to [check out the “Utils — Amounts” section of the API references](<a class="reference external" href="https://umi-docs.vercel.app/modules/umi.html">https://umi-docs.vercel.app/modules/umi.html</a>) to learn more about all these helpers but here’s a quick list of functions that can help create new amount types.</p>
<p><a href="#id8"><span class="problematic" id="id9">``</span></a><a href="#id10"><span class="problematic" id="id11">`</span></a>ts
// Creates an amount from basis points.
createAmount(123, ‘USD’, 2); // -&gt; Amount for “USD 1.23”</p>
<p>// Creates an amount from a decimal number.
createAmountFromDecimals(1.23, ‘USD’, 2); // -&gt; Amount for “USD 1.23”</p>
<p>// Helper functions to create USD amounts.
usd(1.23) // -&gt; Amount for “USD 1.23”</p>
<p>// Helper functions to handle SOL amounts.
sol(1.23) // -&gt; Amount for “1.23 SOL”
lamports(1_230_000_000) // -&gt; Amount for “1.23 SOL”</p>
<p>// Helper function to create percent amounts.
percentAmount(50.42); // -&gt; Amount for “50.42%”
percentAmount(50.42, 2); // -&gt; Amount for “50.42%”
percentAmount(50.42, 0); // -&gt; Amount for “50%”</p>
<p>// Helper function to create token amounts.
tokenAmount(123); // -&gt; Amount for “123 Tokens”
tokenAmount(123, ‘splToken.BONK’); // -&gt; Amount for “123 BONK”
tokenAmount(123.45, ‘splToken.BONK’, 2); // -&gt; Amount for “123.45 BONK”
<a href="#id12"><span class="problematic" id="id13">``</span></a><a href="#id14"><span class="problematic" id="id15">`</span></a></p>
<p>## Options</p>
<p>In Rust, we define optional values as an <cite>Option&lt;T&gt;</cite> enum which can either be <cite>Some(T)</cite> or <cite>None</cite>. This is usually represented as <cite>T | null</cite> in the JavaScript world. The issue with this approach is it doesn’t work with nested options. For instance, an <cite>Option&lt;Option&lt;T&gt;&gt;</cite> in Rust would become a <cite>T | null | null</cite> in JavaScript which is equivalent to <cite>T | null</cite>. That means, there is no way for us to represent the <cite>Some(None)</cite> value in JavaScript or any other nested option.</p>
<p>To solve this issue, Umi provides [an <cite>Option&lt;T&gt;</cite> union type](<a class="reference external" href="https://umi-docs.vercel.app/types/umi.Option.html">https://umi-docs.vercel.app/types/umi.Option.html</a>) that works very similarly to the Rust <cite>Option&lt;T&gt;</cite> type. It is defined as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">`ts</span>
<span class="pre">type</span> <span class="pre">Option&lt;T&gt;</span> <span class="pre">=</span> <span class="pre">Some&lt;T&gt;</span> <span class="pre">|</span> <span class="pre">None;</span>
<span class="pre">type</span> <span class="pre">Some&lt;T&gt;</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">__option:</span> <span class="pre">'Some';</span> <span class="pre">value:</span> <span class="pre">T</span> <span class="pre">};</span>
<span class="pre">type</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">__option:</span> <span class="pre">'None'</span> <span class="pre">};</span>
<span class="pre">`</span></code></p>
<p>To improve the developer experience, Umi offers a <cite>some</cite> and <cite>none</cite> function to create options. The type <cite>T</cite> of the option can either be inferred by TypeScript or explicitly provided.</p>
<p><a href="#id16"><span class="problematic" id="id17">``</span></a><a href="#id18"><span class="problematic" id="id19">`</span></a>ts
// Create an option with a value.
some(‘Hello World’);
some&lt;number | string&gt;(123);</p>
<p>// Create an empty option.
none();
none&lt;number | string&gt;();
<a href="#id20"><span class="problematic" id="id21">``</span></a><a href="#id22"><span class="problematic" id="id23">`</span></a></p>
<p>Umi also provides a set of helper functions to verify and manipulate options.</p>
<p><a href="#id24"><span class="problematic" id="id25">``</span></a><cite>ts
// Check if an option is a `Some</cite> or <cite>None</cite>.
isSome(some(‘Hello World’)); // -&gt; true
isSome(none()); // -&gt; false
isNone(some(‘Hello World’)); // -&gt; false
isNone(none()); // -&gt; true</p>
<p>// Unwrap the value of an option if it is a <cite>Some</cite> or return null.
// Supports custom fallback values for <cite>None</cite>.
unwrapOption(some(‘Hello World’)) // -&gt; ‘Hello World’
unwrapOption(none()) // -&gt; null
unwrapOption(some(‘Hello World’), () =&gt; ‘Default’); // -&gt; ‘Hello World’
unwrapOption(none(), () =&gt; ‘Default’); // -&gt; ‘Default’</p>
<p>// Same as <cite>unwrapOption</cite> but recursively (without mutating the original object/array).
// Also supports custom fallback values for <cite>None</cite>.
unwrapOptionRecursively({</p>
<blockquote>
<div><p>a: ‘hello’,
b: none&lt;string&gt;(),
c: [{ c1: some(42) }, { c2: none&lt;number&gt;() }],</p>
</div></blockquote>
<p>}) // -&gt; { a: ‘hello’, b: null, c: [{ c1: 42 }, { c2: null }] }
<a href="#id26"><span class="problematic" id="id27">``</span></a><a href="#id28"><span class="problematic" id="id29">`</span></a></p>
<p>## DateTimes</p>
<p>Umi provides a <cite>DateTime</cite> type that can be used to represent a date and time using a timestamp in seconds. It is simply defined as a <cite>bigint</cite> number and offers a set of helper functions to create and format date times.</p>
<p><a href="#id30"><span class="problematic" id="id31">``</span></a><a href="#id32"><span class="problematic" id="id33">`</span></a>ts
// Create a new DateTime.
dateTime(1680097346);
dateTime(new Date(Date.now()));
dateTime(“2021-12-31T23:59:59.000Z”);</p>
<p>// Create a new DateTime for the current time.
now();</p>
<p>// Format a DateTime.
formatDateTime(now());
formatDateTime(now(), ‘fr-FR’, myFormatOptions);
<a href="#id34"><span class="problematic" id="id35">``</span></a><a href="#id36"><span class="problematic" id="id37">`</span></a></p>
<p>## GpaBuilders</p>
<p>To help prepare <cite>getProgramAccounts</cite> RPC requests, Umi provides [an immutable <cite>GpaBuilder</cite> helper class](<a class="reference external" href="https://umi-docs.vercel.app/classes/umi.GpaBuilder.html">https://umi-docs.vercel.app/classes/umi.GpaBuilder.html</a>). It can be used to add filters, slice data and fetch the raw accounts whilst mapping them to whatever we want. Here are some examples.</p>
<p><a href="#id38"><span class="problematic" id="id39">``</span></a><a href="#id40"><span class="problematic" id="id41">`</span></a>ts
// Get all accounts for a program.
await gpaBuilder(umi, programId).get();</p>
<p>// Get the first 32 bytes of accounts that are 500 bytes long.
await gpaBuilder(umi, programId)</p>
<blockquote>
<div><p>.slice(0, 32)
.whereSize(500)
.get();</p>
</div></blockquote>
<p>// Get the public keys of accounts that have a given public key at offset 32.
await gpaBuilder(umi, programId)</p>
<blockquote>
<div><p>.withoutData()
.where(32, myPublicKey)
.getPublicKey();</p>
</div></blockquote>
<p>// Get the first 32 bytes of the account data as public keys.
await gpaBuilder(umi, programId)</p>
<blockquote>
<div><p>.slice(0, 32)
.getDataAsPublicKey();</p>
</div></blockquote>
<p>// Get the second byte of the account data and multiply it by 2.
await gpaBuilder(umi, programId)</p>
<blockquote>
<div><p>.slice(1, 1)
.getAndMap((n) =&gt; n * 2);</p>
</div></blockquote>
<p><a href="#id42"><span class="problematic" id="id43">``</span></a><a href="#id44"><span class="problematic" id="id45">`</span></a></p>
<p><cite>GpaBuilder`s can also be told how to deserialize a raw account into a deserialized account via the `deserializeUsing</cite> method. Once a deserialization callback was provided, the <cite>getDeserialized</cite> method can be used to fetch the deserialized accounts.</p>
<p><a href="#id46"><span class="problematic" id="id47">``</span></a><a href="#id48"><span class="problematic" id="id49">`</span></a>ts
const metadataGpaBuilder = gpaBuilder(umi, programId)</p>
<blockquote>
<div><p>.deserializeUsing&lt;Metadata&gt;((account) =&gt; deserializeMetadata(umi, account));</p>
</div></blockquote>
<p>const accounts: Metadata[] = await metadataGpaBuilder.getDeserialized();
<a href="#id50"><span class="problematic" id="id51">``</span></a><a href="#id52"><span class="problematic" id="id53">`</span></a></p>
<p>Additionally, we can pass a set of fields with their offsets to a <cite>GpaBuilder</cite> to improve the developer experience around filtering and slicing data. To do so, we can use the <cite>registerFields</cite> method. For instance, say we know that starting from byte 16, the next 32 bytes represent a <cite>name</cite> via a fixed size string and the next 4 bytes after that represent an <cite>age</cite>. Here’s how we could register those fields.</p>
<p><a href="#id54"><span class="problematic" id="id55">``</span></a><a href="#id56"><span class="problematic" id="id57">`</span></a>ts
import { gpaBuilder } from <a class="reference external" href="mailto:'&#37;&#52;&#48;metaplex-foundation/umi">‘<span>&#64;</span>metaplex-foundation/umi</a>’;
import { string, u32 } from <a class="reference external" href="mailto:'&#37;&#52;&#48;metaplex-foundation/umi/serializers">‘<span>&#64;</span>metaplex-foundation/umi/serializers</a>’;</p>
<dl>
<dt>const myGpaBuilderWithFields = gpaBuilder(umi, programId)</dt><dd><dl class="simple">
<dt>.registerFields&lt;{ name: string; age: number; }&gt;({</dt><dd><p>name: [16, string({ size: 32 })],
age: [48, u32()],</p>
</dd>
</dl>
<p>})</p>
</dd>
</dl>
<p><a href="#id58"><span class="problematic" id="id59">``</span></a><a href="#id60"><span class="problematic" id="id61">`</span></a></p>
<p>Once the fields are registered, we can use the <cite>whereField</cite> and <cite>sliceField</cite> methods to filter and slice data using fields. Not only it will know which offset to use but how to serialize its value.</p>
<p><a href="#id62"><span class="problematic" id="id63">``</span></a><a href="#id64"><span class="problematic" id="id65">`</span></a>ts
// Get the name of accounts that have an age of 42.
await myGpaBuilderWithFields</p>
<blockquote>
<div><p>.whereField(‘age’, 42)
.sliceField(‘name’)
.get();</p>
</div></blockquote>
<p><a href="#id66"><span class="problematic" id="id67">``</span></a><a href="#id68"><span class="problematic" id="id69">`</span></a></p>
<p>&lt;p align=”center”&gt;
&lt;strong&gt;Next: &lt;a href=”./web3js-adapters.md”&gt;Web3.js adapters ≫&lt;/a&gt;&lt;/strong&gt;
&lt;/p&gt;</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/helpers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>