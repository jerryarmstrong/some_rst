<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/static/katex/contrib/mhchem.js &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-static-katex-contrib-mhchem-js">
<h1>docs/static/katex/contrib/mhchem.js<a class="headerlink" href="#docs-static-katex-contrib-mhchem-js" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">webpackUniversalModuleDefinition</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="w"> </span><span class="nx">factory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">exports</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">factory</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;katex&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">define</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;function&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span>
<span class="w">            </span><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;katex&quot;</span><span class="p">],</span><span class="w"> </span><span class="nx">factory</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">exports</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">factory</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;katex&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">factory</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="s2">&quot;katex&quot;</span><span class="p">]);</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">exports</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">exports</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">root</span><span class="p">)[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>})((typeof self !== ‘undefined’ ? self : this), function(__WEBPACK_EXTERNAL_MODULE__0__) {
return /<strong>**</strong>/ (function(modules) { // webpackBootstrap
/<strong>**</strong>/        // The module cache
/<strong>**</strong>/        var installedModules = {};
/<strong>**</strong>/
/<strong>**</strong>/        // The require function
/<strong>**</strong>/        function __webpack_require__(moduleId) {
/<strong>**</strong>/
/<strong>**</strong>/                // Check if module is in cache
/<strong>**</strong>/                if(installedModules[moduleId]) {
/<strong>**</strong>/                        return installedModules[moduleId].exports;
/<strong>**</strong>/                }
/<strong>**</strong>/                // Create a new module (and put it into the cache)
/<strong>**</strong>/                var module = installedModules[moduleId] = {
/<strong>**</strong>/                        i: moduleId,
/<strong>**</strong>/                        l: false,
/<strong>**</strong>/                        exports: {}
/<strong>**</strong>/                };
/<strong>**</strong>/
/<strong>**</strong>/                // Execute the module function
/<strong>**</strong>/                modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/<strong>**</strong>/
/<strong>**</strong>/                // Flag the module as loaded
/<strong>**</strong>/                module.l = true;
/<strong>**</strong>/
/<strong>**</strong>/                // Return the exports of the module
/<strong>**</strong>/                return module.exports;
/<strong>**</strong>/        }
/<strong>**</strong>/
/<strong>**</strong>/
/<strong>**</strong>/        // expose the modules object (__webpack_modules__)
/<strong>**</strong>/        __webpack_require__.m = modules;
/<strong>**</strong>/
/<strong>**</strong>/        // expose the module cache
/<strong>**</strong>/        __webpack_require__.c = installedModules;
/<strong>**</strong>/
/<strong>**</strong>/        // define getter function for harmony exports
/<strong>**</strong>/        __webpack_require__.d = function(exports, name, getter) {
/<strong>**</strong>/                if(!__webpack_require__.o(exports, name)) {
/<strong>**</strong>/                        Object.defineProperty(exports, name, { enumerable: true, get: getter });
/<strong>**</strong>/                }
/<strong>**</strong>/        };
/<strong>**</strong>/
/<strong>**</strong>/        // define __esModule on exports
/<strong>**</strong>/        __webpack_require__.r = function(exports) {
/<strong>**</strong>/                if(typeof Symbol !== ‘undefined’ &amp;&amp; Symbol.toStringTag) {
/<strong>**</strong>/                        Object.defineProperty(exports, Symbol.toStringTag, { value: ‘Module’ });
/<strong>**</strong>/                }
/<strong>**</strong>/                Object.defineProperty(exports, ‘__esModule’, { value: true });
/<strong>**</strong>/        };
/<strong>**</strong>/
/<strong>**</strong>/        // create a fake namespace object
/<strong>**</strong>/        // mode &amp; 1: value is a module id, require it
/<strong>**</strong>/        // mode &amp; 2: merge all properties of value into the ns
/<strong>**</strong>/        // mode &amp; 4: return value when already ns object
/<strong>**</strong>/        // mode &amp; 8|1: behave like require
/<strong>**</strong>/        __webpack_require__.t = function(value, mode) {
/<strong>**</strong>/                if(mode &amp; 1) value = __webpack_require__(value);
/<strong>**</strong>/                if(mode &amp; 8) return value;
/<strong>**</strong>/                if((mode &amp; 4) &amp;&amp; typeof value === ‘object’ &amp;&amp; value &amp;&amp; value.__esModule) return value;
/<strong>**</strong>/                var ns = Object.create(null);
/<strong>**</strong>/                __webpack_require__.r(ns);
/<strong>**</strong>/                Object.defineProperty(ns, ‘default’, { enumerable: true, value: value });
/<strong>**</strong>/                if(mode &amp; 2 &amp;&amp; typeof value != ‘string’) for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/<strong>**</strong>/                return ns;
/<strong>**</strong>/        };
/<strong>**</strong>/
/<strong>**</strong>/        // getDefaultExport function for compatibility with non-harmony modules
/<strong>**</strong>/        __webpack_require__.n = function(module) {
/<strong>**</strong>/                var getter = module &amp;&amp; module.__esModule ?
/<strong>**</strong>/                        function getDefault() { return module[‘default’]; } :
/<strong>**</strong>/                        function getModuleExports() { return module; };
/<strong>**</strong>/                __webpack_require__.d(getter, ‘a’, getter);
/<strong>**</strong>/                return getter;
/<strong>**</strong>/        };
/<strong>**</strong>/
/<strong>**</strong>/        // Object.prototype.hasOwnProperty.call
/<strong>**</strong>/        __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/<strong>**</strong>/
/<strong>**</strong>/        // __webpack_public_path__
/<strong>**</strong>/        __webpack_require__.p = “”;
/<strong>**</strong>/
/<strong>**</strong>/
/<strong>**</strong>/        // Load entry module and return exports
/<strong>**</strong>/        return __webpack_require__(__webpack_require__.s = 1);
/<strong>**</strong>/ })
/<strong>********************************************************************</strong>/
/<strong>**</strong>/ ([
/* 0 <em>/
/**</em>/ (function(module, exports) {</p>
<p>module.exports = __WEBPACK_EXTERNAL_MODULE__0__;</p>
<p>/<strong>*/ }),
/* 1 */
/*</strong>/ (function(module, __webpack_exports__, __webpack_require__) {</p>
<p>“use strict”;
__webpack_require__.r(__webpack_exports__);
/* harmony import <em>/ var katex__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);
/</em> harmony import <em>/ var katex__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__</em>/__webpack_require__.n(katex__WEBPACK_IMPORTED_MODULE_0__);
/* eslint-disable <a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
<p>/* -<em>- Mode: Javascript; indent-tabs-mode:nil; js-indent-level: 2 -</em>- <a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
<p>/* vim: set ts=2 et sw=2 tw=80: <a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
<dl>
<dt>/<strong>*********************************************************</strong></dt><dd><ul class="simple">
<li></li>
<li><p>KaTeX mhchem.js</p></li>
<li></li>
<li><p>This file implements a KaTeX version of mhchem version 3.3.0.</p></li>
<li><p>It is adapted from MathJax/extensions/TeX/mhchem.js</p></li>
<li><p>It differs from the MathJax version as follows:</p></li>
<li><ol class="arabic simple">
<li><p>The interface is changed so that it can be called from KaTeX, not MathJax.</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>rlap and llap are replaced with mathrlap and mathllap.</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>Four lines of code are edited in order to use raisebox instead of raise.</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="4">
<li><p>The reaction arrow code is simplified. All reaction arrows are rendered</p></li>
</ol>
</li>
<li><p>using KaTeX extensible arrows instead of building non-extensible arrows.</p></li>
<li><ol class="arabic simple" start="5">
<li><p>tripledash vertical alignment is slightly adjusted.</p></li>
</ol>
</li>
<li></li>
<li><p>This code, as other KaTeX code, is released under the MIT license.</p></li>
<li></li>
<li><p>/<strong>*********************************************************</strong></p></li>
<li></li>
<li><p>MathJax/extensions/TeX/mhchem.js</p></li>
<li></li>
<li><p>Implements the ce command for handling chemical formulas</p></li>
<li><p>from the mhchem LaTeX package.</p></li>
<li></li>
<li></li>
<li></li>
<li><p>Copyright (c) 2011-2015 The MathJax Consortium</p></li>
<li><p>Copyright (c) 2015-2018 Martin Hensel</p></li>
<li></li>
<li><p>Licensed under the Apache License, Version 2.0 (the “License”);</p></li>
<li><p>you may not use this file except in compliance with the License.</p></li>
<li><p>You may obtain a copy of the License at</p></li>
<li></li>
<li><p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p></li>
<li></li>
<li><p>Unless required by applicable law or agreed to in writing, software</p></li>
<li><p>distributed under the License is distributed on an “AS IS” BASIS,</p></li>
<li><p>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p></li>
<li><p>See the License for the specific language governing permissions and</p></li>
<li><p>limitations under the License.</p></li>
</ul>
<p><a href="#id7"><span class="problematic" id="id8">*</span></a>/</p>
</dd>
</dl>
<p>//
// Coding Style
//   - use ‘’ for identifiers that can by minified/uglified
//   - use “” for strings that need to stay untouched
// version: “3.3.0” for MathJax and KaTeX
// Add ce, pu, and tripledash to the KaTeX macros.
katex__WEBPACK_IMPORTED_MODULE_0___default.a.__defineMacro(”\ce”, function (context) {</p>
<blockquote>
<div><p>return chemParse(context.consumeArgs(1)[0], “ce”);</p>
</div></blockquote>
<p>});</p>
<dl class="simple">
<dt>katex__WEBPACK_IMPORTED_MODULE_0___default.a.__defineMacro(”\pu”, function (context) {</dt><dd><p>return chemParse(context.consumeArgs(1)[0], “pu”);</p>
</dd>
</dl>
<p>}); //  Needed for bond for the ~ forms
//  Raise by 2.56mu, not 2mu. We’re raising a hyphen-minus, U+002D, not
//  a mathematical minus, U+2212. So we need that extra 0.56.</p>
<p>katex__WEBPACK_IMPORTED_MODULE_0___default.a.__defineMacro(”\tripledash”, “{\vphantom{-}\raisebox{2.56mu}{$\mkern2mu” + “\tiny\text{-}\mkern1mu\text{-}\mkern1mu\text{-}\mkern2mu$}}”);</p>
<blockquote>
<div><p>//</p>
</div></blockquote>
<p>//  This is the main function for handing the ce and pu commands.
//  It takes the argument to ce or pu and returns the corresponding TeX string.
//</p>
<dl>
<dt>var chemParse = function chemParse(tokens, stateMachine) {</dt><dd><p>// Recreate the argument string from KaTeX’s array of tokens.
var str = “”;
var expectedLoc = tokens[tokens.length - 1].loc.start;</p>
<dl>
<dt>for (var i = tokens.length - 1; i &gt;= 0; i–) {</dt><dd><dl class="simple">
<dt>if (tokens[i].loc.start &gt; expectedLoc) {</dt><dd><p>// context.consumeArgs has eaten a space.
str += “ “;
expectedLoc = tokens[i].loc.start;</p>
</dd>
</dl>
<p>}</p>
<p>str += tokens[i].text;
expectedLoc += tokens[i].text.length;</p>
</dd>
</dl>
<p>}</p>
<p>var tex = texify.go(mhchemParser.go(str, stateMachine));
return tex;</p>
</dd>
</dl>
<p>}; //
// Core parser for mhchem syntax  (recursive)
//</p>
<p>/** &#64;type {MhchemParser} <a href="#id9"><span class="problematic" id="id10">*</span></a>/</p>
<dl>
<dt>var mhchemParser = {</dt><dd><p>//
// Parses mchem ce syntax
//
// Call like
//   go(“H2O”);
//
go: function go(input, stateMachine) {</p>
<blockquote>
<div><dl class="simple">
<dt>if (!input) {</dt><dd><p>return [];</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (stateMachine === undefined) {</dt><dd><p>stateMachine = ‘ce’;</p>
</dd>
</dl>
<p>}</p>
<p>var state = ‘0’; //
// String buffers for parsing:
//
// buffer.a == amount
// buffer.o == element
// buffer.b == left-side superscript
// buffer.p == left-side subscript
// buffer.q == right-side subscript
// buffer.d == right-side superscript
//
// buffer.r == arrow
// buffer.rdt == arrow, script above, type
// buffer.rd == arrow, script above, content
// buffer.rqt == arrow, script below, type
// buffer.rq == arrow, script below, content
//
// <a href="#id85"><span class="problematic" id="id86">buffer.text_</span></a>
// buffer.rm
// etc.
//
// buffer.parenthesisLevel == int, starting at 0
// buffer.sb == bool, space before
// buffer.beginsWithBond == bool
//
// These letters are also used as state names.
//
// Other states:
// 0 == begin of main part (arrow/operator unlikely)
// 1 == next entity
// 2 == next entity (arrow/operator unlikely)
// 3 == next atom
// c == macro
//</p>
<p>/** &#64;type {Buffer} <a href="#id11"><span class="problematic" id="id12">*</span></a>/</p>
<p>var buffer = {};
buffer[‘parenthesisLevel’] = 0;
input = input.replace(/n/g, “ “);
input = input.replace(/[u2212u2013u2014u2010]/g, “-“);
input = input.replace(/[u2026]/g, “…”); //
// Looks through mhchemParser.transitions, to execute a matching action
// (recursive)
//</p>
<p>var lastInput;
var watchdog = 10;
/** &#64;type {ParserOutput[]} <a href="#id13"><span class="problematic" id="id14">*</span></a>/</p>
<p>var output = [];</p>
<dl>
<dt>while (true) {</dt><dd><dl class="simple">
<dt>if (lastInput !== input) {</dt><dd><p>watchdog = 10;
lastInput = input;</p>
</dd>
<dt>} else {</dt><dd><p>watchdog–;</p>
</dd>
</dl>
<p>} //
// Find actions in transition table
//</p>
<p>var machine = mhchemParser.stateMachines[stateMachine];
var t = machine.transitions[state] || machine.transitions[‘*’];</p>
<dl>
<dt>iterateTransitions: for (var i = 0; i &lt; t.length; i++) {</dt><dd><p>var matches = mhchemParser.patterns.match_(t[i].pattern, input);</p>
<dl>
<dt>if (matches) {</dt><dd><p>//
// Execute actions
//
var task = t[i].task;</p>
<dl>
<dt>for (var iA = 0; iA &lt; <a href="#id87"><span class="problematic" id="id88">task.action_</span></a>.length; iA++) {</dt><dd><p>var o; //
// Find and execute action
//</p>
<dl class="simple">
<dt>if (machine.actions[task.action_[iA].type_]) {</dt><dd><p>o = machine.actions[task.action_[iA].type_](buffer, <a href="#id89"><span class="problematic" id="id90">matches.match_</span></a>, task.action_[iA].option);</p>
</dd>
<dt>} else if (mhchemParser.actions[task.action_[iA].type_]) {</dt><dd><p>o = mhchemParser.actions[task.action_[iA].type_](buffer, <a href="#id91"><span class="problematic" id="id92">matches.match_</span></a>, task.action_[iA].option);</p>
</dd>
<dt>} else {</dt><dd><p>throw [“MhchemBugA”, “mhchem bug A. Please report. (” + task.action_[iA].type_ + “)”]; // Trying to use non-existing action</p>
</dd>
</dl>
<p>} //
// Add output
//</p>
<p>mhchemParser.concatArray(output, o);</p>
</dd>
</dl>
<p>} //
// Set next state,
// Shorten input,
// Continue with next character
//   (= apply only one transition per position)
//</p>
<p>state = task.nextState || state;</p>
<dl>
<dt>if (input.length &gt; 0) {</dt><dd><dl class="simple">
<dt>if (!task.revisit) {</dt><dd><p>input = matches.remainder;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (!task.toContinue) {</dt><dd><p>break iterateTransitions;</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else {</dt><dd><p>return output;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>} //
// Prevent infinite loop
//</p>
<dl class="simple">
<dt>if (watchdog &lt;= 0) {</dt><dd><p>throw [“MhchemBugU”, “mhchem bug U. Please report.”]; // Unexpected character</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
concatArray: function concatArray(a, b) {</p>
<blockquote>
<div><dl>
<dt>if (b) {</dt><dd><dl>
<dt>if (Array.isArray(b)) {</dt><dd><dl class="simple">
<dt>for (var iB = 0; iB &lt; b.length; iB++) {</dt><dd><p>a.push(b[iB]);</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else {</dt><dd><p>a.push(b);</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
patterns: {</p>
<blockquote>
<div><p>//
// Matching patterns
// either regexps or function that return null or {<a href="#id93"><span class="problematic" id="id94">match_</span></a>:”a”, remainder:”bc”}
//
patterns: {</p>
<blockquote>
<div><p>// property names must not look like integers (“2”) for correct property traversal order, later on
‘empty’: /^$/,
‘else’: /^./,
‘else2’: /^./,
‘space’: /^s/,
‘space A’: /^s(?=[A-Z\$])/,
‘space$’: /^s$/,
‘a-z’: /^[a-z]/,
‘x’: /^x/,
‘x$’: /^x$/,
‘i$’: /^i$/,
‘letters’: /^(?:[a-zA-Zu03B1-u03C9u0391-u03A9?&#64;]|(?:\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:s+|{}|(?![a-zA-Z]))))+/,
‘\greek’: /^\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:s+|{}|(?![a-zA-Z]))/,
‘one lowercase latin letter $’: /^(?:([a-z])(?:$|[^a-zA-Z]))$/,
‘$one lowercase latin letter$ $’: /^$(?:([a-z])(?:$|[^a-zA-Z]))$$/,
‘one lowercase greek letter $’: /^(?:$?[u03B1-u03C9]$?|$?\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega)s*$?)(?:s+|{}|(?![a-zA-Z]))$/,
‘digits’: /^[0-9]+/,
‘-9.,9’: /^[+-]?(?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:.[0-9]+))/,
‘-9.,9 no missing 0’: /^[+-]?[0-9]+(?:[.,][0-9]+)?/,
‘(-)(9.,9)(e)(99)’: function e99(input) {</p>
<blockquote>
<div><p>var m = input.match(/^(+-<a href="#id73"><span class="problematic" id="id74">|\+\/\-|</span></a>+|-<a href="#id75"><span class="problematic" id="id76">|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))?(\((?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))\))?(?:([eE]|</span></a>s*(*|x|\times|u00D7)s*10^)([+-]?[0-9]+|{[+-]?[0-9]+}))?/);</p>
<dl>
<dt>if (m &amp;&amp; m[0]) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id95"><span class="problematic" id="id96">match_</span></a>: m.splice(1),
remainder: input.substr(m[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</div></blockquote>
<p>},
‘(-)(9)^(-9)’: function _(input) {</p>
<blockquote>
<div><p>var m = input.match(/^(+-<a href="#id77"><span class="problematic" id="id78">|\+\/\-|</span></a>+|-<a href="#id79"><span class="problematic" id="id80">|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+)?)\^([+\-]?[0-9]+|</span></a>{[+-]?[0-9]+})/);</p>
<dl>
<dt>if (m &amp;&amp; m[0]) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id97"><span class="problematic" id="id98">match_</span></a>: m.splice(1),
remainder: input.substr(m[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</div></blockquote>
<p>},
‘state of aggregation $’: function stateOfAggregation$(input) {</p>
<blockquote>
<div><p>// … or crystal system
var a = mhchemParser.patterns.findObserveGroups(input, “”, /^([a-z]{1,3}(?=[),])/, “)”, “”); // (aq), (aq,$infty$), (aq, sat)</p>
<dl class="simple">
<dt>if (a &amp;&amp; a.remainder.match(/^($|[s,;)]}])/)) {</dt><dd><p>return a;</p>
</dd>
</dl>
<p>} //  AND end of ‘phrase’</p>
<p>var m = input.match(/^(?:((?:\cas?)?$[amothc]$))/); // OR crystal system ($o$) (ca$c$)</p>
<dl>
<dt>if (m) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id99"><span class="problematic" id="id100">match_</span></a>: m[0],
remainder: input.substr(m[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</div></blockquote>
<p>},
‘_{(state of aggregation)}$’: /^_{(([a-z]{1,3}))}/,
‘{[(’: /^(?:\{<a href="#id81"><span class="problematic" id="id82">|\[|</span></a>()/,
‘)]}’: /^(?:)|]|\})/,
‘, ‘: /^[,;]s*/,
‘,’: /^[,;]/,
‘.’: /^[.]/,
‘. ‘: /^([.u22C5u00B7u2022])s*/,
‘…’: /^...(?=$|[^.])/,
‘* ‘: /^([*])s*/,
‘^{(…)}’: function _(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “^{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘^($…$)’: function $$(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “^”, “$”, “$”, “”);</p>
</div></blockquote>
<p>},
‘^a’: /^^([0-9]+|[^\_])/,
‘^\x{}{}’: function x(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “^”, /^\[a-zA-Z]+{/, “}”, “”, “”, “{”, “}”, “”, true);</p>
</div></blockquote>
<p>},
‘^\x{}’: function x(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “^”, /^\[a-zA-Z]+{/, “}”, “”);</p>
</div></blockquote>
<p>},
‘^\x’: /^^(\[a-zA-Z]+)s*/,
‘^(-1)’: /^^(-?d+)/,
‘'’: /^’/,
‘_{(…)}’: function _(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “_{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘_($…$)’: function _$$(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “_”, “$”, “$”, “”);</p>
</div></blockquote>
<p>},
‘_9’: /^_([+-]?[0-9]+|[^\])/,
‘_\x{}{}’: function _X(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “_”, /^\[a-zA-Z]+{/, “}”, “”, “”, “{”, “}”, “”, true);</p>
</div></blockquote>
<p>},
‘_\x{}’: function _X(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “_”, /^\[a-zA-Z]+{/, “}”, “”);</p>
</div></blockquote>
<p>},
‘_\x’: /^_(\[a-zA-Z]+)s*/,
‘^_’: /^(?:^(?=_)|_(?=^)|[^_]$)/,
‘{}’: /^{}/,
‘{…}’: function _(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “”, “{”, “}”, “”);</p>
</div></blockquote>
<p>},
‘{(…)}’: function _(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘$…$’: function $$(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “”, “$”, “$”, “”);</p>
</div></blockquote>
<p>},
‘${(…)}$’: function $$(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “${”, “”, “”, “}$”);</p>
</div></blockquote>
<p>},
‘$(…)$’: function $$(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “$”, “”, “”, “$”);</p>
</div></blockquote>
<p>},
‘=&lt;&gt;’: /^[=&lt;&gt;]/,
‘#’: /^[#u2261]/,
‘+’: /^+/,
‘-$’: /^-(?=[s_},;]/]|$|([a-z]+))/,
// -space -, -; -] -/ -$ -state-of-aggregation
‘-9’: /^-(?=[0-9])/,
‘- orbital overlap’: /^-(?=(?:[spd]|sp)(?:$|[s,;)]}]))/,
‘-’: /^-/,
‘pm-operator’: /^(?:\pm|$\pm$|+-<a href="#id83"><span class="problematic" id="id84">|\+\/-)/,
'operator': /^(?:\+|(?:[\-=&lt;&gt;]|&lt;&lt;|</span></a>&gt;&gt;|\approx|$\approx$)(?=s|$|-?[0-9]))/,
‘arrowUpDown’: /^(?:v|(v)|^|(^))(?=$|[s,;)]}])/,
‘\bond{(…)}’: function bond(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\bond{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘-&gt;’: /^(?:&lt;-&gt;|&lt;–&gt;|-&gt;|&lt;-<a href="#id15"><span class="problematic" id="id16">|</span></a>&lt;=&gt;&gt;|&lt;&lt;=&gt;|&lt;=&gt;|[u2192u27F6u21CC])/,
‘CMT’: /^[CMT](?=[)/,
‘[(…)]’: function _(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “[”, “”, “”, “]”);</p>
</div></blockquote>
<p>},
‘1st-level escape’: /^(&amp;|\\|\hline)s*/,
‘\,’: /^(?:\[,;:])/,
// \x - but output no space before
‘\x{}{}’: function x(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “”, /^\[a-zA-Z]+{/, “}”, “”, “”, “{”, “}”, “”, true);</p>
</div></blockquote>
<p>},
‘\x{}’: function x(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “”, /^\[a-zA-Z]+{/, “}”, “”);</p>
</div></blockquote>
<p>},
‘\ca’: /^\ca(?:s+|(?![a-zA-Z]))/,
‘\x’: /^(?:\[a-zA-Z]+s*|\[_&amp;{}%])/,
‘orbital’: /^(?:[0-9]{1,2}[spdfgh]|[0-9]{0,2}sp)(?=$|[^a-zA-Z])/,
// only those with numbers in front, because the others will be formatted correctly anyway
‘others’: /^[/~|]/,
‘\frac{(…)}’: function frac(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\frac{”, “”, “”, “}”, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘\overset{(…)}’: function overset(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\overset{”, “”, “”, “}”, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
“\underset{(…)}”: function underset(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\underset{”, “”, “”, “}”, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
“\underbrace{(…)}”: function underbrace(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\underbrace{”, “”, “”, “}_”, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘\color{(…)}0’: function color0(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\color{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘\color{(…)}{(…)}1’: function color1(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\color{”, “”, “”, “}”, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘\color(…){(…)}2’: function color2(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\color”, “\”, “”, /^(?={)/, “{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘\ce{(…)}’: function ce(input) {</p>
<blockquote>
<div><p>return mhchemParser.patterns.findObserveGroups(input, “\ce{”, “”, “”, “}”);</p>
</div></blockquote>
<p>},
‘oxidation$’: /^(?:[+-][IVX]+|\pms*0|$\pm$s*0)$/,
‘d-oxidation$’: /^(?:[+-]?s?[IVX]+|\pms*0|$\pm$s*0)$/,
// 0 could be oxidation or charge
‘roman numeral’: /^[IVX]+/,
‘1/2$’: /^[+-]?(?:[0-9]+|$[a-z]$|[a-z])/[0-9]+(?:$[a-z]$|[a-z])?$/,
‘amount’: function amount(input) {</p>
<blockquote>
<div><p>var match; // e.g. 2, 0.5, 1/2, -2, n/2, +;  $a$ could be added later in parsing</p>
<p>match = input.match(/^(?:(?:(?:([+-]?[0-9]+/[0-9]+)|[+-]?(?:[0-9]+|$[a-z]$|[a-z])/[0-9]+|[+-]?[0-9]+[.,][0-9]+|[+-]?.[0-9]+|[+-]?[0-9]+)(?:[a-z](?=s*[A-Z]))?)|[+-]?[a-z](?=s*[A-Z])|+(?!s))/);</p>
<dl>
<dt>if (match) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id101"><span class="problematic" id="id102">match_</span></a>: match[0],
remainder: input.substr(match[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>var a = mhchemParser.patterns.findObserveGroups(input, “”, “$”, “$”, “”);</p>
<dl>
<dt>if (a) {</dt><dd><p>// e.g. $2n-1$, $-$
match = <a href="#id103"><span class="problematic" id="id104">a.match_</span></a>.match(/^$(?:(?[+-]?(?:[0-9]*[a-z]?[+-])?[0-9]*[a-z](?:[+-][0-9]*[a-z]?)?)?|+|-)$$/);</p>
<dl>
<dt>if (match) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id105"><span class="problematic" id="id106">match_</span></a>: match[0],
remainder: input.substr(match[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</div></blockquote>
<p>},
‘amount2’: function amount2(input) {</p>
<blockquote>
<div><p>return this[‘amount’](input);</p>
</div></blockquote>
<p>},
‘(KV letters),’: /^(?:[A-Z][a-z]{0,2}|i)(?=,)/,
‘formula$’: function formula$(input) {</p>
<blockquote>
<div><dl class="simple">
<dt>if (input.match(/^([a-z]+)$/)) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>} // state of aggregation = no formula</p>
<p>var match = input.match(/^(?:[a-z]|(?:[0-9+-,.()]+[a-z])+[0-9+-,.()]*|(?:[a-z][0-9+-,.()]+)+[a-z]?)$/);</p>
<dl>
<dt>if (match) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id107"><span class="problematic" id="id108">match_</span></a>: match[0],
remainder: input.substr(match[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</div></blockquote>
<p>},
‘uprightEntities’: /^(?:pH|pOH|pC|pK|iPr|iBu)(?=$|[^a-zA-Z])/,
‘/’: /^s*(/)s*/,
‘//’: /^s*(//)s*/,
‘*’: /^s*[<em>.]s</em>/</p>
</div></blockquote>
<p>},
findObserveGroups: function findObserveGroups(input, begExcl, begIncl, endIncl, endExcl, beg2Excl, beg2Incl, end2Incl, end2Excl, combine) {</p>
<blockquote>
<div><p>/** &#64;type {{(input: string, pattern: string | RegExp): string | string[] | null;}} <a href="#id17"><span class="problematic" id="id18">*</span></a>/
var _match = function _match(input, pattern) {</p>
<blockquote>
<div><dl>
<dt>if (typeof pattern === “string”) {</dt><dd><dl class="simple">
<dt>if (input.indexOf(pattern) !== 0) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>return pattern;</p>
</dd>
<dt>} else {</dt><dd><p>var match = input.match(pattern);</p>
<dl class="simple">
<dt>if (!match) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>return match[0];</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>};
/** &#64;type {{(input: string, i: number, endChars: string | RegExp): {endMatchBegin: number, endMatchEnd: number} | null;}} <a href="#id19"><span class="problematic" id="id20">*</span></a>/</p>
<dl>
<dt>var _findObserveGroups = function _findObserveGroups(input, i, endChars) {</dt><dd><p>var braces = 0;</p>
<dl>
<dt>while (i &lt; input.length) {</dt><dd><p>var a = input.charAt(i);</p>
<p>var match = _match(input.substr(i), endChars);</p>
<dl>
<dt>if (match !== null &amp;&amp; braces === 0) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p>endMatchBegin: i,
endMatchEnd: i + match.length</p>
</dd>
</dl>
<p>};</p>
</dd>
<dt>} else if (a === “{”) {</dt><dd><p>braces++;</p>
</dd>
<dt>} else if (a === “}”) {</dt><dd><dl class="simple">
<dt>if (braces === 0) {</dt><dd><p>throw [“ExtraCloseMissingOpen”, “Extra close brace or missing open brace”];</p>
</dd>
<dt>} else {</dt><dd><p>braces–;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>i++;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (braces &gt; 0) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</dd>
</dl>
<p>};</p>
<p>var match = _match(input, begExcl);</p>
<dl class="simple">
<dt>if (match === null) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>input = input.substr(match.length);
match = _match(input, begIncl);</p>
<dl class="simple">
<dt>if (match === null) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>var e = _findObserveGroups(input, match.length, endIncl || endExcl);</p>
<dl class="simple">
<dt>if (e === null) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}</p>
<p>var match1 = input.substring(0, endIncl ? e.endMatchEnd : e.endMatchBegin);</p>
<dl>
<dt>if (!(beg2Excl || beg2Incl)) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id109"><span class="problematic" id="id110">match_</span></a>: match1,
remainder: input.substr(e.endMatchEnd)</p>
</dd>
</dl>
<p>};</p>
</dd>
<dt>} else {</dt><dd><p>var group2 = this.findObserveGroups(input.substr(e.endMatchEnd), beg2Excl, beg2Incl, end2Incl, end2Excl);</p>
<dl class="simple">
<dt>if (group2 === null) {</dt><dd><p>return null;</p>
</dd>
</dl>
<p>}
/** &#64;type {string[]} <a href="#id21"><span class="problematic" id="id22">*</span></a>/</p>
<p>var matchRet = [match1, <a href="#id111"><span class="problematic" id="id112">group2.match_</span></a>];
return {</p>
<blockquote>
<div><p><a href="#id113"><span class="problematic" id="id114">match_</span></a>: combine ? matchRet.join(“”) : matchRet,
remainder: group2.remainder</p>
</div></blockquote>
<p>};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>// Matching function
// e.g. match(“a”, input) will look for the regexp called “a” and see if it matches
// returns null or {<a href="#id115"><span class="problematic" id="id116">match_</span></a>:”a”, remainder:”bc”}
//
<a href="#id117"><span class="problematic" id="id118">match_</span></a>: function match_(m, input) {</p>
<blockquote>
<div><p>var pattern = mhchemParser.patterns.patterns[m];</p>
<dl>
<dt>if (pattern === undefined) {</dt><dd><p>throw [“MhchemBugP”, “mhchem bug P. Please report. (” + m + “)”]; // Trying to use non-existing pattern</p>
</dd>
<dt>} else if (typeof pattern === “function”) {</dt><dd><p>return mhchemParser.patterns.patterns[m](input); // cannot use cached var pattern here, because some pattern functions need this===mhchemParser</p>
</dd>
<dt>} else {</dt><dd><p>// RegExp
var match = input.match(pattern);</p>
<dl>
<dt>if (match) {</dt><dd><p>var mm;</p>
<dl class="simple">
<dt>if (match[2]) {</dt><dd><p>mm = [match[1], match[2]];</p>
</dd>
<dt>} else if (match[1]) {</dt><dd><p>mm = match[1];</p>
</dd>
<dt>} else {</dt><dd><p>mm = match[0];</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>return {</dt><dd><p><a href="#id119"><span class="problematic" id="id120">match_</span></a>: mm,
remainder: input.substr(match[0].length)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<p>return null;</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>// Generic state machine actions
//
actions: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘a=’: function a(buffer, m) {</dt><dd><p>buffer.a = (buffer.a || “”) + m;</p>
</dd>
</dl>
<p>},
‘b=’: function b(buffer, m) {</p>
<blockquote>
<div><p>buffer.b = (buffer.b || “”) + m;</p>
</div></blockquote>
<p>},
‘p=’: function p(buffer, m) {</p>
<blockquote>
<div><p>buffer.p = (buffer.p || “”) + m;</p>
</div></blockquote>
<p>},
‘o=’: function o(buffer, m) {</p>
<blockquote>
<div><p>buffer.o = (buffer.o || “”) + m;</p>
</div></blockquote>
<p>},
‘q=’: function q(buffer, m) {</p>
<blockquote>
<div><p>buffer.q = (buffer.q || “”) + m;</p>
</div></blockquote>
<p>},
‘d=’: function d(buffer, m) {</p>
<blockquote>
<div><p>buffer.d = (buffer.d || “”) + m;</p>
</div></blockquote>
<p>},
‘rm=’: function rm(buffer, m) {</p>
<blockquote>
<div><p>buffer.rm = (buffer.rm || “”) + m;</p>
</div></blockquote>
<p>},
‘text=’: function text(buffer, m) {</p>
<blockquote>
<div><p><a href="#id121"><span class="problematic" id="id122">buffer.text_</span></a> = (<a href="#id123"><span class="problematic" id="id124">buffer.text_</span></a> || “”) + m;</p>
</div></blockquote>
<p>},
‘insert’: function insert(buffer, m, a) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id125"><span class="problematic" id="id126">type_</span></a>: a</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘insert+p1’: function insertP1(buffer, m, a) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id127"><span class="problematic" id="id128">type_</span></a>: a,
p1: m</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘insert+p1+p2’: function insertP1P2(buffer, m, a) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id129"><span class="problematic" id="id130">type_</span></a>: a,
p1: m[0],
p2: m[1]</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘copy’: function copy(buffer, m) {</p>
<blockquote>
<div><p>return m;</p>
</div></blockquote>
<p>},
‘rm’: function rm(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id131"><span class="problematic" id="id132">type_</span></a>: ‘rm’,
p1: m || “”</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘text’: function text(buffer, m) {</p>
<blockquote>
<div><p>return mhchemParser.go(m, ‘text’);</p>
</div></blockquote>
<p>},
‘{text}’: function text(buffer, m) {</p>
<blockquote>
<div><p>var ret = [“{“];
mhchemParser.concatArray(ret, mhchemParser.go(m, ‘text’));
ret.push(“}”);
return ret;</p>
</div></blockquote>
<p>},
‘tex-math’: function texMath(buffer, m) {</p>
<blockquote>
<div><p>return mhchemParser.go(m, ‘tex-math’);</p>
</div></blockquote>
<p>},
‘tex-math tight’: function texMathTight(buffer, m) {</p>
<blockquote>
<div><p>return mhchemParser.go(m, ‘tex-math tight’);</p>
</div></blockquote>
<p>},
‘bond’: function bond(buffer, m, k) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id133"><span class="problematic" id="id134">type_</span></a>: ‘bond’,
<a href="#id135"><span class="problematic" id="id136">kind_</span></a>: k || m</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘color0-output’: function color0Output(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id137"><span class="problematic" id="id138">type_</span></a>: ‘color0’,
color: m[0]</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘ce’: function ce(buffer, m) {</p>
<blockquote>
<div><p>return mhchemParser.go(m);</p>
</div></blockquote>
<p>},
‘1/2’: function _(buffer, m) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput[]} <a href="#id23"><span class="problematic" id="id24">*</span></a>/
var ret = [];</p>
<dl class="simple">
<dt>if (m.match(/^[+-]/)) {</dt><dd><p>ret.push(m.substr(0, 1));
m = m.substr(1);</p>
</dd>
</dl>
<p>}</p>
<p>var n = m.match(/^([0-9]+|$[a-z]$|[a-z])/([0-9]+)($[a-z]$|[a-z])?$/);
n[1] = n[1].replace(/$/g, “”);
ret.push({</p>
<blockquote>
<div><p><a href="#id139"><span class="problematic" id="id140">type_</span></a>: ‘frac’,
p1: n[1],
p2: n[2]</p>
</div></blockquote>
<p>});</p>
<dl>
<dt>if (n[3]) {</dt><dd><p>n[3] = n[3].replace(/$/g, “”);
ret.push({</p>
<blockquote>
<div><p><a href="#id141"><span class="problematic" id="id142">type_</span></a>: ‘tex-math’,
p1: n[3]</p>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>},
‘9,9’: function _(buffer, m) {</p>
<blockquote>
<div><p>return mhchemParser.go(m, ‘9,9’);</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>// createTransitions
// convert  { ‘letter’: { ‘state’: { <a href="#id143"><span class="problematic" id="id144">action_</span></a>: ‘output’ } } }  to  { ‘state’ =&gt; [ { pattern: ‘letter’, task: { <a href="#id145"><span class="problematic" id="id146">action_</span></a>: [{<a href="#id147"><span class="problematic" id="id148">type_</span></a>: ‘output’}] } } ] }
// with expansion of ‘a|b’ to ‘a’ and ‘b’ (at 2 places)
//
createTransitions: function createTransitions(o) {</p>
<blockquote>
<div><p>var pattern, state;
/** &#64;type {string[]} <a href="#id25"><span class="problematic" id="id26">*</span></a>/</p>
<p>var stateArray;
var i; //
// 1. Collect all states
//</p>
<p>/** &#64;type {Transitions} <a href="#id27"><span class="problematic" id="id28">*</span></a>/</p>
<p>var transitions = {};</p>
<dl>
<dt>for (pattern in o) {</dt><dd><dl>
<dt>for (state in o[pattern]) {</dt><dd><p>stateArray = state.split(“|”);
o[pattern][state].stateArray = stateArray;</p>
<dl class="simple">
<dt>for (i = 0; i &lt; stateArray.length; i++) {</dt><dd><p>transitions[stateArray[i]] = [];</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>} //
// 2. Fill states
//</p>
<dl>
<dt>for (pattern in o) {</dt><dd><dl>
<dt>for (state in o[pattern]) {</dt><dd><p>stateArray = o[pattern][state].stateArray || [];</p>
<dl>
<dt>for (i = 0; i &lt; stateArray.length; i++) {</dt><dd><p>//
// 2a. Normalize actions into array:  ‘text=’ ==&gt; [{<a href="#id149"><span class="problematic" id="id150">type_</span></a>:’text=’}]
// (Note to myself: Resolving the function here would be problematic. It would need .bind (for <em>this</em>) and currying (for <em>option</em>).)
//</p>
<p>/** &#64;type {any} <a href="#id29"><span class="problematic" id="id30">*</span></a>/
var p = o[pattern][state];</p>
<dl>
<dt>if (<a href="#id151"><span class="problematic" id="id152">p.action_</span></a>) {</dt><dd><p><a href="#id153"><span class="problematic" id="id154">p.action_</span></a> = [].concat(<a href="#id155"><span class="problematic" id="id156">p.action_</span></a>);</p>
<dl>
<dt>for (var k = 0; k &lt; <a href="#id157"><span class="problematic" id="id158">p.action_</span></a>.length; k++) {</dt><dd><dl>
<dt>if (typeof p.action_[k] === “string”) {</dt><dd><dl class="simple">
<dt>p.action_[k] = {</dt><dd><p><a href="#id159"><span class="problematic" id="id160">type_</span></a>: p.action_[k]</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else {</dt><dd><p><a href="#id161"><span class="problematic" id="id162">p.action_</span></a> = [];</p>
</dd>
</dl>
<p>} //
// 2.b Multi-insert
//</p>
<p>var patternArray = pattern.split(“|”);</p>
<dl>
<dt>for (var j = 0; j &lt; patternArray.length; j++) {</dt><dd><dl>
<dt>if (stateArray[i] === ‘*’) {</dt><dd><p>// insert into all
for (var t in transitions) {</p>
<blockquote>
<div><dl class="simple">
<dt>transitions[t].push({</dt><dd><p>pattern: patternArray[j],
task: p</p>
</dd>
</dl>
<p>});</p>
</div></blockquote>
<p>}</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>transitions[stateArray[i]].push({</dt><dd><p>pattern: patternArray[j],
task: p</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>return transitions;</p>
</div></blockquote>
<p>},
stateMachines: {}</p>
</dd>
</dl>
<p>}; //
// Definition of state machines
//</p>
<dl>
<dt>mhchemParser.stateMachines = {</dt><dd><p>//
// ce state machines
//
//#region ce
‘ce’: {</p>
<blockquote>
<div><p>// main parser
transitions: mhchemParser.createTransitions({</p>
<blockquote>
<div><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id163"><span class="problematic" id="id164">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2’: {</dt><dd><p><a href="#id165"><span class="problematic" id="id166">action_</span></a>: ‘beginsWithBond=false’,
revisit: true,
toContinue: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘oxidation$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id167"><span class="problematic" id="id168">action_</span></a>: ‘oxidation-output’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘CMT’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘r’: {</dt><dd><p><a href="#id169"><span class="problematic" id="id170">action_</span></a>: ‘rdt=’,
nextState: ‘rt’</p>
</dd>
</dl>
<p>},
‘rd’: {</p>
<blockquote>
<div><p><a href="#id171"><span class="problematic" id="id172">action_</span></a>: ‘rqt=’,
nextState: ‘rdt’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘arrowUpDown’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|as’: {</dt><dd><p><a href="#id173"><span class="problematic" id="id174">action_</span></a>: [‘sb=false’, ‘output’, ‘operator’],
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘uprightEntities’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2’: {</dt><dd><p><a href="#id175"><span class="problematic" id="id176">action_</span></a>: [‘o=’, ‘output’],
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘orbital’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3’: {</dt><dd><p><a href="#id177"><span class="problematic" id="id178">action_</span></a>: ‘o=’,
nextState: ‘o’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-&gt;’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3’: {</dt><dd><p><a href="#id179"><span class="problematic" id="id180">action_</span></a>: ‘r=’,
nextState: ‘r’</p>
</dd>
</dl>
<p>},
‘a|as’: {</p>
<blockquote>
<div><p><a href="#id181"><span class="problematic" id="id182">action_</span></a>: [‘output’, ‘r=’],
nextState: ‘r’</p>
</div></blockquote>
<p>},
‘*’: {</p>
<blockquote>
<div><p><a href="#id183"><span class="problematic" id="id184">action_</span></a>: [‘output’, ‘r=’],
nextState: ‘r’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘+’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘o’: {</dt><dd><p><a href="#id185"><span class="problematic" id="id186">action_</span></a>: ‘d= kv’,
nextState: ‘d’</p>
</dd>
</dl>
<p>},
‘d|D’: {</p>
<blockquote>
<div><p><a href="#id187"><span class="problematic" id="id188">action_</span></a>: ‘d=’,
nextState: ‘d’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><p><a href="#id189"><span class="problematic" id="id190">action_</span></a>: ‘d=’,
nextState: ‘qd’</p>
</div></blockquote>
<p>},
‘qd|qD’: {</p>
<blockquote>
<div><p><a href="#id191"><span class="problematic" id="id192">action_</span></a>: ‘d=’,
nextState: ‘qd’</p>
</div></blockquote>
<p>},
‘dq’: {</p>
<blockquote>
<div><p><a href="#id193"><span class="problematic" id="id194">action_</span></a>: [‘output’, ‘d=’],
nextState: ‘d’</p>
</div></blockquote>
<p>},
‘3’: {</p>
<blockquote>
<div><p><a href="#id195"><span class="problematic" id="id196">action_</span></a>: [‘sb=false’, ‘output’, ‘operator’],
nextState: ‘0’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘amount’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|2’: {</dt><dd><p><a href="#id197"><span class="problematic" id="id198">action_</span></a>: ‘a=’,
nextState: ‘a’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘pm-operator’: {</p>
<blockquote>
<div><dl>
<dt>‘0|1|2|a|as’: {</dt><dd><dl class="simple">
<dt><a href="#id199"><span class="problematic" id="id200">action_</span></a>: [‘sb=false’, ‘output’, {</dt><dd><p><a href="#id201"><span class="problematic" id="id202">type_</span></a>: ‘operator’,
option: ‘\pm’</p>
</dd>
</dl>
<p>}],
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘operator’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|a|as’: {</dt><dd><p><a href="#id203"><span class="problematic" id="id204">action_</span></a>: [‘sb=false’, ‘output’, ‘operator’],
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘o|q’: {</dt><dd><p><a href="#id205"><span class="problematic" id="id206">action_</span></a>: [‘charge or bond’, ‘output’],
nextState: ‘qd’</p>
</dd>
</dl>
<p>},
‘d’: {</p>
<blockquote>
<div><p><a href="#id207"><span class="problematic" id="id208">action_</span></a>: ‘d=’,
nextState: ‘d’</p>
</div></blockquote>
<p>},
‘D’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id209"><span class="problematic" id="id210">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id211"><span class="problematic" id="id212">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><p><a href="#id213"><span class="problematic" id="id214">action_</span></a>: ‘d=’,
nextState: ‘qd’</p>
</div></blockquote>
<p>},
‘qd’: {</p>
<blockquote>
<div><p><a href="#id215"><span class="problematic" id="id216">action_</span></a>: ‘d=’,
nextState: ‘qd’</p>
</div></blockquote>
<p>},
‘qD|dq’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id217"><span class="problematic" id="id218">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id219"><span class="problematic" id="id220">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘-9’: {</p>
<blockquote>
<div><dl>
<dt>‘3|o’: {</dt><dd><dl class="simple">
<dt><a href="#id221"><span class="problematic" id="id222">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id223"><span class="problematic" id="id224">type_</span></a>: ‘insert’,
option: ‘hyphen’</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘- orbital overlap’: {</p>
<blockquote>
<div><dl>
<dt>‘o’: {</dt><dd><dl class="simple">
<dt><a href="#id225"><span class="problematic" id="id226">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id227"><span class="problematic" id="id228">type_</span></a>: ‘insert’,
option: ‘hyphen’</p>
</dd>
</dl>
<p>}],
nextState: ‘2’</p>
</dd>
</dl>
<p>},
‘d’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id229"><span class="problematic" id="id230">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id231"><span class="problematic" id="id232">type_</span></a>: ‘insert’,
option: ‘hyphen’</p>
</dd>
</dl>
<p>}],
nextState: ‘2’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘-’: {</p>
<blockquote>
<div><dl>
<dt>‘0|1|2’: {</dt><dd><dl class="simple">
<dt><a href="#id233"><span class="problematic" id="id234">action_</span></a>: [{</dt><dd><p><a href="#id235"><span class="problematic" id="id236">type_</span></a>: ‘output’,
option: 1</p>
</dd>
<dt>}, ‘beginsWithBond=true’, {</dt><dd><p><a href="#id237"><span class="problematic" id="id238">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</dd>
</dl>
<p>},
‘3’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id239"><span class="problematic" id="id240">action_</span></a>: {</dt><dd><p><a href="#id241"><span class="problematic" id="id242">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘a’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id243"><span class="problematic" id="id244">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id245"><span class="problematic" id="id246">type_</span></a>: ‘insert’,
option: ‘hyphen’</p>
</dd>
</dl>
<p>}],
nextState: ‘2’</p>
</div></blockquote>
<p>},
‘as’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id247"><span class="problematic" id="id248">action_</span></a>: [{</dt><dd><p><a href="#id249"><span class="problematic" id="id250">type_</span></a>: ‘output’,
option: 2</p>
</dd>
<dt>}, {</dt><dd><p><a href="#id251"><span class="problematic" id="id252">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</div></blockquote>
<p>},
‘b’: {</p>
<blockquote>
<div><p><a href="#id253"><span class="problematic" id="id254">action_</span></a>: ‘b=’</p>
</div></blockquote>
<p>},
‘o’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id255"><span class="problematic" id="id256">action_</span></a>: {</dt><dd><p><a href="#id257"><span class="problematic" id="id258">type_</span></a>: ‘- after o/d’,
option: false</p>
</dd>
</dl>
<p>},
nextState: ‘2’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id259"><span class="problematic" id="id260">action_</span></a>: {</dt><dd><p><a href="#id261"><span class="problematic" id="id262">type_</span></a>: ‘- after o/d’,
option: false</p>
</dd>
</dl>
<p>},
nextState: ‘2’</p>
</div></blockquote>
<p>},
‘d|qd|dq’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id263"><span class="problematic" id="id264">action_</span></a>: {</dt><dd><p><a href="#id265"><span class="problematic" id="id266">type_</span></a>: ‘- after o/d’,
option: true</p>
</dd>
</dl>
<p>},
nextState: ‘2’</p>
</div></blockquote>
<p>},
‘D|qD|p’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id267"><span class="problematic" id="id268">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id269"><span class="problematic" id="id270">type_</span></a>: ‘bond’,
option: “-”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘amount2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘1|3’: {</dt><dd><p><a href="#id271"><span class="problematic" id="id272">action_</span></a>: ‘a=’,
nextState: ‘a’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘letters’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3|a|as|b|p|bp|o’: {</dt><dd><p><a href="#id273"><span class="problematic" id="id274">action_</span></a>: ‘o=’,
nextState: ‘o’</p>
</dd>
</dl>
<p>},
‘q|dq’: {</p>
<blockquote>
<div><p><a href="#id275"><span class="problematic" id="id276">action_</span></a>: [‘output’, ‘o=’],
nextState: ‘o’</p>
</div></blockquote>
<p>},
‘d|D|qd|qD’: {</p>
<blockquote>
<div><p><a href="#id277"><span class="problematic" id="id278">action_</span></a>: ‘o after d’,
nextState: ‘o’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘digits’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘o’: {</dt><dd><p><a href="#id279"><span class="problematic" id="id280">action_</span></a>: ‘q=’,
nextState: ‘q’</p>
</dd>
</dl>
<p>},
‘d|D’: {</p>
<blockquote>
<div><p><a href="#id281"><span class="problematic" id="id282">action_</span></a>: ‘q=’,
nextState: ‘dq’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><p><a href="#id283"><span class="problematic" id="id284">action_</span></a>: [‘output’, ‘o=’],
nextState: ‘o’</p>
</div></blockquote>
<p>},
‘a’: {</p>
<blockquote>
<div><p><a href="#id285"><span class="problematic" id="id286">action_</span></a>: ‘o=’,
nextState: ‘o’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘space A’: {</p>
<blockquote>
<div><p>‘b|p|bp’: {}</p>
</div></blockquote>
<p>},
‘space’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘a’: {</dt><dd><p>nextState: ‘as’</p>
</dd>
</dl>
<p>},
‘0’: {</p>
<blockquote>
<div><p><a href="#id287"><span class="problematic" id="id288">action_</span></a>: ‘sb=false’</p>
</div></blockquote>
<p>},
‘1|2’: {</p>
<blockquote>
<div><p><a href="#id289"><span class="problematic" id="id290">action_</span></a>: ‘sb=true’</p>
</div></blockquote>
<p>},
‘r|rt|rd|rdt|rdq’: {</p>
<blockquote>
<div><p><a href="#id291"><span class="problematic" id="id292">action_</span></a>: ‘output’,
nextState: ‘0’</p>
</div></blockquote>
<p>},
‘*’: {</p>
<blockquote>
<div><p><a href="#id293"><span class="problematic" id="id294">action_</span></a>: [‘output’, ‘sb=true’],
nextState: ‘1’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘1st-level escape’: {</p>
<blockquote>
<div><dl>
<dt>‘1|2’: {</dt><dd><dl class="simple">
<dt><a href="#id295"><span class="problematic" id="id296">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id297"><span class="problematic" id="id298">type_</span></a>: ‘insert+p1’,
option: ‘1st-level escape’</p>
</dd>
</dl>
<p>}]</p>
</dd>
</dl>
<p>},
‘*’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id299"><span class="problematic" id="id300">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id301"><span class="problematic" id="id302">type_</span></a>: ‘insert+p1’,
option: ‘1st-level escape’</p>
</dd>
</dl>
<p>}],
nextState: ‘0’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘[(…)]’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘r|rt’: {</dt><dd><p><a href="#id303"><span class="problematic" id="id304">action_</span></a>: ‘rd=’,
nextState: ‘rd’</p>
</dd>
</dl>
<p>},
‘rd|rdt’: {</p>
<blockquote>
<div><p><a href="#id305"><span class="problematic" id="id306">action_</span></a>: ‘rq=’,
nextState: ‘rdq’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘…’: {</p>
<blockquote>
<div><dl>
<dt>‘o|d|D|dq|qd|qD’: {</dt><dd><dl class="simple">
<dt><a href="#id307"><span class="problematic" id="id308">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id309"><span class="problematic" id="id310">type_</span></a>: ‘bond’,
option: “…”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</dd>
</dl>
<p>},
‘*’: {</p>
<blockquote>
<div><dl class="simple">
<dt><a href="#id311"><span class="problematic" id="id312">action_</span></a>: [{</dt><dd><p><a href="#id313"><span class="problematic" id="id314">type_</span></a>: ‘output’,
option: 1</p>
</dd>
<dt>}, {</dt><dd><p><a href="#id315"><span class="problematic" id="id316">type_</span></a>: ‘insert’,
option: ‘ellipsis’</p>
</dd>
</dl>
<p>}],
nextState: ‘1’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘. <a href="#id31"><span class="problematic" id="id32">|</span></a>* ‘: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id317"><span class="problematic" id="id318">action_</span></a>: [‘output’, {</dt><dd><p><a href="#id319"><span class="problematic" id="id320">type_</span></a>: ‘insert’,
option: ‘addition compound’</p>
</dd>
</dl>
<p>}],
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘state of aggregation $’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id321"><span class="problematic" id="id322">action_</span></a>: [‘output’, ‘state of aggregation’],
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{[(’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘a|as|o’: {</dt><dd><p><a href="#id323"><span class="problematic" id="id324">action_</span></a>: [‘o=’, ‘output’, ‘parenthesisLevel++’],
nextState: ‘2’</p>
</dd>
</dl>
<p>},
‘0|1|2|3’: {</p>
<blockquote>
<div><p><a href="#id325"><span class="problematic" id="id326">action_</span></a>: [‘o=’, ‘output’, ‘parenthesisLevel++’],
nextState: ‘2’</p>
</div></blockquote>
<p>},
‘*’: {</p>
<blockquote>
<div><p><a href="#id327"><span class="problematic" id="id328">action_</span></a>: [‘output’, ‘o=’, ‘output’, ‘parenthesisLevel++’],
nextState: ‘2’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘)]}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3|b|p|bp|o’: {</dt><dd><p><a href="#id329"><span class="problematic" id="id330">action_</span></a>: [‘o=’, ‘parenthesisLevel–‘],
nextState: ‘o’</p>
</dd>
</dl>
<p>},
‘a|as|d|D|q|qd|qD|dq’: {</p>
<blockquote>
<div><p><a href="#id331"><span class="problematic" id="id332">action_</span></a>: [‘output’, ‘o=’, ‘parenthesisLevel–‘],
nextState: ‘o’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘, ‘: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id333"><span class="problematic" id="id334">action_</span></a>: [‘output’, ‘comma’],
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘^_’: {</p>
<blockquote>
<div><p>// ^ and _ without a sensible argument
‘*’: {}</p>
</div></blockquote>
<p>},
‘^{(…)}|^($…$)’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|as’: {</dt><dd><p><a href="#id335"><span class="problematic" id="id336">action_</span></a>: ‘b=’,
nextState: ‘b’</p>
</dd>
</dl>
<p>},
‘p’: {</p>
<blockquote>
<div><p><a href="#id337"><span class="problematic" id="id338">action_</span></a>: ‘b=’,
nextState: ‘bp’</p>
</div></blockquote>
<p>},
‘3|o’: {</p>
<blockquote>
<div><p><a href="#id339"><span class="problematic" id="id340">action_</span></a>: ‘d= kv’,
nextState: ‘D’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><p><a href="#id341"><span class="problematic" id="id342">action_</span></a>: ‘d=’,
nextState: ‘qD’</p>
</div></blockquote>
<p>},
‘d|D|qd|qD|dq’: {</p>
<blockquote>
<div><p><a href="#id343"><span class="problematic" id="id344">action_</span></a>: [‘output’, ‘d=’],
nextState: ‘D’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘^a|^\x{}{}|^\x{}|^\x|'’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|as’: {</dt><dd><p><a href="#id345"><span class="problematic" id="id346">action_</span></a>: ‘b=’,
nextState: ‘b’</p>
</dd>
</dl>
<p>},
‘p’: {</p>
<blockquote>
<div><p><a href="#id347"><span class="problematic" id="id348">action_</span></a>: ‘b=’,
nextState: ‘bp’</p>
</div></blockquote>
<p>},
‘3|o’: {</p>
<blockquote>
<div><p><a href="#id349"><span class="problematic" id="id350">action_</span></a>: ‘d= kv’,
nextState: ‘d’</p>
</div></blockquote>
<p>},
‘q’: {</p>
<blockquote>
<div><p><a href="#id351"><span class="problematic" id="id352">action_</span></a>: ‘d=’,
nextState: ‘qd’</p>
</div></blockquote>
<p>},
‘d|qd|D|qD’: {</p>
<blockquote>
<div><p><a href="#id353"><span class="problematic" id="id354">action_</span></a>: ‘d=’</p>
</div></blockquote>
<p>},
‘dq’: {</p>
<blockquote>
<div><p><a href="#id355"><span class="problematic" id="id356">action_</span></a>: [‘output’, ‘d=’],
nextState: ‘d’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘_{(state of aggregation)}$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘d|D|q|qd|qD|dq’: {</dt><dd><p><a href="#id357"><span class="problematic" id="id358">action_</span></a>: [‘output’, ‘q=’],
nextState: ‘q’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘_{(…)}|_($…$)|_9|_\x{}{}|_\x{}|_\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|as’: {</dt><dd><p><a href="#id359"><span class="problematic" id="id360">action_</span></a>: ‘p=’,
nextState: ‘p’</p>
</dd>
</dl>
<p>},
‘b’: {</p>
<blockquote>
<div><p><a href="#id361"><span class="problematic" id="id362">action_</span></a>: ‘p=’,
nextState: ‘bp’</p>
</div></blockquote>
<p>},
‘3|o’: {</p>
<blockquote>
<div><p><a href="#id363"><span class="problematic" id="id364">action_</span></a>: ‘q=’,
nextState: ‘q’</p>
</div></blockquote>
<p>},
‘d|D’: {</p>
<blockquote>
<div><p><a href="#id365"><span class="problematic" id="id366">action_</span></a>: ‘q=’,
nextState: ‘dq’</p>
</div></blockquote>
<p>},
‘q|qd|qD|dq’: {</p>
<blockquote>
<div><p><a href="#id367"><span class="problematic" id="id368">action_</span></a>: [‘output’, ‘q=’],
nextState: ‘q’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘=&lt;&gt;’: {</p>
<blockquote>
<div><dl>
<dt>‘0|1|2|3|a|as|o|q|d|D|qd|qD|dq’: {</dt><dd><dl class="simple">
<dt><a href="#id369"><span class="problematic" id="id370">action_</span></a>: [{</dt><dd><p><a href="#id371"><span class="problematic" id="id372">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘bond’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘#’: {</p>
<blockquote>
<div><dl>
<dt>‘0|1|2|3|a|as|o’: {</dt><dd><dl class="simple">
<dt><a href="#id373"><span class="problematic" id="id374">action_</span></a>: [{</dt><dd><p><a href="#id375"><span class="problematic" id="id376">type_</span></a>: ‘output’,
option: 2</p>
</dd>
<dt>}, {</dt><dd><p><a href="#id377"><span class="problematic" id="id378">type_</span></a>: ‘bond’,
option: “#”</p>
</dd>
</dl>
<p>}],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{}’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id379"><span class="problematic" id="id380">action_</span></a>: {</dt><dd><p><a href="#id381"><span class="problematic" id="id382">type_</span></a>: ‘output’,
option: 1</p>
</dd>
</dl>
<p>},
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{…}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3|a|as|b|p|bp’: {</dt><dd><p><a href="#id383"><span class="problematic" id="id384">action_</span></a>: ‘o=’,
nextState: ‘o’</p>
</dd>
</dl>
<p>},
‘o|d|D|q|qd|qD|dq’: {</p>
<blockquote>
<div><p><a href="#id385"><span class="problematic" id="id386">action_</span></a>: [‘output’, ‘o=’],
nextState: ‘o’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘$…$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘a’: {</dt><dd><p><a href="#id387"><span class="problematic" id="id388">action_</span></a>: ‘a=’</p>
</dd>
</dl>
<p>},
// 2$n$
‘0|1|2|3|as|b|p|bp|o’: {</p>
<blockquote>
<div><p><a href="#id389"><span class="problematic" id="id390">action_</span></a>: ‘o=’,
nextState: ‘o’</p>
</div></blockquote>
<p>},
// not ‘amount’
‘as|o’: {</p>
<blockquote>
<div><p><a href="#id391"><span class="problematic" id="id392">action_</span></a>: ‘o=’</p>
</div></blockquote>
<p>},
‘q|d|D|qd|qD|dq’: {</p>
<blockquote>
<div><p><a href="#id393"><span class="problematic" id="id394">action_</span></a>: [‘output’, ‘o=’],
nextState: ‘o’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘\bond{(…)}’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id395"><span class="problematic" id="id396">action_</span></a>: [{</dt><dd><p><a href="#id397"><span class="problematic" id="id398">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘bond’],
nextState: “3”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\frac{(…)}’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id399"><span class="problematic" id="id400">action_</span></a>: [{</dt><dd><p><a href="#id401"><span class="problematic" id="id402">type_</span></a>: ‘output’,
option: 1</p>
</dd>
</dl>
<p>}, ‘frac-output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\overset{(…)}’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id403"><span class="problematic" id="id404">action_</span></a>: [{</dt><dd><p><a href="#id405"><span class="problematic" id="id406">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘overset-output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
“\underset{(…)}”: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id407"><span class="problematic" id="id408">action_</span></a>: [{</dt><dd><p><a href="#id409"><span class="problematic" id="id410">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘underset-output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
“\underbrace{(…)}”: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id411"><span class="problematic" id="id412">action_</span></a>: [{</dt><dd><p><a href="#id413"><span class="problematic" id="id414">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘underbrace-output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}{(…)}1|\color(…){(…)}2’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id415"><span class="problematic" id="id416">action_</span></a>: [{</dt><dd><p><a href="#id417"><span class="problematic" id="id418">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘color-output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}0’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id419"><span class="problematic" id="id420">action_</span></a>: [{</dt><dd><p><a href="#id421"><span class="problematic" id="id422">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘color0-output’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\ce{(…)}’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id423"><span class="problematic" id="id424">action_</span></a>: [{</dt><dd><p><a href="#id425"><span class="problematic" id="id426">type_</span></a>: ‘output’,
option: 2</p>
</dd>
</dl>
<p>}, ‘ce’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\,’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id427"><span class="problematic" id="id428">action_</span></a>: [{</dt><dd><p><a href="#id429"><span class="problematic" id="id430">type_</span></a>: ‘output’,
option: 1</p>
</dd>
</dl>
<p>}, ‘copy’],
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|1|2|3|a|as|b|p|bp|o|c0’: {</dt><dd><p><a href="#id431"><span class="problematic" id="id432">action_</span></a>: [‘o=’, ‘output’],
nextState: ‘3’</p>
</dd>
</dl>
<p>},
‘*’: {</p>
<blockquote>
<div><p><a href="#id433"><span class="problematic" id="id434">action_</span></a>: [‘output’, ‘o=’, ‘output’],
nextState: ‘3’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘others’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id435"><span class="problematic" id="id436">action_</span></a>: [{</dt><dd><p><a href="#id437"><span class="problematic" id="id438">type_</span></a>: ‘output’,
option: 1</p>
</dd>
</dl>
<p>}, ‘copy’],
nextState: ‘3’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘a’: {</dt><dd><p><a href="#id439"><span class="problematic" id="id440">action_</span></a>: ‘a to o’,
nextState: ‘o’,
revisit: true</p>
</dd>
</dl>
<p>},
‘as’: {</p>
<blockquote>
<div><p><a href="#id441"><span class="problematic" id="id442">action_</span></a>: [‘output’, ‘sb=true’],
nextState: ‘1’,
revisit: true</p>
</div></blockquote>
<p>},
‘r|rt|rd|rdt|rdq’: {</p>
<blockquote>
<div><p><a href="#id443"><span class="problematic" id="id444">action_</span></a>: [‘output’],
nextState: ‘0’,
revisit: true</p>
</div></blockquote>
<p>},
‘*’: {</p>
<blockquote>
<div><p><a href="#id445"><span class="problematic" id="id446">action_</span></a>: [‘output’, ‘copy’],
nextState: ‘3’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘o after d’: function oAfterD(buffer, m) {</dt><dd><p>var ret;</p>
<dl class="simple">
<dt>if ((buffer.d || “”).match(/^[0-9]+$/)) {</dt><dd><p>var tmp = buffer.d;
buffer.d = undefined;
ret = this[‘output’](buffer);
buffer.b = tmp;</p>
</dd>
<dt>} else {</dt><dd><p>ret = this[‘output’](buffer);</p>
</dd>
</dl>
<p>}</p>
<p>mhchemParser.actions[‘o=’](buffer, m);
return ret;</p>
</dd>
</dl>
<p>},
‘d= kv’: function dKv(buffer, m) {</p>
<blockquote>
<div><p>buffer.d = m;
buffer.dType = ‘kv’;</p>
</div></blockquote>
<p>},
‘charge or bond’: function chargeOrBond(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>if (buffer[‘beginsWithBond’]) {</dt><dd><p>/** &#64;type {ParserOutput[]} <a href="#id33"><span class="problematic" id="id34">*</span></a>/
var ret = [];
mhchemParser.concatArray(ret, this[‘output’](buffer));
mhchemParser.concatArray(ret, mhchemParser.actions[‘bond’](buffer, m, “-“));
return ret;</p>
</dd>
<dt>} else {</dt><dd><p>buffer.d = m;</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘- after o/d’: function afterOD(buffer, m, isAfterD) {</p>
<blockquote>
<div><p>var c1 = mhchemParser.patterns.match_(‘orbital’, buffer.o || “”);
var c2 = mhchemParser.patterns.match_(‘one lowercase greek letter $’, buffer.o || “”);
var c3 = mhchemParser.patterns.match_(‘one lowercase latin letter $’, buffer.o || “”);
var c4 = mhchemParser.patterns.match_(‘$one lowercase latin letter$ $’, buffer.o || “”);
var hyphenFollows = m === “-” &amp;&amp; (c1 &amp;&amp; c1.remainder === “” || c2 || c3 || c4);</p>
<dl class="simple">
<dt>if (hyphenFollows &amp;&amp; !buffer.a &amp;&amp; !buffer.b &amp;&amp; !buffer.p &amp;&amp; !buffer.d &amp;&amp; !buffer.q &amp;&amp; !c1 &amp;&amp; c3) {</dt><dd><p>buffer.o = ‘$’ + buffer.o + ‘$’;</p>
</dd>
</dl>
<p>}
/** &#64;type {ParserOutput[]} <a href="#id35"><span class="problematic" id="id36">*</span></a>/</p>
<p>var ret = [];</p>
<dl>
<dt>if (hyphenFollows) {</dt><dd><p>mhchemParser.concatArray(ret, this[‘output’](buffer));
ret.push({</p>
<blockquote>
<div><p><a href="#id447"><span class="problematic" id="id448">type_</span></a>: ‘hyphen’</p>
</div></blockquote>
<p>});</p>
</dd>
<dt>} else {</dt><dd><p>c1 = mhchemParser.patterns.match_(‘digits’, buffer.d || “”);</p>
<dl class="simple">
<dt>if (isAfterD &amp;&amp; c1 &amp;&amp; c1.remainder === ‘’) {</dt><dd><p>mhchemParser.concatArray(ret, mhchemParser.actions[‘d=’](buffer, m));
mhchemParser.concatArray(ret, this[‘output’](buffer));</p>
</dd>
<dt>} else {</dt><dd><p>mhchemParser.concatArray(ret, this[‘output’](buffer));
mhchemParser.concatArray(ret, mhchemParser.actions[‘bond’](buffer, m, “-“));</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>},
‘a to o’: function aToO(buffer) {</p>
<blockquote>
<div><p>buffer.o = buffer.a;
buffer.a = undefined;</p>
</div></blockquote>
<p>},
‘sb=true’: function sbTrue(buffer) {</p>
<blockquote>
<div><p>buffer.sb = true;</p>
</div></blockquote>
<p>},
‘sb=false’: function sbFalse(buffer) {</p>
<blockquote>
<div><p>buffer.sb = false;</p>
</div></blockquote>
<p>},
‘beginsWithBond=true’: function beginsWithBondTrue(buffer) {</p>
<blockquote>
<div><p>buffer[‘beginsWithBond’] = true;</p>
</div></blockquote>
<p>},
‘beginsWithBond=false’: function beginsWithBondFalse(buffer) {</p>
<blockquote>
<div><p>buffer[‘beginsWithBond’] = false;</p>
</div></blockquote>
<p>},
‘parenthesisLevel++’: function parenthesisLevel(buffer) {</p>
<blockquote>
<div><p>buffer[‘parenthesisLevel’]++;</p>
</div></blockquote>
<p>},
‘parenthesisLevel–’: function parenthesisLevel(buffer) {</p>
<blockquote>
<div><p>buffer[‘parenthesisLevel’]–;</p>
</div></blockquote>
<p>},
‘state of aggregation’: function stateOfAggregation(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id449"><span class="problematic" id="id450">type_</span></a>: ‘state of aggregation’,
p1: mhchemParser.go(m, ‘o’)</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘comma’: function comma(buffer, m) {</p>
<blockquote>
<div><p>var a = m.replace(/s*$/, ‘’);
var withSpace = a !== m;</p>
<dl>
<dt>if (withSpace &amp;&amp; buffer[‘parenthesisLevel’] === 0) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id451"><span class="problematic" id="id452">type_</span></a>: ‘comma enumeration L’,
p1: a</p>
</dd>
</dl>
<p>};</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id453"><span class="problematic" id="id454">type_</span></a>: ‘comma enumeration M’,
p1: a</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘output’: function output(buffer, m, entityFollows) {</p>
<blockquote>
<div><p>// entityFollows:
//   undefined = if we have nothing else to output, also ignore the just read space (buffer.sb)
//   1 = an entity follows, never omit the space if there was one just read before (can only apply to state 1)
//   2 = 1 + the entity can have an amount, so output a, instead of converting it to o (can only apply to states a|as)</p>
<p>/** &#64;type {ParserOutput | ParserOutput[]} <a href="#id37"><span class="problematic" id="id38">*</span></a>/
var ret;</p>
<dl>
<dt>if (!buffer.r) {</dt><dd><p>ret = [];</p>
<p>if (!buffer.a &amp;&amp; !buffer.b &amp;&amp; !buffer.p &amp;&amp; !buffer.o &amp;&amp; !buffer.q &amp;&amp; !buffer.d &amp;&amp; !entityFollows) {//ret = [];
} else {</p>
<blockquote>
<div><dl>
<dt>if (buffer.sb) {</dt><dd><dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id455"><span class="problematic" id="id456">type_</span></a>: ‘entitySkip’</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>if (!buffer.o &amp;&amp; !buffer.q &amp;&amp; !buffer.d &amp;&amp; !buffer.b &amp;&amp; !buffer.p &amp;&amp; entityFollows !== 2) {</dt><dd><p>buffer.o = buffer.a;
buffer.a = undefined;</p>
</dd>
<dt>} else if (!buffer.o &amp;&amp; !buffer.q &amp;&amp; !buffer.d &amp;&amp; (buffer.b || buffer.p)) {</dt><dd><p>buffer.o = buffer.a;
buffer.d = buffer.b;
buffer.q = buffer.p;
buffer.a = buffer.b = buffer.p = undefined;</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>if (buffer.o &amp;&amp; buffer.dType === ‘kv’ &amp;&amp; mhchemParser.patterns.match_(‘d-oxidation$’, buffer.d || “”)) {</dt><dd><p>buffer.dType = ‘oxidation’;</p>
</dd>
<dt>} else if (buffer.o &amp;&amp; buffer.dType === ‘kv’ &amp;&amp; !buffer.q) {</dt><dd><p>buffer.dType = undefined;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id457"><span class="problematic" id="id458">type_</span></a>: ‘chemfive’,
a: mhchemParser.go(buffer.a, ‘a’),
b: mhchemParser.go(buffer.b, ‘bd’),
p: mhchemParser.go(buffer.p, ‘pq’),
o: mhchemParser.go(buffer.o, ‘o’),
q: mhchemParser.go(buffer.q, ‘pq’),
d: mhchemParser.go(buffer.d, buffer.dType === ‘oxidation’ ? ‘oxidation’ : ‘bd’),
dType: buffer.dType</p>
</dd>
</dl>
<p>});</p>
</div></blockquote>
<p>}</p>
</dd>
<dt>} else {</dt><dd><p>// r</p>
<p>/** &#64;type {ParserOutput[]} <a href="#id39"><span class="problematic" id="id40">*</span></a>/
var rd;</p>
<dl>
<dt>if (buffer.rdt === ‘M’) {</dt><dd><p>rd = mhchemParser.go(buffer.rd, ‘tex-math’);</p>
</dd>
<dt>} else if (buffer.rdt === ‘T’) {</dt><dd><dl class="simple">
<dt>rd = [{</dt><dd><p><a href="#id459"><span class="problematic" id="id460">type_</span></a>: ‘text’,
p1: buffer.rd || “”</p>
</dd>
</dl>
<p>}];</p>
</dd>
<dt>} else {</dt><dd><p>rd = mhchemParser.go(buffer.rd);</p>
</dd>
</dl>
<p>}
/** &#64;type {ParserOutput[]} <a href="#id41"><span class="problematic" id="id42">*</span></a>/</p>
<p>var rq;</p>
<dl>
<dt>if (buffer.rqt === ‘M’) {</dt><dd><p>rq = mhchemParser.go(buffer.rq, ‘tex-math’);</p>
</dd>
<dt>} else if (buffer.rqt === ‘T’) {</dt><dd><dl class="simple">
<dt>rq = [{</dt><dd><p><a href="#id461"><span class="problematic" id="id462">type_</span></a>: ‘text’,
p1: buffer.rq || “”</p>
</dd>
</dl>
<p>}];</p>
</dd>
<dt>} else {</dt><dd><p>rq = mhchemParser.go(buffer.rq);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>ret = {</dt><dd><p><a href="#id463"><span class="problematic" id="id464">type_</span></a>: ‘arrow’,
r: buffer.r,
rd: rd,
rq: rq</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>for (var p in buffer) {</dt><dd><dl class="simple">
<dt>if (p !== ‘parenthesisLevel’ &amp;&amp; p !== ‘beginsWithBond’) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>},
‘oxidation-output’: function oxidationOutput(buffer, m) {</p>
<blockquote>
<div><p>var ret = [“{“];
mhchemParser.concatArray(ret, mhchemParser.go(m, ‘oxidation’));
ret.push(“}”);
return ret;</p>
</div></blockquote>
<p>},
‘frac-output’: function fracOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id465"><span class="problematic" id="id466">type_</span></a>: ‘frac-ce’,
p1: mhchemParser.go(m[0]),
p2: mhchemParser.go(m[1])</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘overset-output’: function oversetOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id467"><span class="problematic" id="id468">type_</span></a>: ‘overset’,
p1: mhchemParser.go(m[0]),
p2: mhchemParser.go(m[1])</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘underset-output’: function undersetOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id469"><span class="problematic" id="id470">type_</span></a>: ‘underset’,
p1: mhchemParser.go(m[0]),
p2: mhchemParser.go(m[1])</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘underbrace-output’: function underbraceOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id471"><span class="problematic" id="id472">type_</span></a>: ‘underbrace’,
p1: mhchemParser.go(m[0]),
p2: mhchemParser.go(m[1])</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘color-output’: function colorOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id473"><span class="problematic" id="id474">type_</span></a>: ‘color’,
color1: m[0],
color2: mhchemParser.go(m[1])</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘r=’: function r(buffer, m) {</p>
<blockquote>
<div><p>buffer.r = m;</p>
</div></blockquote>
<p>},
‘rdt=’: function rdt(buffer, m) {</p>
<blockquote>
<div><p>buffer.rdt = m;</p>
</div></blockquote>
<p>},
‘rd=’: function rd(buffer, m) {</p>
<blockquote>
<div><p>buffer.rd = m;</p>
</div></blockquote>
<p>},
‘rqt=’: function rqt(buffer, m) {</p>
<blockquote>
<div><p>buffer.rqt = m;</p>
</div></blockquote>
<p>},
‘rq=’: function rq(buffer, m) {</p>
<blockquote>
<div><p>buffer.rq = m;</p>
</div></blockquote>
<p>},
‘operator’: function operator(buffer, m, p1) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id475"><span class="problematic" id="id476">type_</span></a>: ‘operator’,
<a href="#id477"><span class="problematic" id="id478">kind_</span></a>: p1 || m</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘a’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘1/2$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id479"><span class="problematic" id="id480">action_</span></a>: ‘1/2’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘1’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id481"><span class="problematic" id="id482">action_</span></a>: ‘tex-math tight’,
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘,’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id483"><span class="problematic" id="id484">action_</span></a>: {</dt><dd><p><a href="#id485"><span class="problematic" id="id486">type_</span></a>: ‘insert’,
option: ‘commaDecimal’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id487"><span class="problematic" id="id488">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {}</p>
</div></blockquote>
<p>},
‘o’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘1/2$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id489"><span class="problematic" id="id490">action_</span></a>: ‘1/2’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘1’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘letters’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id491"><span class="problematic" id="id492">action_</span></a>: ‘rm’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\ca’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id493"><span class="problematic" id="id494">action_</span></a>: {</dt><dd><p><a href="#id495"><span class="problematic" id="id496">type_</span></a>: ‘insert’,
option: ‘circa’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id497"><span class="problematic" id="id498">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘${(…)}$|$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id499"><span class="problematic" id="id500">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id501"><span class="problematic" id="id502">action_</span></a>: ‘{text}’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id503"><span class="problematic" id="id504">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {}</p>
</div></blockquote>
<p>},
‘text’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id505"><span class="problematic" id="id506">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘{…}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id507"><span class="problematic" id="id508">action_</span></a>: ‘text=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘${(…)}$|$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id509"><span class="problematic" id="id510">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\greek’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id511"><span class="problematic" id="id512">action_</span></a>: [‘output’, ‘rm’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\,|\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id513"><span class="problematic" id="id514">action_</span></a>: [‘output’, ‘copy’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id515"><span class="problematic" id="id516">action_</span></a>: ‘text=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘output’: function output(buffer) {</dt><dd><dl>
<dt>if (<a href="#id517"><span class="problematic" id="id518">buffer.text_</span></a>) {</dt><dd><p>/** &#64;type {ParserOutput} <a href="#id43"><span class="problematic" id="id44">*</span></a>/
var ret = {</p>
<blockquote>
<div><p><a href="#id519"><span class="problematic" id="id520">type_</span></a>: ‘text’,
p1: <a href="#id521"><span class="problematic" id="id522">buffer.text_</span></a></p>
</div></blockquote>
<p>};</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘pq’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘state of aggregation $’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id523"><span class="problematic" id="id524">action_</span></a>: ‘state of aggregation’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘i$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘!f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘(KV letters),’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id525"><span class="problematic" id="id526">action_</span></a>: ‘rm’,
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘formula$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘1/2$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id527"><span class="problematic" id="id528">action_</span></a>: ‘1/2’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘!f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘${(…)}$|$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id529"><span class="problematic" id="id530">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id531"><span class="problematic" id="id532">action_</span></a>: ‘text’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘a-z’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘f’: {</dt><dd><p><a href="#id533"><span class="problematic" id="id534">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘letters’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id535"><span class="problematic" id="id536">action_</span></a>: ‘rm’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-9.,9’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id537"><span class="problematic" id="id538">action_</span></a>: ‘9,9’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘,’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id539"><span class="problematic" id="id540">action_</span></a>: {</dt><dd><p><a href="#id541"><span class="problematic" id="id542">type_</span></a>: ‘insert+p1’,
option: ‘comma enumeration S’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}{(…)}1|\color(…){(…)}2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id543"><span class="problematic" id="id544">action_</span></a>: ‘color-output’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}0’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id545"><span class="problematic" id="id546">action_</span></a>: ‘color0-output’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\ce{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id547"><span class="problematic" id="id548">action_</span></a>: ‘ce’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\,|\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id549"><span class="problematic" id="id550">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id551"><span class="problematic" id="id552">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘state of aggregation’: function stateOfAggregation(buffer, m) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id553"><span class="problematic" id="id554">type_</span></a>: ‘state of aggregation subscript’,
p1: mhchemParser.go(m, ‘o’)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>},
‘color-output’: function colorOutput(buffer, m) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id555"><span class="problematic" id="id556">type_</span></a>: ‘color’,
color1: m[0],
color2: mhchemParser.go(m[1], ‘pq’)</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘bd’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘x$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘!f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘formula$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p>nextState: ‘!f’,
revisit: true</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-9.,9 no missing 0’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id557"><span class="problematic" id="id558">action_</span></a>: ‘9,9’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘.’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id559"><span class="problematic" id="id560">action_</span></a>: {</dt><dd><p><a href="#id561"><span class="problematic" id="id562">type_</span></a>: ‘insert’,
option: ‘electron dot’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘a-z’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘f’: {</dt><dd><p><a href="#id563"><span class="problematic" id="id564">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘x’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id565"><span class="problematic" id="id566">action_</span></a>: {</dt><dd><p><a href="#id567"><span class="problematic" id="id568">type_</span></a>: ‘insert’,
option: ‘KV x’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘letters’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id569"><span class="problematic" id="id570">action_</span></a>: ‘rm’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘'’: {</p>
<blockquote>
<div><dl>
<dt>‘*’: {</dt><dd><dl class="simple">
<dt><a href="#id571"><span class="problematic" id="id572">action_</span></a>: {</dt><dd><p><a href="#id573"><span class="problematic" id="id574">type_</span></a>: ‘insert’,
option: ‘prime’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘${(…)}$|$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id575"><span class="problematic" id="id576">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id577"><span class="problematic" id="id578">action_</span></a>: ‘text’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}{(…)}1|\color(…){(…)}2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id579"><span class="problematic" id="id580">action_</span></a>: ‘color-output’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\color{(…)}0’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id581"><span class="problematic" id="id582">action_</span></a>: ‘color0-output’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\ce{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id583"><span class="problematic" id="id584">action_</span></a>: ‘ce’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\,|\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id585"><span class="problematic" id="id586">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else2’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id587"><span class="problematic" id="id588">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘color-output’: function colorOutput(buffer, m) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id589"><span class="problematic" id="id590">type_</span></a>: ‘color’,
color1: m[0],
color2: mhchemParser.go(m[1], ‘bd’)</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘oxidation’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘roman numeral’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id591"><span class="problematic" id="id592">action_</span></a>: ‘roman-numeral’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘${(…)}$|$(…)$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id593"><span class="problematic" id="id594">action_</span></a>: ‘tex-math’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id595"><span class="problematic" id="id596">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘roman-numeral’: function romanNumeral(buffer, m) {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id597"><span class="problematic" id="id598">type_</span></a>: ‘roman numeral’,
p1: m || “”</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘tex-math’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id599"><span class="problematic" id="id600">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘\ce{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id601"><span class="problematic" id="id602">action_</span></a>: [‘output’, ‘ce’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{…}|\,|\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id603"><span class="problematic" id="id604">action_</span></a>: ‘o=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id605"><span class="problematic" id="id606">action_</span></a>: ‘o=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘output’: function output(buffer) {</dt><dd><dl>
<dt>if (buffer.o) {</dt><dd><p>/** &#64;type {ParserOutput} <a href="#id45"><span class="problematic" id="id46">*</span></a>/
var ret = {</p>
<blockquote>
<div><p><a href="#id607"><span class="problematic" id="id608">type_</span></a>: ‘tex-math’,
p1: buffer.o</p>
</div></blockquote>
<p>};</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘tex-math tight’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id609"><span class="problematic" id="id610">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘\ce{(…)}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id611"><span class="problematic" id="id612">action_</span></a>: [‘output’, ‘ce’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{…}|\,|\x{}{}|\x{}|\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id613"><span class="problematic" id="id614">action_</span></a>: ‘o=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-<a href="#id47"><span class="problematic" id="id48">|</span></a>+’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id615"><span class="problematic" id="id616">action_</span></a>: ‘tight operator’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id617"><span class="problematic" id="id618">action_</span></a>: ‘o=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘tight operator’: function tightOperator(buffer, m) {</dt><dd><p>buffer.o = (buffer.o || “”) + “{” + m + “}”;</p>
</dd>
</dl>
<p>},
‘output’: function output(buffer) {</p>
<blockquote>
<div><dl>
<dt>if (buffer.o) {</dt><dd><p>/** &#64;type {ParserOutput} <a href="#id49"><span class="problematic" id="id50">*</span></a>/
var ret = {</p>
<blockquote>
<div><p><a href="#id619"><span class="problematic" id="id620">type_</span></a>: ‘tex-math’,
p1: buffer.o</p>
</div></blockquote>
<p>};</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘9,9’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl class="simple">
<dt>‘empty’: {</dt><dd><p>‘*’: {}</p>
</dd>
</dl>
<p>},
‘,’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id621"><span class="problematic" id="id622">action_</span></a>: ‘comma’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id623"><span class="problematic" id="id624">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘comma’: function comma() {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id625"><span class="problematic" id="id626">type_</span></a>: ‘commaDecimal’</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
//#endregion
//
// pu state machines
//
//#region pu
‘pu’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id627"><span class="problematic" id="id628">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘space$’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id629"><span class="problematic" id="id630">action_</span></a>: [‘output’, ‘space’]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{[(|)]}’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|a’: {</dt><dd><p><a href="#id631"><span class="problematic" id="id632">action_</span></a>: ‘copy’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘(-)(9)^(-9)’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id633"><span class="problematic" id="id634">action_</span></a>: ‘number^’,
nextState: ‘a’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘(-)(9.,9)(e)(99)’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id635"><span class="problematic" id="id636">action_</span></a>: ‘enumber’,
nextState: ‘a’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘space’: {</p>
<blockquote>
<div><p>‘0|a’: {}</p>
</div></blockquote>
<p>},
‘pm-operator’: {</p>
<blockquote>
<div><dl>
<dt>‘0|a’: {</dt><dd><dl class="simple">
<dt><a href="#id637"><span class="problematic" id="id638">action_</span></a>: {</dt><dd><p><a href="#id639"><span class="problematic" id="id640">type_</span></a>: ‘operator’,
option: ‘\pm’</p>
</dd>
</dl>
<p>},
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘operator’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|a’: {</dt><dd><p><a href="#id641"><span class="problematic" id="id642">action_</span></a>: ‘copy’,
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘//’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘d’: {</dt><dd><p><a href="#id643"><span class="problematic" id="id644">action_</span></a>: ‘o=’,
nextState: ‘/’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘/’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘d’: {</dt><dd><p><a href="#id645"><span class="problematic" id="id646">action_</span></a>: ‘o=’,
nextState: ‘/’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘{…}|else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0|d’: {</dt><dd><p><a href="#id647"><span class="problematic" id="id648">action_</span></a>: ‘d=’,
nextState: ‘d’</p>
</dd>
</dl>
<p>},
‘a’: {</p>
<blockquote>
<div><p><a href="#id649"><span class="problematic" id="id650">action_</span></a>: [‘space’, ‘d=’],
nextState: ‘d’</p>
</div></blockquote>
<p>},
‘/<a href="#id51"><span class="problematic" id="id52">|</span></a>q’: {</p>
<blockquote>
<div><p><a href="#id651"><span class="problematic" id="id652">action_</span></a>: ‘q=’,
nextState: ‘q’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘enumber’: function enumber(buffer, m) {</dt><dd><p>/** &#64;type {ParserOutput[]} <a href="#id53"><span class="problematic" id="id54">*</span></a>/
var ret = [];</p>
<dl class="simple">
<dt>if (m[0] === “+-” || m[0] === “+/-”) {</dt><dd><p>ret.push(”\pm “);</p>
</dd>
<dt>} else if (m[0]) {</dt><dd><p>ret.push(m[0]);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>if (m[1]) {</dt><dd><p>mhchemParser.concatArray(ret, mhchemParser.go(m[1], ‘pu-9,9’));</p>
<dl>
<dt>if (m[2]) {</dt><dd><dl class="simple">
<dt>if (m[2].match(/[,.]/)) {</dt><dd><p>mhchemParser.concatArray(ret, mhchemParser.go(m[2], ‘pu-9,9’));</p>
</dd>
<dt>} else {</dt><dd><p>ret.push(m[2]);</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>m[3] = m[4] || m[3];</p>
<dl>
<dt>if (m[3]) {</dt><dd><p>m[3] = m[3].trim();</p>
<dl>
<dt>if (m[3] === “e” || m[3].substr(0, 1) === “*”) {</dt><dd><dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id653"><span class="problematic" id="id654">type_</span></a>: ‘cdot’</p>
</dd>
</dl>
<p>});</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id655"><span class="problematic" id="id656">type_</span></a>: ‘times’</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (m[3]) {</dt><dd><p>ret.push(“10^{” + m[5] + “}”);</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</dd>
</dl>
<p>},
‘number^’: function number(buffer, m) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput[]} <a href="#id55"><span class="problematic" id="id56">*</span></a>/
var ret = [];</p>
<dl class="simple">
<dt>if (m[0] === “+-” || m[0] === “+/-”) {</dt><dd><p>ret.push(”\pm “);</p>
</dd>
<dt>} else if (m[0]) {</dt><dd><p>ret.push(m[0]);</p>
</dd>
</dl>
<p>}</p>
<p>mhchemParser.concatArray(ret, mhchemParser.go(m[1], ‘pu-9,9’));
ret.push(“^{” + m[2] + “}”);
return ret;</p>
</div></blockquote>
<p>},
‘operator’: function operator(buffer, m, p1) {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id657"><span class="problematic" id="id658">type_</span></a>: ‘operator’,
<a href="#id659"><span class="problematic" id="id660">kind_</span></a>: p1 || m</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘space’: function space() {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id661"><span class="problematic" id="id662">type_</span></a>: ‘pu-space-1’</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘output’: function output(buffer) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput | ParserOutput[]} <a href="#id57"><span class="problematic" id="id58">*</span></a>/
var ret;
var md = mhchemParser.patterns.match_(‘{(…)}’, buffer.d || “”);</p>
<dl class="simple">
<dt>if (md &amp;&amp; md.remainder === ‘’) {</dt><dd><p>buffer.d = <a href="#id663"><span class="problematic" id="id664">md.match_</span></a>;</p>
</dd>
</dl>
<p>}</p>
<p>var mq = mhchemParser.patterns.match_(‘{(…)}’, buffer.q || “”);</p>
<dl class="simple">
<dt>if (mq &amp;&amp; mq.remainder === ‘’) {</dt><dd><p>buffer.q = <a href="#id665"><span class="problematic" id="id666">mq.match_</span></a>;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (buffer.d) {</dt><dd><p>buffer.d = buffer.d.replace(/u00B0C|^oC|^{o}C/g, “{}^{\circ}C”);
buffer.d = buffer.d.replace(/u00B0F|^oF|^{o}F/g, “{}^{\circ}F”);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>if (buffer.q) {</dt><dd><p>// fraction
buffer.q = buffer.q.replace(/u00B0C|^oC|^{o}C/g, “{}^{\circ}C”);
buffer.q = buffer.q.replace(/u00B0F|^oF|^{o}F/g, “{}^{\circ}F”);
var b5 = {</p>
<blockquote>
<div><p>d: mhchemParser.go(buffer.d, ‘pu’),
q: mhchemParser.go(buffer.q, ‘pu’)</p>
</div></blockquote>
<p>};</p>
<dl>
<dt>if (buffer.o === ‘//’) {</dt><dd><dl class="simple">
<dt>ret = {</dt><dd><p><a href="#id667"><span class="problematic" id="id668">type_</span></a>: ‘pu-frac’,
p1: b5.d,
p2: b5.q</p>
</dd>
</dl>
<p>};</p>
</dd>
<dt>} else {</dt><dd><p>ret = b5.d;</p>
<dl>
<dt>if (b5.d.length &gt; 1 || b5.q.length &gt; 1) {</dt><dd><dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id669"><span class="problematic" id="id670">type_</span></a>: ‘ / ‘</p>
</dd>
</dl>
<p>});</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>ret.push({</dt><dd><p><a href="#id671"><span class="problematic" id="id672">type_</span></a>: ‘/’</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>}</p>
<p>mhchemParser.concatArray(ret, b5.q);</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else {</dt><dd><p>// no fraction
ret = mhchemParser.go(buffer.d, ‘pu-2’);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘pu-2’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id673"><span class="problematic" id="id674">action_</span></a>: ‘output’</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
‘*’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id675"><span class="problematic" id="id676">action_</span></a>: [‘output’, ‘cdot’],
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘\x’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id677"><span class="problematic" id="id678">action_</span></a>: ‘rm=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘space’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id679"><span class="problematic" id="id680">action_</span></a>: [‘output’, ‘space’],
nextState: ‘0’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘^{(…)}|^(-1)’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘1’: {</dt><dd><p><a href="#id681"><span class="problematic" id="id682">action_</span></a>: ‘^(-1)’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘-9.,9’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id683"><span class="problematic" id="id684">action_</span></a>: ‘rm=’,
nextState: ‘0’</p>
</dd>
</dl>
<p>},
‘1’: {</p>
<blockquote>
<div><p><a href="#id685"><span class="problematic" id="id686">action_</span></a>: ‘^(-1)’,
nextState: ‘0’</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘{…}|else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id687"><span class="problematic" id="id688">action_</span></a>: ‘rm=’,
nextState: ‘1’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘cdot’: function cdot() {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id689"><span class="problematic" id="id690">type_</span></a>: ‘tight cdot’</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>},
‘^(-1)’: function _(buffer, m) {</p>
<blockquote>
<div><p>buffer.rm += “^{” + m + “}”;</p>
</div></blockquote>
<p>},
‘space’: function space() {</p>
<blockquote>
<div><dl class="simple">
<dt>return {</dt><dd><p><a href="#id691"><span class="problematic" id="id692">type_</span></a>: ‘pu-space-2’</p>
</dd>
</dl>
<p>};</p>
</div></blockquote>
<p>},
‘output’: function output(buffer) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput | ParserOutput[]} <a href="#id59"><span class="problematic" id="id60">*</span></a>/
var ret = [];</p>
<dl>
<dt>if (buffer.rm) {</dt><dd><p>var mrm = mhchemParser.patterns.match_(‘{(…)}’, buffer.rm || “”);</p>
<dl>
<dt>if (mrm &amp;&amp; mrm.remainder === ‘’) {</dt><dd><p>ret = mhchemParser.go(<a href="#id693"><span class="problematic" id="id694">mrm.match_</span></a>, ‘pu’);</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>ret = {</dt><dd><p><a href="#id695"><span class="problematic" id="id696">type_</span></a>: ‘rm’,
p1: buffer.rm</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
‘pu-9,9’: {</p>
<blockquote>
<div><dl>
<dt>transitions: mhchemParser.createTransitions({</dt><dd><dl>
<dt>‘empty’: {</dt><dd><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id697"><span class="problematic" id="id698">action_</span></a>: ‘output-0’</p>
</dd>
</dl>
<p>},
‘o’: {</p>
<blockquote>
<div><p><a href="#id699"><span class="problematic" id="id700">action_</span></a>: ‘output-o’</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>},
‘,’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id701"><span class="problematic" id="id702">action_</span></a>: [‘output-0’, ‘comma’],
nextState: ‘o’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘.’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘0’: {</dt><dd><p><a href="#id703"><span class="problematic" id="id704">action_</span></a>: [‘output-0’, ‘copy’],
nextState: ‘o’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
‘else’: {</p>
<blockquote>
<div><dl class="simple">
<dt>‘*’: {</dt><dd><p><a href="#id705"><span class="problematic" id="id706">action_</span></a>: ‘text=’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}),
actions: {</p>
<blockquote>
<div><dl>
<dt>‘comma’: function comma() {</dt><dd><dl class="simple">
<dt>return {</dt><dd><p><a href="#id707"><span class="problematic" id="id708">type_</span></a>: ‘commaDecimal’</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>},
‘output-0’: function output0(buffer) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput[]} <a href="#id61"><span class="problematic" id="id62">*</span></a>/
var ret = [];
<a href="#id709"><span class="problematic" id="id710">buffer.text_</span></a> = <a href="#id711"><span class="problematic" id="id712">buffer.text_</span></a> || “”;</p>
<dl>
<dt>if (<a href="#id713"><span class="problematic" id="id714">buffer.text_</span></a>.length &gt; 4) {</dt><dd><p>var a = <a href="#id715"><span class="problematic" id="id716">buffer.text_</span></a>.length % 3;</p>
<dl class="simple">
<dt>if (a === 0) {</dt><dd><p>a = 3;</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>for (var i = <a href="#id717"><span class="problematic" id="id718">buffer.text_</span></a>.length - 3; i &gt; 0; i -= 3) {</dt><dd><p>ret.push(<a href="#id719"><span class="problematic" id="id720">buffer.text_</span></a>.substr(i, 3));
ret.push({</p>
<blockquote>
<div><p><a href="#id721"><span class="problematic" id="id722">type_</span></a>: ‘1000 separator’</p>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p>}</p>
<p>ret.push(<a href="#id723"><span class="problematic" id="id724">buffer.text_</span></a>.substr(0, a));
ret.reverse();</p>
</dd>
<dt>} else {</dt><dd><p>ret.push(<a href="#id725"><span class="problematic" id="id726">buffer.text_</span></a>);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>},
‘output-o’: function outputO(buffer) {</p>
<blockquote>
<div><p>/** &#64;type {ParserOutput[]} <a href="#id63"><span class="problematic" id="id64">*</span></a>/
var ret = [];
<a href="#id727"><span class="problematic" id="id728">buffer.text_</span></a> = <a href="#id729"><span class="problematic" id="id730">buffer.text_</span></a> || “”;</p>
<dl>
<dt>if (<a href="#id731"><span class="problematic" id="id732">buffer.text_</span></a>.length &gt; 4) {</dt><dd><p>var a = <a href="#id733"><span class="problematic" id="id734">buffer.text_</span></a>.length - 3;</p>
<dl>
<dt>for (var i = 0; i &lt; a; i += 3) {</dt><dd><p>ret.push(<a href="#id735"><span class="problematic" id="id736">buffer.text_</span></a>.substr(i, 3));
ret.push({</p>
<blockquote>
<div><p><a href="#id737"><span class="problematic" id="id738">type_</span></a>: ‘1000 separator’</p>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p>}</p>
<p>ret.push(<a href="#id739"><span class="problematic" id="id740">buffer.text_</span></a>.substr(i));</p>
</dd>
<dt>} else {</dt><dd><p>ret.push(<a href="#id741"><span class="problematic" id="id742">buffer.text_</span></a>);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>for (var p in buffer) {</dt><dd><p>delete buffer[p];</p>
</dd>
</dl>
<p>}</p>
<p>return ret;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>} //#endregion</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}; //
// texify: Take MhchemParser output and convert it to TeX
//</p>
<p>/** &#64;type {Texify} <a href="#id65"><span class="problematic" id="id66">*</span></a>/</p>
<dl>
<dt>var texify = {</dt><dd><dl>
<dt>go: function go(input, isInner) {</dt><dd><p>// (recursive, max 4 levels)
if (!input) {</p>
<blockquote>
<div><p>return “”;</p>
</div></blockquote>
<p>}</p>
<p>var res = “”;
var cee = false;</p>
<dl>
<dt>for (var i = 0; i &lt; input.length; i++) {</dt><dd><p>var inputi = input[i];</p>
<dl>
<dt>if (typeof inputi === “string”) {</dt><dd><p>res += inputi;</p>
</dd>
<dt>} else {</dt><dd><p>res += texify._go2(inputi);</p>
<dl class="simple">
<dt>if (<a href="#id743"><span class="problematic" id="id744">inputi.type_</span></a> === ‘1st-level escape’) {</dt><dd><p>cee = true;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (!isInner &amp;&amp; !cee &amp;&amp; res) {</dt><dd><p>res = “{” + res + “}”;</p>
</dd>
</dl>
<p>}</p>
<p>return res;</p>
</dd>
</dl>
<p>},
_goInner: function _goInner(input) {</p>
<blockquote>
<div><dl class="simple">
<dt>if (!input) {</dt><dd><p>return input;</p>
</dd>
</dl>
<p>}</p>
<p>return texify.go(input, true);</p>
</div></blockquote>
<p>},
_go2: function _go2(buf) {</p>
<blockquote>
<div><p>/** &#64;type {undefined | string} <a href="#id67"><span class="problematic" id="id68">*</span></a>/
var res;</p>
<dl>
<dt>switch (<a href="#id745"><span class="problematic" id="id746">buf.type_</span></a>) {</dt><dd><dl>
<dt>case ‘chemfive’:</dt><dd><p>res = “”;
var b5 = {</p>
<blockquote>
<div><p>a: texify._goInner(buf.a),
b: texify._goInner(buf.b),
p: texify._goInner(buf.p),
o: texify._goInner(buf.o),
q: texify._goInner(buf.q),
d: texify._goInner(buf.d)</p>
</div></blockquote>
<p>}; //
// a
//</p>
<dl>
<dt>if (b5.a) {</dt><dd><dl class="simple">
<dt>if (b5.a.match(/^[+-]/)) {</dt><dd><p>b5.a = “{” + b5.a + “}”;</p>
</dd>
</dl>
<p>}</p>
<p>res += b5.a + “\,”;</p>
</dd>
</dl>
<p>} //
// b and p
//</p>
<dl class="simple">
<dt>if (b5.b || b5.p) {</dt><dd><p>res += “{\vphantom{X}}”;
res += “^{\hphantom{” + (b5.b || “”) + “}}_{\hphantom{” + (b5.p || “”) + “}}”;
res += “{\vphantom{X}}”;
res += “^{\smash[t]{\vphantom{2}}\mathllap{” + (b5.b || “”) + “}}”;
res += “_{\vphantom{2}\mathllap{\smash[t]{” + (b5.p || “”) + “}}}”;</p>
</dd>
</dl>
<p>} //
// o
//</p>
<dl>
<dt>if (b5.o) {</dt><dd><dl class="simple">
<dt>if (b5.o.match(/^[+-]/)) {</dt><dd><p>b5.o = “{” + b5.o + “}”;</p>
</dd>
</dl>
<p>}</p>
<p>res += b5.o;</p>
</dd>
</dl>
<p>} //
// q and d
//</p>
<dl>
<dt>if (buf.dType === ‘kv’) {</dt><dd><dl class="simple">
<dt>if (b5.d || b5.q) {</dt><dd><p>res += “{\vphantom{X}}”;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (b5.d) {</dt><dd><p>res += “^{” + b5.d + “}”;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (b5.q) {</dt><dd><p>res += “_{\smash[t]{” + b5.q + “}}”;</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else if (buf.dType === ‘oxidation’) {</dt><dd><dl class="simple">
<dt>if (b5.d) {</dt><dd><p>res += “{\vphantom{X}}”;
res += “^{” + b5.d + “}”;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (b5.q) {</dt><dd><p>res += “{\vphantom{X}}”;
res += “_{\smash[t]{” + b5.q + “}}”;</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else {</dt><dd><dl class="simple">
<dt>if (b5.q) {</dt><dd><p>res += “{\vphantom{X}}”;
res += “_{\smash[t]{” + b5.q + “}}”;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (b5.d) {</dt><dd><p>res += “{\vphantom{X}}”;
res += “^{” + b5.d + “}”;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>break;</p>
</dd>
<dt>case ‘rm’:</dt><dd><p>res = “\mathrm{” + buf.p1 + “}”;
break;</p>
</dd>
<dt>case ‘text’:</dt><dd><dl class="simple">
<dt>if (buf.p1.match(/[^_]/)) {</dt><dd><p>buf.p1 = buf.p1.replace(” “, “~”).replace(“-”, “\text{-}”);
res = “\mathrm{” + buf.p1 + “}”;</p>
</dd>
<dt>} else {</dt><dd><p>res = “\text{” + buf.p1 + “}”;</p>
</dd>
</dl>
<p>}</p>
<p>break;</p>
</dd>
<dt>case ‘roman numeral’:</dt><dd><p>res = “\mathrm{” + buf.p1 + “}”;
break;</p>
</dd>
<dt>case ‘state of aggregation’:</dt><dd><p>res = “\mskip2mu “ + texify._goInner(buf.p1);
break;</p>
</dd>
<dt>case ‘state of aggregation subscript’:</dt><dd><p>res = “\mskip1mu “ + texify._goInner(buf.p1);
break;</p>
</dd>
<dt>case ‘bond’:</dt><dd><p>res = texify._getBond(<a href="#id747"><span class="problematic" id="id748">buf.kind_</span></a>);</p>
<dl class="simple">
<dt>if (!res) {</dt><dd><p>throw [“MhchemErrorBond”, “mhchem Error. Unknown bond type (” + <a href="#id749"><span class="problematic" id="id750">buf.kind_</span></a> + “)”];</p>
</dd>
</dl>
<p>}</p>
<p>break;</p>
</dd>
<dt>case ‘frac’:</dt><dd><p>var c = “\frac{” + buf.p1 + “}{” + buf.p2 + “}”;
res = “\mathchoice{\textstyle” + c + “}{” + c + “}{” + c + “}{” + c + “}”;
break;</p>
</dd>
<dt>case ‘pu-frac’:</dt><dd><p>var d = “\frac{” + texify._goInner(buf.p1) + “}{” + texify._goInner(buf.p2) + “}”;
res = “\mathchoice{\textstyle” + d + “}{” + d + “}{” + d + “}{” + d + “}”;
break;</p>
</dd>
<dt>case ‘tex-math’:</dt><dd><p>res = buf.p1 + “ “;
break;</p>
</dd>
<dt>case ‘frac-ce’:</dt><dd><p>res = “\frac{” + texify._goInner(buf.p1) + “}{” + texify._goInner(buf.p2) + “}”;
break;</p>
</dd>
<dt>case ‘overset’:</dt><dd><p>res = “\overset{” + texify._goInner(buf.p1) + “}{” + texify._goInner(buf.p2) + “}”;
break;</p>
</dd>
<dt>case ‘underset’:</dt><dd><p>res = “\underset{” + texify._goInner(buf.p1) + “}{” + texify._goInner(buf.p2) + “}”;
break;</p>
</dd>
<dt>case ‘underbrace’:</dt><dd><p>res = “\underbrace{” + texify._goInner(buf.p1) + “}_{” + texify._goInner(buf.p2) + “}”;
break;</p>
</dd>
<dt>case ‘color’:</dt><dd><p>res = “{\color{” + buf.color1 + “}{” + texify._goInner(buf.color2) + “}}”;
break;</p>
</dd>
<dt>case ‘color0’:</dt><dd><p>res = “\color{” + buf.color + “}”;
break;</p>
</dd>
<dt>case ‘arrow’:</dt><dd><dl class="simple">
<dt>var b6 = {</dt><dd><p>rd: texify._goInner(buf.rd),
rq: texify._goInner(buf.rq)</p>
</dd>
</dl>
<p>};</p>
<p>var arrow = “\x” + texify._getArrow(buf.r);</p>
<dl class="simple">
<dt>if (b6.rq) {</dt><dd><p>arrow += “[{” + b6.rq + “}]”;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>if (b6.rd) {</dt><dd><p>arrow += “{” + b6.rd + “}”;</p>
</dd>
<dt>} else {</dt><dd><p>arrow += “{}”;</p>
</dd>
</dl>
<p>}</p>
<p>res = arrow;
break;</p>
</dd>
<dt>case ‘operator’:</dt><dd><p>res = texify._getOperator(<a href="#id751"><span class="problematic" id="id752">buf.kind_</span></a>);
break;</p>
</dd>
<dt>case ‘1st-level escape’:</dt><dd><p>res = buf.p1 + “ “; // &amp;, \\, \hlin</p>
<p>break;</p>
</dd>
<dt>case ‘space’:</dt><dd><p>res = “ “;
break;</p>
</dd>
<dt>case ‘entitySkip’:</dt><dd><p>res = “~”;
break;</p>
</dd>
<dt>case ‘pu-space-1’:</dt><dd><p>res = “~”;
break;</p>
</dd>
<dt>case ‘pu-space-2’:</dt><dd><p>res = “\mkern3mu “;
break;</p>
</dd>
<dt>case ‘1000 separator’:</dt><dd><p>res = “\mkern2mu “;
break;</p>
</dd>
<dt>case ‘commaDecimal’:</dt><dd><p>res = “{,}”;
break;</p>
</dd>
<dt>case ‘comma enumeration L’:</dt><dd><p>res = “{” + buf.p1 + “}\mkern6mu “;
break;</p>
</dd>
<dt>case ‘comma enumeration M’:</dt><dd><p>res = “{” + buf.p1 + “}\mkern3mu “;
break;</p>
</dd>
<dt>case ‘comma enumeration S’:</dt><dd><p>res = “{” + buf.p1 + “}\mkern1mu “;
break;</p>
</dd>
<dt>case ‘hyphen’:</dt><dd><p>res = “\text{-}”;
break;</p>
</dd>
<dt>case ‘addition compound’:</dt><dd><p>res = “\,{\cdot}\,”;
break;</p>
</dd>
<dt>case ‘electron dot’:</dt><dd><p>res = “\mkern1mu \bullet\mkern1mu “;
break;</p>
</dd>
<dt>case ‘KV x’:</dt><dd><p>res = “{\times}”;
break;</p>
</dd>
<dt>case ‘prime’:</dt><dd><p>res = “\prime “;
break;</p>
</dd>
<dt>case ‘cdot’:</dt><dd><p>res = “\cdot “;
break;</p>
</dd>
<dt>case ‘tight cdot’:</dt><dd><p>res = “\mkern1mu{\cdot}\mkern1mu “;
break;</p>
</dd>
<dt>case ‘times’:</dt><dd><p>res = “\times “;
break;</p>
</dd>
<dt>case ‘circa’:</dt><dd><p>res = “{\sim}”;
break;</p>
</dd>
<dt>case ‘^’:</dt><dd><p>res = “uparrow”;
break;</p>
</dd>
<dt>case ‘v’:</dt><dd><p>res = “downarrow”;
break;</p>
</dd>
<dt>case ‘ellipsis’:</dt><dd><p>res = “\ldots “;
break;</p>
</dd>
<dt>case ‘/’:</dt><dd><p>res = “/”;
break;</p>
</dd>
<dt>case ‘ / ‘:</dt><dd><p>res = “\,/\,”;
break;</p>
</dd>
<dt>default:</dt><dd><p>assertNever(buf);
throw [“MhchemBugT”, “mhchem bug T. Please report.”];</p>
</dd>
</dl>
<p>// Missing texify rule or unknown MhchemParser output</p>
</dd>
</dl>
<p>}</p>
<p>assertString(res);
return res;</p>
</div></blockquote>
<p>},
_getArrow: function _getArrow(a) {</p>
<blockquote>
<div><dl class="simple">
<dt>switch (a) {</dt><dd><dl class="simple">
<dt>case “-&gt;”:</dt><dd><p>return “rightarrow”;</p>
</dd>
<dt>case “u2192”:</dt><dd><p>return “rightarrow”;</p>
</dd>
<dt>case “u27F6”:</dt><dd><p>return “rightarrow”;</p>
</dd>
<dt>case “&lt;-“:</dt><dd><p>return “leftarrow”;</p>
</dd>
<dt>case “&lt;-&gt;”:</dt><dd><p>return “leftrightarrow”;</p>
</dd>
<dt>case “&lt;–&gt;”:</dt><dd><p>return “rightleftarrows”;</p>
</dd>
<dt>case “&lt;=&gt;”:</dt><dd><p>return “rightleftharpoons”;</p>
</dd>
<dt>case “u21CC”:</dt><dd><p>return “rightleftharpoons”;</p>
</dd>
<dt>case “&lt;=&gt;&gt;”:</dt><dd><p>return “rightequilibrium”;</p>
</dd>
<dt>case “&lt;&lt;=&gt;”:</dt><dd><p>return “leftequilibrium”;</p>
</dd>
<dt>default:</dt><dd><p>assertNever(a);
throw [“MhchemBugT”, “mhchem bug T. Please report.”];</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
_getBond: function _getBond(a) {</p>
<blockquote>
<div><dl class="simple">
<dt>switch (a) {</dt><dd><dl class="simple">
<dt>case “-“:</dt><dd><p>return “{-}”;</p>
</dd>
<dt>case “1”:</dt><dd><p>return “{-}”;</p>
</dd>
<dt>case “=”:</dt><dd><p>return “{=}”;</p>
</dd>
<dt>case “2”:</dt><dd><p>return “{=}”;</p>
</dd>
<dt>case “#”:</dt><dd><p>return “{\equiv}”;</p>
</dd>
<dt>case “3”:</dt><dd><p>return “{\equiv}”;</p>
</dd>
<dt>case “~”:</dt><dd><p>return “{\tripledash}”;</p>
</dd>
<dt>case “~-“:</dt><dd><p>return “{\mathrlap{\raisebox{-.1em}{$-$}}\raisebox{.1em}{$\tripledash$}}”;</p>
</dd>
<dt>case “~=”:</dt><dd><p>return “{\mathrlap{\raisebox{-.2em}{$-$}}\mathrlap{\raisebox{.2em}{$\tripledash$}}-}”;</p>
</dd>
<dt>case “~–“:</dt><dd><p>return “{\mathrlap{\raisebox{-.2em}{$-$}}\mathrlap{\raisebox{.2em}{$\tripledash$}}-}”;</p>
</dd>
<dt>case “-~-“:</dt><dd><p>return “{\mathrlap{\raisebox{-.2em}{$-$}}\mathrlap{\raisebox{.2em}{$-$}}\tripledash}”;</p>
</dd>
<dt>case “…”:</dt><dd><p>return “{{\cdot}{\cdot}{\cdot}}”;</p>
</dd>
<dt>case “….”:</dt><dd><p>return “{{\cdot}{\cdot}{\cdot}{\cdot}}”;</p>
</dd>
<dt>case “-&gt;”:</dt><dd><p>return “{\rightarrow}”;</p>
</dd>
<dt>case “&lt;-“:</dt><dd><p>return “{\leftarrow}”;</p>
</dd>
<dt>case “&lt;”:</dt><dd><p>return “{&lt;}”;</p>
</dd>
<dt>case “&gt;”:</dt><dd><p>return “{&gt;}”;</p>
</dd>
<dt>default:</dt><dd><p>assertNever(a);
throw [“MhchemBugT”, “mhchem bug T. Please report.”];</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
_getOperator: function _getOperator(a) {</p>
<blockquote>
<div><dl class="simple">
<dt>switch (a) {</dt><dd><dl class="simple">
<dt>case “+”:</dt><dd><p>return “ {}+{} “;</p>
</dd>
<dt>case “-“:</dt><dd><p>return “ {}-{} “;</p>
</dd>
<dt>case “=”:</dt><dd><p>return “ {}={} “;</p>
</dd>
<dt>case “&lt;”:</dt><dd><p>return “ {}&lt;{} “;</p>
</dd>
<dt>case “&gt;”:</dt><dd><p>return “ {}&gt;{} “;</p>
</dd>
<dt>case “&lt;&lt;”:</dt><dd><p>return “ {}\ll{} “;</p>
</dd>
<dt>case “&gt;&gt;”:</dt><dd><p>return “ {}\gg{} “;</p>
</dd>
<dt>case “\pm”:</dt><dd><p>return “ {}\pm{} “;</p>
</dd>
<dt>case “\approx”:</dt><dd><p>return “ {}\approx{} “;</p>
</dd>
<dt>case “$\approx$”:</dt><dd><p>return “ {}\approx{} “;</p>
</dd>
<dt>case “v”:</dt><dd><p>return “ \downarrow{} “;</p>
</dd>
<dt>case “(v)”:</dt><dd><p>return “ \downarrow{} “;</p>
</dd>
<dt>case “^”:</dt><dd><p>return “ \uparrow{} “;</p>
</dd>
<dt>case “(^)”:</dt><dd><p>return “ \uparrow{} “;</p>
</dd>
<dt>default:</dt><dd><p>assertNever(a);
throw [“MhchemBugT”, “mhchem bug T. Please report.”];</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}; //
// Helpers for code anaylsis
// Will show type error at calling position
//</p>
<p>/** &#64;param {number} a <a href="#id69"><span class="problematic" id="id70">*</span></a>/</p>
<p>function assertNever(a) {}
/** &#64;param {string} a <a href="#id71"><span class="problematic" id="id72">*</span></a>/</p>
<p>function assertString(a) {}</p>
<p>/<strong>*/ })
/****</strong>/ ])[“default”];
});</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/static/katex/contrib/mhchem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>