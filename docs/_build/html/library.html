<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/library.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-library-md">
<h1>docs/library.md<a class="headerlink" href="#docs-library-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-01-05 08:54:11</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Library</span>
</pre></div>
</div>
<p>You can use Octane as a Node.js library for your backend application. You’ll be able to use methods for transaction validation, signing and fee payer account management (for example, swapping token fees to SOL).</p>
<p>## Install</p>
<p>Currently, Octane isn’t available on NPM. You can install it from the git repo using GitPkg:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">yarn</span> <span class="pre">add</span> <span class="pre">'https://gitpkg.now.sh/solana-labs/octane/packages/core?630a8d6afc90d2fe5aad88db2dc56c880cdbb5ad&amp;scripts.postinstall=yarn%20install%20--ignore-scripts%20%26%26%20yarn%20run%20build'</span>
<span class="pre">`</span></code></p>
<p>## Methods</p>
<p>### Actions</p>
<p>Actions are self-contained transaction validation and signing endpoints.</p>
<p>You can call them from your backend endpoints when your use case fits in the Octane server capabilities:
* Paying for transactions with an SPL token fee (including if it’s your own token)
* Paying for creating associated token accounts with an SPL token fee
* Paying for gasless swaps with an SPL Token fee or without fee</p>
<p>#### signWithTokenFee</p>
<p>Sign transaction by fee payer if the first instruction of transaction is a transfer of token fee and the rest instructions do not interact with fee payer’s wallet.</p>
<p>It also implements additional checks: duplicated transactions, fee payer source and failing transactions detection using simulation.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>javascript
const { signature } = await signWithTokenFee(</p>
<blockquote>
<div><p>connection,
transaction,
feePayerKeypair,
2,
5000,
[</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>mint: mint,
account: feePayerTokenAccount.address,
decimals: 9,
fee: BigInt(100),</p>
</dd>
</dl>
<p>},</p>
</div></blockquote>
<p>],
cache,
2000</p>
</div></blockquote>
<p>);
transaction.addSignature(feePayerKeypair.publicKey, base58.decode(signature));
await sendAndConfirmRawTransaction(connection, transaction.serialize(), { commitment: ‘confirmed’ });
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<div class="line-block">
<div class="line">Parameter            | Type                                       | Description                                                          |</div>
</div>
<p><a href="#id90"><span class="problematic" id="id91">|----------------------|</span></a>——————————————–<a href="#id92"><span class="problematic" id="id93">|----------------------------------------------------------------------|</span></a>
| connection           | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’          | Connection to a Solana node                                          |
| transaction          | Transaction from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’         | Transaction to sign                                                  |
| feePayer             | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’             | Keypair that will pay for transaction fees                           |
| maxSignatures        | number                                     | Maximum allowed signatures in the transaction including fee payer’s  |
| lamportsPerSignature | number                                     | Maximum transaction fee payment amount in lamports                   |
| allowedTokens        | core.TokenFee[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core">‘<span>&#64;</span>solana/octane-core</a>’ | List of tokens that can be used for Octane fees with associated info |
| cache                | Cache from ‘cache-manager’                 | A cache to store duplicate transactions                              |
| sameSourceTimeout    | number                                     | An interval for transactions with same token fee source, ms          |</p>
<p>#### createAccountIfTokenFeePaid</p>
<p>Signs transaction by fee payer if both statements are true:</p>
<ol class="loweralpha simple">
<li><p>the first instruction is a transfer of token fee to given account</p></li>
<li><p>the second instruction creates an associated token account with initialization fees paid by fee payer.</p></li>
</ol>
<p>This action allows end users to transfer some tokens to a new associated token account, while paying rent fees in SPL tokens instead of SOL.</p>
<p>Token fee for this operation should be higher then usual. Node owners pay SOL for both transaction fees and rent exemption of the newly created account.</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>javascript
const { signature } = await createAccountIfTokenFeePaid(</p>
<blockquote>
<div><p>connection,
accountTransaction,
feePayerKeypair,
2,
5000,
[</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>mint: mint,
account: feePayerTokenAccount.address,
decimals: 9,
fee: BigInt(100),</p>
</dd>
</dl>
<p>},</p>
</div></blockquote>
<p>],
cache,
2000,</p>
</div></blockquote>
<p>);
accountTransaction.addSignature(feePayerKeypair.publicKey, base58.decode(signature));
await sendAndConfirmRawTransaction(connection, accountTransaction.serialize(), { commitment: ‘confirmed’ });
<a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<div class="line-block">
<div class="line">Parameter            | Type                                       | Description                                                          |</div>
</div>
<p><a href="#id94"><span class="problematic" id="id95">|----------------------|</span></a>——————————————–<a href="#id96"><span class="problematic" id="id97">|----------------------------------------------------------------------|</span></a>
| connection           | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’          | Connection to a Solana node                                          |
| transaction          | Transaction from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’         | Transaction to sign                                                  |
| feePayer             | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’             | Keypair that will pay for transaction fees                           |
| maxSignatures        | number                                     | Maximum allowed signatures in the transaction including fee payer’s  |
| lamportsPerSignature | number                                     | Maximum transaction fee payment amount in lamports                   |
| allowedTokens        | core.TokenFee[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core">‘<span>&#64;</span>solana/octane-core</a>’ | List of tokens that can be used for Octane fees with associated info |
| cache                | Cache from ‘cache-manager’                 | A cache to store duplicate transactions                              |
| sameSourceTimeout    | number                                     | An interval for transactions with same token fee source, ms          |</p>
<p>#### buildWhirlpoolsSwapToSOL</p>
<p>Creates a non-signed transaction with Whirlpools swap from one SPL token to unwrapped SOL.</p>
<p>The transaction has to be signed using <cite>signGeneratedTransaction</cite>. If you want full protection against failed transaction spend, you have to sign after receiving user’s signature.</p>
<p><cite>messageToken</cite> has to be passed to <cite>signGeneratedTransaction</cite> to verify that transaction hasn’t changed since the generation.</p>
<p>Fee has to be paid in swapped token.</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>javascript
const { transaction, quote, messageToken } = await buildWhirlpoolsSwapToSOL(</p>
<blockquote>
<div><p>connection,
feePayerKeypair,
userPublicKey,
sourceMint,
new BN(100000), // in token decimals
slippingTolerance,
cache,
3000,
{</p>
<blockquote>
<div><p>amount: Number(tokenFee.fee), // in token decimals
sourceAccount: await getAssociatedTokenAddress(sourceMint, user),
destinationAccount: tokenFee.account</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<section id="id21">
<h2>);<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Parameter         | Type                                  | Description                                                   |</div>
</div>
<p><a href="#id98"><span class="problematic" id="id99">|-------------------|</span></a>—————————————<a href="#id100"><span class="problematic" id="id101">|---------------------------------------------------------------|</span></a>
| connection        | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’     | Connection to a Solana node                                   |
| feePayer          | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’        | Keypair that will pay for transaction fees                    |
| user              | PublicKey from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’      | Public key of user’s wallet with tokens                       |
| sourceMint        | PublicKey from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’      | Mint of source token for swap                                 |
| amount            | BN from ‘bn.js’                       | Amount of token to swap, in token decimals                    |
| slippingTolerance | Percentage from <a class="reference external" href="mailto:'&#37;&#52;&#48;orca-so/common-sdk">‘<span>&#64;</span>orca-so/common-sdk</a>’ | Slipping tolerance relative to transaction                    |
| cache             | Cache from ‘cache-manager’            | A cache to store duplicate transactions                       |
| sameMintTimeout   | number                                | An interval for swap transactions with same mint and user, ms |
| feeOptions?       | FeeOptions from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core">‘<span>&#64;</span>solana/octane-core</a>’ | A fee settings for Octane to charge on this swap              |</p>
<p>#### signGeneratedTransaction</p>
<p>Signs previously generated transaction by Octane. The transaction should have user’s signature. The authenticity check is provided using <cite>messageToken</cite> argument, which is a signature for transaction’s message.</p>
<p><a href="#id22"><span class="problematic" id="id23">``</span></a><a href="#id24"><span class="problematic" id="id25">`</span></a>javascript
const { signature } = await signGeneratedTransaction(</p>
<blockquote>
<div><p>connection,
transaction,
feePayerKeypair,
whirlpools.MESSAGE_TOKEN_KEY, // or ‘whirlpools-swap’
messageToken,
cache,</p>
</div></blockquote>
<p>);
transaction.addSignature(</p>
<blockquote>
<div><p>feePayerKeypair.publicKey,
Buffer.from(base58.decode(signature))</p>
</div></blockquote>
<p>);
await sendAndConfirmRawTransaction(</p>
<blockquote>
<div><p>connection,
transaction.serialize(),
{commitment: ‘confirmed’}</p>
</div></blockquote>
</section>
<section id="id26">
<h2>);<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Parameter         | Type                                  | Description                                                         |</div>
</div>
<p><a href="#id102"><span class="problematic" id="id103">|-------------------|</span></a>—————————————<a href="#id104"><span class="problematic" id="id105">|---------------------------------------------------------------------|</span></a>
| connection        | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’     | Connection to a Solana node                                         |
| transaction       | Transaction from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’    | Transaction to sign                                                 |
| feePayer          | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’        | Keypair that will pay for transaction fees                          |
| messageTokenKey   | string                                | Key used in messageToken generation, for example, ‘whirlpools-swap’ |
| messageToken      | string                                | Key returned from transaction generation action                     |
| cache             | Cache from ‘cache-manager’            | A cache to store duplicate transactions                             |</p>
<p>### Core</p>
<p>Octane’s core provides helper functions for implementing your own gasless signing logic.</p>
<p>You can view example of such usage in [octane-demo app’s backend](<a class="reference external" href="https://github.com/sevazhidkov/octane-demo/blob/main/src/pages/api/auth-transactions/send.ts">https://github.com/sevazhidkov/octane-demo/blob/main/src/pages/api/auth-transactions/send.ts</a>).</p>
<p>#### validateTransaction</p>
<p>Validates transaction metadata prior to signing by fee payer: fee payer, fee, signatures. After validation return signature by fee payer.</p>
<p><em>Does not</em> validate instructions.</p>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a>javascript
import { core } from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core">‘<span>&#64;</span>solana/octane-core</a>’;</p>
<p>let signature: string;
try {</p>
<blockquote>
<div><dl class="simple">
<dt>signature = (await core.validateTransaction(</dt><dd><p>connection,
transaction,
feePayer,
2,
5000,</p>
</dd>
</dl>
<p>)).signature;</p>
</div></blockquote>
<dl class="simple">
<dt>} catch (e) {</dt><dd><p>console.log(e);
res.status(400).send({status: ‘error’, message: ‘bad transaction’});
return;</p>
</dd>
</dl>
</section>
<section id="id31">
<h2>}<a class="headerlink" href="#id31" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Parameter            | Type                               | Description                                                         |</div>
</div>
<p><a href="#id106"><span class="problematic" id="id107">|----------------------|</span></a>————————————<a href="#id108"><span class="problematic" id="id109">|---------------------------------------------------------------------|</span></a>
| connection           | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’  | Connection to a Solana node                                         |
| transaction          | Transaction from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’ | User’s transaction                                                  |
| feePayer             | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’     | Keypair that will pay for transaction fees                          |
| maxSignatures        | number                             | Maximum allowed signatures in the transaction including fee payer’s |
| lamportsPerSignature | number                             | Maximum transaction fee payment amount in lamports                  |</p>
<p>#### validateInstructions</p>
<p>Checks that instructions in a transaction do not use fee payer’s account as writable.</p>
<p><a href="#id32"><span class="problematic" id="id33">``</span></a><a href="#id34"><span class="problematic" id="id35">`</span></a>javascript
try {</p>
<blockquote>
<div><blockquote>
<div><p>await core.validateInstructions(transaction, feePayer);</p>
</div></blockquote>
<dl class="simple">
<dt>} catch (e) {</dt><dd><p>res.status(400).send({status: ‘error’, message: ‘bad instructions’});
return;</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p><a href="#id36"><span class="problematic" id="id37">``</span></a><a href="#id38"><span class="problematic" id="id39">`</span></a></p>
<div class="line-block">
<div class="line">Parameter         | Type                                  | Description                                |</div>
</div>
<p><a href="#id110"><span class="problematic" id="id111">|-------------------|</span></a>—————————————<a href="#id112"><span class="problematic" id="id113">|--------------------------------------------|</span></a>
| transaction       | Transaction from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’    | User’s transaction                         |
| feePayer          | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’        | Keypair that will pay for transaction fees |</p>
<p>### Payer utils</p>
<p>When providing gasless transactions for your users, you manage a Solana wallet that accepts tokens and stores SOL for user’s transactions. Naturally, amount of SOL decreases and balances of tokens increase. You have to regularly swap tokens for SOL to keep node operational. Additionally, node operators have to create associated token accounts for each token they receive and setup pricing settings for each token individually.</p>
<p><cite>PayerUtils</cite> are helper functions to manage your fee payer signing account.</p>
<p>#### getPopularTokens</p>
<p>Returns popular tokens from Jupyter aggregator.</p>
<div class="line-block">
<div class="line">Parameter | Type   | Description                   |</div>
</div>
<p><a href="#id114"><span class="problematic" id="id115">|-----------|</span></a>——–<a href="#id116"><span class="problematic" id="id117">|-------------------------------|</span></a>
| count     | number | Number of tokens from the top |</p>
<p><a href="#id40"><span class="problematic" id="id41">``</span></a><a href="#id42"><span class="problematic" id="id43">`</span></a>javascript
const popularTokenMints = await PayerUtils.getPopularTokens(10);</p>
<p>// const tokensWithPriceInfo = await Promise.all(popularTokenMints.map(async mint =&gt; ({
//     mint: mint,
//     priceInfo: await PayerUtils.getTokenToNativePriceInfo(mint)
// })));
<a href="#id44"><span class="problematic" id="id45">``</span></a><a href="#id46"><span class="problematic" id="id47">`</span></a></p>
<p>#### getTokenToNativePriceInfo</p>
<p>Returns token’s price info from Jupyter aggregator.</p>
<p><a href="#id48"><span class="problematic" id="id49">``</span></a><a href="#id50"><span class="problematic" id="id51">`</span></a>javascript
import { PayerUtils } from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core">‘<span>&#64;</span>solana/octane-core</a>’;</p>
<p>const priceInfo = await PayerUtils.getTokenToNativePriceInfo(mint);</p>
<p>// const tokenFee = (await PayerUtils.buildTokenFeeList(
//     connection,
//     ENV_SECRET_KEYPAIR.publicKey,
//     [{ mint, priceInfo }],
//     pricingParams,
// ))[0];
<a href="#id52"><span class="problematic" id="id53">``</span></a><a href="#id54"><span class="problematic" id="id55">`</span></a></p>
<div class="line-block">
<div class="line">Parameter | Type                             | Description |</div>
</div>
<p><a href="#id118"><span class="problematic" id="id119">|-----------|</span></a>———————————-<a href="#id120"><span class="problematic" id="id121">|-------------|</span></a>
| mint      | PublicKey from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’ | Token mint  |</p>
<p>#### buildTokenFeeList</p>
<p>Builds a list of tokens with prices and accounts to receive fees. Should be used to configure <cite>allowedTokens</cite> parameter or <cite>config.json</cite>.</p>
<p><a href="#id56"><span class="problematic" id="id57">``</span></a><a href="#id58"><span class="problematic" id="id59">`</span></a>javascript
const tokenFee = (await PayerUtils.buildTokenFeeList(</p>
<blockquote>
<div><p>connection,
ENV_SECRET_KEYPAIR.publicKey,
[{ mint, priceInfo }],
{ costInLamports: 5000, margin: 0.9 },</p>
</div></blockquote>
<p>))[0];</p>
<p>console.log(JSON.stringify(tokenFee.toSerializable()));
<a href="#id60"><span class="problematic" id="id61">``</span></a><a href="#id62"><span class="problematic" id="id63">`</span></a></p>
<div class="line-block">
<div class="line">Parameter  | Type                                                       | Description                                                          |</div>
</div>
<p><a href="#id122"><span class="problematic" id="id123">|------------|</span></a>————————————————————<a href="#id124"><span class="problematic" id="id125">|----------------------------------------------------------------------|</span></a>
| connection | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’                          | Connection to a Solana node                                          |
| feePayer   | PublicKey from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’                           | Public key of a wallet that will receive fees in associated accounts |
| tokens     | TokenWithPriceInfo[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;PayerUtils">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>PayerUtils</a> | Tokens with mints and price info that should be included             |
| params     | PricingParams from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;PayerUtils">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>PayerUtils</a>        | Options to set price with margin                                     |</p>
<p>#### buildCreateAccountListFromTokenFees</p>
<p>Returns uncreated associated token accounts for fees from TokenFee list. You can create these accounts using <cite>PayerUtils.createAccounts</cite>.</p>
<p><a href="#id64"><span class="problematic" id="id65">``</span></a><a href="#id66"><span class="problematic" id="id67">`</span></a>javascript
const createAccounts = await PayerUtils.buildCreateAccountListFromTokenFees(</p>
<blockquote>
<div><p>connection,
ENV_SECRET_KEYPAIR.publicKey,
config.endpoints.transfer.tokens.map((tokenFee) =&gt; core.TokenFee.fromSerializable(tokenFee))</p>
</div></blockquote>
<p>);</p>
<p>console.log(‘accounts to create:’, createAccounts);
<a href="#id68"><span class="problematic" id="id69">``</span></a><a href="#id70"><span class="problematic" id="id71">`</span></a></p>
<div class="line-block">
<div class="line">Parameter  | Type                                       | Description                                                          |</div>
</div>
<p><a href="#id126"><span class="problematic" id="id127">|------------|</span></a>——————————————–<a href="#id128"><span class="problematic" id="id129">|----------------------------------------------------------------------|</span></a>
| connection | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’          | Connection to a Solana node                                          |
| feePayer   | PublicKey from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’           | Public key of a wallet that will receive fees in associated accounts |
| tokenFees  | TokenFee[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;core">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>core</a> | Tokens configured to receive payments                                |</p>
<p>#### createAccounts</p>
<p>Creates associated token accounts returned from <cite>buildCreateAccountListFromTokenFees</cite>.</p>
<p><a href="#id72"><span class="problematic" id="id73">``</span></a><a href="#id74"><span class="problematic" id="id75">`</span></a>javascript
const createAccounts = await PayerUtils.buildCreateAccountListFromTokenFees(</p>
<blockquote>
<div><p>connection,
ENV_SECRET_KEYPAIR.publicKey,
config.endpoints.transfer.tokens.map((tokenFee) =&gt; core.TokenFee.fromSerializable(tokenFee))</p>
</div></blockquote>
<p>);
const result = await PayerUtils.createAccounts(connection, ENV_SECRET_KEYPAIR, createAccounts);
<a href="#id76"><span class="problematic" id="id77">``</span></a><a href="#id78"><span class="problematic" id="id79">`</span></a></p>
<div class="line-block">
<div class="line">Parameter      | Type                                                  | Description                                     |</div>
</div>
<p><a href="#id130"><span class="problematic" id="id131">|----------------|</span></a>——————————————————-<a href="#id132"><span class="problematic" id="id133">|-------------------------------------------------|</span></a>
| connection     | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’                     | Connection to a Solana node                     |
| feePayer       | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’                        | Keypair that will own associated token accounts |
| createAccounts | CreateAccount[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;PayerUtils">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>PayerUtils</a> | Accounts to create                              |</p>
<p>#### loadSwapRoutesForTokenFees</p>
<p>Calculates swap routes from tokens to SOL using Jupyter aggregator API for a list of token fees.</p>
<p>It only returns tokens with balance higher than provided threshold.</p>
<p>Use <cite>executeSwapByRoute</cite> to execute each swap.</p>
<p><a href="#id80"><span class="problematic" id="id81">``</span></a><a href="#id82"><span class="problematic" id="id83">`</span></a>javascript
const routesToSwap = await PayerUtils.loadSwapRoutesForTokenFees(</p>
<blockquote>
<div><p>connection,
config.endpoints.transfer.tokens.map(token =&gt; core.TokenFee.fromSerializable(token)),
parseInt(threshold),
0.5</p>
</div></blockquote>
</section>
<section id="id84">
<h2>);<a class="headerlink" href="#id84" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Parameter           | Type                                       | Description                                                                     |</div>
</div>
<p><a href="#id134"><span class="problematic" id="id135">|---------------------|</span></a>——————————————–<a href="#id136"><span class="problematic" id="id137">|---------------------------------------------------------------------------------|</span></a>
| connection          | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’          | Connection to a Solana node                                                     |
| tokenFees           | TokenFee[] from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;core">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>core</a> | Tokens configured to receive payments, that would be checked for possible swaps |
| thresholdInLamports | number                                     | The minimum amount of SOL lamports to receive from a swap                       |
| slippage            | number                                     | Accepted slippage for the swap                                                  |</p>
<p>#### executeSwapByRoute</p>
<p>Execute calculated swaps from <cite>loadSwapRoutesForTokenFees</cite>.</p>
<p><a href="#id85"><span class="problematic" id="id86">``</span></a><a href="#id87"><span class="problematic" id="id88">`</span></a>javascript
for (const route of routesToSwap) {</p>
<blockquote>
<div><p>const txids = await PayerUtils.executeSwapByRoute(connection, ENV_SECRET_KEYPAIR, route);
console.log(<cite>Executed transactions:</cite>, txids);</p>
</div></blockquote>
</section>
<section id="id89">
<h2>}<a class="headerlink" href="#id89" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Parameter  | Type                                        | Description                                           |</div>
</div>
<p><a href="#id138"><span class="problematic" id="id139">|------------|</span></a>———————————————<a href="#id140"><span class="problematic" id="id141">|-------------------------------------------------------|</span></a>
| connection | Connection from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’           | Connection to a Solana node                           |
| feePayer   | Keypair from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/web3&#46;js">‘<span>&#64;</span>solana/web3<span>&#46;</span>js</a>’              | Owner of token accounts                               |
| route      | Route from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/octane-core'&#46;PayerUtils">‘<span>&#64;</span>solana/octane-core’<span>&#46;</span>PayerUtils</a> | Minimum amount of SOL lamports to receive from a swap |</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/library.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>