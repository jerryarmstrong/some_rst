<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/developing/lookup-tables.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-developing-lookup-tables-md">
<h1>docs/src/developing/lookup-tables.md<a class="headerlink" href="#docs-src-developing-lookup-tables-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Address Lookup Tables
description: “”
—</p>
<p>Address Lookup Tables, commonly referred to as “_lookup <a href="#id31"><span class="problematic" id="id32">tables_</span></a>” or “_ALTs_” for short, allow developers to create a collection of related addresses to efficiently load more addresses in a single transaction.</p>
<p>Since each transaction on the Solana blockchain requires a listing of every address that is interacted with as part of the transaction, this listing would effectively be capped at 32 addresses per transaction. With the help of [Address Lookup Tables](./lookup-tables.md), a transaction would now be able to raise that limit to 256 addresses per transaction.</p>
<p>## Compressing on chain addresses</p>
<p>After all the desired addresses have been stored on chain in an Address Lookup Table, each address can be referenced inside a transaction by its 1-byte index within the table (instead of their full 32-byte address). This lookup method effectively “_compresses_” a 32-byte address into a 1-byte index value.</p>
<p>This “_compression_” enables storing up to 256 addresses in a single lookup table for use inside any given transaction.</p>
<p>## Versioned Transactions</p>
<p>To utilize an Address Lookup Table inside a transaction, developers must use v0 transactions that were introduced with the new [Versioned Transaction format](./versioned-transactions.md).</p>
<p>## How to create an address lookup table</p>
<p>Creating a new lookup table with the <cite>&#64;solana/web3.js</cite> library is similar to the older <cite>legacy</cite> transactions, but with some differences.</p>
<p>Using the <cite>&#64;solana/web3.js</cite> library, you can use the [<cite>createLookupTable</cite>](<a class="reference external" href="https://solana-labs.github.io/solana-web3.js/classes/AddressLookupTableProgram.html#createLookupTable">https://solana-labs.github.io/solana-web3.js/classes/AddressLookupTableProgram.html#createLookupTable</a>) function to construct the instruction needed to create a new lookup table, as well as determine its address:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>js
const web3 = require(“&#64;solana/web3.js”);</p>
<p>// connect to a cluster and get the current <cite>slot</cite>
const connection = new web3.Connection(web3.clusterApiUrl(“devnet”));
const slot = await connection.getSlot();</p>
<p>// Assumption:
// <cite>payer</cite> is a valid <cite>Keypair</cite> with enough SOL to pay for the execution</p>
<dl>
<dt>const [lookupTableInst, lookupTableAddress] =</dt><dd><dl class="simple">
<dt>web3.AddressLookupTableProgram.createLookupTable({</dt><dd><p>authority: payer.publicKey,
payer: payer.publicKey,
recentSlot: slot,</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>console.log(“lookup table address:”, lookupTableAddress.toBase58());</p>
<p>// To create the Address Lookup Table on chain:
// send the <cite>lookupTableInst</cite> instruction in a transaction
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>&gt; NOTE:
&gt; Address lookup tables can be <strong>created</strong> with either a <cite>v0</cite> transaction or a <cite>legacy</cite> transaction. But the Solana runtime can only retrieve and handle the additional addresses within a lookup table while using [v0 Versioned Transactions](./versioned-transactions.md#current-transaction-versions).</p>
<p>## Add addresses to a lookup table</p>
<p>Adding addresses to a lookup table is known as “_extending_”. Using the <cite>&#64;solana/web3.js</cite> library, you can create a new _extend_ instruction using the [<cite>extendLookupTable</cite>](<a class="reference external" href="https://solana-labs.github.io/solana-web3.js/classes/AddressLookupTableProgram.html#extendLookupTable">https://solana-labs.github.io/solana-web3.js/classes/AddressLookupTableProgram.html#extendLookupTable</a>) method:</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><cite>js
// add addresses to the `lookupTableAddress</cite> table via an <cite>extend</cite> instruction
const extendInstruction = web3.AddressLookupTableProgram.extendLookupTable({</p>
<blockquote>
<div><p>payer: payer.publicKey,
authority: payer.publicKey,
lookupTable: lookupTableAddress,
addresses: [</p>
<blockquote>
<div><p>payer.publicKey,
web3.SystemProgram.programId,
// list more <cite>publicKey</cite> addresses here</p>
</div></blockquote>
<p>],</p>
</div></blockquote>
<p>});</p>
<p>// Send this <cite>extendInstruction</cite> in a transaction to the cluster
// to insert the listing of <cite>addresses</cite> into your lookup table with address <cite>lookupTableAddress</cite>
<a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a></p>
<p>&gt; NOTE:
&gt; Due to the same memory limits of <cite>legacy</cite> transactions, any transaction used to _extend_ an Address Lookup Table is also limited in how many addresses can be added at a time. Because of this, you will need to use multiple transactions to _extend_ any table with more addresses (~20) that can fit within a single transaction’s memory limits.</p>
<p>Once these addresses have been inserted into the table, and stored on chain, you will be able to utilize the Address Lookup Table in future transactions. Enabling up to 256 addresses in those future transactions.</p>
<p>## Fetch an Address Lookup Table</p>
<p>Similar to requesting another account (or PDA) from the cluster, you can fetch a complete Address Lookup Table with the [<cite>getAddressLookupTable</cite>](<a class="reference external" href="https://solana-labs.github.io/solana-web3.js/classes/Connection.html#getAddressLookupTable">https://solana-labs.github.io/solana-web3.js/classes/Connection.html#getAddressLookupTable</a>) method:</p>
<p><a href="#id15"><span class="problematic" id="id16">``</span></a><cite>js
// define the `PublicKey</cite> of the lookup table to fetch
const lookupTableAddress = new web3.PublicKey(“”);</p>
<p>// get the table from the cluster
const lookupTableAccount = (await connection.getAddressLookupTable(lookupTableAddress)).value;</p>
<p>// <cite>lookupTableAccount</cite> will now be a <cite>AddressLookupTableAccount</cite> object</p>
<p>console.log(“Table address from cluster:”, lookupTableAccount.key.toBase58());
<a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a></p>
<p>Our <cite>lookupTableAccount</cite> variable will now be a <cite>AddressLookupTableAccount</cite> object which we can parse to read the listing of all the addresses stored on chain in the lookup table:</p>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a>js
// loop through and parse all the addresses stored in the table
for (let i = 0; i &lt; lookupTableAccount.state.addresses.length; i++) {</p>
<blockquote>
<div><p>const address = lookupTableAccount.state.addresses[i];
console.log(i, address.toBase58());</p>
</div></blockquote>
<section id="id25">
<h2>}<a class="headerlink" href="#id25" title="Permalink to this heading">¶</a></h2>
<p>## How to use an address lookup table in a transaction</p>
<p>After you have created your lookup table, and stored your needed address on chain (via extending the lookup table), you can create a <cite>v0</cite> transaction to utilize the on chain lookup capabilities.</p>
<p>Just like older <cite>legacy</cite> transactions, you can create all the [instructions](./../terminology.md#instruction) your transaction will execute on chain. You can then provide an array of these instructions to the [Message](./../terminology.md#message) used in the <a href="#id26"><span class="problematic" id="id27">`</span></a>v0 transaction.</p>
<p>&gt; NOTE:
&gt; The instructions used inside a <cite>v0</cite> transaction can be constructed using the same methods and functions used to create the instructions in the past. There is no required change to the instructions used involving an Address Lookup Table.</p>
<p><a href="#id28"><span class="problematic" id="id29">``</span></a><cite>js
// Assumptions:
// - `arrayOfInstructions</cite> has been created as an <cite>array</cite> of <cite>TransactionInstruction</cite>
// - we are using the <cite>lookupTableAccount</cite> obtained above</p>
<p>// construct a v0 compatible transaction <cite>Message</cite>
const messageV0 = new web3.TransactionMessage({</p>
<blockquote>
<div><p>payerKey: payer.publicKey,
recentBlockhash: blockhash,
instructions: arrayOfInstructions, // note this is an array of instructions</p>
</div></blockquote>
<p>}).compileToV0Message([lookupTableAccount]);</p>
<p>// create a v0 transaction from the v0 message
const transactionV0 = new web3.VersionedTransaction(messageV0);</p>
<p>// sign the v0 transaction using the file system wallet we created named <cite>payer</cite>
transactionV0.sign([payer]);</p>
<p>// send and confirm the transaction
// (NOTE: There is NOT an array of Signers here; see the note below…)
const txid = await web3.sendAndConfirmTransaction(connection, transactionV0);</p>
<dl class="simple">
<dt>console.log(</dt><dd><p><cite>Transaction: https://explorer.solana.com/tx/${txid}?cluster=devnet</cite>,</p>
</dd>
</dl>
</section>
<section id="id30">
<h2>);<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h2>
<p>&gt; NOTE:
&gt; When sending a <cite>VersionedTransaction</cite> to the cluster, it must be signed BEFORE calling the
&gt; <cite>sendAndConfirmTransaction</cite> method. If you pass an array of <cite>Signer</cite>
&gt; (like with <cite>legacy</cite> transactions) the method will trigger an error!</p>
<p>## More Resources</p>
<ul class="simple">
<li><p>Read the [proposal](./../proposals/versioned-transactions.md) for Address Lookup Tables and Versioned transactions</p></li>
<li><p>[Example Rust program using Address Lookup Tables](<a class="reference external" href="https://github.com/TeamRaccoons/address-lookup-table-multi-swap">https://github.com/TeamRaccoons/address-lookup-table-multi-swap</a>)</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/developing/lookup-tables.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>