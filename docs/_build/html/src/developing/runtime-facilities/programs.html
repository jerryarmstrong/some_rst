<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/developing/runtime-facilities/programs.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-developing-runtime-facilities-programs-md">
<h1>docs/src/developing/runtime-facilities/programs.md<a class="headerlink" href="#docs-src-developing-runtime-facilities-programs-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: “Native Programs”
—</p>
<p>Solana contains a small handful of native programs, which are required to run
validator nodes. Unlike third-party programs, the native programs are part of
the validator implementation and can be upgraded as part of cluster upgrades.
Upgrades may occur to add features, fix bugs, or improve performance. Interface
changes to individual instructions should rarely, if ever, occur. Instead, when
change is needed, new instructions are added and previous ones are marked
deprecated. Apps can upgrade on their own timeline without concern of breakages
across upgrades.</p>
<p>For each native program the program id and description each supported
instruction is provided. A transaction can mix and match instructions from different
programs, as well include instructions from on-chain programs.</p>
<p>## System Program</p>
<p>Create new accounts, allocate account data, assign accounts to owning programs,
transfer lamports from System Program owned accounts and pay transaction fees.</p>
<ul class="simple">
<li><p>Program id: <cite>11111111111111111111111111111111</cite></p></li>
<li><p>Instructions: [SystemInstruction](<a class="reference external" href="https://docs.rs/solana-program/VERSION_FOR_DOCS_RS/solana_program/system_instruction/enum.SystemInstruction.html">https://docs.rs/solana-program/VERSION_FOR_DOCS_RS/solana_program/system_instruction/enum.SystemInstruction.html</a>)</p></li>
</ul>
<p>## Config Program</p>
<p>Add configuration data to the chain and the list of public keys that are permitted to modify it</p>
<ul class="simple">
<li><p>Program id: <cite>Config1111111111111111111111111111111111111</cite></p></li>
<li><p>Instructions: [config_instruction](<a class="reference external" href="https://docs.rs/solana-config-program/VERSION_FOR_DOCS_RS/solana_config_program/config_instruction/index.html">https://docs.rs/solana-config-program/VERSION_FOR_DOCS_RS/solana_config_program/config_instruction/index.html</a>)</p></li>
</ul>
<p>Unlike the other programs, the Config program does not define any individual
instructions. It has just one implicit instruction, a “store” instruction. Its
instruction data is a set of keys that gate access to the account, and the
data to store in it.</p>
<p>## Stake Program</p>
<p>Create and manage accounts representing stake and rewards for delegations to
validators.</p>
<ul class="simple">
<li><p>Program id: <cite>Stake11111111111111111111111111111111111111</cite></p></li>
<li><p>Instructions: [StakeInstruction](<a class="reference external" href="https://docs.rs/solana-sdk/VERSION_FOR_DOCS_RS/solana_sdk/stake/instruction/enum.StakeInstruction.html">https://docs.rs/solana-sdk/VERSION_FOR_DOCS_RS/solana_sdk/stake/instruction/enum.StakeInstruction.html</a>)</p></li>
</ul>
<p>## Vote Program</p>
<p>Create and manage accounts that track validator voting state and rewards.</p>
<ul class="simple">
<li><p>Program id: <cite>Vote111111111111111111111111111111111111111</cite></p></li>
<li><p>Instructions: [VoteInstruction](<a class="reference external" href="https://docs.rs/solana-vote-program/VERSION_FOR_DOCS_RS/solana_vote_program/vote_instruction/enum.VoteInstruction.html">https://docs.rs/solana-vote-program/VERSION_FOR_DOCS_RS/solana_vote_program/vote_instruction/enum.VoteInstruction.html</a>)</p></li>
</ul>
<p>## BPF Loader</p>
<p>Deploys, upgrades, and executes programs on the chain.</p>
<ul class="simple">
<li><p>Program id: <cite>BPFLoaderUpgradeab1e11111111111111111111111</cite></p></li>
<li><p>Instructions: [LoaderInstruction](<a class="reference external" href="https://docs.rs/solana-sdk/VERSION_FOR_DOCS_RS/solana_sdk/loader_upgradeable_instruction/enum.UpgradeableLoaderInstruction.html">https://docs.rs/solana-sdk/VERSION_FOR_DOCS_RS/solana_sdk/loader_upgradeable_instruction/enum.UpgradeableLoaderInstruction.html</a>)</p></li>
</ul>
<p>The BPF Upgradeable Loader marks itself as “owner” of the executable and
program-data accounts it creates to store your program. When a user invokes an
instruction via a program id, the Solana runtime will load both your the program
and its owner, the BPF Upgradeable Loader. The runtime then passes your program
to the BPF Upgradeable Loader to process the instruction.</p>
<p>[More information about deployment](cli/deploy-a-program.md)</p>
<p>## Ed25519 Program</p>
<p>Verify ed25519 signature program. This program takes an ed25519 signature, public key, and message.
Multiple signatures can be verified. If any of the signatures fail to verify, an error is returned.</p>
<ul class="simple">
<li><p>Program id: <cite>Ed25519SigVerify111111111111111111111111111</cite></p></li>
<li><p>Instructions: [new_ed25519_instruction](<a class="reference external" href="https://github.com/solana-labs/solana/blob/master/sdk/src/ed25519_instruction.rs#L45">https://github.com/solana-labs/solana/blob/master/sdk/src/ed25519_instruction.rs#L45</a>)</p></li>
</ul>
<p>The ed25519 program processes an instruction. The first <cite>u8</cite> is a count of the number of
signatures to check, which is followed by a single byte padding. After that, the
following struct is serialized, one for each signature to check.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
struct Ed25519SignatureOffsets {</p>
<blockquote>
<div><p>signature_offset: u16,             // offset to ed25519 signature of 64 bytes
signature_instruction_index: u16,  // instruction index to find signature
public_key_offset: u16,            // offset to public key of 32 bytes
public_key_instruction_index: u16, // instruction index to find public key
message_data_offset: u16,          // offset to start of message data
message_data_size: u16,            // size of message data
message_instruction_index: u16,    // index of instruction data to get message data</p>
</div></blockquote>
<section id="id3">
<h2>}<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>Pseudo code of the operation:</p>
<p><a href="#id4"><span class="problematic" id="id5">``</span></a>`
process_instruction() {</p>
<blockquote>
<div><dl>
<dt>for i in 0..count {</dt><dd><p>// i’th index values referenced:
instructions = &amp;transaction.message().instructions
instruction_index = ed25519_signature_instruction_index != u16::MAX ? ed25519_signature_instruction_index : current_instruction;
signature = instructions[instruction_index].data[ed25519_signature_offset..ed25519_signature_offset + 64]
instruction_index = ed25519_pubkey_instruction_index != u16::MAX ? ed25519_pubkey_instruction_index : current_instruction;
pubkey = instructions[instruction_index].data[ed25519_pubkey_offset..ed25519_pubkey_offset + 32]
instruction_index = ed25519_message_instruction_index != u16::MAX ? ed25519_message_instruction_index : current_instruction;
message = instructions[instruction_index].data[ed25519_message_data_offset..ed25519_message_data_offset + ed25519_message_data_size]
if pubkey.verify(signature, message) != Success {</p>
<blockquote>
<div><p>return Error</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}
return Success</p>
</div></blockquote>
</section>
<section id="id6">
<h2>}<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h2>
<p>## Secp256k1 Program</p>
<p>Verify secp256k1 public key recovery operations (ecrecover).</p>
<ul class="simple">
<li><p>Program id: <cite>KeccakSecp256k11111111111111111111111111111</cite></p></li>
<li><p>Instructions: [new_secp256k1_instruction](<a class="reference external" href="https://github.com/solana-labs/solana/blob/1a658c7f31e1e0d2d39d9efbc0e929350e2c2bcb/sdk/src/secp256k1_instruction.rs#L31">https://github.com/solana-labs/solana/blob/1a658c7f31e1e0d2d39d9efbc0e929350e2c2bcb/sdk/src/secp256k1_instruction.rs#L31</a>)</p></li>
</ul>
<p>The secp256k1 program processes an instruction which takes in as the first byte
a count of the following struct serialized in the instruction data:</p>
<p><a href="#id7"><span class="problematic" id="id8">``</span></a>`
struct Secp256k1SignatureOffsets {</p>
<blockquote>
<div><p>secp_signature_key_offset: u16,        // offset to [signature,recovery_id,etherum_address] of 64+1+20 bytes
secp_signature_instruction_index: u8,  // instruction index to find data
secp_pubkey_offset: u16,               // offset to [signature,recovery_id] of 64+1 bytes
secp_signature_instruction_index: u8,  // instruction index to find data
secp_message_data_offset: u16,         // offset to start of message data
secp_message_data_size: u16,           // size of message data
secp_message_instruction_index: u8,    // index of instruction data to get message data</p>
</div></blockquote>
</section>
<section id="id9">
<h2>}<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h2>
<p>Pseudo code of the operation:</p>
<p><a href="#id10"><span class="problematic" id="id11">``</span></a>`
process_instruction() {</p>
<blockquote>
<div><dl>
<dt>for i in 0..count {</dt><dd><p>// i’th index values referenced:
instructions = &amp;transaction.message().instructions
signature = instructions[secp_signature_instruction_index].data[secp_signature_offset..secp_signature_offset + 64]
recovery_id = instructions[secp_signature_instruction_index].data[secp_signature_offset + 64]
ref_eth_pubkey = instructions[secp_pubkey_instruction_index].data[secp_pubkey_offset..secp_pubkey_offset + 32]
message_hash = keccak256(instructions[secp_message_instruction_index].data[secp_message_data_offset..secp_message_data_offset + secp_message_data_size])
pubkey = ecrecover(signature, recovery_id, message_hash)
eth_pubkey = keccak256(pubkey[1..])[12..]
if eth_pubkey != ref_eth_pubkey {</p>
<blockquote>
<div><p>return Error</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}
return Success</p>
</div></blockquote>
</section>
<section id="id12">
<h2>}<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h2>
<p>This allows the user to specify any instruction data in the transaction for
signature and message data. By specifying a special instructions sysvar, one can
also receive data from the transaction itself.</p>
<p>Cost of the transaction will count the number of signatures to verify multiplied
by the signature cost verify multiplier.</p>
<p>### Optimization notes</p>
<p>The operation will have to take place after (at least partial) deserialization,
but all inputs come from the transaction data itself, this allows it to be
relatively easy to execute in parallel to transaction processing and PoH
verification.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/developing/runtime-facilities/programs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>