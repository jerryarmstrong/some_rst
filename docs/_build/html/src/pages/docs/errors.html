<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/pages/docs/errors.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-pages-docs-errors-md">
<h1>docs/src/pages/docs/errors.md<a class="headerlink" href="#docs-src-pages-docs-errors-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-12-14 20:15:57</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Errors
description: Anchor - Errors
—</p>
<p>&gt; [<cite>AnchorError</cite> Rust Reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/error/struct.AnchorError.html">https://docs.rs/anchor-lang/latest/anchor_lang/error/struct.AnchorError.html</a>)</p>
<p>&gt; [<cite>AnchorError</cite> Typescript Reference](<a class="reference external" href="https://coral-xyz.github.io/anchor/ts/classes/AnchorError.html">https://coral-xyz.github.io/anchor/ts/classes/AnchorError.html</a>)</p>
<p>There are two types of errors in anchor programs. AnchorErrors and non-anchor errors.
AnchorErrors can be divided into Anchor Internal Errors that the framework returns from inside its own code or
custom errors which the user (you!) can return.</p>
<ul class="simple">
<li><p>AnchorErrors
- Anchor Internal Errors
- Custom Errors</p></li>
<li><p>Non-anchor errors.</p></li>
</ul>
<p>[AnchorErrors](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/error/struct.AnchorError.html">https://docs.rs/anchor-lang/latest/anchor_lang/error/struct.AnchorError.html</a>) provide a range of information like the error name and number or the location in the code where the anchor was thrown, or the account that violated a constraint (e.g. a <cite>mut</cite> constraint). Once thrown inside the program, [you can access the error information](<a class="reference external" href="https://coral-xyz.github.io/anchor/ts/classes/AnchorError.html">https://coral-xyz.github.io/anchor/ts/classes/AnchorError.html</a>) in the anchor clients like the typescript client. The typescript client also enriches the error with additional information about which program the error was thrown in and the CPI calls (which are explained [here](./cross-program-invocations) in the book) that led to the program from which the error was thrown from. [The milestone chapter](./milestone_project_tic-tac-toe.md) explores how all of this works together in practice. For now, let’s look at how different errors can be returned from inside a program.</p>
<p>## Anchor Internal Errors</p>
<p>&gt; [Anchor Internal Error Code Reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/error/enum.ErrorCode.html">https://docs.rs/anchor-lang/latest/anchor_lang/error/enum.ErrorCode.html</a>)</p>
<p>Anchor has many different internal error codes. These are not meant to be used by users, but it’s useful to study the reference to learn about the mappings between codes and their causes. They are, for example, thrown when a constraint has been violated, e.g. when an account is marked with <cite>mut</cite> but its <cite>is_writable</cite> property is <cite>false</cite>.</p>
<p>## Custom Errors</p>
<p>You can add errors that are unique to your program by using the <cite>error_code</cite> attribute.</p>
<p>Simply add it to an enum with a name of your choice. You can then use the variants of the enum as errors in your program. Additionally, you can add a message attribute to the individual variants. Clients will then display this error message if the error occurs. Custom Error code numbers start at the [custom error offset](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/error/constant.ERROR_CODE_OFFSET.html">https://docs.rs/anchor-lang/latest/anchor_lang/error/constant.ERROR_CODE_OFFSET.html</a>).</p>
<p>To actually throw an error use the [<cite>err!</cite>](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/macro.err.html">https://docs.rs/anchor-lang/latest/anchor_lang/macro.err.html</a>) or the [<cite>error!</cite>](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/prelude/macro.error.html">https://docs.rs/anchor-lang/latest/anchor_lang/prelude/macro.error.html</a>) macro. These add file and line information to the error that is then logged by anchor.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>rust
#[program]
mod hello_anchor {</p>
<blockquote>
<div><p>use super::<a href="#id5"><span class="problematic" id="id6">*</span></a>;
pub fn set_data(ctx: Context&lt;SetData&gt;, data: MyAccount) -&gt; Result&lt;()&gt; {</p>
<blockquote>
<div><dl class="simple">
<dt>if data.data &gt;= 100 {</dt><dd><p>return err!(MyError::DataTooLarge);</p>
</dd>
</dl>
<p>}
ctx.accounts.my_account.set_inner(data);
Ok(())</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>#[error_code]
pub enum MyError {</p>
<blockquote>
<div><p>#[msg(“MyAccount may only hold data below 100”)]
DataTooLarge</p>
</div></blockquote>
<section id="id7">
<h2>}<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h2>
<p>### require!</p>
<p>You can use the [<cite>require</cite>](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/macro.require.html">https://docs.rs/anchor-lang/latest/anchor_lang/macro.require.html</a>) macro to simplify writing errors. The code above can be simplified to this (Note that the <cite>&gt;=</cite> flips to <cite>&lt;</cite>):</p>
<p><a href="#id8"><span class="problematic" id="id9">``</span></a><a href="#id10"><span class="problematic" id="id11">`</span></a>rust
#[program]
mod hello_anchor {</p>
<blockquote>
<div><p>use super::<a href="#id12"><span class="problematic" id="id13">*</span></a>;
pub fn set_data(ctx: Context&lt;SetData&gt;, data: MyAccount) -&gt; Result&lt;()&gt; {</p>
<blockquote>
<div><p>require!(data.data &lt; 100, MyError::DataTooLarge);
ctx.accounts.my_account.set_inner(data);
Ok(())</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>#[error_code]
pub enum MyError {</p>
<blockquote>
<div><p>#[msg(“MyAccount may only hold data below 100”)]
DataTooLarge</p>
</div></blockquote>
</section>
<section id="id14">
<h2>}<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h2>
<p>There are a couple of <cite>require</cite> macros to choose from ([search for require in the docs](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/?search=require">https://docs.rs/anchor-lang/latest/anchor_lang/?search=require</a>)). When comparing public keys, it’s important to use the <cite>keys</cite> variants of the require statements like <cite>require_keys_eq</cite> instead of <cite>require_eq</cite> because comparing public keys with <cite>require_eq</cite> is very expensive.</p>
<p>&gt; (Ultimately, all programs return the same Error: The [<cite>ProgramError</cite>](<a class="reference external" href="https://docs.rs/solana-program/latest/solana_program/program_error/enum.ProgramError.html">https://docs.rs/solana-program/latest/solana_program/program_error/enum.ProgramError.html</a>).</p>
<p>This Error has a field for a custom error number. This is where Anchor puts its internal and custom error codes. However, this is just a single number and a single number is only so useful. So in addition, in the case of AnchorErrors, Anchor logs the returned AnchorError and the Anchor clients parse these logs to provide as much information as possible. This is not always possible. For example, there is currently no easy way to get the logs of a <cite>processed</cite> transaction with preflight checks turned off. In addition, non-anchor or old anchor programs might not log AnchorErrors. In these cases, Anchor will fall back to checking whether the returned error number by the transaction matches an error number defined in the <cite>IDL</cite> or an Anchor internal error code. If so, Anchor will at least enrich the error with the error message. Also, if there are logs available, Anchor will always try to parse the program error stack and return that so you know which program the error was returned from.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/pages/docs/errors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>