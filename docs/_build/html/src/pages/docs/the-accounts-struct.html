<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/pages/docs/the-accounts-struct.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-pages-docs-the-accounts-struct-md">
<h1>docs/src/pages/docs/the-accounts-struct.md<a class="headerlink" href="#docs-src-pages-docs-the-accounts-struct-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-12-14 20:15:57</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: The Accounts Struct
description: Anchor - The Accounts Struct
—</p>
<p>The Accounts struct is where you define which accounts your instruction expects and which constraints these accounts should adhere to. You do this via two constructs: Types and constraints.</p>
<p>—</p>
<p>## Types</p>
<p>&gt; [Account Types Reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/index.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/index.html</a>)</p>
<p>Each type has a specific use case in mind. Detailed explanations for the types can be found in the [reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/index.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/index.html</a>). We will briefly explain the most important type here, the <cite>Account</cite> type.</p>
<p>### The Account Type</p>
<p>&gt; [Account Reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html</a>)</p>
<p>The <cite>Account</cite> type is used when an instruction is interested in the deserialized data of the account. Consider the following example where we set some data in an account:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>rust
use anchor_lang::prelude::<a href="#id5"><span class="problematic" id="id6">*</span></a>;</p>
<p>declare_id!(“Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS”);</p>
<p>#[program]
mod hello_anchor {</p>
<blockquote>
<div><p>use super::<a href="#id7"><span class="problematic" id="id8">*</span></a>;
pub fn set_data(ctx: Context&lt;SetData&gt;, data: u64) -&gt; Result&lt;()&gt; {</p>
<blockquote>
<div><p>ctx.accounts.my_account.data = data;
Ok(())</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>#[account]
#[derive(Default)]
pub struct MyAccount {</p>
<blockquote>
<div><p>data: u64</p>
</div></blockquote>
<p>}</p>
<p>#[derive(Accounts)]
pub struct SetData&lt;’info&gt; {</p>
<blockquote>
<div><p>#[account(mut)]
pub my_account: Account&lt;’info, MyAccount&gt;</p>
</div></blockquote>
<section id="id9">
<h2>}<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h2>
<p><cite>Account</cite> is generic over <cite>T</cite>. This <cite>T</cite> is a type you can create yourself to store data. In this example, we have created a struct <cite>MyAccount</cite> with a single <cite>data</cite> field to store a <cite>u64</cite>. Account requires <cite>T</cite> to implement certain functions (e.g. functions that (de)serialize <cite>T</cite>). Most of the time, you can use the <cite>#[account]</cite> attribute to add these functions to your data, as is done in the example.</p>
<p>Most importantly, the <cite>#[account]</cite> attribute sets the owner of that data to the <cite>ID</cite> (the one we created earlier with <cite>declare_id</cite>) of the crate <cite>#[account]</cite> is used in. The Account type can then check for you that the <cite>AccountInfo</cite> passed into your instruction has its <cite>owner</cite> field set to the correct program. In this example, <cite>MyAccount</cite> is declared in our own crate so <cite>Account</cite> will verify that the owner of <cite>my_account</cite> equals the address we declared with <cite>declare_id</cite>.</p>
<p>#### Using <cite>Account&lt;’a, T&gt;</cite> with non-anchor program accounts</p>
<p>There may be cases where you want your program to interact with a non-Anchor program. You can still get all the benefits of <cite>Account</cite> but you have to write a custom wrapper type instead of using <cite>#[account]</cite>. For instance, Anchor provides wrapper types for the token program accounts so they can be used with <cite>Account</cite>.</p>
<p><a href="#id10"><span class="problematic" id="id11">``</span></a><a href="#id12"><span class="problematic" id="id13">`</span></a>rust
use anchor_lang::prelude::<a href="#id14"><span class="problematic" id="id15">*</span></a>;
use anchor_spl::token::TokenAccount;</p>
<p>declare_id!(“Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS”);</p>
<p>#[program]
mod hello_anchor {</p>
<blockquote>
<div><p>use super::<a href="#id16"><span class="problematic" id="id17">*</span></a>;
pub fn set_data(ctx: Context&lt;SetData&gt;, data: u64) -&gt; Result&lt;()&gt; {</p>
<blockquote>
<div><dl class="simple">
<dt>if ctx.accounts.token_account.amount &gt; 0 {</dt><dd><p>ctx.accounts.my_account.data = data;</p>
</dd>
</dl>
<p>}
Ok(())</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>#[account]
#[derive(Default)]
pub struct MyAccount {</p>
<blockquote>
<div><p>data: u64,
mint: Pubkey</p>
</div></blockquote>
<p>}</p>
<p>#[derive(Accounts)]
pub struct SetData&lt;’info&gt; {</p>
<blockquote>
<div><p>#[account(mut)]
pub my_account: Account&lt;’info, MyAccount&gt;,
#[account(</p>
<blockquote>
<div><p>constraint = my_account.mint == token_account.mint,
has_one = owner</p>
</div></blockquote>
<p>)]
pub token_account: Account&lt;’info, TokenAccount&gt;,
pub owner: Signer&lt;’info&gt;</p>
</div></blockquote>
</section>
<section id="id18">
<h2>}<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h2>
<p>To run this example, add <cite>anchor-spl = “&lt;version&gt;”</cite> to the dependencies section in your <cite>Cargo.toml</cite>, located in the <cite>programs/&lt;your-project-name&gt;/</cite> directory. <cite>&lt;version&gt;</cite> should be equal to the <cite>anchor-lang</cite> version you’re using.</p>
<p>In this example, we set the <cite>data</cite> field of an account if the caller has admin rights. We decide whether the caller is an admin by checking whether they own admin tokens for the account they want to change. We do most of this via constraints which we will look at in the next section.
The important thing to take away is that we use the <cite>TokenAccount</cite> type (that wraps around the token program’s <cite>Account</cite> struct and adds the required functions) to make anchor ensure that the incoming account is owned by the token program and to make anchor deserialize it. This means we can use the <cite>TokenAccount</cite> properties inside our constraints (e.g. <cite>token_account.mint</cite>) as well as in the instruction function.</p>
<p>Check out the [reference for the Account type](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html</a>) to learn how to implement your own wrapper types for non-anchor programs.</p>
<p>## Constraints</p>
<p>&gt; [Constraints reference](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/derive.Accounts.html">https://docs.rs/anchor-lang/latest/anchor_lang/derive.Accounts.html</a>)</p>
<p>Account types can do a lot of work for you but they’re not dynamic enough to handle all the security checks a secure program requires.</p>
<p>Add constraints to an account with the following format:</p>
<p><code class="docutils literal notranslate"><span class="pre">`rust</span>
<span class="pre">#[account(&lt;constraints&gt;)]</span>
<span class="pre">pub</span> <span class="pre">account:</span> <span class="pre">AccountType</span>
<span class="pre">`</span></code></p>
<p>Some constraints support custom Errors (we will explore errors [later](./errors.md)):</p>
<p><code class="docutils literal notranslate"><span class="pre">`rust</span>
<span class="pre">#[account(...,&lt;constraint&gt;</span> <span class="pre">&#64;</span> <span class="pre">MyError::MyErrorVariant,</span> <span class="pre">...)]</span>
<span class="pre">pub</span> <span class="pre">account:</span> <span class="pre">AccountType</span>
<span class="pre">`</span></code></p>
<p>For example, in the examples above, we used the <cite>mut</cite> constraint to indicate that <cite>my_account</cite> should be mutable. We used <cite>has_one</cite> to check that <cite>token_account.owner == owner.key()</cite>. And finally we used <cite>constraint</cite> to check an arbitrary expression; in this case, whether the incoming <cite>TokenAccount</cite> belongs to the admin mint.</p>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a>rust
#[derive(Accounts)]
pub struct SetData&lt;’info&gt; {</p>
<blockquote>
<div><p>#[account(mut)]
pub my_account: Account&lt;’info, MyAccount&gt;,
#[account(</p>
<blockquote>
<div><p>constraint = my_account.mint == token_account.mint,
has_one = owner</p>
</div></blockquote>
<p>)]
pub token_account: Account&lt;’info, TokenAccount&gt;,
pub owner: Signer&lt;’info&gt;</p>
</div></blockquote>
</section>
<section id="id23">
<h2>}<a class="headerlink" href="#id23" title="Permalink to this heading">¶</a></h2>
<p>You can find information about all constraints in the reference. We will cover some of the most important ones in the milestone project at the end of the Essentials section.</p>
<p>## Safety checks</p>
<p>Two of the Anchor account types, [AccountInfo](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account_info/index.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account_info/index.html</a>) and [UncheckedAccount](<a class="reference external" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/unchecked_account/index.html">https://docs.rs/anchor-lang/latest/anchor_lang/accounts/unchecked_account/index.html</a>) do not implement any checks on the account being passed. Anchor implements safety checks that encourage additional documentation describing why additional checks are not necesssary.</p>
<p>Attempting to build a program containing the following excerpt with <cite>anchor build</cite>:</p>
<p><a href="#id24"><span class="problematic" id="id25">``</span></a><a href="#id26"><span class="problematic" id="id27">`</span></a>rust
#[derive(Accounts)]
pub struct Initialize&lt;’info&gt; {</p>
<blockquote>
<div><p>pub potentially_dangerous: UncheckedAccount&lt;’info&gt;</p>
</div></blockquote>
</section>
<section id="id28">
<h2>}<a class="headerlink" href="#id28" title="Permalink to this heading">¶</a></h2>
<p>will result in an error similar to the following:</p>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a>shell
Error:</p>
<blockquote>
<div><p>/anchor/tests/unchecked/programs/unchecked/src/lib.rs:15:8
Struct field “potentially_dangerous” is unsafe, but is not documented.
Please add a <cite>/// CHECK:</cite> doc comment explaining why no checks through types are necessary.
See <a class="reference external" href="https://book.anchor-lang.com/anchor_in_depth/the_accounts_struct.html#safety-checks">https://book.anchor-lang.com/anchor_in_depth/the_accounts_struct.html#safety-checks</a> for more information.</p>
</div></blockquote>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a></p>
<p>To fix this, write a doc comment describing the potential security implications, e.g.:</p>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a>rust
#[derive(Accounts)]
pub struct Initialize&lt;’info&gt; {</p>
<blockquote>
<div><p>/// CHECK: This is not dangerous because we don’t read or write from this account
pub potentially_dangerous: UncheckedAccount&lt;’info&gt;</p>
</div></blockquote>
</section>
<section id="id41">
<h2>}<a class="headerlink" href="#id41" title="Permalink to this heading">¶</a></h2>
<p>{% callout type=”warning” title=”Note” %}
The doc comment needs to be a [line or block doc comment](<a class="reference external" href="https://doc.rust-lang.org/reference/comments.html#doc-comments">https://doc.rust-lang.org/reference/comments.html#doc-comments</a>) (/// or /**) to be interepreted as doc attribute by Rust. Double slash comments (//) are not interpreted as such.
{% /callout %}</p>
<p>## Other Resources</p>
<ul class="simple">
<li><p>[Solana Cookbook](<a class="reference external" href="https://solanacookbook.com/core-concepts/accounts.html">https://solanacookbook.com/core-concepts/accounts.html</a>)</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/pages/docs/the-accounts-struct.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>