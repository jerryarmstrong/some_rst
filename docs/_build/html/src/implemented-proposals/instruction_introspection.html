<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/implemented-proposals/instruction_introspection.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-implemented-proposals-instruction-introspection-md">
<h1>docs/src/implemented-proposals/instruction_introspection.md<a class="headerlink" href="#docs-src-implemented-proposals-instruction-introspection-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: instruction introspection
—</p>
<p>## Problem</p>
<p>Some smart contract programs may want to verify that another Instruction is present in a
given Message since that Instruction could be be performing a verification of certain data,
in a precompiled function. (See secp256k1_instruction for an example).</p>
<p>## Solution</p>
<p>Add a new sysvar Sysvar1nstructions1111111111111111111111111 that a program can reference
and received the Message’s instruction data inside, and also the index of the current instruction.</p>
<p>Two helper functions to extract this data can be used:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">fn</span> <span class="pre">load_current_index_checked(instruction_data:</span> <span class="pre">&amp;[u8])</span> <span class="pre">-&gt;</span> <span class="pre">u16;</span>
<span class="pre">fn</span> <span class="pre">load_instruction_at_checked(instruction_index:</span> <span class="pre">usize,</span> <span class="pre">instruction_sysvar_account_info:</span> <span class="pre">&amp;AccountInfo)</span> <span class="pre">-&gt;</span> <span class="pre">Result&lt;Instruction&gt;;</span>
<span class="pre">`</span></code></p>
<p>The runtime will recognize this special instruction, serialize the Message instruction data
for it and also write the current instruction index and then the bpf program can extract the
necessary information from there.</p>
<p>Note: custom serialization of instructions is used because bincode is about 10x slower
in native code and exceeds current SBF instruction limits.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/implemented-proposals/instruction_introspection.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>