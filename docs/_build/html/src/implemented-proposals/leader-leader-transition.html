<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/implemented-proposals/leader-leader-transition.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-implemented-proposals-leader-leader-transition-md">
<h1>docs/src/implemented-proposals/leader-leader-transition.md<a class="headerlink" href="#docs-src-implemented-proposals-leader-leader-transition-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Leader-to-Leader Transition
—</p>
<p>This design describes how leaders transition production of the PoH ledger between each other as each leader generates its own slot.</p>
<p>## Challenges</p>
<p>Current leader and the next leader are both racing to generate the final tick for the current slot. The next leader may arrive at that slot while still processing the current leader’s entries.</p>
<p>The ideal scenario would be that the next leader generated its own slot right after it was able to vote for the current leader. It is very likely that the next leader will arrive at their PoH slot height before the current leader finishes broadcasting the entire block.</p>
<p>The next leader has to make the decision of attaching its own block to the last completed block, or wait to finalize the pending block. It is possible that the next leader will produce a block that proposes that the current leader failed, even though the rest of the network observes that block succeeding.</p>
<p>The current leader has incentives to start its slot as early as possible to capture economic rewards. Those incentives need to be balanced by the leader’s need to attach its block to a block that has the most commitment from the rest of the network.</p>
<p>## Leader timeout</p>
<p>While a leader is actively receiving entries for the previous slot, the leader can delay broadcasting the start of its block in real time. The delay is locally configurable by each leader, and can be dynamically based on the previous leader’s behavior. If the previous leader’s block is confirmed by the leader’s TVU before the timeout, the PoH is reset to the start of the slot and this leader produces its block immediately.</p>
<p>The downsides:</p>
<ul>
<li><p>Leader delays its own slot, potentially allowing the next leader more time to</p>
<p>catch up.</p>
</li>
</ul>
<p>The upsides compared to guards:</p>
<ul class="simple">
<li><p>All the space in a block is used for entries.</p></li>
<li><p>The timeout is not fixed.</p></li>
<li><p>The timeout is local to the leader, and therefore can be clever. The leader’s heuristic can take into account turbine performance.</p></li>
<li><p>This design doesn’t require a ledger hard fork to update.</p></li>
<li><p>The previous leader can redundantly transmit the last entry in the block to the next leader, and the next leader can speculatively decide to trust it to generate its block without verification of the previous block.</p></li>
<li><p>The leader can speculatively generate the last tick from the last received entry.</p></li>
<li><p>The leader can speculatively process transactions and guess which ones are not going to be encoded by the previous leader. This is also a censorship attack vector. The current leader may withhold transactions that it receives from the clients so it can encode them into its own slot. Once processed, entries can be replayed into PoH quickly.</p></li>
</ul>
<p>## Alternative design options</p>
<p>### Guard tick at the end of the slot</p>
<p>A leader does not produce entries in its block after the _penultimate <a href="#id1"><span class="problematic" id="id2">tick_</span></a>, which is the last tick before the first tick of the next slot. The network votes on the _last <a href="#id3"><span class="problematic" id="id4">tick_</span></a>, so the time difference between the _penultimate <a href="#id5"><span class="problematic" id="id6">tick_</span></a> and the _last <a href="#id7"><span class="problematic" id="id8">tick_</span></a> is the forced delay for the entire network, as well as the next leader before a new slot can be generated. The network can produce the _last <a href="#id9"><span class="problematic" id="id10">tick_</span></a> from the _penultimate <a href="#id11"><span class="problematic" id="id12">tick_</span></a>.</p>
<p>If the next leader receives the _penultimate <a href="#id13"><span class="problematic" id="id14">tick_</span></a> before it produces its own _first <a href="#id15"><span class="problematic" id="id16">tick_</span></a>, it will reset its PoH and produce the _first <a href="#id17"><span class="problematic" id="id18">tick_</span></a> from the previous leader’s _penultimate <a href="#id19"><span class="problematic" id="id20">tick_</span></a>. The rest of the network will also reset its PoH to produce the _last <a href="#id21"><span class="problematic" id="id22">tick_</span></a> as the id to vote on.</p>
<p>The downsides:</p>
<ul class="simple">
<li><p>Every vote, and therefore confirmation, is delayed by a fixed timeout. 1 tick, or around 100ms.</p></li>
<li><p>Average case confirmation time for a transaction would be at least 50ms worse.</p></li>
<li><p>It is part of the ledger definition, so to change this behavior would require a hard fork.</p></li>
<li><p>Not all the available space is used for entries.</p></li>
</ul>
<p>The upsides compared to leader timeout:</p>
<ul class="simple">
<li><p>The next leader has received all the previous entries, so it can start processing transactions without recording them into PoH.</p></li>
<li><p>The previous leader can redundantly transmit the last entry containing the _penultimate <a href="#id23"><span class="problematic" id="id24">tick_</span></a> to the next leader. The next leader can speculatively generate the _last <a href="#id25"><span class="problematic" id="id26">tick_</span></a> as soon as it receives the _penultimate <a href="#id27"><span class="problematic" id="id28">tick_</span></a>, even before verifying it.</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/implemented-proposals/leader-leader-transition.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>