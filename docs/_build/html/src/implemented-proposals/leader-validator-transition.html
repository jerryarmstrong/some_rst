<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/implemented-proposals/leader-validator-transition.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-implemented-proposals-leader-validator-transition-md">
<h1>docs/src/implemented-proposals/leader-validator-transition.md<a class="headerlink" href="#docs-src-implemented-proposals-leader-validator-transition-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Leader-to-Validator Transition
—</p>
<p>A validator typically spends its time validating blocks. If, however, a staker delegates its stake to a validator, it will occasionally be selected as a _slot <a href="#id1"><span class="problematic" id="id2">leader_</span></a>. As a slot leader, the validator is responsible for producing blocks during an assigned _slot_. A slot has a duration of some number of preconfigured _ticks_. The duration of those ticks are estimated with a _PoH <a href="#id3"><span class="problematic" id="id4">Recorder_</span></a> described later in this document.</p>
<p>## BankFork</p>
<p>BankFork tracks changes to the bank state over a specific slot. Once the final tick has been registered the state is frozen. Any attempts to write to are rejected.</p>
<p>## Validator</p>
<p>A validator operates on many different concurrent forks of the bank state until it generates a PoH hash with a height within its leader slot.</p>
<p>## Slot Leader</p>
<p>A slot leader builds blocks on top of only one fork, the one it last voted on.</p>
<p>## PoH Recorder</p>
<p>Slot leaders and validators use a PoH Recorder for both estimating slot height and for recording transactions.</p>
<p>### PoH Recorder when Validating</p>
<p>The PoH Recorder acts as a simple VDF when validating. It tells the validator when it needs to switch to the slot leader role. Every time the validator votes on a fork, it should use the fork’s latest [blockhash](../terminology.md#blockhash) to re-seed the VDF. Re-seeding solves two problems. First, it synchronizes its VDF to the leader’s, allowing it to more accurately determine when its leader slot begins. Second, if the previous leader goes down, all wallclock time is accounted for in the next leader’s PoH stream. For example, if one block is missing when the leader starts, the block it produces should have a PoH duration of two blocks. The longer duration ensures the following leader isn’t attempting to snip all the transactions from the previous leader’s slot.</p>
<p>### PoH Recorder when Leading</p>
<p>A slot leader use the PoH Recorder to record transactions, locking their positions in time. The PoH hash must be derived from a previous leader’s last block. If it isn’t, its block will fail PoH verification and be rejected by the cluster.</p>
<p>The PoH Recorder also serves to inform the slot leader when its slot is over. The leader needs to take care not to modify its bank if recording the transaction would generate a PoH height outside its designated slot. The leader, therefore, should not commit account changes until after it generates the entry’s PoH hash. When the PoH height falls outside its slot any transactions in its pipeline may be dropped or forwarded to the next leader. Forwarding is preferred, as it would minimize network congestion, allowing the cluster to advertise higher TPS capacity.</p>
<p>## Validator Loop</p>
<p>The PoH Recorder manages the transition between modes. Once a ledger is replayed, the validator can run until the recorder indicates it should be the slot leader. As a slot leader, the node can then execute and record transactions.</p>
<p>The loop is synchronized to PoH and does a synchronous start and stop of the slot leader functionality. After stopping, the validator’s TVU should find itself in the same state as if a different leader had sent it the same block. The following is pseudocode for the loop:</p>
<ol class="arabic">
<li><p>Query the LeaderScheduler for the next assigned slot.</p></li>
<li><p>Run the TVU over all the forks. 1. TVU will send votes to what it believes is the “best” fork. 2. After each vote, restart the PoH Recorder to run until the next assigned</p>
<p>slot.</p>
</li>
<li><p>When time to be a slot leader, start the TPU. Point it to the last fork the</p>
<p>TVU voted on.</p>
</li>
<li><p>Produce entries until the end of the slot. 1. For the duration of the slot, the TVU must not vote on other forks. 2. After the slot ends, the TPU freezes its BankFork. After freezing,</p>
<p>the TVU may resume voting.</p>
</li>
<li><p>Goto 1.</p></li>
</ol>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/implemented-proposals/leader-validator-transition.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>