<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/offline-signing/durable-nonce.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-offline-signing-durable-nonce-md">
<h1>docs/src/offline-signing/durable-nonce.md<a class="headerlink" href="#docs-src-offline-signing-durable-nonce-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Durable Transaction Nonces
—</p>
<p>Durable transaction nonces are a mechanism for getting around the typical
short lifetime of a transaction’s [<cite>recent_blockhash</cite>](developing/programming-model/transactions.md#recent-blockhash).
They are implemented as a Solana Program, the mechanics of which can be read
about in the [proposal](../implemented-proposals/durable-tx-nonces.md).</p>
<p>## Usage Examples</p>
<p>Full usage details for durable nonce CLI commands can be found in the
[CLI reference](../cli/usage.md).</p>
<p>### Nonce Authority</p>
<p>Authority over a nonce account can optionally be assigned to another account. In
doing so the new authority inherits full control over the nonce account from the
previous authority, including the account creator. This feature enables the
creation of more complex account ownership arrangements and derived account
addresses not associated with a keypair. The <cite>–nonce-authority &lt;AUTHORITY_KEYPAIR&gt;</cite>
argument is used to specify this account and is supported by the following
commands</p>
<ul class="simple">
<li><p><cite>create-nonce-account</cite></p></li>
<li><p><cite>new-nonce</cite></p></li>
<li><p><cite>withdraw-from-nonce-account</cite></p></li>
<li><p><cite>authorize-nonce-account</cite></p></li>
</ul>
<p>### Nonce Account Creation</p>
<p>The durable transaction nonce feature uses an account to store the next nonce
value. Durable nonce accounts must be [rent-exempt](../implemented-proposals/rent.md#two-tiered-rent-regime),
so need to carry the minimum balance to achieve this.</p>
<p>A nonce account is created by first generating a new keypair, then create the account on chain</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">nonce-keypair.json</span>
<span class="pre">solana</span> <span class="pre">create-nonce-account</span> <span class="pre">nonce-keypair.json</span> <span class="pre">1</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">2SymGjGV4ksPdpbaqWFiDoBz8okvtiik4KE9cnMQgRHrRLySSdZ6jrEcpPifW4xUpp4z66XM9d9wM48sA7peG2XL</span>
<span class="pre">`</span></code></p>
<p>&gt; To keep the keypair entirely offline, use the [Paper Wallet](wallet-guide/paper-wallet.md) keypair generation [instructions](wallet-guide/paper-wallet.md#seed-phrase-generation) instead</p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-create-nonce-account)</p>
<p>### Querying the Stored Nonce Value</p>
<p>Creating a durable nonce transaction requires passing the stored nonce value as
the value to the <cite>–blockhash</cite> argument upon signing and submission. Obtain the
presently stored nonce value with</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">nonce</span> <span class="pre">nonce-keypair.json</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">8GRipryfxcsxN8mAGjy8zbFo9ezaUsh47TsPzmZbuytU</span>
<span class="pre">`</span></code></p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-get-nonce)</p>
<p>### Advancing the Stored Nonce Value</p>
<p>While not typically needed outside a more useful transaction, the stored nonce
value can be advanced by</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">new-nonce</span> <span class="pre">nonce-keypair.json</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">44jYe1yPKrjuYDmoFTdgPjg8LFpYyh1PFKJqm5SC1PiSyAL8iw1bhadcAX1SL7KDmREEkmHpYvreKoNv6fZgfvUK</span>
<span class="pre">`</span></code></p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-new-nonce)</p>
<p>### Display Nonce Account</p>
<p>Inspect a nonce account in a more human friendly format with</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">nonce-account</span> <span class="pre">nonce-keypair.json</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">balance:</span> <span class="pre">0.5</span> <span class="pre">SOL</span>
<span class="pre">minimum</span> <span class="pre">balance</span> <span class="pre">required:</span> <span class="pre">0.00136416</span> <span class="pre">SOL</span>
<span class="pre">nonce:</span> <span class="pre">DZar6t2EaCFQTbUP4DHKwZ1wT8gCPW2aRfkVWhydkBvS</span>
<span class="pre">`</span></code></p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-nonce-account)</p>
<p>### Withdraw Funds from a Nonce Account</p>
<p>Withdraw funds from a nonce account with</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">withdraw-from-nonce-account</span> <span class="pre">nonce-keypair.json</span> <span class="pre">~/.config/solana/id.json</span> <span class="pre">0.5</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">3foNy1SBqwXSsfSfTdmYKDuhnVheRnKXpoPySiUDBVeDEs6iMVokgqm7AqfTjbk7QBE8mqomvMUMNQhtdMvFLide</span>
<span class="pre">`</span></code></p>
<p>&gt; Close a nonce account by withdrawing the full balance</p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-withdraw-from-nonce-account)</p>
<p>### Assign a New Authority to a Nonce Account</p>
<p>Reassign the authority of a nonce account after creation with</p>
<ul class="simple">
<li><p>Command</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">authorize-nonce-account</span> <span class="pre">nonce-keypair.json</span> <span class="pre">nonce-authority.json</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p>Output</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`text</span>
<span class="pre">3F9cg4zN9wHxLGx4c3cUKmqpej4oa67QbALmChsJbfxTgTffRiL3iUehVhR9wQmWgPua66jPuAYeL1K2pYYjbNoT</span>
<span class="pre">`</span></code></p>
<p>&gt; [Full usage documentation](../cli/usage.md#solana-authorize-nonce-account)</p>
<p>## Other Commands Supporting Durable Nonces</p>
<p>To make use of durable nonces with other CLI subcommands, two arguments must be
supported.</p>
<ul class="simple">
<li><p><cite>–nonce</cite>, specifies the account storing the nonce value</p></li>
<li><p><cite>–nonce-authority</cite>, specifies an optional [nonce authority](#nonce-authority)</p></li>
</ul>
<p>The following subcommands have received this treatment so far</p>
<ul class="simple">
<li><p>[<cite>pay</cite>](../cli/usage.md#solana-pay)</p></li>
<li><p>[<cite>delegate-stake</cite>](../cli/usage.md#solana-delegate-stake)</p></li>
<li><p>[<cite>deactivate-stake</cite>](../cli/usage.md#solana-deactivate-stake)</p></li>
</ul>
<p>### Example Pay Using Durable Nonce</p>
<p>Here we demonstrate Alice paying Bob 1 SOL using a durable nonce. The procedure
is the same for all subcommands supporting durable nonces</p>
<p>#### - Create accounts</p>
<p>First we need some accounts for Alice, Alice’s nonce and Bob</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">alice.json</span>
<span class="pre">$</span> <span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">nonce.json</span>
<span class="pre">$</span> <span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">-o</span> <span class="pre">bob.json</span>
<span class="pre">`</span></code></p>
<p>#### - Fund Alice’s account</p>
<p>Alice will need some funds to create a nonce account and send to Bob. Airdrop
her some SOL</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">airdrop</span> <span class="pre">-k</span> <span class="pre">alice.json</span> <span class="pre">1</span>
<span class="pre">1</span> <span class="pre">SOL</span>
<span class="pre">`</span></code></p>
<p>#### - Create Alice’s nonce account</p>
<p>Now Alice needs a nonce account. Create one</p>
<p>&gt; Here, no separate [nonce authority](#nonce-authority) is employed, so <cite>alice.json</cite> has full authority over the nonce account</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">create-nonce-account</span> <span class="pre">-k</span> <span class="pre">alice.json</span> <span class="pre">nonce.json</span> <span class="pre">0.1</span>
<span class="pre">3KPZr96BTsL3hqera9up82KAU462Gz31xjqJ6eHUAjF935Yf8i1kmfEbo6SVbNaACKE5z6gySrNjVRvmS8DcPuwV</span>
<span class="pre">`</span></code></p>
<p>#### - A failed first attempt to pay Bob</p>
<p>Alice attempts to pay Bob, but takes too long to sign. The specified blockhash
expires and the transaction fails</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">transfer</span> <span class="pre">-k</span> <span class="pre">alice.json</span> <span class="pre">--blockhash</span> <span class="pre">expiredDTaxfagttWjQweib42b6ZHADSx94Tw8gHx11</span> <span class="pre">bob.json</span> <span class="pre">0.01</span>
<span class="pre">[2020-01-02T18:48:28.462911000Z</span> <span class="pre">ERROR</span> <span class="pre">solana_cli::cli]</span> <span class="pre">Io(Custom</span> <span class="pre">{</span> <span class="pre">kind:</span> <span class="pre">Other,</span> <span class="pre">error:</span> <span class="pre">&quot;Transaction</span> <span class="pre">\&quot;33gQQaoPc9jWePMvDAeyJpcnSPiGUAdtVg8zREWv4GiKjkcGNufgpcbFyRKRrA25NkgjZySEeKue5rawyeH5TzsV\&quot;</span> <span class="pre">failed:</span> <span class="pre">None&quot;</span> <span class="pre">})</span>
<span class="pre">Error:</span> <span class="pre">Io(Custom</span> <span class="pre">{</span> <span class="pre">kind:</span> <span class="pre">Other,</span> <span class="pre">error:</span> <span class="pre">&quot;Transaction</span> <span class="pre">\&quot;33gQQaoPc9jWePMvDAeyJpcnSPiGUAdtVg8zREWv4GiKjkcGNufgpcbFyRKRrA25NkgjZySEeKue5rawyeH5TzsV\&quot;</span> <span class="pre">failed:</span> <span class="pre">None&quot;</span> <span class="pre">})</span>
<span class="pre">`</span></code></p>
<p>#### - Nonce to the rescue!</p>
<p>Alice retries the transaction, this time specifying her nonce account and the
blockhash stored there</p>
<p>&gt; Remember, <cite>alice.json</cite> is the [nonce authority](#nonce-authority) in this example</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">nonce-account</span> <span class="pre">nonce.json</span>
<span class="pre">balance:</span> <span class="pre">0.1</span> <span class="pre">SOL</span>
<span class="pre">minimum</span> <span class="pre">balance</span> <span class="pre">required:</span> <span class="pre">0.00136416</span> <span class="pre">SOL</span>
<span class="pre">nonce:</span> <span class="pre">F7vmkY3DTaxfagttWjQweib42b6ZHADSx94Tw8gHx3W7</span>
<span class="pre">`</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">transfer</span> <span class="pre">-k</span> <span class="pre">alice.json</span> <span class="pre">--blockhash</span> <span class="pre">F7vmkY3DTaxfagttWjQweib42b6ZHADSx94Tw8gHx3W7</span> <span class="pre">--nonce</span> <span class="pre">nonce.json</span> <span class="pre">bob.json</span> <span class="pre">0.01</span>
<span class="pre">HR1368UKHVZyenmH7yVz5sBAijV6XAPeWbEiXEGVYQorRMcoijeNAbzZqEZiH8cDB8tk65ckqeegFjK8dHwNFgQ</span>
<span class="pre">`</span></code></p>
<p>#### - Success!</p>
<p>The transaction succeeds! Bob receives 0.01 SOL from Alice and Alice’s stored
nonce advances to a new value</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">balance</span> <span class="pre">-k</span> <span class="pre">bob.json</span>
<span class="pre">0.01</span> <span class="pre">SOL</span>
<span class="pre">`</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">nonce-account</span> <span class="pre">nonce.json</span>
<span class="pre">balance:</span> <span class="pre">0.1</span> <span class="pre">SOL</span>
<span class="pre">minimum</span> <span class="pre">balance</span> <span class="pre">required:</span> <span class="pre">0.00136416</span> <span class="pre">SOL</span>
<span class="pre">nonce:</span> <span class="pre">6bjroqDcZgTv6Vavhqf81oBHTv3aMnX19UTB51YhAZnN</span>
<span class="pre">`</span></code></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/offline-signing/durable-nonce.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>