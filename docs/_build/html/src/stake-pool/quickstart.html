<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/stake-pool/quickstart.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-stake-pool-quickstart-md">
<h1>docs/src/stake-pool/quickstart.md<a class="headerlink" href="#docs-src-stake-pool-quickstart-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-07-07 18:10:20</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Quick Start Guide
—</p>
<p>This quick start guide is meant for managers who want to start running a pool
right away.</p>
<p>## Prerequisites</p>
<p>This guide requires the Solana CLI tool suite and Stake Pool CLI tool.</p>
<ul class="simple">
<li><p>[Install the Solana Tools](<a class="reference external" href="https://docs.solana.com/cli/install-solana-cli-tools">https://docs.solana.com/cli/install-solana-cli-tools</a>)</p></li>
<li><p>[Install the Stake Pool CLI](cli.md)</p></li>
</ul>
<p>You must also have an account with SOL. The guide will assume that you
are using the default keypair created at the default location using <cite>solana-keygen new</cite>.
Note that it is possible to override the default keypair with every command if
needed.</p>
<p>If you are running on localhost using <cite>solana-test-validator</cite>, the default keypair
will automatically start with 500,000,000 SOL.</p>
<p>If you are running on devnet or testnet, you can airdrop funds using <cite>solana airdrop 1</cite>.</p>
<p>If you are running on mainnet-beta, you must purchase funds some other way, from
an exchange, a friend, etc.</p>
<p>## Sample scripts</p>
<p>This guide uses the
[sample scripts on GitHub](<a class="reference external" href="https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/cli/scripts">https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/cli/scripts</a>)
to run everything quickly and easily.</p>
<p>You’ll see the following scripts:</p>
<ul class="simple">
<li><p><cite>setup-test-validator.sh</cite>: sets up a local test validator with validator vote accounts</p></li>
<li><p><cite>setup-stake-pool.sh</cite>: creates a new stake pool with hardcoded parameters</p></li>
<li><p><cite>add-validators.sh</cite>: adds validators to the stake pool</p></li>
<li><p><cite>deposit.sh</cite>: performs stake and SOL deposits</p></li>
<li><p><cite>rebalance.sh</cite>: rebalances the stake pool</p></li>
<li><p><cite>withdraw.sh</cite>: performs some withdrawals</p></li>
</ul>
<p>This guide will use most of these scripts to setup a stake pool on a local
network.</p>
<p>## (Optional) Step 0: Setup a local network for testing</p>
<p>All of these scripts can be run against devnet, testnet, or mainnet-beta, but
to allow for more experimentation, we will setup a local validator with some
validator vote accounts using <cite>setup-test-validator.sh</cite>.</p>
<p>The script accepts the number of vote accounts to create and file path to output
validator vote accounts, e.g.:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./setup-test-validator.sh</span> <span class="pre">10</span> <span class="pre">local_validators.txt</span>
<span class="pre">`</span></code></p>
<p>This will take roughly 10 seconds, eventually outputting a file with list of
base58-encoded public keys. These represent validator vote accounts on the
local network, e.g.:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">7q371UZcYJTMmFPeijUJ6RBr6jHE9t4mDd2gnDs7wpje</span>
<span class="pre">7ffftyketRJrmCcczhSnWatxB32SzAG3dhDpnyRdm91d</span>
<span class="pre">HtqJXQNWr4E1qxftAxxqNnHbpSYnokayHSxurzS9vKKF</span>
<span class="pre">4e6EmSSmExdRM6tF1osYiAq9HxXN5oVvDqS78FcT6F4P</span>
<span class="pre">DrT6VGqqJT1GRVaZmuEjNim4ie7ecmNixjiycd67jyJy</span>
<span class="pre">71vNo5HBuAtejbcQYp9CdBeT7npVdbJqjmuWbXbNeudq</span>
<span class="pre">7FMebvnWnWN45KF5Fa3Y7kAJZReKU6WLzribtWDJybax</span>
<span class="pre">`</span></code></p>
<p>Note: this will fail if another <cite>solana-test-validator</cite> is already running.</p>
<p>#### Important notes on local network</p>
<p>If you are using epochs of 32 slots, there is a good chance
that you will pass an epoch while using one of the stake pool commands, causing
it to fail with: <cite>Custom program error: 0x11</cite>. This is totally normal, and will
not happen on the other networks. You simply need to re-run the command.</p>
<p>Since there is no voting activity on the test validator network, you will
need to use the secret <cite>–force</cite> flag with <cite>solana delegate-stake</cite>, ie:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">delegate-stake</span> <span class="pre">--force</span> <span class="pre">stake.json</span> <span class="pre">CzDy6uxLTko5Jjcdm46AozMmrARY6R2aDBagdemiBuiT</span>
<span class="pre">`</span></code></p>
<p>## Step 1: Create the stake pool</p>
<p>Our next script is <cite>setup-stake-pool.sh</cite>. In it, you will see a large section
in which you can modify parameters for your stake pool. These parameters are used
to create a new stake pool, and include:</p>
<ul class="simple">
<li><p>epoch fee, expressed as two different flags, numerator and denominator</p></li>
<li><p>withdrawal fee, expressed as two different flags, numerator and denominator</p></li>
<li><p>deposit fee, expressed as two different flags, numerator and denominator</p></li>
<li><p>referral fee, expressed as a number between 0 and 100, inclusive</p></li>
<li><p>maximum number of validators (highest possible is 2,950 currently)</p></li>
<li><p>(Optional) deposit authority, for restricted pools</p></li>
</ul>
<p>Although fees may seem uninteresting or scammy at this point, consider the costs
of running your stake pool, and potential malicious actors that may abuse your pool
if it has no fees.</p>
<p>Each of these parameters is modifiable after pool creation, so there’s no need
to worry about being locked in to any choices.</p>
<p>Modify the parameters to suit your needs. The fees are especially important to
avoid abuse, so please take the time to review and calculate fees that work best
for your pool.</p>
<p>Carefully read through the [Fees](fees.md) for more information about fees and
best practices.</p>
<p>In our example, we will use fees of 0.3%, a referral fee of 50%, opt to <em>not</em>
set a deposit authority, and have the maximum number of validators (2,950).  Next,
run the script:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./setup-stake-pool.sh</span>
<span class="pre">Creating</span> <span class="pre">pool</span>
<span class="pre">+</span> <span class="pre">spl-stake-pool</span> <span class="pre">create-pool</span> <span class="pre">--epoch-fee-numerator</span> <span class="pre">3</span> <span class="pre">--epoch-fee-denominator</span> <span class="pre">1000</span> <span class="pre">--withdrawal-fee-numerator</span> <span class="pre">3</span> <span class="pre">--withdrawal-fee-denominator</span> <span class="pre">1000</span> <span class="pre">--deposit-fee-numerator</span> <span class="pre">3</span> <span class="pre">--deposit-fee-denominator</span> <span class="pre">1000</span> <span class="pre">--referral-fee</span> <span class="pre">50</span> <span class="pre">--max-validators</span> <span class="pre">2950</span> <span class="pre">--pool-keypair</span> <span class="pre">keys/stake-pool.json</span> <span class="pre">--validator-list-keypair</span> <span class="pre">keys/validator-list.json</span> <span class="pre">--mint-keypair</span> <span class="pre">keys/mint.json</span> <span class="pre">--reserve-keypair</span> <span class="pre">keys/reserve.json</span>
<span class="pre">Creating</span> <span class="pre">reserve</span> <span class="pre">stake</span> <span class="pre">4tvTkLB4X7ahUYZ2NaTohkG3mud4UBBvu9ZEGD4Wk9mt</span>
<span class="pre">Creating</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Creating</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Creating</span> <span class="pre">pool</span> <span class="pre">fee</span> <span class="pre">collection</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span>
<span class="pre">Signature:</span> <span class="pre">51yf2J6dSGAx42KPs2oTMTV4ufEm1ncAHyLPQ6PNf4sbeMHGqno7BGn2tHkUnrd7PRXiWBbGzCWpJNevYjmoLgn2</span>
<span class="pre">Creating</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">with</span> <span class="pre">validator</span> <span class="pre">list</span> <span class="pre">86VZZCuqiz7sDJpFKjQy9c9dZQN9vwDKbYgY8pcwHuaF</span>
<span class="pre">Signature:</span> <span class="pre">47QHcWMEa5Syg13C3SQRA4n88Y8iLx1f39wJXQAStRUxpt2VD5t6pYgAdruNRHUQt1ZBY8QwbvEC1LX9j3nPrAzn</span>
<span class="pre">`</span></code></p>
<p>Your stake pool now exists! For the largest number of validators, the cost for
this phase is ~2.02 SOL.</p>
<p>## Step 2: Add validators to the pool</p>
<p>Now that the pool exists, we need to add validators to it.</p>
<p>Using <cite>add-validators.sh</cite>, we’ll add each of the validators created during step 0
to the stake pool. If you are running on another network, you can create your own
file with validator vote accounts.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./add-validators.sh</span> <span class="pre">keys/stake-pool.json</span> <span class="pre">local_validators.txt</span>
<span class="pre">Adding</span> <span class="pre">validator</span> <span class="pre">stake</span> <span class="pre">accounts</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">pool</span>
<span class="pre">Adding</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Signature:</span> <span class="pre">5Vm2n3umPXFzQgDiaib1B42k7GqsNYHZWrauoe4DUyFszczB7Hjv9r1DKWKrypc8KDiUccdWmJhHBqM1fdP6WiCm</span>
<span class="pre">Signature:</span> <span class="pre">3XtmYu9msqnMeKJs9BopYjn5QTc5hENMXXiBwvEw6HYzU5w6z1HUkGwNW24io4Vu9WRKFFN6SAtrfkZBLK4fYjv4</span>
<span class="pre">...</span> <span class="pre">(something</span> <span class="pre">similar</span> <span class="pre">repeated</span> <span class="pre">9</span> <span class="pre">more</span> <span class="pre">times)</span>
<span class="pre">`</span></code></p>
<p>This operation costs 0.00328288 SOL per validator. This amount is totally recoverable
by removing the validator from the stake pool.</p>
<p>## Step 3: Deposit into the pool</p>
<p>Now that your pool has validators, it needs some SOL or stake accounts for you
to manage. There are two possible sources of deposits: SOL or stake accounts.</p>
<p>### a) Depositing SOL</p>
<p>This will likely be the most attractive form of deposit, since it’s the easiest
for everyone to use. Normally, this will likely be done from a DeFi app or
wallet, but in our example, we’ll do it straight from the command line.  Let’s
deposit 10 SOL into our pool:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">deposit-sol</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">100</span>
<span class="pre">Using</span> <span class="pre">existing</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">4AJv6hSznYoMGnaQvjWXSBjKqtjYpjBx2MLezmRRjWRDa8vUaBLQfPNGd3kamZNs1JeWSvnzczwtzsMD5WkgKamA</span>
<span class="pre">`</span></code></p>
<p>Now there will be some SOL for us to work with.</p>
<p>### b) Depositing stake accounts</p>
<p>Alternatively, users can deposit stake accounts into the pool. This option is
particularly attractive for users that already have a stake account, and either
want stake pool tokens in return, or to diversify their stake more.</p>
<p>The <cite>deposit.sh</cite> script gives an idea of how this works with the CLI.</p>
<p>Creates new stakes to deposit a given amount into each of the stake accounts in
the pool, given the stake pool and validator file.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./deposit.sh</span> <span class="pre">keys/stake-pool.json</span> <span class="pre">local_validators.txt</span> <span class="pre">10</span>
<span class="pre">`</span></code></p>
<p>Note: This is a bit more finnicky on a local network because of the short epochs, and
may fail. No problem, you simply need to retry.</p>
<p>## Step 4: Rebalance stake in the pool</p>
<p>Over time, as people deposit SOL into the reserve, or as validator performance
varies, you will want to move stake around. The best way to do this will be
through an automated system to collect information about the stake pool and the
network, and decide how much stake to allocate to each validator.</p>
<p>The Solana Foundation maintains an open-source bot for its delegation program,
which can be adapated for your stake pool. The source code is part of the
[stake-o-matic GitHub repo](<a class="reference external" href="https://github.com/solana-labs/stake-o-matic/tree/master/bot">https://github.com/solana-labs/stake-o-matic/tree/master/bot</a>).</p>
<p>Additionally, there is a work-in-progress Python stake pool bot, found at the
[stake-pool-py on GitHub](<a class="reference external" href="https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/py">https://github.com/solana-labs/solana-program-library/tree/master/stake-pool/py</a>).</p>
<p>For our example, we will run a simple pool rebalancer, which increases the stake
on each validator in the list by the given amount. There are no checks or logic
to make sure that this is valid.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./rebalance.sh</span> <span class="pre">keys/stake-pool.json</span> <span class="pre">local_validators.txt</span> <span class="pre">1</span>
<span class="pre">`</span></code></p>
<p>## Step 5: Withdraw from the stake pool</p>
<p>Finally, if a user wants to withdraw from the stake pool, they can choose to
withdraw SOL from the reserve if it has enough SOL, or to withdraw from one of
the stake accounts in the pool.</p>
<p>The <cite>withdraw.sh</cite> script removes stakes and SOL from each of the stake accounts
in the pool, given the stake pool, validator file, and amount.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">./withdraw.sh</span> <span class="pre">keys/stake-pool.json</span> <span class="pre">local_validators.txt</span> <span class="pre">1</span>
<span class="pre">`</span></code></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/stake-pool/quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>