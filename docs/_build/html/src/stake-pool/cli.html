<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/stake-pool/cli.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-stake-pool-cli-md">
<h1>docs/src/stake-pool/cli.md<a class="headerlink" href="#docs-src-stake-pool-cli-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-07-07 18:10:20</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Command-line Interface
—</p>
<p>The following explains the instructions available in the Stake Pool Program along
with examples using the command-line utility.</p>
<p>## Installation</p>
<p>The <cite>spl-stake-pool</cite> command-line utility can be used to experiment with SPL
tokens.  Once you have [Rust installed](<a class="reference external" href="https://rustup.rs/">https://rustup.rs/</a>), run:
<code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">cargo</span> <span class="pre">install</span> <span class="pre">spl-stake-pool-cli</span>
<span class="pre">`</span></code></p>
<p>Run <cite>spl-stake-pool –help</cite> for a full description of available commands.</p>
<p>## Configuration</p>
<p>The <cite>spl-stake-pool</cite> configuration is shared with the <cite>solana</cite> command-line tool.</p>
<p>### Current Configuration</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">config</span> <span class="pre">get</span>
<span class="pre">Config</span> <span class="pre">File:</span> <span class="pre">${HOME}/.config/solana/cli/config.yml</span>
<span class="pre">RPC</span> <span class="pre">URL:</span> <span class="pre">https://api.mainnet-beta.solana.com</span>
<span class="pre">WebSocket</span> <span class="pre">URL:</span> <span class="pre">wss://api.mainnet-beta.solana.com/</span> <span class="pre">(computed)</span>
<span class="pre">Keypair</span> <span class="pre">Path:</span> <span class="pre">${HOME}/.config/solana/id.json</span>
<span class="pre">`</span></code></p>
<p>### Cluster RPC URL</p>
<p>See [Solana clusters](<a class="reference external" href="https://docs.solana.com/clusters">https://docs.solana.com/clusters</a>) for cluster-specific RPC URLs
<code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">config</span> <span class="pre">set</span> <span class="pre">--url</span> <span class="pre">https://api.devnet.solana.com</span>
<span class="pre">`</span></code></p>
<p>### Default Keypair</p>
<p>See [Keypair conventions](<a class="reference external" href="https://docs.solana.com/cli/conventions#keypair-conventions">https://docs.solana.com/cli/conventions#keypair-conventions</a>)
for information on how to setup a keypair if you don’t already have one.</p>
<p>Keypair File
<code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">config</span> <span class="pre">set</span> <span class="pre">--keypair</span> <span class="pre">${HOME}/new-keypair.json</span>
<span class="pre">`</span></code></p>
<p>Hardware Wallet URL (See [URL spec](<a class="reference external" href="https://docs.solana.com/wallet-guide/hardware-wallets#specify-a-keypair-url">https://docs.solana.com/wallet-guide/hardware-wallets#specify-a-keypair-url</a>))
<code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">config</span> <span class="pre">set</span> <span class="pre">--keypair</span> <span class="pre">usb://ledger/</span>
<span class="pre">`</span></code></p>
<p>### Running Locally</p>
<p>If you would like to test a stake pool locally without having to wait for stakes
to activate and deactivate, you can run the stake pool locally using the
<cite>solana-test-validator</cite> tool with shorter epochs, and pulling the current program
from devnet.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana-test-validator</span> <span class="pre">-c</span> <span class="pre">SPoo1Ku8WFXoNDMHPsrGSTSG1Y47rzgn41SLUNakuHy</span> <span class="pre">-c</span> <span class="pre">EmiU8AQkB2sswTxVB6aCmsAJftoowZGGDXuytm6X65R3</span> <span class="pre">--url</span> <span class="pre">devnet</span> <span class="pre">--slots-per-epoch</span> <span class="pre">32</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">config</span> <span class="pre">set</span> <span class="pre">--url</span> <span class="pre">http://127.0.0.1:8899</span>
<span class="pre">`</span></code></p>
<p>## Stake Pool Manager Examples</p>
<p>### Create a stake pool</p>
<p>The stake pool manager controls the stake pool from a high level, and in exchange
receives a fee in the form of SPL tokens. The manager
sets the fee on creation. Let’s create a pool with a 3% fee and a maximum of 1000
validator stake accounts:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">create-pool</span> <span class="pre">--epoch-fee-numerator</span> <span class="pre">3</span> <span class="pre">--epoch-fee-denominator</span> <span class="pre">100</span> <span class="pre">--max-validators</span> <span class="pre">1000</span>
<span class="pre">Creating</span> <span class="pre">reserve</span> <span class="pre">stake</span> <span class="pre">DVwDn4LTRztuai4QeenM6fyzgiwUGpVXVNZ1mgKE1Pyc</span>
<span class="pre">Creating</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Creating</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Creating</span> <span class="pre">pool</span> <span class="pre">fee</span> <span class="pre">collection</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span>
<span class="pre">Signature:</span> <span class="pre">qQwqahLuC24wPwVdgVXtd7v5htSSPDAH3JxFNmXCv9aDwjjqygQ64VMg3WdPCiNzc4Bn8vtS3qcnUVHVP5MbKgL</span>
<span class="pre">Creating</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Signature:</span> <span class="pre">5z6uH3EuPcujeWGpAjBtciSUR3TxtMBgWYU4ULagUso4QGzE9JenhYHwYthJ4b3rS57ByUNEXTr2BFyF5PjWC42Y</span>
<span class="pre">`</span></code></p>
<p>The unique stake pool identifier is <cite>Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</cite>.</p>
<p>The identifier for the stake pool’s SPL token mint is
<cite>BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</cite>. The stake pool has full control
over the mint.</p>
<p>The pool creator’s fee account identifier is
<cite>DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</cite>. Every epoch, as stake accounts
in the stake pool earn rewards, the program will mint SPL pool tokens
equal to 3% of the gains on that epoch into this account. If no gains were observed,
nothing will be deposited.</p>
<p>The reserve stake account identifier is <cite>J5XB7mWpeaUZxZ6ogXT57qSCobczx27vLZYSgfSbZoBB</cite>.
This account holds onto additional stake used when rebalancing between validators.</p>
<p>For a stake pool with 1000 validators, the cost to create a stake pool is less
than 0.5 SOL.</p>
<p>The <cite>create-pool</cite> command allows setting all of the accounts and keypairs to
pre-generated values, including:</p>
<ul class="simple">
<li><p>stake pool, through the <cite>–pool-keypair</cite> flag</p></li>
<li><p>validator list, through the <cite>–validator-list-keypair</cite> flag</p></li>
<li><p>pool token mint, through the <cite>–mint-keypair</cite> flag</p></li>
<li><p>pool reserve stake account, through the <cite>–reserve-keypair</cite> flag</p></li>
</ul>
<p>Otherwise, these will all default to newly-generated keypairs.</p>
<p>You can always check out the available options by running <cite>spl-stake-pool create-pool -h</cite>.</p>
<p>### Create a restricted stake pool</p>
<p>If a manager would like to restrict deposits (stake and SOL) to one key in
particular, they can set a deposit authority at creation:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">create-pool</span> <span class="pre">--epoch-fee-numerator</span> <span class="pre">3</span> <span class="pre">--epoch-fee-denominator</span> <span class="pre">100</span> <span class="pre">--max-validators</span> <span class="pre">1000</span> <span class="pre">--deposit-authority</span> <span class="pre">authority_keypair.json</span>
<span class="pre">Creating</span> <span class="pre">reserve</span> <span class="pre">stake</span> <span class="pre">DVwDn4LTRztuai4QeenM6fyzgiwUGpVXVNZ1mgKE1Pyc</span>
<span class="pre">Creating</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Creating</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Creating</span> <span class="pre">pool</span> <span class="pre">fee</span> <span class="pre">collection</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span>
<span class="pre">Signature:</span> <span class="pre">qQwqahLuC24wPwVdgVXtd7v5htSSPDAH3JxFNmXCv9aDwjjqygQ64VMg3WdPCiNzc4Bn8vtS3qcnUVHVP5MbKgL</span>
<span class="pre">Creating</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Deposits</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">restricted</span> <span class="pre">to</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span> <span class="pre">only,</span> <span class="pre">this</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">changed</span> <span class="pre">using</span> <span class="pre">the</span> <span class="pre">set-funding-authority</span> <span class="pre">command.</span>
<span class="pre">Signature:</span> <span class="pre">5z6uH3EuPcujeWGpAjBtciSUR3TxtMBgWYU4ULagUso4QGzE9JenhYHwYthJ4b3rS57ByUNEXTr2BFyF5PjWC42Y</span>
<span class="pre">`</span></code></p>
<p>As the output says, the <cite>set-funding-authority</cite> can be used to modify or remove
the deposit authority.</p>
<p>As long as the deposit authority is set, SOL and stake deposits must be signed
by <cite>4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</cite>, so no one else can participate
in the pool. As mentioned earlier, this feature does not prohibit withdrawals,
so anyone with pool tokens will still be able to withdraw from the pool.</p>
<p>### Set manager</p>
<p>The stake pool manager may pass their administrator privileges to another account.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-manager</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">--new-manager</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">39N5gkaqXuWm6JPEUWfenKXeG4nSa71p7iHb9zurvdZcsWmbjdmSXwLVYfhAVHWucTY77sJ8SkUNpVpVAhe4eZ53</span>
<span class="pre">`</span></code></p>
<p>At the same time, they may also change the SPL token account that receives fees
every epoch. The mint for the provided token account must be the SPL token mint,
<cite>BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</cite> in our example.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-manager</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">--new-fee-receiver</span> <span class="pre">HoCsh97wRxRXVjtG7dyfsXSwH9VxdDzC7GvAsBE1eqJz</span>
<span class="pre">Signature:</span> <span class="pre">4aK8yzYvPBkP4PyuXTcCm529kjEH6tTt4ixc5D5ZyCrHwc4pvxAHj6wcr4cpAE1e3LddE87J1GLD466aiifcXoAY</span>
<span class="pre">`</span></code></p>
<p>### Set fee</p>
<p>The stake pool manager may update any of the fees associated with the stake pool,
passing the numerator and denominator for the fraction that make up the fee.</p>
<p>For an epoch fee of 10%, they could run:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-fee</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">epoch</span> <span class="pre">10</span> <span class="pre">100</span>
<span class="pre">Signature:</span> <span class="pre">5yPXfVj5cbKBfZiEVi2UR5bXzVDuc2c3ruBwSjkAqpvxPHigwGHiS1mXQVE4qwok5moMWT5RNYAMvkE9bnfQ1i93</span>
<span class="pre">`</span></code></p>
<p>In order to protect stake pool depositors from malicious managers, the program
applies the new fee for the following epoch.</p>
<p>For example, if the fee is 1% at epoch 100, and the manager sets it to 10%, the
manager will still gain 1% for the rewards earned during epoch 100. Starting
with epoch 101, the manager will earn 10%.</p>
<p>Additionally, to prevent a malicious manager from immediately setting the withdrawal
fee to a very high amount, making it practically impossible for users to withdraw,
the stake pool program currently enforces a limit of 1.5x increase per epoch.</p>
<p>For example, if the current withdrawal fee is 2.5%, the maximum that can be set
for the next epoch is 3.75%.</p>
<p>The possible options for the fee type are <cite>epoch</cite>, <cite>sol-withdrawal</cite>,
<cite>stake-withdrawal</cite>, <cite>sol-deposit</cite>, and <cite>stake-deposit</cite>.</p>
<p>### Set referral fee</p>
<p>The stake pool manager may update the referral fee on deposits at any time, passing
in a percentage amount.</p>
<p>To set a stake deposit referral fee of 80%, they may run:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-referral-fee</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">stake</span> <span class="pre">80</span>
<span class="pre">Signature:</span> <span class="pre">4vhaBEDhuKkVwMxy7TpyfHEk3Z5kGZKerD1AgajQBdiMRQLZuNZKVR3KQaqbUYZM7UyfRXgkZNdAeP1NfvmwKdqb</span>
<span class="pre">`</span></code></p>
<p>For 80%, this means that 20% of the stake deposit fee goes to the manager, and
80% goes to the referrer.</p>
<p>### Set staker</p>
<p>In order to manage the stake accounts, the stake pool manager or
staker can set the staker authority of the stake pool’s managed accounts.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-staker</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">39N5gkaqXuWm6JPEUWfenKXeG4nSa71p7iHb9zurvdZcsWmbjdmSXwLVYfhAVHWucTY77sJ8SkUNpVpVAhe4eZ53</span>
<span class="pre">`</span></code></p>
<p>Now, the new staker can perform any normal stake pool operations, including
adding and removing validators and rebalancing stake.</p>
<p>Important security note: the stake pool program only gives staking authority to
the pool staker and always retains withdraw authority. Therefore, a malicious
stake pool staker cannot steal funds from the stake pool.</p>
<p>Note: to avoid “disturbing the manager”, the staker can also reassign their stake
authority.</p>
<p>### Set Funding Authority</p>
<p>To restrict who can interact with the pool, the stake pool manager may require
a particular signature on stake deposits, SOL deposits, or SOL withdrawals. This
does not make the pool private, since all information is available on-chain, but
it restricts who can use the pool.</p>
<p>As an example, let’s say a pool wants to restrict all SOL withdrawals.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-funding-authority</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">sol-withdraw</span> <span class="pre">AZ1PgxWSxw4ezX8gvpNgGsr39jJHCwtkaXr1mNMwWWeK</span>
<span class="pre">Signature:</span> <span class="pre">3gx7ckGNSL7gUUyxh4CU3RH3Lyt88hiCvYQ4QRKtnmrZHvAS93ebP6bf39WYGTeKDMVSJUuwBEmk9VFSaWtXsHVV</span>
<span class="pre">`</span></code></p>
<p>After running this command, <cite>AZ1PgxWSxw4ezX8gvpNgGsr39jJHCwtkaXr1mNMwWWeK</cite> must
sign all SOL withdrawals, otherwise the operation fails.</p>
<p>After some time, if the manager wishes to enable SOL withdrawals, they can remove
the restriction:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-funding-authority</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">sol-withdraw</span> <span class="pre">--unset</span>
<span class="pre">Signature:</span> <span class="pre">5kWeBqoxyvANMHCP4ydsZRf8QU4hMotLnKkFbTEdvqEVywo4F3MpZtay7D57FbjJZpdp72fc3vrbxJi9qDLfLCnD</span>
<span class="pre">`</span></code></p>
<p>Now, anyone can withdraw SOL from the stake pool, provided there is enough SOL left
in the reserve.</p>
<p>The options for funding authorities are <cite>sol-withdraw</cite>, <cite>sol-deposit</cite>, and <cite>stake-deposit</cite>.</p>
<p>Note: it is impossible to restrict stake withdrawals. This would create an opportunity
for malicious pool managers to effectively lock user funds.</p>
<p>## Stake Pool Staker Examples</p>
<p>### Add a validator to the pool</p>
<p>In order to accommodate large numbers of user deposits into the stake pool, the
stake pool only manages one stake account per validator. To add a new validator
to the stake pool, the staker must use the <cite>add-validator</cite> command.</p>
<p>Let’s add some random validators to the stake pool.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">add-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">Adding</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">Signature:</span> <span class="pre">5tdpsx64mVcSHBK8vMbBzFDHnEZB6GUmVpqSXXE5hezMAzPYwZbJCBtAHakDAiuWNcrMongGrmwDaeywhVz4i8pi</span>
<span class="pre">`</span></code></p>
<p>In order to maximize censorship resistance, we want to distribute our SOL to as
many validators as possible, so let’s add a few more.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">add-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Adding</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Signature:</span> <span class="pre">4xeve6gWuiffqBLAMcqa8s7dCMvBmSVdKbDu5WQhigLiXHdCjSNEwoZRexTZji786qgEjXg3nrUh4HcTt3RauZV5</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">add-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Adding</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Signature:</span> <span class="pre">4VJYHpPmWkP99TdgYUTgLYixmhqmqsEkWtg4j7zvGZFjYbnLgryu48aV6ub8bqDyULzKckUhb6tvcmZmMX5AFf5G</span>
<span class="pre">`</span></code></p>
<p>We can see the status of a stake account using the Solana command-line utility.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">stake-account</span> <span class="pre">5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</span>
<span class="pre">Balance:</span> <span class="pre">0.00328288</span> <span class="pre">SOL</span>
<span class="pre">Rent</span> <span class="pre">Exempt</span> <span class="pre">Reserve:</span> <span class="pre">0.00228288</span> <span class="pre">SOL</span>
<span class="pre">Delegated</span> <span class="pre">Stake:</span> <span class="pre">0.001</span> <span class="pre">SOL</span>
<span class="pre">Active</span> <span class="pre">Stake:</span> <span class="pre">0</span> <span class="pre">SOL</span>
<span class="pre">Activating</span> <span class="pre">Stake:</span> <span class="pre">0.001</span> <span class="pre">SOL</span>
<span class="pre">Stake</span> <span class="pre">activates</span> <span class="pre">starting</span> <span class="pre">from</span> <span class="pre">epoch:</span> <span class="pre">5</span>
<span class="pre">Delegated</span> <span class="pre">Vote</span> <span class="pre">Account</span> <span class="pre">Address:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Stake</span> <span class="pre">Authority:</span> <span class="pre">DS3AyFN9dF1ruNBcSeo8XXQR8UyVMhcCPcnjU5GnY18S</span>
<span class="pre">Withdraw</span> <span class="pre">Authority:</span> <span class="pre">DS3AyFN9dF1ruNBcSeo8XXQR8UyVMhcCPcnjU5GnY18S</span>
<span class="pre">`</span></code></p>
<p>The stake pool creates these special staking accounts with 0.001 SOL as the required
minimum delegation amount. The stake and withdraw authorities are the stake pool
withdraw authority, program addresses derived from the stake pool’s address.</p>
<p>We can also see the status of the stake pool.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">list</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Stake</span> <span class="pre">Pool:</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Pool</span> <span class="pre">Token</span> <span class="pre">Mint:</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Epoch</span> <span class="pre">Fee:</span> <span class="pre">3/100</span> <span class="pre">of</span> <span class="pre">epoch</span> <span class="pre">rewards</span>
<span class="pre">Withdrawal</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Reserve</span> <span class="pre">Account:</span> <span class="pre">EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5</span>&#160;&#160; <span class="pre">Available</span> <span class="pre">Balance:</span> <span class="pre">◎0.000000000</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎0.000000000</span> <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎0.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎0.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Stake:</span> <span class="pre">◎0.000000000</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Tokens:</span> <span class="pre">0.00000000</span>
<span class="pre">Current</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">3</span>
<span class="pre">Max</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">1000</span>
<span class="pre">`</span></code></p>
<p>To make reading easier, the tool will not show balances that cannot be touched by
the stake pool. The stake account <cite>5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</cite>,
delegated to <cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite>, actually has a balance
of 0.00328288 SOL, but since this is the minimum required amount, it is
not shown by the CLI.</p>
<p>### Remove validator stake account</p>
<p>If the stake pool staker wants to stop delegating to a vote account, they can
totally remove the validator stake account from the stake pool.</p>
<p>As with adding a validator, the validator stake account must have exactly
0.00328288 SOL (0.001 SOL delegated, 0.00228288 SOL for rent exemption) to be removed.</p>
<p>If that is not the case, the staker must first decrease the stake to that minimum amount.
Let’s assume that the validator stake account delegated to
<cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite> has a total delegated amount of
7.5 SOL. To reduce that number, the staker can run:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">decrease-validator-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span> <span class="pre">6.5</span>
<span class="pre">Signature:</span> <span class="pre">ZpQGwT85rJ8Y9afdkXhKo3TVv4xgTz741mmZj2vW7mihYseAkFsazWxza2y8eNGY4HDJm15c1cStwyiQzaM3RpH</span>
<span class="pre">`</span></code></p>
<p>Now, let’s try to remove validator <cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite>, with
stake account <cite>5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr</cite>.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">remove-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Removing</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">5AaobwjccyHnXhFCd24uiX6VqPjXE3Ry4o92fJjqqjAr,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Creating</span> <span class="pre">account</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">nHEEyey8KkgHuVRAUDzkH5Q4PkA4veSHuTxgG6C8L2G</span>
<span class="pre">Signature:</span> <span class="pre">4XprnR768Ch6LUvqUVLTjMCiqdYvtjNfECh4izErqwbsASTGjUBz7NtLZHAiraTqhs7b9PoSAazetdsgXa6J4wVu</span>
<span class="pre">`</span></code></p>
<p>Unlike a normal withdrawal, the validator stake account is totally moved from
the stake pool and into a new account belonging to the administrator.</p>
<p>Note: since removal is only possible when the validator stake is at the minimum
amount of 0.00328288, the administrator does not get any control of user funds,
and only recovers the amount contributed during <cite>add-validator</cite>.</p>
<p>The authority for the withdrawn stake account can also be specified using the
<cite>–new-authority</cite> flag:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">remove-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span> <span class="pre">--new-authority</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">5rrQ3xhDWyiPkUTAQkNAeq31n6sMf1xsg2x9hVY8Vj1NonwBnhxuTv87nADLkwC8Xzc4CGTNCTX2Vph9esWnXk2d</span>
<span class="pre">`</span></code></p>
<p>We can check the removed stake account:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">stake-account</span> <span class="pre">nHEEyey8KkgHuVRAUDzkH5Q4PkA4veSHuTxgG6C8L2G</span>
<span class="pre">Balance:</span> <span class="pre">0.003282880</span> <span class="pre">SOL</span>
<span class="pre">Rent</span> <span class="pre">Exempt</span> <span class="pre">Reserve:</span> <span class="pre">0.00328288</span> <span class="pre">SOL</span>
<span class="pre">Delegated</span> <span class="pre">Stake:</span> <span class="pre">0.001000000</span> <span class="pre">SOL</span>
<span class="pre">Active</span> <span class="pre">Stake:</span> <span class="pre">0.001000000</span> <span class="pre">SOL</span>
<span class="pre">Delegated</span> <span class="pre">Vote</span> <span class="pre">Account</span> <span class="pre">Address:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>
<span class="pre">Stake</span> <span class="pre">Authority:</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Withdraw</span> <span class="pre">Authority:</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">`</span></code></p>
<p>### Rebalance the stake pool</p>
<p>As time goes on, users will deposit to and withdraw from all of the stake accounts
managed by the pool, and the stake pool staker may want to rebalance the stakes.</p>
<p>For example, let’s say the staker wants the same delegation to every validator
in the pool. When they look at the state of the pool, they see:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">list</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Stake</span> <span class="pre">Pool:</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Pool</span> <span class="pre">Token</span> <span class="pre">Mint:</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Epoch</span> <span class="pre">Fee:</span> <span class="pre">3/100</span> <span class="pre">of</span> <span class="pre">epoch</span> <span class="pre">rewards</span>
<span class="pre">Withdrawal</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Reserve</span> <span class="pre">Account:</span> <span class="pre">EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5</span>&#160;&#160; <span class="pre">Available</span> <span class="pre">Balance:</span> <span class="pre">◎10.006848640</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎100.000000000</span> <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎10.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎10.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">4</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Stake:</span> <span class="pre">◎130.006848640</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Tokens:</span> <span class="pre">130.00684864</span>
<span class="pre">Current</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">3</span>
<span class="pre">Max</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">1000</span>
<span class="pre">`</span></code></p>
<p>This isn’t great! The first stake account, <cite>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</cite>
has too much allocated. For their strategy, the staker wants the <cite>100</cite>
SOL to be distributed evenly, meaning <cite>40</cite> in each account. They need
to move <cite>30</cite> to <cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite> and
<cite>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</cite>.</p>
<p>#### Decrease validator stake</p>
<p>First, they need to decrease the amount on stake account
<cite>3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx</cite>, delegated to
<cite>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</cite>, by a total of <cite>60</cite> SOL.</p>
<p>They decrease that amount of SOL:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">decrease-validator-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span> <span class="pre">60</span>
<span class="pre">Signature:</span> <span class="pre">ZpQGwT85rJ8Y9afdkXhKo3TVv4xgTz741mmZj2vW7mihYseAkFsazWxza2y8eNGY4HDJm15c1cStwyiQzaM3RpH</span>
<span class="pre">`</span></code></p>
<p>Internally, this instruction splits and deactivates 60 SOL from the
validator stake account <cite>3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx</cite> into a
transient stake account, owned and managed entirely by the stake pool.</p>
<p>Once the stake is deactivated during the next epoch, the <cite>update</cite> command will
automatically merge the transient stake account into a reserve stake account,
also entirely owned and managed by the stake pool.</p>
<p>#### Increase validator stake</p>
<p>Now that the reserve stake account has enough to perform the rebalance, the staker
can increase the stake on the two other validators,
<cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite> and
<cite>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</cite>.</p>
<p>They add 30 SOL to <cite>J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</cite>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">increase-validator-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span> <span class="pre">30</span>
<span class="pre">Signature:</span> <span class="pre">3GJACzjUGLPjcd9RLUW86AfBLWKapZRkxnEMc2yHT6erYtcKBgCapzyrVH6VN8Utxj7e2mtvzcigwLm6ZafXyTMw</span>
<span class="pre">`</span></code></p>
<p>And they add 30 SOL to <cite>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</cite>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">increase-validator-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span> <span class="pre">30</span>
<span class="pre">Signature:</span> <span class="pre">4zaKYu3MQ3as8reLbuHKaXN8FNaHvpHuiZtsJeARo67UKMo6wUUoWE88Fy8N4EYQYicuwULTNffcUD3a9jY88PoU</span>
<span class="pre">`</span></code></p>
<p>Internally, this instruction also uses transient stake accounts.  This time, the
stake pool splits from the reserve stake, into the transient stake account,
then activates it to the appropriate validator.</p>
<p>One to two epochs later, once the transient stakes activate, the <cite>update</cite> command
automatically merges the transient stakes into the validator stake account, leaving
a fully rebalanced stake pool:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">list</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Stake</span> <span class="pre">Pool:</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Pool</span> <span class="pre">Token</span> <span class="pre">Mint:</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Preferred</span> <span class="pre">Deposit</span> <span class="pre">Validator:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">Epoch</span> <span class="pre">Fee:</span> <span class="pre">3/100</span> <span class="pre">of</span> <span class="pre">epoch</span> <span class="pre">rewards</span>
<span class="pre">Withdrawal</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Reserve</span> <span class="pre">Account:</span> <span class="pre">EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5</span>&#160;&#160; <span class="pre">Available</span> <span class="pre">Balance:</span> <span class="pre">◎10.006848640</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎40.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎40.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎40.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Stake:</span> <span class="pre">◎130.006848640</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Tokens:</span> <span class="pre">130.00684864</span>
<span class="pre">Current</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">3</span>
<span class="pre">Max</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">1000</span>
<span class="pre">`</span></code></p>
<p>Due to staking rewards that accrued during the rebalancing process, the pool may
not perfectly balanced. This is completely normal.</p>
<p>### Set Preferred Deposit / Withdraw Validator</p>
<p>Since a stake pool accepts deposits to any of its stake accounts, and allows
withdrawals from any of its stake accounts, it could be used by malicious arbitrageurs
looking to maximize returns each epoch.</p>
<p>For example, if a stake pool has 1000 validators, an arbitrageur could stake to
any one of those validators. At the end of the epoch, they can check which
validator has the best performance, deposit their stake, and immediately withdraw
from the highest performing validator. Once rewards are paid out, they can take
their valuable stake, and deposit it back for more than they had.</p>
<p>To mitigate this arbitrage, a stake pool staker can set a preferred withdraw
or deposit validator. Any deposits or withdrawals must go to the corresponding
stake account, making this attack impossible without a lot of funds.</p>
<p>Let’s set a preferred deposit validator stake account:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-preferred-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">deposit</span> <span class="pre">--vote-account</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Signature:</span> <span class="pre">j6fbTqGJ8ehgKnSPns1adaSeFwg5M3wP1a32qYwZsQjymYoSejFUXLNGwvHSouJcFm4C78HUoC8xd7cvb5iActL</span>
<span class="pre">`</span></code></p>
<p>And then let’s set the preferred withdraw validator stake account to the same one:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-preferred-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">withdraw</span> <span class="pre">--vote-account</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Signature:</span> <span class="pre">4MKdYLyFqU6H3311YZDeLtsoeGZMzswBHyBCRjHfkzuN1rB4LXJbPfkgUGLKkdbsxJvPRub7SqB1zNPTqDdwti2w</span>
<span class="pre">`</span></code></p>
<p>At any time, they may also unset the preferred validator:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">set-preferred-validator</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">withdraw</span> <span class="pre">--unset</span>
<span class="pre">Signature:</span> <span class="pre">5Qh9FA3EXtJ7nKw7UyxmMWXnTMLRKQqcpvfEsEyBtxSPqzPAXp2vFXnPg1Pw8f37JFdvyzYay65CtA8Z1ewzVkvF</span>
<span class="pre">`</span></code></p>
<p>The preferred validators are marked in the <cite>list</cite> command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">list</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Stake</span> <span class="pre">Pool:</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Pool</span> <span class="pre">Token</span> <span class="pre">Mint:</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Preferred</span> <span class="pre">Deposit</span> <span class="pre">Validator:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Preferred</span> <span class="pre">Withdraw</span> <span class="pre">Validator:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">...</span>
<span class="pre">`</span></code></p>
<p>## User Examples</p>
<p>### List validator stake accounts</p>
<p>In order to deposit into the stake pool, a user must first delegate some stake
to one of the validator stake accounts associated with the stake pool. The
command-line utility has a special instruction for finding out which vote
accounts are already associated with the stake pool.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">list</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Stake</span> <span class="pre">Pool:</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Pool</span> <span class="pre">Token</span> <span class="pre">Mint:</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">Preferred</span> <span class="pre">Deposit</span> <span class="pre">Validator:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">Epoch</span> <span class="pre">Fee:</span> <span class="pre">3/100</span> <span class="pre">of</span> <span class="pre">epoch</span> <span class="pre">rewards</span>
<span class="pre">Withdrawal</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">SOL</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Stake</span> <span class="pre">Deposit</span> <span class="pre">Referral</span> <span class="pre">Fee:</span> <span class="pre">none</span>
<span class="pre">Reserve</span> <span class="pre">Account:</span> <span class="pre">EN4px2h4gFkYtsQUi4yeCYBrdRM4DoRxCVJyavMXEAm5</span>&#160;&#160; <span class="pre">Available</span> <span class="pre">Balance:</span> <span class="pre">◎10.006848640</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎35.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">J3xu64PWShcMen99kU3igxtwbke2Nwfo8pkZNRgrq66H</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎35.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Vote</span> <span class="pre">Account:</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">Balance:</span> <span class="pre">◎35.000000000</span>&#160; <span class="pre">Last</span> <span class="pre">Update</span> <span class="pre">Epoch:</span> <span class="pre">8</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Stake:</span> <span class="pre">◎115.006848640</span>
<span class="pre">Total</span> <span class="pre">Pool</span> <span class="pre">Tokens:</span> <span class="pre">115.00684864</span>
<span class="pre">Current</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">3</span>
<span class="pre">Max</span> <span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Validators:</span> <span class="pre">1000</span>
<span class="pre">`</span></code></p>
<p>### Deposit SOL</p>
<p>Stake pools accept SOL deposits directly from a normal SOL wallet account, and
in exchange mint the appropriate amount of pool tokens.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">deposit-sol</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">100</span>
<span class="pre">Using</span> <span class="pre">existing</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">23CptpZaq33njCpJPAvk8XS53xXwpfqF1sGxChk3VDB5mzz7XPKQqwsreun3iwZ6b51AyHqGBaUyc6tx9fqvF9JK</span>
<span class="pre">`</span></code></p>
<p>In return, the stake pool has minted us new pool tokens, representing our share
of ownership in the pool.  We can double-check our stake pool account using the
SPL token command-line utility.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-token</span> <span class="pre">balance</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">100.00000000</span>
<span class="pre">`</span></code></p>
<p>### Withdraw SOL</p>
<p>Stake pools allow SOL withdrawals directly from the reserve and into a normal
SOL wallet account, and in exchange burns the provided pool tokens.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-sol</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8</span> <span class="pre">2</span>
<span class="pre">Signature:</span> <span class="pre">4bqZKUUrjVspqTGqGqX4zxnHnJB67WbeukKUZRmxJ2yFmr275CtHPjZNzQJD9Pe7Q6mSxnUpcVv9FUdAbGP9RyBc</span>
<span class="pre">`</span></code></p>
<p>The stake pool has burned 2 pool tokens, and in return, sent SOL to
<cite>7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8</cite>.</p>
<p>You can check that the pool tokens have been burned:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-token</span> <span class="pre">balance</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">98.00000000</span>
<span class="pre">`</span></code></p>
<p>And you can check that the recipient has been credited:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">balance</span> <span class="pre">7VXPpSxneL6JLj18Naw2gkukXtjBZfbmPh18cnoUCMD8</span>
<span class="pre">2</span> <span class="pre">SOL</span>
<span class="pre">`</span></code></p>
<p>### Deposit stake</p>
<p>Stake pools also accept deposits from active stake accounts, so we must first
create stake accounts and delegate them to one of the validators managed by the
stake pool. Using the <cite>list</cite> command from the previous section, we see that
<cite>38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</cite> is a valid vote account, so let’s
create a stake account and delegate our stake there.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana-keygen</span> <span class="pre">new</span> <span class="pre">--no-passphrase</span> <span class="pre">-o</span> <span class="pre">stake-account.json</span>
<span class="pre">Generating</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">keypair</span>
<span class="pre">Wrote</span> <span class="pre">new</span> <span class="pre">keypair</span> <span class="pre">to</span> <span class="pre">stake-account.json</span>
<span class="pre">============================================================================</span>
<span class="pre">pubkey:</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span>
<span class="pre">============================================================================</span>
<span class="pre">Save</span> <span class="pre">this</span> <span class="pre">seed</span> <span class="pre">phrase</span> <span class="pre">to</span> <span class="pre">recover</span> <span class="pre">your</span> <span class="pre">new</span> <span class="pre">keypair:</span>
<span class="pre">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<span class="pre">============================================================================</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">create-stake-account</span> <span class="pre">stake-account.json</span> <span class="pre">10</span>
<span class="pre">Signature:</span> <span class="pre">5Y9r6MNoqJzVX8TWryAJbdp8i2DvintfxbYWoY6VcLEPgphK2tdydhtJTd3o3dF7QdM2Pg8sBFDZuyNcMag3nPvj</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">delegate-stake</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span> <span class="pre">38DYMkwYCvsj8TC6cNaEvFHHVDYeWDp1qUgMgyjNqZXk</span>
<span class="pre">Signature:</span> <span class="pre">2cDjHXSHjuadGQf1NQpPi43A8R19aCifsY16yTcictKPHcSAXN5TvXZ58nDJwkYs12tuZfTh5WVgAMSvptfrKdPP</span>
<span class="pre">`</span></code></p>
<p>Two epochs later, when the stake is fully active and has received one epoch of
rewards, we can deposit the stake into the stake pool.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">deposit-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span>
<span class="pre">Depositing</span> <span class="pre">stake</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span> <span class="pre">into</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">account</span> <span class="pre">F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt</span>
<span class="pre">Using</span> <span class="pre">existing</span> <span class="pre">associated</span> <span class="pre">token</span> <span class="pre">account</span> <span class="pre">DgyZrAq88bnG1TNRxpgDQzWXpzEurCvfY2ukKFWBvADQ</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">tokens</span> <span class="pre">of</span> <span class="pre">mint</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB,</span> <span class="pre">owned</span> <span class="pre">by</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Signature:</span> <span class="pre">45x2UtA1b49eBPtRHdkvA3k8JneZzfwjptNN1kKQZaPABYiJ4hSA8qwi7qLNN5b3Fr4Z6vXhJprrTCpkk3f8UqgD</span>
<span class="pre">`</span></code></p>
<p>The CLI will default to using the fee payer’s
[Associated Token Account](associated-token-account.md) for stake pool tokens
and the withdraw authority on the deposited stake account.</p>
<p>Alternatively, you can create an SPL token account yourself and pass it as the
<cite>token-receiver</cite> for the command, and specify the withdraw authority on the
stake account using the <cite>withdraw-authority</cite> flag.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">deposit-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span> <span class="pre">--token-receiver</span> <span class="pre">34XMHa3JUPv46ftU4dGHvemZ9oKVjnciRePYMcX3rjEF</span> <span class="pre">--withdraw-authority</span> <span class="pre">authority.json</span>
<span class="pre">Depositing</span> <span class="pre">stake</span> <span class="pre">97wBBiLVA7fUViEew8yV8R6tTdKithZDVz8LHLfF9sTJ</span> <span class="pre">into</span> <span class="pre">stake</span> <span class="pre">pool</span> <span class="pre">account</span> <span class="pre">F8e8Ympp4MkDSPZdvRxdQUZXRkMBDdyqgHa363GShAPt</span>
<span class="pre">Signature:</span> <span class="pre">4AESGZzqBVfj5xQnMiPWAwzJnAtQDRFK1Ha6jqKKTs46Zm5fw3LqgU1mRAT6CKTywVfFMHZCLm1hcQNScSMwVvjQ</span>
<span class="pre">`</span></code></p>
<p>In return, the stake pool has minted us new pool tokens, representing our share
of ownership in the pool.  We can double-check our stake pool account using the
SPL token command-line utility.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-token</span> <span class="pre">balance</span> <span class="pre">BoNneHKDrX9BHjjvSpPfnQyRjsnc9WFH71v8wrgCd7LB</span>
<span class="pre">10.00000000</span>
<span class="pre">`</span></code></p>
<p>#### Note on stake deposit fee</p>
<p>Stake pools have separate fees for stake and SOL, so the total fee from depositing
a stake account is calculated from the rent-exempt reserve as SOL, and the delegation
as stake.</p>
<p>For example, if a stake pool has a stake deposit fee of 1%, and a SOL deposit fee
of 5%, and you deposit a stake account with 10 SOL in stake, and .00228288 SOL
in rent-exemption, the total fee charged is:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">total_fee</span> <span class="pre">=</span> <span class="pre">stake_delegation</span> <span class="pre">*</span> <span class="pre">stake_deposit_fee</span> <span class="pre">+</span> <span class="pre">rent_exemption</span> <span class="pre">*</span> <span class="pre">sol_deposit_fee</span>
<span class="pre">total_fee</span> <span class="pre">=</span> <span class="pre">10</span> <span class="pre">*</span> <span class="pre">1%</span> <span class="pre">+</span> <span class="pre">.00228288</span> <span class="pre">*</span> <span class="pre">5%</span>
<span class="pre">total_fee</span> <span class="pre">=</span> <span class="pre">0.100114144</span>
<span class="pre">`</span></code></p>
<p>### Update</p>
<p>Every epoch, the network pays out rewards to stake accounts managed by the stake
pool, increasing the value of pool tokens minted on deposit.
In order to calculate the proper value of these stake pool tokens, we must update
the total value managed by the stake pool every epoch.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">update</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Signature:</span> <span class="pre">2rtPNGKFSSnXFCb6MKG5wHp34dkB5hJWNhro8EU2oGh1USafAgzu98EgoRnPLi7ojQfmTpvXk4S7DWXYGu5t85Ka</span>
<span class="pre">Signature:</span> <span class="pre">5V2oCNvZCNJfC6QXHmR2UHGxVMip6nfZixYkVjFQBTyTf2Z9s9GJ9BjkxSFGvUsvW6zc2cCRv9Lqucu1cgHMFcVU</span>
<span class="pre">`</span></code></p>
<p>If another user already updated the stake pool balance for the current epoch, we
see a different output.</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">update</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>
<span class="pre">Update</span> <span class="pre">not</span> <span class="pre">required</span>
<span class="pre">`</span></code></p>
<p>If no one updates the stake pool in the current epoch, all instructions, including
deposit and withdraw, will fail. The update instruction is permissionless, so any user
can run it before interacting with the pool. As a convenience, the CLI attempts
to update before running any instruction on the stake pool.</p>
<p>If the stake pool transient stakes are in an unexpected state, and merges are
not possible, there is the option to only update the stake pool balances without
performing merges using the <cite>–no-merge</cite> flag.</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">update</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">--no-merge</span>
<span class="pre">Signature:</span> <span class="pre">5cjdZG727uzwnEEG3vJ1vskA9WsXibaEHh7imXSb2S1cwEYK4Q3btr2GEeAV8EffK4CEQ2WM6PQxawkJAHoZ4jsQ</span>
<span class="pre">Signature:</span> <span class="pre">EBHbSRstJ3HxKwYKak8vEwVMKr1UBxdbqs5KuX3XYt4ppPjhaziGEtvL2TJCm1HLokbrtMeTEv57Ef4xhByJtJP</span>
<span class="pre">`</span></code></p>
<p>Later on, whenever the transient stakes are ready to be merged, it is possible to
force another update in the same epoch using the <cite>–force</cite> flag.</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">update</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">--force</span>
<span class="pre">Signature:</span> <span class="pre">5RneEBwJkFytBJaJdkvCTHFrG3QzE3SGf9vdBm9gteCcHV4HwaHzj3mjX1hZg4yCREQSgmo3H9bPF6auMmMFTSTo</span>
<span class="pre">Signature:</span> <span class="pre">1215wJUY7vj82TQoGCacQ2VJZ157HnCTvfsUXkYph3nZzJNmeDaGmy1nCD7hkhFfxnQYYxVtec5TkDFGGB4e7EvG</span>
<span class="pre">`</span></code></p>
<p>### Withdraw stake</p>
<p>Whenever the user wants to recover their SOL plus accrued rewards, they can provide their
pool tokens in exchange for an activated stake account.</p>
<p>Let’s withdraw active staked SOL in exchange for 5 pool tokens.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">5</span>
<span class="pre">Withdrawing</span> <span class="pre">◎5.000000000,</span> <span class="pre">or</span> <span class="pre">5</span> <span class="pre">pool</span> <span class="pre">tokens,</span> <span class="pre">from</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Creating</span> <span class="pre">account</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">5GuAyPAt6577HoGhSVRNBv6aHohVtjQ8q7q5i3X1p4tB</span>
<span class="pre">Signature:</span> <span class="pre">5fzaKt5MU8bLjJRgNZyEktKsgweSQzFRpubCGKPeuk9shNQb4CtTkbgZ2X5MmC1VRDZ3YcCTPdtL9sFpXYfoqaeV</span>
<span class="pre">`</span></code></p>
<p>The stake pool took 5 pool tokens, and in exchange the user received a fully
active stake account, delegated to <cite>EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</cite>.
Let’s double-check the status of the stake account:</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">stake-account</span> <span class="pre">5GuAyPAt6577HoGhSVRNBv6aHohVtjQ8q7q5i3X1p4tB</span>
<span class="pre">Balance:</span> <span class="pre">5.00228288</span> <span class="pre">SOL</span>
<span class="pre">Rent</span> <span class="pre">Exempt</span> <span class="pre">Reserve:</span> <span class="pre">0.00228288</span> <span class="pre">SOL</span>
<span class="pre">Delegated</span> <span class="pre">Stake:</span> <span class="pre">5</span> <span class="pre">SOL</span>
<span class="pre">Active</span> <span class="pre">Stake:</span> <span class="pre">5</span> <span class="pre">SOL</span>
<span class="pre">Delegated</span> <span class="pre">Vote</span> <span class="pre">Account</span> <span class="pre">Address:</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Stake</span> <span class="pre">Authority:</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">Withdraw</span> <span class="pre">Authority:</span> <span class="pre">4SnSuUtJGKvk2GYpBwmEsWG53zTurVM8yXGsoiZQyMJn</span>
<span class="pre">`</span></code></p>
<p>Note: this operation cost the user some funds, as they needed to create a new
stake account with the minimum rent exemption in order to receive the funds. This
allows the user to withdraw any amount of stake pool tokens, even if it is not
enough to cover the stake account rent-exemption.</p>
<p>Alternatively, the user can specify an existing uninitialized stake account to
receive their stake using the <cite>–stake-receiver</cite> parameter.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>&#160; <span class="pre">--amount</span> <span class="pre">0.02</span> <span class="pre">--vote-account</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span> <span class="pre">--stake-receiver</span> <span class="pre">CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span>
<span class="pre">Withdrawing</span> <span class="pre">◎5.000000000,</span> <span class="pre">or</span> <span class="pre">5</span> <span class="pre">pool</span> <span class="pre">tokens,</span> <span class="pre">from</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Signature:</span> <span class="pre">2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span>
<span class="pre">`</span></code></p>
<p>By default, the withdraw command uses the <cite>token-owner</cite>’s associated token account to
source the pool tokens. It’s possible to specify the SPL token account using
the <cite>–pool-account</cite> flag.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">5</span> <span class="pre">--pool-account</span> <span class="pre">34XMHa3JUPv46ftU4dGHvemZ9oKVjnciRePYMcX3rjEF</span>
<span class="pre">Withdrawing</span> <span class="pre">◎5.000000000,</span> <span class="pre">or</span> <span class="pre">5</span> <span class="pre">pool</span> <span class="pre">tokens,</span> <span class="pre">from</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Creating</span> <span class="pre">account</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span>
<span class="pre">Signature:</span> <span class="pre">2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span>
<span class="pre">`</span></code></p>
<p>By default, the withdraw command will withdraw from the largest validator stake
accounts in the pool. It’s also possible to specify a specific vote account for
the withdraw using the <cite>–vote-account</cite> flag.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span>&#160; <span class="pre">--amount</span> <span class="pre">5</span> <span class="pre">--vote-account</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Withdrawing</span> <span class="pre">◎5.000000000,</span> <span class="pre">or</span> <span class="pre">5</span> <span class="pre">pool</span> <span class="pre">tokens,</span> <span class="pre">from</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">3k7Nwu9jUSc6SNG11wzufKYoZXRFgxWamheGLYWp5Rvx,</span> <span class="pre">delegated</span> <span class="pre">to</span> <span class="pre">EhRbKi4Vhm1oUCGWHiLEMYZqDrHwEd7Jgzgi26QJKvfQ</span>
<span class="pre">Creating</span> <span class="pre">account</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">CZF2z3JJoDmJRcVjtsrz1BKUUGNL3VPW5FPFqge1bzmQ</span>
<span class="pre">Signature:</span> <span class="pre">2xBPVPJ749AE4hHNCNYdjuHv1EdMvxm9uvvraWfTA7Urrvecwh9w64URCyLLroLQ2RKDGE2QELM2ZHd8qRkjavJM</span>
<span class="pre">`</span></code></p>
<p>Note that the associated validator stake account must have enough lamports to
satisfy the pool token amount requested.</p>
<p>#### Special case: exiting pool with a delinquent staker</p>
<p>With the reserve stake, it’s possible for a delinquent or malicious staker to
move all stake into the reserve through <cite>decrease-validator-stake</cite>, so the
pool tokens will not gain rewards, and the stake pool users will not
be able to withdraw their funds.</p>
<p>To get around this case, it is also possible to withdraw from the stake pool’s
reserve, but only if all of the validator stake accounts are at the minimum amount of
<cite>0.001 SOL + stake account rent exemption</cite>.</p>
<p><code class="docutils literal notranslate"><span class="pre">`console</span>
<span class="pre">$</span> <span class="pre">spl-stake-pool</span> <span class="pre">withdraw-stake</span> <span class="pre">Zg5YBPAk8RqBR9kaLLSoN5C8Uv7nErBz1WC63HTsCPR</span> <span class="pre">5</span> <span class="pre">--use-reserve</span>
<span class="pre">Withdrawing</span> <span class="pre">◎5.000000000,</span> <span class="pre">or</span> <span class="pre">5</span> <span class="pre">pool</span> <span class="pre">tokens,</span> <span class="pre">from</span> <span class="pre">stake</span> <span class="pre">account</span> <span class="pre">J5XB7mWpeaUZxZ6ogXT57qSCobczx27vLZYSgfSbZoBB</span>
<span class="pre">Creating</span> <span class="pre">account</span> <span class="pre">to</span> <span class="pre">receive</span> <span class="pre">stake</span> <span class="pre">51XdXiBSsVzeuY79xJwWAGZgeKzzgFKWajkwvWyrRiNE</span>
<span class="pre">Signature:</span> <span class="pre">yQH9n7Go6iCMEYXqWef38ZYBPwXDmbwKAJFJ4EHD6TusBpusKsfNuT3TV9TL8FmxR2N9ExZTZwbD9Njc3rMvUcf</span>
<span class="pre">`</span></code></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/stake-pool/cli.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>