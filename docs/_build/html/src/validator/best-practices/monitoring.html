<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/validator/best-practices/monitoring.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-validator-best-practices-monitoring-md">
<h1>docs/src/validator/best-practices/monitoring.md<a class="headerlink" href="#docs-src-validator-best-practices-monitoring-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Validator Monitoring Best Practices
sidebar_label: Monitoring
—</p>
<p>It is essential that you have monitoring in place on your validator. In the event that your validator is delinquent (behind the rest of the network) you want to respond immediately to fix the issue. One very useful tool to monitor your validator is [<cite>solana-watchtower</cite>](#solana-watchtower).</p>
<p>## Solana Watchtower</p>
<p>Solana Watchtower is an extremely useful monitoring tool that will regularly monitor the health of your validator. It can monitor your validator for delinquency then notify you on your application of choice: Slack, Discord, Telegram or Twilio. Additionally, <cite>solana-watchtower</cite> has the ability to monitor the health of the entire cluster so that you can be aware of any cluster wide problems.</p>
<p>### Getting Started</p>
<p>To get started with Solana Watchtower, run <cite>solana-watchtower –help</cite>. From the help menu, you can see the optional flags and an explanation of the command.</p>
<p>Here is a sample command that will monitor a validator node with an identity public key of <cite>2uTk98rqqwENevkPH2AHHzGHXgeGc1h6ku8hQUqWeXZp</cite>:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
solana-watchtower –monitor-active-stake –validator-identity </p>
<blockquote>
<div><p>2uTk98rqqwENevkPH2AHHzGHXgeGc1h6ku8hQUqWeXZp</p>
</div></blockquote>
<p><a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>The command will monitor your validator, but you will not get notifications unless you added the environment variables mentioned in <cite>solana-watchtower –help</cite>. Since getting each of these services setup for notifications is not straight forward, the next section will walk through [setting up watchtower notifications on Telegram](#setup-telegram-notifications).</p>
<p>### Best Practices</p>
<p>It is a best practice to run the <cite>solana-watchtower</cite> command on a separate server from your validator.</p>
<p>In the case that you run <cite>solana-watchtower</cite> on the same computer as your <cite>solana-validator</cite> process, then during catastrophic events like a power outage, you will not be aware of the issue, because your <cite>solana-watchtower</cite> process will stop at the same time as your <cite>solana-validator</cite> process.</p>
<p>Additionally, while running the <cite>solana-watchtower</cite> process manually with environment variables set in the terminal is a good way to test out the command, it is not operationally sound because the process will not be restarted when the terminal closes or during a system restart.</p>
<p>Instead, you could run your <cite>solana-watchtower</cite> command as a system process similar to <cite>solana-validator</cite>. In the system process file, you can specify the environment variables for your bot.</p>
<p>### Setup Telegram Notifications</p>
<p>To send validator health notifications to your Telegram account, we are going to do a few things:</p>
<ol class="arabic simple">
<li><p>Create a bot to send the messages. The bot will be created using BotFather on Telegram</p></li>
<li><p>Send a message to the bot</p></li>
<li><p>Create a Telegram group that will get the watchtower notifications</p></li>
<li><p>Add the environment variables to your command line environment</p></li>
<li><p>Restart the <cite>solana-watchtower</cite> command</p></li>
</ol>
<p>#### Create a Bot Using BotFather</p>
<p>In Telegram, search for <cite>&#64;BotFather</cite>. Send the following message to <a class="reference external" href="mailto:_&#37;&#52;&#48;BotFather_">_<span>&#64;</span>BotFather_</a>: <cite>/newbot</cite>.</p>
<p>Now you will have to come up with a name for the bot. The only requirement is that it cannot have dashes or spaces, and it <strong>must</strong> end in the word <cite>bot</cite>. Many names have already been taken, so you may have to try a few. Once you find an available name, you will get a response from <a class="reference external" href="mailto:_&#37;&#52;&#48;BotFather_">_<span>&#64;</span>BotFather_</a> that includes a link to chat with the bot as well as a token for the bot. Take note of the token. You will need it when you setup your environment variables.</p>
<p>#### Send a Message to The Bot</p>
<p>Find the bot in Telegram and send it the following message: <cite>/start</cite>. Messaging the bot will help you later when looking for the bot chatroom id.</p>
<p>#### Create Telegram Group</p>
<p>In Telegram, click on the new message icon and then select new group. Find your newly created bot and add the bot to the group. Next, name the group whatever you’d like.</p>
<p>#### Set Environment Variables For Watchtower</p>
<p>Now that you have a bot setup, you will need to set the environment variables for the bot so that watchtower can send notifications.</p>
<p>First, recall the chat message that you got from <a class="reference external" href="mailto:_&#37;&#52;&#48;BotFather_">_<span>&#64;</span>BotFather_</a>. In the message, there was an HTTP API token for your bot. The token will have this format: <cite>389178471:MMTKMrnZB4ErUzJmuFIXTKE6DupLSgoa7h4o</cite>. You will use that token to set the <cite>TELEGRAM_BOT_TOKEN</cite> environment variable. In the terminal where you plan to run <cite>solana-watchtower</cite>, run the following:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">TELEGRAM_BOT_TOKEN=&lt;HTTP</span> <span class="pre">API</span> <span class="pre">Token&gt;</span>
<span class="pre">`</span></code></p>
<p>Next, you need the chat id for your group so that <cite>solana-watcher</cite> knows where to send the message. First, send a message to your bot in the chat group that you created. Something like <cite>&#64;newvalidatorbot hello</cite>.</p>
<p>Next, in your browser, go to <cite>https://api.telegram.org/bot&lt;HTTP API Token&gt;/getUpdates</cite>. Make sure to replace <cite>&lt;HTTP API TOKEN&gt;</cite> with your API token that you got in the <a class="reference external" href="mailto:_&#37;&#52;&#48;BotFather_">_<span>&#64;</span>BotFather_</a> message. Also make sure that you include the word <cite>bot</cite> in the URL before the API token. Make the request in the browser.</p>
<p>The response should be in JSON. Search for the string <cite>“chat”:</cite> in the JSON. The <cite>id</cite> value of that chat is your <cite>TELEGRAM_CHAT_ID</cite>. It will be a negative number like: <cite>-781559558</cite>. Remember to include the negative sign! If you cannot find <cite>“chat”:</cite> in the JSON, then you may have to remove the bot from your chat group and add it again.</p>
<p>With your Telegram chat id in hand, export the environment variable where you plan to run <cite>solana-watchtower</cite>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">TELEGRAM_CHAT_ID=&lt;negative</span> <span class="pre">chat</span> <span class="pre">id</span> <span class="pre">number&gt;</span>
<span class="pre">`</span></code></p>
<p>#### Restart solana-watchtower</p>
<p>Once your environment variables are set, restart <cite>solana-watchtower</cite>. You should see output about your validator.</p>
<p>To test that your Telegram configuration is working properly, you could stop your validator briefly until it is labeled as delinquent. Up to a minute after the validator is delinquent, you should receive a message in the Telegram group from your bot. Start the validator again and verify that you get another message in your Telegram group from the bot. The message should say <cite>all clear</cite>.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/validator/best-practices/monitoring.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>