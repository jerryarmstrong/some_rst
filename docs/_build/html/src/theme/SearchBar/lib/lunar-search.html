<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/theme/SearchBar/lib/lunar-search.js &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-theme-searchbar-lib-lunar-search-js">
<h1>docs/src/theme/SearchBar/lib/lunar-search.js<a class="headerlink" href="#docs-src-theme-searchbar-lib-lunar-search-js" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-07-07 18:10:20</p>
<p>Contents:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nx">lunr</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@generated/lunr.client&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>lunr.tokenizer.separator = /[s-/]+/;</p>
<dl>
<dt>class LunrSearchAdapter {</dt><dd><dl class="simple">
<dt>constructor(searchDocs, searchIndex) {</dt><dd><p>this.searchDocs = searchDocs;
this.lunrIndex = lunr.Index.load(searchIndex);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>getLunrResult(input) {</dt><dd><dl>
<dt>return this.lunrIndex.query(function (query) {</dt><dd><p>const tokens = lunr.tokenizer(input);
query.term(tokens, {</p>
<blockquote>
<div><p>boost: 10</p>
</div></blockquote>
<p>});
query.term(tokens, {</p>
<blockquote>
<div><p>wildcard: lunr.Query.wildcard.TRAILING</p>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p>});</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>getHit(doc, formattedTitle, formattedContent) {</dt><dd><dl>
<dt>return {</dt><dd><dl class="simple">
<dt>hierarchy: {</dt><dd><p>lvl0: doc.pageTitle || doc.title,
lvl1: doc.type === 0 ? null : doc.title</p>
</dd>
</dl>
<p>},
url: doc.url,
_snippetResult: formattedContent ? {</p>
<blockquote>
<div><dl class="simple">
<dt>content: {</dt><dd><p>value: formattedContent,
matchLevel: “full”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>} : null,
_highlightResult: {</p>
<blockquote>
<div><dl>
<dt>hierarchy: {</dt><dd><dl class="simple">
<dt>lvl0: {</dt><dd><p>value: doc.type === 0 ? formattedTitle || doc.title : doc.pageTitle,</p>
</dd>
</dl>
<p>},
lvl1:</p>
<blockquote>
<div><dl>
<dt>doc.type === 0</dt><dd><p>? null
: {</p>
<blockquote>
<div><p>value: formattedTitle || doc.title</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>};</p>
</dd>
</dl>
<p>}
getTitleHit(doc, position, length) {</p>
<blockquote>
<div><p>const start = position[0];
const end = position[0] + length;
let formattedTitle = doc.title.substring(0, start) + ‘&lt;span class=”algolia-docsearch-suggestion–highlight”&gt;’ + doc.title.substring(start, end) + ‘&lt;/span&gt;’ + doc.title.substring(end, doc.title.length);
return this.getHit(doc, formattedTitle)</p>
</div></blockquote>
<p>}</p>
<dl class="simple">
<dt>getKeywordHit(doc, position, length) {</dt><dd><p>const start = position[0];
const end = position[0] + length;
let formattedTitle = doc.title + ‘&lt;br /&gt;&lt;i&gt;Keywords: ‘ + doc.keywords.substring(0, start) + ‘&lt;span class=”algolia-docsearch-suggestion–highlight”&gt;’ + doc.keywords.substring(start, end) + ‘&lt;/span&gt;’ + doc.keywords.substring(end, doc.keywords.length) + ‘&lt;/i&gt;’
return this.getHit(doc, formattedTitle)</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>getContentHit(doc, position) {</dt><dd><p>const start = position[0];
const end = position[0] + position[1];
let previewStart = start;
let previewEnd = end;
let ellipsesBefore = true;
let ellipsesAfter = true;
for (let k = 0; k &lt; 3; k++) {</p>
<blockquote>
<div><p>const nextSpace = doc.content.lastIndexOf(’ ‘, previewStart - 2);
const nextDot = doc.content.lastIndexOf(‘.’, previewStart - 2);
if ((nextDot &gt; 0) &amp;&amp; (nextDot &gt; nextSpace)) {</p>
<blockquote>
<div><p>previewStart = nextDot + 1;
ellipsesBefore = false;
break;</p>
</div></blockquote>
<p>}
if (nextSpace &lt; 0) {</p>
<blockquote>
<div><p>previewStart = 0;
ellipsesBefore = false;
break;</p>
</div></blockquote>
<p>}
previewStart = nextSpace + 1;</p>
</div></blockquote>
<p>}
for (let k = 0; k &lt; 10; k++) {</p>
<blockquote>
<div><p>const nextSpace = doc.content.indexOf(’ ‘, previewEnd + 1);
const nextDot = doc.content.indexOf(‘.’, previewEnd + 1);
if ((nextDot &gt; 0) &amp;&amp; (nextDot &lt; nextSpace)) {</p>
<blockquote>
<div><p>previewEnd = nextDot;
ellipsesAfter = false;
break;</p>
</div></blockquote>
<p>}
if (nextSpace &lt; 0) {</p>
<blockquote>
<div><p>previewEnd = doc.content.length;
ellipsesAfter = false;
break;</p>
</div></blockquote>
<p>}
previewEnd = nextSpace;</p>
</div></blockquote>
<p>}
let preview = doc.content.substring(previewStart, start);
if (ellipsesBefore) {</p>
<blockquote>
<div><p>preview = ‘… ‘ + preview;</p>
</div></blockquote>
<p>}
preview += ‘&lt;span class=”algolia-docsearch-suggestion–highlight”&gt;’ + doc.content.substring(start, end) + ‘&lt;/span&gt;’;
preview += doc.content.substring(end, previewEnd);
if (ellipsesAfter) {</p>
<blockquote>
<div><p>preview += ‘ …’;</p>
</div></blockquote>
<p>}
return this.getHit(doc, null, preview);</p>
</dd>
</dl>
<p>}
search(input) {</p>
<blockquote>
<div><dl>
<dt>return new Promise((resolve, rej) =&gt; {</dt><dd><p>const results = this.getLunrResult(input);
const hits = [];
results.length &gt; 5 &amp;&amp; (results.length = 5);
this.titleHitsRes = []
this.contentHitsRes = []
results.forEach(result =&gt; {</p>
<blockquote>
<div><p>const doc = this.searchDocs[result.ref];
const { metadata } = result.matchData;
for (let i in metadata) {</p>
<blockquote>
<div><dl>
<dt>if (metadata[i].title) {</dt><dd><dl class="simple">
<dt>if (!this.titleHitsRes.includes(result.ref)) {</dt><dd><p>const position = metadata[i].title.position[0]
hits.push(this.getTitleHit(doc, position, input.length));
this.titleHitsRes.push(result.ref);</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>} else if (metadata[i].content) {</dt><dd><p>const position = metadata[i].content.position[0]
hits.push(this.getContentHit(doc, position))</p>
</dd>
<dt>} else if (metadata[i].keywords) {</dt><dd><p>const position = metadata[i].keywords.position[0]
hits.push(this.getKeywordHit(doc, position, input.length));
this.titleHitsRes.push(result.ref);</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>});
hits.length &gt; 5 &amp;&amp; (hits.length = 5);
resolve(hits);</p>
</dd>
</dl>
<p>});</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p>export default LunrSearchAdapter;</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../_sources/src/theme/SearchBar/lib/lunar-search.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>