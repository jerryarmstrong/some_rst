<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/core/transfer-request/WALLET_INTEGRATION.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-core-transfer-request-wallet-integration-md">
<h1>docs/src/core/transfer-request/WALLET_INTEGRATION.md<a class="headerlink" href="#docs-src-core-transfer-request-wallet-integration-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-05-03 15:27:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Handle a transfer request
slug: /core/transfer-request/wallet-integration
—</p>
<p>This section describes how a wallet provider can support payment links in their wallet. It shows how to parse the payment URL and create a transaction from it.</p>
<p>This guide walks through an <strong>example</strong> implementation for wallet providers. The purpose of this is to make it easy for wallets to implement the protocol correctly.</p>
<p>—</p>
<p>## 1. Set up Solana Pay</p>
<p>Install the packages and import them in your code.</p>
<p><strong>npm</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`shell=</span>
<span class="pre">npm</span> <span class="pre">install</span> <span class="pre">&#64;solana/pay</span> <span class="pre">&#64;solana/web3.js</span> <span class="pre">--save</span>
<span class="pre">`</span></code></p>
<p><strong>yarn</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`shell=</span>
<span class="pre">yarn</span> <span class="pre">add</span> <span class="pre">&#64;solana/pay</span> <span class="pre">&#64;solana/web3.js</span>
<span class="pre">`</span></code></p>
<p>## 2. Parse payment request link</p>
<p>As a wallet provider, you will have to parse the received URL to extract the parameters. For more information on the URL format, please see the [specification](../../SPEC.md).</p>
<dl class="simple">
<dt>&lt;details&gt;</dt><dd><p>&lt;summary&gt;Parse the URL to retrieve all possible fields:&lt;/summary&gt;</p>
</dd>
</dl>
<p>&lt;br/&gt;</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>ts
import { parseURL } from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/pay">‘<span>&#64;</span>solana/pay</a>’;</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>For example only</p></li>
<li></li>
<li><p>The URL that triggers the wallet interaction; follows the Solana Pay URL scheme</p></li>
<li><p>The parameters needed to create the correct transaction is encoded within the URL</p></li>
</ul>
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
</dd>
<dt>const url =</dt><dd><p>‘solana:mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN?amount=0.01&amp;reference=82ZJ7nbGpixjeDCmEhUcmwXYfvurzAgGdtSMuHnUgyny&amp;label=Michael&amp;message=Thanks%20for%20all%20the%20fish&amp;memo=OrderId5678’;</p>
</dd>
</dl>
<p>const { recipient, amount, splToken, reference, label, message, memo } = parseURL(url);
<a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id9"><span class="problematic" id="id10">`</span></a></p>
<p>See [full code snippet][9]</p>
<p>&lt;/details&gt;</p>
<p>## 3. Create transaction</p>
<p>Use the <cite>createTransaction</cite> function to create a transaction with the parameters from the <cite>parseURL</cite> function with an additional <cite>payer</cite>.</p>
<p>The <cite>payer</cite> <strong>should</strong> be the public key of the current users’ wallet.</p>
<dl class="simple">
<dt>&lt;details&gt;</dt><dd><p>&lt;summary&gt;Create transaction reference implementation&lt;/summary&gt;</p>
</dd>
</dl>
<p>&lt;br/&gt;</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a>typescript
import { parseURL, createTransaction } from <a class="reference external" href="mailto:'&#37;&#52;&#48;solana/pay">‘<span>&#64;</span>solana/pay</a>’;</p>
<dl class="simple">
<dt>const url =</dt><dd><p>‘solana:mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN?amount=0.01&amp;reference=82ZJ7nbGpixjeDCmEhUcmwXYfvurzAgGdtSMuHnUgyny&amp;label=Michael&amp;message=Thanks%20for%20all%20the%20fish&amp;memo=OrderId5678’;</p>
</dd>
</dl>
<p>const { recipient, amount, splToken, reference, label, message, memo } = parseURL(url);</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Create the transaction with the parameters decoded from the URL</p></li>
</ul>
<p><a href="#id15"><span class="problematic" id="id16">*</span></a>/</p>
</dd>
</dl>
<p>const payer = CUSTOMER_WALLET.publicKey;
const tx = await createTransfer(connection, payer, { recipient, amount, reference, memo });
<a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a></p>
<p>See [full code snippet][10]</p>
<p>&lt;/details&gt;</p>
<p>This transaction <strong>should</strong> represent the original intent of the payment request link. The example implementation walks through the steps on how to construct the transaction:</p>
<p><strong>Native SOL transfer</strong></p>
<ol class="arabic simple">
<li><p>Check that the payer and recipient accounts exist</p></li>
<li><p>Check the payer and recipient are valid native accounts</p></li>
<li><p>Check the payer has enough lamports for the transfer</p></li>
<li><p>Create an instruction to transfer native SOL</p></li>
<li><p>If references were included, add them to the instruction</p></li>
<li><p>If a memo was included, create an instruction for the memo program</p></li>
</ol>
<p><strong>SPL token transfer</strong></p>
<ol class="arabic simple">
<li><p>Check that the payer and recipient accounts exist</p></li>
<li><p>Check the token provided is an initialized mint</p></li>
<li><p>Check the payer and recipient’s Associated Token Account (ATA) exists</p></li>
<li><p>Check the payer has enough lamports for the transfer</p></li>
<li><p>Create an instruction to transfer SPL tokens</p></li>
<li><p>If references were included, add them to the instruction</p></li>
<li><p>If a memo was included, create an instruction for the memo program</p></li>
</ol>
<p>## 4. Complete transaction</p>
<p>With the transaction formed. The user must be prompted to approve the transaction.</p>
<p>The <cite>label</cite> and <cite>message</cite> <strong>should</strong> be shown to the user, as it gives added context to the user on the transaction.</p>
<dl>
<dt>&lt;details&gt;</dt><dd><dl class="simple">
<dt>&lt;summary&gt;</dt><dd><p>Finally, use &lt;code&gt;sendAndConfirmTransaction&lt;/code&gt; to complete the transaction.</p>
</dd>
</dl>
<p>&lt;/summary&gt;</p>
</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a>typescript
const { recipient, message, memo, amount, reference, label } = parseURL(url);
console.log(‘label: ‘, label);
console.log(‘message: ‘, message);</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Create the transfer with the parameters decoded from the URL</p></li>
</ul>
<p><a href="#id25"><span class="problematic" id="id26">*</span></a>/</p>
</dd>
</dl>
<p>const tx = await createTransfer(connection, payer, { recipient, amount, reference, memo });</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Send the transaction to the network</p></li>
</ul>
<p><a href="#id27"><span class="problematic" id="id28">*</span></a>/</p>
</dd>
</dl>
<p>sendAndConfirmTransaction(connection, tx, [CUSTOMER_WALLET]);
<a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>See [full code snippet][11]</p>
<p>&lt;/details&gt;</p>
<p>## Deep linking</p>
<p>Wallet providers building for mobile or wearable devices are encouraged to register their app as a handler for the Solana Pay URL scheme <cite>solana:</cite>.</p>
<p>For example, when a payment request is presented as a QR code, the payer should ideally be able to read the code using the native scanning capability of their device and have the appropriate wallet open with the transaction prefilled.</p>
<p>URLs can be embedded in the environment in web pages, QR codes, NFC tags and potential new formats. To avoid inadvertent transfer of tokens, care must be taken when designing wallets to ensure that transactions cannot accidentally be triggered and sent.</p>
<p>&lt;!– References –&gt;</p>
<p>[9]: <a class="reference external" href="https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L13">https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L13</a>
[10]: <a class="reference external" href="https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L27">https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L27</a>
[11]: <a class="reference external" href="https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L35">https://github.com/solana-labs/solana-pay/blob/master/core/example/payment-flow-merchant/simulateWalletInteraction.ts#L35</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/core/transfer-request/WALLET_INTEGRATION.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>