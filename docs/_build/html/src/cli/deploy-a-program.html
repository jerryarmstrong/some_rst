<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/cli/deploy-a-program.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-cli-deploy-a-program-md">
<h1>docs/src/cli/deploy-a-program.md<a class="headerlink" href="#docs-src-cli-deploy-a-program-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Deploy a Program
—</p>
<p>Developers can deploy on-chain [programs](terminology.md#program) (often called
smart contracts elsewhere) with the Solana tools.</p>
<p>To learn about developing and executing programs on Solana, start with the
[intro to Solana programs](developing/intro/programs.md) and then dig into the
details of [on-chain programs](developing/on-chain-programs/overview.md).</p>
<p>To deploy a program, use the Solana tools to interact with the on-chain loader
to:</p>
<ul class="simple">
<li><p>Initialize a program account</p></li>
<li><p>Upload the program’s shared object to the program account’s data buffer</p></li>
<li><p>Verify the uploaded program</p></li>
<li><p>Finalize the program by marking the program account executable.</p></li>
</ul>
<p>Once deployed, anyone can execute the program by sending transactions that
reference it to the cluster.</p>
<p>## Usage</p>
<p>### Deploy a program</p>
<p>To deploy a program, you will need the location of the program’s shared object
(the program binary .so)</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>Successful deployment will return the program id of the deployed program, for
example:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">Program</span> <span class="pre">Id:</span> <span class="pre">3KS2k14CmtnuVv2fvYcvdrNgC94Y11WETBpMUGgXyWZL</span>
<span class="pre">`</span></code></p>
<p>Specify the keypair in the deploy command to deploy to a specific program id:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--program-id</span> <span class="pre">&lt;KEYPAIR_FILEPATH&gt;</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>If the program id is not specified on the command line the tools will first look
for a keypair file matching the <cite>&lt;PROGRAM_FILEPATH&gt;</cite>, or internally generate a
new keypair.</p>
<p>A matching program keypair file is in the same directory as the program’s shared
object, and named &lt;PROGRAM_NAME&gt;-keypair.json. Matching program keypairs are
generated automatically by the program build tools:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">./path-to-program/program.so</span>
<span class="pre">./path-to-program/program-keypair.json</span>
<span class="pre">`</span></code></p>
<p>### Showing a program account</p>
<p>To get information about a deployed program:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">&lt;ACCOUNT_ADDRESS&gt;</span>
<span class="pre">`</span></code></p>
<p>An example output looks like:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">Program</span> <span class="pre">Id:</span> <span class="pre">3KS2k14CmtnuVv2fvYcvdrNgC94Y11WETBpMUGgXyWZL</span>
<span class="pre">Owner:</span> <span class="pre">BPFLoaderUpgradeab1e11111111111111111111111</span>
<span class="pre">ProgramData</span> <span class="pre">Address:</span> <span class="pre">EHsACWBhgmw8iq5dmUZzTA1esRqcTognhKNHUkPi4q4g</span>
<span class="pre">Authority:</span> <span class="pre">FwoGJNUaJN2zfVEex9BB11Dqb3NJKy3e9oY3KTh9XzCU</span>
<span class="pre">Last</span> <span class="pre">Deployed</span> <span class="pre">In</span> <span class="pre">Slot:</span> <span class="pre">63890568</span>
<span class="pre">Data</span> <span class="pre">Length:</span> <span class="pre">5216</span> <span class="pre">(0x1460)</span> <span class="pre">bytes</span>
<span class="pre">`</span></code></p>
<ul class="simple">
<li><p><cite>Program Id</cite> is the address that can be referenced in an instruction’s
<cite>program_id</cite> field when invoking a program.</p></li>
<li><p><cite>Owner</cite>: The loader this program was deployed with.</p></li>
<li><p><cite>ProgramData Address</cite> is the account associated with the program account that
holds the program’s data (shared object).</p></li>
<li><p><cite>Authority</cite> is the program’s upgrade authority.</p></li>
<li><p><cite>Last Deployed In Slot</cite> is the slot in which the program was last deployed.</p></li>
<li><p><cite>Data Length</cite> is the size of the space reserved for deployments. The actual
space used by the currently deployed program may be less.</p></li>
</ul>
<p>### Redeploy a program</p>
<p>A program can be redeployed to the same address to facilitate rapid development,
bug fixes, or upgrades. Matching keypair files are generated once so that
redeployments will be to the same program address.</p>
<p>The command looks the same as the deployment command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>By default, programs are deployed to accounts that are twice the size of the
original deployment. Doing so leaves room for program growth in future
redeployments. But, if the initially deployed program is very small  and then
later grows substantially, the redeployment may fail. To avoid this, specify
a <cite>max_len</cite> that is at least the size (in bytes) that the program is expected
to become (plus some wiggle room).</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--max-len</span> <span class="pre">200000</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>Note that program accounts are required to be
[rent-exempt](developing/programming-model/accounts.md#rent-exemption), and the
<cite>max-len</cite> is fixed after initial deployment, so any SOL in the program accounts
is locked up permanently.</p>
<p>### Resuming a failed deploy</p>
<p>If program deployment fails, there will be a hanging intermediate buffer account
that contains a non-zero balance. In order to recoup that balance you may
resume a failed deployment by providing the same intermediate buffer to a new
call to <cite>deploy</cite>.</p>
<p>Deployment failures will print an error message specifying the seed phrase
needed to recover the generated intermediate buffer’s keypair:</p>
</section>
<section id="id5">
<h1><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h1>
<p>Recover the intermediate account’s ephemeral keypair file with
<cite>solana-keygen recover</cite> and the following 12-word seed phrase:
==================================================================================
valley flat great hockey share token excess clever benefit traffic avocado athlete
==================================================================================
To resume a deploy, pass the recovered keypair as
the [BUFFER_SIGNER] to <cite>solana program deploy</cite> or <cite>solana program write-buffer’.
Or to recover the account’s lamports, pass it as the
[BUFFER_ACCOUNT_ADDRESS] argument to `solana program drain</cite>.
==================================================================================
<a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a></p>
<p>To recover the keypair:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana-keygen</span> <span class="pre">recover</span> <span class="pre">-o</span> <span class="pre">&lt;KEYPAIR_PATH&gt;</span>
<span class="pre">`</span></code></p>
<p>When asked, enter the 12-word seed phrase.</p>
<p>Then issue a new <cite>deploy</cite> command and specify the buffer:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--buffer</span> <span class="pre">&lt;KEYPAIR_PATH&gt;</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>### Closing program and buffer accounts, and reclaiming their lamports</p>
<p>Both program and buffer accounts can be closed and their lamport balances
transferred to a recipient’s account.</p>
<p>If deployment fails there will be a left over buffer account that holds
lamports. The buffer account can either be used to [resume a
deploy](#resuming-a-failed-deploy) or closed.</p>
<p>The program or buffer account’s authority must be present to close an account,
to list all the open program or buffer accounts that match the default
authority:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">--programs</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">--buffers</span>
<span class="pre">`</span></code></p>
<p>To specify a different authority:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">--programs</span> <span class="pre">--buffer-authority</span> <span class="pre">&lt;AURTHORITY_ADRESS&gt;</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">--buffers</span> <span class="pre">--buffer-authority</span> <span class="pre">&lt;AURTHORITY_ADRESS&gt;</span>
<span class="pre">`</span></code></p>
<p>To close a single account:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">close</span> <span class="pre">&lt;BADDRESS&gt;</span>
<span class="pre">`</span></code></p>
<p>To close a single account and specify a different authority than the default:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">close</span> <span class="pre">&lt;ADDRESS&gt;</span> <span class="pre">--buffer-authority</span> <span class="pre">&lt;KEYPAIR_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>To close a single account and specify a different recipient than the default:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">close</span> <span class="pre">&lt;ADDRESS&gt;</span> <span class="pre">--recipient</span> <span class="pre">&lt;RECIPIENT_ADDRESS&gt;</span>
<span class="pre">`</span></code></p>
<p>To close all the buffer accounts associated with the current authority:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">close</span> <span class="pre">--buffers</span>
<span class="pre">`</span></code></p>
<p>To show all buffer accounts regardless of the authority</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">show</span> <span class="pre">--buffers</span> <span class="pre">--all</span>
<span class="pre">`</span></code></p>
<p>### Set a program’s upgrade authority</p>
<p>The program’s upgrade authority must to be present to deploy a program. If no
authority is specified during program deployment, the default keypair is used as
the authority. This is why redeploying a program in the steps above didn’t
require an authority to be explicitly specified.</p>
<p>The authority can be specified during deployment:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--upgrade-authority</span> <span class="pre">&lt;UPGRADE_AUTHORITY_SIGNER&gt;</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>Or after deployment and using the default keypair as the current authority:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">set-upgrade-authority</span> <span class="pre">&lt;PROGRAM_ADDRESS&gt;</span> <span class="pre">--new-upgrade-authority</span> <span class="pre">&lt;NEW_UPGRADE_AUTHORITY&gt;</span>
<span class="pre">`</span></code></p>
<p>Or after deployment and specifying the current authority:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">set-upgrade-authority</span> <span class="pre">&lt;PROGRAM_ADDRESS&gt;</span> <span class="pre">--upgrade-authority</span> <span class="pre">&lt;UPGRADE_AUTHORITY_SIGNER&gt;</span> <span class="pre">--new-upgrade-authority</span> <span class="pre">&lt;NEW_UPGRADE_AUTHORITY&gt;</span>
<span class="pre">`</span></code></p>
<p>### Immutable programs</p>
<p>A program can be marked immutable, which prevents all further redeployments, by
specifying the <cite>–final</cite> flag during deployment:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span> <span class="pre">--final</span>
<span class="pre">`</span></code></p>
<p>Or anytime after:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">set-upgrade-authority</span> <span class="pre">&lt;PROGRAM_ADDRESS&gt;</span> <span class="pre">--final</span>
<span class="pre">`</span></code></p>
<p>### Dumping a program to a file</p>
<p>The deployed program may be dumped back to a local file:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">dump</span> <span class="pre">&lt;ACCOUNT_ADDRESS&gt;</span> <span class="pre">&lt;OUTPUT_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>The dumped file will be in the same as what was deployed, so in the case of a
shared object, the dumped file will be a fully functional shared object. Note
that the <cite>dump</cite> command dumps the entire data space, which means the output file
will have trailing zeros after the shared object’s data up to <cite>max_len</cite>.
Sometimes it is useful to dump and compare a program to ensure it matches a
known program binary. The original program file can be zero-extended, hashed,
and compared to the hash of the dumped file.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$</span> <span class="pre">solana</span> <span class="pre">dump</span> <span class="pre">&lt;ACCOUNT_ADDRESS&gt;</span> <span class="pre">dump.so</span>
<span class="pre">$</span> <span class="pre">cp</span> <span class="pre">original.so</span> <span class="pre">extended.so</span>
<span class="pre">$</span> <span class="pre">truncate</span> <span class="pre">-r</span> <span class="pre">dump.so</span> <span class="pre">extended.so</span>
<span class="pre">$</span> <span class="pre">sha256sum</span> <span class="pre">extended.so</span> <span class="pre">dump.so</span>
<span class="pre">`</span></code></p>
<p>### Using an intermediary Buffer account</p>
<p>Instead of deploying directly to the program account, the program can be written
to an intermediary buffer account. Intermediary accounts can be useful for things
like multi-entity governed programs where the governing members fist verify the
intermediary buffer contents and then vote to allow an upgrade using it.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">write-buffer</span> <span class="pre">&lt;PROGRAM_FILEPATH&gt;</span>
<span class="pre">`</span></code></p>
<p>Buffer accounts support authorities like program accounts:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">set-buffer-authority</span> <span class="pre">&lt;BUFFER_ADDRESS&gt;</span> <span class="pre">--new-buffer-authority</span> <span class="pre">&lt;NEW_BUFFER_AUTHORITY&gt;</span>
<span class="pre">`</span></code></p>
<p>One exception is that buffer accounts cannot be marked immutable like program
accounts can, so they don’t support <cite>–final</cite>.</p>
<p>The buffer account, once entirely written, can be passed to <cite>deploy</cite> to deploy
the program:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">solana</span> <span class="pre">program</span> <span class="pre">deploy</span> <span class="pre">--program-id</span> <span class="pre">&lt;PROGRAM_ADDRESS&gt;</span> <span class="pre">--buffer</span> <span class="pre">&lt;BUFFER_ADDRESS&gt;</span>
<span class="pre">`</span></code></p>
<p>Note, the buffer’s authority must match the program’s upgrade authority.</p>
<p>Buffers also support <cite>show</cite> and <cite>dump</cite> just like programs do.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/cli/deploy-a-program.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>