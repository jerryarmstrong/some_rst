<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/cluster/bench-tps.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-cluster-bench-tps-md">
<h1>docs/src/cluster/bench-tps.md<a class="headerlink" href="#docs-src-cluster-bench-tps-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Benchmark a Cluster
—</p>
<p>The Solana git repository contains all the scripts you might need to spin up your own local testnet. Depending on what you’re looking to achieve, you may want to run a different variation, as the full-fledged, performance-enhanced multinode testnet is considerably more complex to set up than a Rust-only, singlenode testnode. If you are looking to develop high-level features, such as experimenting with smart contracts, save yourself some setup headaches and stick to the Rust-only singlenode demo. If you’re doing performance optimization of the transaction pipeline, consider the enhanced singlenode demo. If you’re doing consensus work, you’ll need at least a Rust-only multinode demo. If you want to reproduce our TPS metrics, run the enhanced multinode demo.</p>
<p>For all four variations, you’d need the latest Rust toolchain and the Solana source code:</p>
<p>First, setup Rust, Cargo and system packages as described in the Solana [README](<a class="reference external" href="https://github.com/solana-labs/solana#1-install-rustc-cargo-and-rustfmt">https://github.com/solana-labs/solana#1-install-rustc-cargo-and-rustfmt</a>)</p>
<p>Now checkout the code from github:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/solana-labs/solana.git</span>
<span class="pre">cd</span> <span class="pre">solana</span>
<span class="pre">`</span></code></p>
<p>The demo code is sometimes broken between releases as we add new low-level features, so if this is your first time running the demo, you’ll improve your odds of success if you check out the [latest release](<a class="reference external" href="https://github.com/solana-labs/solana/releases">https://github.com/solana-labs/solana/releases</a>) before proceeding:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">TAG=$(git</span> <span class="pre">describe</span> <span class="pre">--tags</span> <span class="pre">$(git</span> <span class="pre">rev-list</span> <span class="pre">--tags</span> <span class="pre">--max-count=1))</span>
<span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">$TAG</span>
<span class="pre">`</span></code></p>
<p>### Configuration Setup</p>
<p>Ensure important programs such as the vote program are built before any nodes are started. Note that we are using the release build here for good performance.
If you want the debug build, use just <cite>cargo build</cite> and omit the <cite>NDEBUG=1</cite> part of the command.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">cargo</span> <span class="pre">build</span> <span class="pre">--release</span>
<span class="pre">`</span></code></p>
<p>The network is initialized with a genesis ledger generated by running the following script.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/setup.sh</span>
<span class="pre">`</span></code></p>
<p>### Faucet</p>
<p>In order for the validators and clients to work, we’ll need to spin up a faucet to give out some test tokens. The faucet delivers Milton Friedman-style “air drops” (free tokens to requesting clients) to be used in test transactions.</p>
<p>Start the faucet with:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/faucet.sh</span>
<span class="pre">`</span></code></p>
<p>### Singlenode Testnet</p>
<p>Before you start a validator, make sure you know the IP address of the machine you want to be the bootstrap validator for the demo, and make sure that udp ports 8000-10000 are open on all the machines you want to test with.</p>
<p>Now start the bootstrap validator in a separate shell:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/bootstrap-validator.sh</span>
<span class="pre">`</span></code></p>
<p>Wait a few seconds for the server to initialize. It will print “leader ready…” when it’s ready to receive transactions. The leader will request some tokens from the faucet if it doesn’t have any. The faucet does not need to be running for subsequent leader starts.</p>
<p>### Multinode Testnet</p>
<p>To run a multinode testnet, after starting a leader node, spin up some additional validators in separate shells:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/validator-x.sh</span>
<span class="pre">`</span></code></p>
<p>To run a performance-enhanced validator on Linux, [CUDA 10.0](<a class="reference external" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a>) must be installed on your system:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">./fetch-perf-libs.sh</span>
<span class="pre">NDEBUG=1</span> <span class="pre">SOLANA_CUDA=1</span> <span class="pre">./multinode-demo/bootstrap-validator.sh</span>
<span class="pre">NDEBUG=1</span> <span class="pre">SOLANA_CUDA=1</span> <span class="pre">./multinode-demo/validator.sh</span>
<span class="pre">`</span></code></p>
<p>### Testnet Client Demo</p>
<p>Now that your singlenode or multinode testnet is up and running let’s send it some transactions!</p>
<p>In a separate shell start the client:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/bench-tps.sh</span> <span class="pre">#</span> <span class="pre">runs</span> <span class="pre">against</span> <span class="pre">localhost</span> <span class="pre">by</span> <span class="pre">default</span>
<span class="pre">`</span></code></p>
<p>What just happened? The client demo spins up several threads to send 500,000 transactions to the testnet as quickly as it can. The client then pings the testnet periodically to see how many transactions it processed in that time. Take note that the demo intentionally floods the network with UDP packets, such that the network will almost certainly drop a bunch of them. This ensures the testnet has an opportunity to reach 710k TPS. The client demo completes after it has convinced itself the testnet won’t process any additional transactions. You should see several TPS measurements printed to the screen. In the multinode variation, you’ll see TPS measurements for each validator node as well.</p>
<p>### Testnet Debugging</p>
<p>There are some useful debug messages in the code, you can enable them on a per-module and per-level basis. Before running a leader or validator set the normal RUST_LOG environment variable.</p>
<p>For example</p>
<ul>
<li><p>To enable <cite>info</cite> everywhere and <cite>debug</cite> only in the solana::banking_stage module:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">export</span> <span class="pre">RUST_LOG=solana=info,solana::banking_stage=debug</span>
<span class="pre">`</span></code></p>
</li>
<li><p>To enable SBF program logging:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">export</span> <span class="pre">RUST_LOG=solana_bpf_loader=trace</span>
<span class="pre">`</span></code></p>
</li>
</ul>
<p>Generally we are using <cite>debug</cite> for infrequent debug messages, <cite>trace</cite> for potentially frequent messages and <cite>info</cite> for performance-related logging.</p>
<p>You can also attach to a running process with GDB. The leader’s process is named _solana-<a href="#id1"><span class="problematic" id="id2">validator_</span></a>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">sudo</span> <span class="pre">gdb</span>
<span class="pre">attach</span> <span class="pre">&lt;PID&gt;</span>
<span class="pre">set</span> <span class="pre">logging</span> <span class="pre">on</span>
<span class="pre">thread</span> <span class="pre">apply</span> <span class="pre">all</span> <span class="pre">bt</span>
<span class="pre">`</span></code></p>
<p>This will dump all the threads stack traces into gdb.txt</p>
<p>## Developer Testnet</p>
<p>In this example the client connects to our public testnet. To run validators on the testnet you would need to open udp ports <cite>8000-10000</cite>.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">NDEBUG=1</span> <span class="pre">./multinode-demo/bench-tps.sh</span> <span class="pre">--entrypoint</span> <span class="pre">entrypoint.devnet.solana.com:8001</span> <span class="pre">--faucet</span> <span class="pre">api.devnet.solana.com:9900</span> <span class="pre">--duration</span> <span class="pre">60</span> <span class="pre">--tx_count</span> <span class="pre">50</span>
<span class="pre">`</span></code></p>
<p>You can observe the effects of your client’s transactions on our [metrics dashboard](<a class="reference external" href="https://metrics.solana.com:3000/d/monitor/cluster-telemetry?var-testnet=devnet">https://metrics.solana.com:3000/d/monitor/cluster-telemetry?var-testnet=devnet</a>)</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/cluster/bench-tps.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>