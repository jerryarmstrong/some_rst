<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/src/cluster/managing-forks.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-src-cluster-managing-forks-md">
<h1>docs/src/cluster/managing-forks.md<a class="headerlink" href="#docs-src-cluster-managing-forks-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-11 21:38:33</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>title: Managing Forks
—</p>
<p>The ledger is permitted to fork at slot boundaries. The resulting data structure forms a tree called a _blockstore_. When the validator interprets the blockstore, it must maintain state for each fork in the chain. It is the responsibility of a validator to weigh those forks, such that it may eventually select a fork. Details for selection and voting on these forks can be found in [Tower Bft](../implemented-proposals/tower-bft.md)</p>
<p>## Forks</p>
<p>A fork is as a sequence of slots originating from some root. For example:</p>
<dl>
<dt><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a></dt><dd><blockquote>
<div><p>2 - 4 - 6 - 8</p>
</div></blockquote>
<p>/</p>
</dd>
<dt>0 - 1       12 - 13</dt><dd><dl class="simple">
<dt>    /</dt><dd><dl class="simple">
<dt>3 - 5</dt><dd><dl class="simple">
<dt></dt><dd><p>7 - 9 - 10 - 11</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>The following sequences are forks:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">-</span> <span class="pre">{0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">4,</span> <span class="pre">6,</span> <span class="pre">8}</span>
<span class="pre">-</span> <span class="pre">{0,</span> <span class="pre">1,</span> <span class="pre">3,</span> <span class="pre">5,</span> <span class="pre">12,</span> <span class="pre">13}</span>
<span class="pre">-</span> <span class="pre">{0,</span> <span class="pre">1,</span> <span class="pre">3,</span> <span class="pre">5,</span> <span class="pre">7,</span> <span class="pre">9,</span> <span class="pre">10,</span> <span class="pre">11}</span>
<span class="pre">`</span></code></p>
<p>## Pruning and Squashing</p>
<p>As the chain grows, storing the local forks view becomes detrimental to performance. Fortunately we can take advantage of the properties of tower bft roots to prune this data structure. Recall a root is a slot that has reached the max lockout depth. The assumption is that this slot has accrued enough lockout that it would be impossible to roll this slot back.</p>
<p>Thus, the validator prunes forks that do not originate from its local root, and then takes the opportunity to minimize its memory usage by squashing any nodes it can into the root. Although not necessary for consensus, to enable some RPC use cases the validator chooses to keep ancestors of its local root up until the last slot rooted by the super majority of the cluster. We call this the super majority root (SMR).</p>
<p>Starting from the above example imagine a max lockout depth of 3. Our validator votes on slots <cite>0, 1, 3, 5, 7, 9</cite>. Upon the final vote at <cite>9</cite>, our local root is <cite>3</cite>. Assume the latest super majority root is <cite>0</cite>. After pruning this is our local fork view.</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a>`
SMR</p>
<blockquote>
<div><dl>
<dt>0 - 1       12 - 13</dt><dd><blockquote>
<div><dl class="simple">
<dt>    /</dt><dd><p>3 - 5</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>ROOT   </dt><dd><p>7 - 9 - 10 - 11</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a></p>
<p>Now imagine we vote on <cite>10</cite>, which roots <cite>5</cite>. At the same time the cluster catches up and the latest super majority root is now <cite>3</cite>. After pruning this is our local fork view.</p>
<dl>
<dt><a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">`</span></a></dt><dd><blockquote>
<div><blockquote>
<div><blockquote>
<div><p>12 - 13</p>
</div></blockquote>
<p>/</p>
</div></blockquote>
<p>3 - 5 ROOT</p>
</div></blockquote>
<dl class="simple">
<dt>SMR   </dt><dd><p>7 - 9 - 10 - 11</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>Finally a vote on <cite>11</cite> will root <cite>7</cite>, pruning the final fork
<a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">`</span></a></p>
<blockquote>
<div><blockquote>
<div><p>3 - 5 - 7 - 9 - 10 - 11</p>
</div></blockquote>
<p>SMR     ROOT</p>
</div></blockquote>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/src/cluster/managing-forks.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>