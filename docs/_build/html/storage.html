<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/storage.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-storage-md">
<h1>docs/storage.md<a class="headerlink" href="#docs-storage-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-07-27 15:49:41</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Uploading and downloading assets</span>
</pre></div>
</div>
<p>Umi enables us to upload and download any file via the [<cite>UploaderInterface</cite>](<a class="reference external" href="https://umi-docs.vercel.app/interfaces/umi.UploaderInterface.html">https://umi-docs.vercel.app/interfaces/umi.UploaderInterface.html</a>) and [<cite>DownloaderInterface</cite>](<a class="reference external" href="https://umi-docs.vercel.app/interfaces/umi.DownloaderInterface.html">https://umi-docs.vercel.app/interfaces/umi.DownloaderInterface.html</a>) interfaces respectively.</p>
<p>## Generic files</p>
<p>Because the definition of a file varies between libraries and whether we are in the browser or a Node server, Umi defines a type called <cite>GenericFile</cite> so we can agree on a common type for files.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>ts
type GenericFile = {</p>
<blockquote>
<div><p>readonly buffer: Uint8Array;
readonly fileName: string;
readonly displayName: string;
readonly uniqueName: string;
readonly contentType: string | null;
readonly extension: string | null;
readonly tags: GenericFileTag[];</p>
</div></blockquote>
<section id="id5">
<h2>};<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>As you can see, its content is stored as a <cite>Uint8Array</cite> buffer and it includes some metadata such as its filename, its display name, its content type, etc. It also includes a simple key-value storage to store any additional data as tags. These can also be used to pass additional information about the file to the uploader.</p>
<p>You can use the <cite>createGenericFile</cite> helper function to create a new <cite>GenericFile</cite> instance from its content and filename. To help us convert a file from a specific environment to and from a <cite>GenericFile</cite>, Umi also provides some additional helper methods.</p>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>ts
// Create a generic file directly.
createGenericFile(‘some content’, ‘my-file.txt’);</p>
<p>// Parse a generic file to and from a browser file.
await createGenericFileFromBrowserFile(myBrowserFile);
createBrowserFileFromGenericFile(myGenericFile);</p>
<p>// Parse a generic file to and from a JSON object.
createGenericFileFromJson(myJson);
parseJsonFromGenericFile(myGenericFile);
<a href="#id10"><span class="problematic" id="id11">``</span></a><a href="#id12"><span class="problematic" id="id13">`</span></a></p>
<p>## The uploader interface</p>
<p>First and foremost, the <cite>UploaderInterface</cite> provides an <cite>upload</cite> method that can be used to upload one or several files at once. It returns an array of URIs that represent the uploaded files in the order in which they were passed.</p>
<p><code class="docutils literal notranslate"><span class="pre">`ts</span>
<span class="pre">const</span> <span class="pre">[myUri,</span> <span class="pre">myOtherUri]</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">umi.uploader.upload([myFile,</span> <span class="pre">myOtherFile]);</span>
<span class="pre">`</span></code></p>
<blockquote>
<div><p>The <cite>upload</cite> method also accepts some options to configure the upload process such as an abort <cite>signal</cite> to cancel the upload or an <cite>onProgress</cite> callback to track the upload progress. Note that these may not be supported by all uploaders.</p>
</div></blockquote>
<p><a href="#id14"><span class="problematic" id="id15">``</span></a><a href="#id16"><span class="problematic" id="id17">`</span></a>ts
const myUris = await umi.uploader.upload(myFiles, {</p>
<blockquote>
<div><p>signal: myAbortSignal,
onProgress: (percent) =&gt; {</p>
<blockquote>
<div><p>console.log(<cite>${percent * 100}% uploaded…</cite>);</p>
</div></blockquote>
<p>},</p>
</div></blockquote>
</section>
<section id="id18">
<h2>})<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h2>
<p>The <cite>UploaderInterface</cite> also provides a <cite>uploadJson</cite> method that converts a JSON object into a file and uploads it.</p>
<p><code class="docutils literal notranslate"><span class="pre">`ts</span>
<span class="pre">const</span> <span class="pre">myUri</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">umi.uploader.uploadJson({</span> <span class="pre">name:</span> <span class="pre">'John',</span> <span class="pre">age:</span> <span class="pre">42</span> <span class="pre">});</span>
<span class="pre">`</span></code></p>
<p>Finally, if an uploader charges an amount to store a set of files, you may find out how much it will cost by using the <cite>getUploadPrice</cite> method. It will return a custom <cite>Amount</cite> object which can be in any currency and unit.</p>
<p><code class="docutils literal notranslate"><span class="pre">`ts</span>
<span class="pre">const</span> <span class="pre">price</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">umi.uploader.getUploadPrice(myFiles);</span>
<span class="pre">`</span></code></p>
<p>## The downloader interface</p>
<p>Reciprocally, the <cite>DownloaderInterface</cite> provides a <cite>download</cite> method that can be used to download one or several files at once and a <cite>downloadJson</cite> method that can be used to download a parsed JSON file. Both of these methods can be cancelled via an abort <cite>signal</cite>.</p>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a>ts
// Download one or several files.
const [myFile, myOtherFile] = await umi.downloader.download([myUri, myOtherUri]);</p>
<p>// Download using an abort signal.
const myFiles = await umi.downloader.download(myUris, { signal: myAbortSignal });</p>
<p>// Download a JSON file.
type Person = { name: string; age: number; };
const myJsonObject = await umi.downloader.downloadJson&lt;Person&gt;(myUri);
<a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">`</span></a></p>
<p>## The mock storage</p>
<p>Umi provides a mock storage helper class that acts as both an uploader and a downloader. It can be used to test your application without having to set up a real storage service. Anything that is uploaded to the mock storage will be cached in memory such that it can be downloaded later on.</p>
<p>The mock storage helper is available as a [standalone package](<a class="reference external" href="https://github.com/metaplex-foundation/umi/tree/main/packages/umi-storage-mock">https://github.com/metaplex-foundation/umi/tree/main/packages/umi-storage-mock</a>) and must be installed separately.</p>
<p><code class="docutils literal notranslate"><span class="pre">`sh</span>
<span class="pre">npm</span> <span class="pre">install</span> <span class="pre">&#64;metaplex-foundation/umi-storage-mock</span>
<span class="pre">`</span></code></p>
<p>Then, we can register the plugin it provides to our Umi instance and start using it.</p>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a>ts
import { mockStorage } from <a class="reference external" href="mailto:'&#37;&#52;&#48;metaplex-foundation/umi-storage-mock">‘<span>&#64;</span>metaplex-foundation/umi-storage-mock</a>’;</p>
<p>umi.use(mockStorage());
const [myUri] = await umi.uploader.upload([myFile]);
const [myDownloadedFile] = await umi.downloader.download([myUri]);
// myFile and myDownloadedFile are identical.
<a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">`</span></a></p>
<p>&lt;p align=”center”&gt;
&lt;strong&gt;Next: &lt;a href=”./http.md”&gt;Sending Http requests ≫&lt;/a&gt;&lt;/strong&gt;
&lt;/p&gt;</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/storage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>