<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/rust_client.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-rust-client-md">
<h1>docs/rust_client.md<a class="headerlink" href="#docs-rust-client-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2022-12-05 19:44:34</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Rust Client</span>
</pre></div>
</div>
<p>Rust Client is a library that provides an easy way for off-chain Rust programs to interact with Routers, Pools, Funds, Vaults, and Funds, perform admin operations, metadata queries, and some common operations with wallets and accounts.</p>
<p>Rust Client is a part of Farms suite, and to use it, existing deployment of Farm programs and metadata must be present per [Quick Start Guide](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/quick_start.md">https://github.com/solana-labs/farms/blob/master/docs/quick_start.md</a>).</p>
<p>The library needs to be specified as a dependency in your Cargo.toml:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">[dependencies]</span>
<span class="pre">solana-farm-client</span> <span class="pre">=</span> <span class="pre">&quot;1.1.3&quot;</span>
<span class="pre">`</span></code></p>
<p>And declared in a program:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>rust
use solana_farm_client::client::FarmClient;</p>
<p>let client = FarmClient::new(”<a class="reference external" href="https://api.mainnet-beta.solana.com">https://api.mainnet-beta.solana.com</a>”);
let keypair = FarmClient::read_keypair_from_file(</p>
<blockquote>
<div><p>&amp;(std::env::var(“HOME”).unwrap().to_string() + “/.config/solana/id.json”),</p>
</div></blockquote>
<section id="id5">
<h2>);<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>Client’s methods accept human-readable names (tokens, polls, etc.) and UI (decimal) amounts, so you can simply call:</p>
<p><code class="docutils literal notranslate"><span class="pre">`rust</span>
<span class="pre">client.swap(&amp;keypair,</span> <span class="pre">&quot;RDM&quot;,</span> <span class="pre">&quot;SOL&quot;,</span> <span class="pre">&quot;RAY&quot;,</span> <span class="pre">0.1);</span>
<span class="pre">client.add_liquidity(&amp;keypair,</span> <span class="pre">&quot;RDM.RAY-SOL&quot;,</span> <span class="pre">0.0,</span> <span class="pre">0.1);</span>
<span class="pre">client.stake(&amp;keypair,</span> <span class="pre">&quot;RDM.RAY-SOL&quot;,</span> <span class="pre">0.0);</span>
<span class="pre">client.harvest(&amp;keypair,</span> <span class="pre">&quot;RDM.RAY-SOL&quot;);</span>
<span class="pre">`</span></code></p>
<p>to swap 0.1 SOL for RAY, deposit RAY and SOL to a Raydium pool, stake LP tokens, and harvest rewards. <cite>RDM</cite> above is a route or protocol. Use <cite>SBR</cite> for Saber pools and <cite>ORC</cite> for Orca. All metadata required to lookup account addresses, decimals, etc., is stored on-chain.</p>
<p>Rust Client caches metadata to make subsequent calls faster, most noticeably queries that list a large number of objects, like <cite>get_tokens()</cite>. It also leverages RefDB to detect if any metadata objects have changed (e.g., any of the tokens) and reloads them if that is the case.</p>
<p>Under the hood Client uses the official Solana RPC Client which can be accessed with
client.rpc_client, for example: <cite>client.rpc_client.get_latest_blockhash()</cite>.</p>
<p>The naming convention for Pools and Farms is <cite>[PROTOCOL].[TOKEN_A]-[TOKEN_B]-[VERSION]</cite>.
Naming convention for Vaults is <cite>[PROTOCOL].[STRATEGY].[TOKEN_A]-[TOKEN_B]-[VERSION]</cite>.
There are single token pools where <cite>[TOKEN_B]</cite> is not present.
A list of supported protocols can be obtained with <cite>get_protocols()</cite>.
If <cite>[VERSION]</cite> is omitted, then Pool, Farm, or Vault with the latest version will be used.</p>
<p>A few examples:</p>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>rust
// get SOL account balance
client.get_account_balance(&amp;keypair.pubkey());</p>
<p>// get SPL token account balance
client.get_token_account_balance(&amp;keypair.pubkey(), “SRM”);</p>
<p>// get token metadata
client.get_token(“SRM”);</p>
<p>// find Raydium pools with RAY and SRM tokens
client.find_pools(Protocol::Raydium, “RAY”, “SRM”);</p>
<p>// find Saber pools with USDC and USDT tokens
client.find_pools(Protocol::Saber, “USDC”, “USDT”);</p>
<p>// get pool metadata
client.get_pool(“RDM.RAY-SRM”);</p>
<p>// get farm metadata
client.get_farm(“RDM.RAY-SRM”);</p>
<p>// find all vaults with RAY and SRM tokens
client.find_vaults(“RAY”, “SRM”);</p>
<p>// get vault metadata
client.get_vault(“RDM.STC.RAY-SRM”);</p>
<p>// get fund metadata
client.get_fund(“TestFund”);</p>
<p>// get the list of all pools
client.get_pools();</p>
<p>// find farms for specific LP token
client.find_farms_with_lp(“LP.RDM.RAY-SRM-V4”);</p>
<p>// get Raydium pool price
client.get_pool_price(“RDM.RAY-SRM”);
// or specify version for specific pool
client.get_pool_price(“RDM.RAY-SRM-V4”);</p>
<p>// get oracle price
client.get_oracle_price(“SOL”, 0, 0.0);</p>
<p>// list official program IDs
client.get_program_ids();</p>
<p>// swap in the Raydium pool
client.swap(&amp;keypair, Protocol::Raydium, “SOL”, “RAY”, 0.01, 0.0);</p>
<p>// swap in the Saber pool
client.swap(&amp;keypair, Protocol::Saber, “USDC”, “USDT”, 0.01, 0.0);</p>
<p>// deposit liquidity to the Raydium pool (zero second token amount means calculate it automatically)
client.add_liquidity_pool(&amp;keypair, “RDM.GRAPE-USDC”, 0.1, 0.0);</p>
<p>// withdraw your liquidity from the Raydium pool (zero amount means remove all tokens)
client.remove_liquidity_pool(&amp;keypair, “RDM.GRAPE-USDC”, 0.0);</p>
<p>// stake LP tokens to the Raydium farm (zero amount means stake all)
client.stake(&amp;keypair, “RDM.GRAPE-USDC”, 0.0);</p>
<p>// get staked balance
client.get_user_stake_balance(&amp;keypair.pubkey(), “RDM.GRAPE-USDC”);</p>
<p>// harvest rewards
client.harvest(&amp;keypair, “RDM.GRAPE-USDC”);</p>
<p>// unstake LP tokens from the farm (zero amount means unstake all)
client.unstake(&amp;keypair, “RDM.GRAPE-USDC”, 0.0);</p>
<p>// deposit liquidity to the vault (zero second token amount means calculate it automatically)
client.add_liquidity_vault(&amp;keypair, “RDM.STC.RAY-SRM”, 0.01, 0.0);</p>
<p>// withdraw liquidity from the vault (zero amount means remove all tokens)
client.remove_liquidity_vault(&amp;keypair, “RDM.STC.RAY-SRM”, 0.0);</p>
<p>// request liquidity deposit to the fund
client.request_deposit_fund(&amp;keypair, “TestFund”, “USDC”, 0.01);</p>
<p>// request liquidity withdrawal from the fund (zero amount means withdraw everything)
client.request_withdrawal_fund(&amp;keypair, “TestFund”, “USDC”, 0.0);</p>
<p>// list all vaults that belong to particular fund
client.get_fund_vaults(“TestFund”);</p>
<p>// transfer SOL to another wallet
client.transfer(&amp;keypair, &amp;Pubkey::new_unique(), 0.001);</p>
<p>// transfer SPL tokens to another wallet
client.token_transfer(&amp;keypair, “SRM”, &amp;Pubkey::new_unique(), 0.001);</p>
<p>// create associated token account for the wallet
client.get_or_create_token_account(&amp;keypair, “SRM”);</p>
<p>// list all active token accounts for the wallet
client.get_wallet_tokens(&amp;keypair.pubkey());</p>
<p>// get vault stats
client.get_vault_info(“RDM.STC.RAY-SRM”);</p>
<p>// get user stats for particular vault
client.get_vault_user_info(&amp;keypair.pubkey(), “RDM.STC.RAY-SRM”);</p>
<p>// get fund stats and parameters
client.get_fund_info(“TestFund”);</p>
<p>// get fund custody info
client.get_fund_custody(“TestFund”, “USDC”, FundCustodyType::DepositWithdraw);</p>
<p>// get information about fund assets
client.get_fund_assets(&amp;fund_name, FundAssetType::Vault);
client.get_fund_assets(&amp;fund_name, FundAssetType::Custody);
<a href="#id10"><span class="problematic" id="id11">``</span></a><a href="#id12"><span class="problematic" id="id13">`</span></a></p>
<p>The Client also allows for building raw unsigned instructions that can be integrated into more complex workflows:</p>
<p><code class="docutils literal notranslate"><span class="pre">`rust</span>
<span class="pre">//</span> <span class="pre">create</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">instruction</span> <span class="pre">for</span> <span class="pre">cranking</span> <span class="pre">a</span> <span class="pre">Vault,</span> <span class="pre">neither</span> <span class="pre">sign</span> <span class="pre">nor</span> <span class="pre">send</span> <span class="pre">it</span>
<span class="pre">let</span> <span class="pre">inst</span> <span class="pre">=</span> <span class="pre">client.new_instruction_crank_vault(&amp;keypair.pubkey(),</span> <span class="pre">&quot;RDM.STC.RAY-SRM&quot;);</span>
<span class="pre">`</span></code></p>
<p>You can then sign and send it with:</p>
<p><code class="docutils literal notranslate"><span class="pre">`rust</span>
<span class="pre">client.sign_and_send_instructions(&amp;[keypair],</span> <span class="pre">&amp;[inst]);</span>
<span class="pre">`</span></code></p>
<p>Some actions may require multiple instructions to be executed. To handle such cases, there are methods with names starting with <cite>all_instructions_</cite>, and they return a vector of instructions. For example:</p>
<p><a href="#id14"><span class="problematic" id="id15">``</span></a><a href="#id16"><span class="problematic" id="id17">`</span></a>rust
// create a single instruction for depositing liquidity to the vault assuming all prerequisites are met
client.new_instruction_add_liquidity_vault(&amp;keypair.pubkey(), “RDM.STC.RAY-SRM”, 0.1, 0.0);</p>
<p>// create potentially multiple instructions that would handle new token accounts creation, user initialization, token wrap/unwrap, etc.
client.all_instructions_add_liquidity_vault(&amp;keypair.pubkey(), “RDM.STC.RAY-SRM”, 0.1, 0.0);
<a href="#id18"><span class="problematic" id="id19">``</span></a><a href="#id20"><span class="problematic" id="id21">`</span></a></p>
<p>In addition to the library, there is also a command-line tool that sets an example for basic usage of the library: [Farm Client CLI](<a class="reference external" href="https://github.com/solana-labs/farms/blob/master/docs/farm_client_cli.md">https://github.com/solana-labs/farms/blob/master/docs/farm_client_cli.md</a>).</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/rust_client.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>