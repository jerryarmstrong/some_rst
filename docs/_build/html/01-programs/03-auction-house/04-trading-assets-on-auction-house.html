<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/01-programs/03-auction-house/04-trading-assets-on-auction-house.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-01-programs-03-auction-house-04-trading-assets-on-auction-house-md">
<h1>docs/01-programs/03-auction-house/04-trading-assets-on-auction-house.md<a class="headerlink" href="#docs-01-programs-03-auction-house-04-trading-assets-on-auction-house-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-08 19:56:25</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>description: “Explains how to manage the trading of assets on Auction House.”
—</p>
<p>import { Accordion, AccordionItem } from ‘/src/accordion.jsx’;</p>
<p># Trading Assets on Auction House</p>
<p>## Introduction
In the previous pages, we’ve talked about Auction Houses and how to create &amp; manage them. Once an Auction House is created, assets can be traded on it. A simple trade on a marketplace usually comprises of three actions:</p>
<ol class="arabic simple">
<li><p>The seller lists an asset</p></li>
<li><p>The buyer makes a bid on the asset</p></li>
<li><p>Once a matching bid is found for a listing, the sale is executed</p></li>
</ol>
<p>On this page, we will talk about these three actions and see code examples to easily execute these actions. We will also see trade scenarios that are different from the above simple trade scenario, and go through a code example to execute each scenario. Finally, we’ll also explore how listings and bids can be cancelled once they are created.</p>
<p>Let us start with listing an asset on an Auction House.</p>
<p>## Listing assets</p>
<p>We went through the process of listing an asset in the [Overview page](/programs/auction-house/overview). This action is also referred to as creating a <strong>Sell Order</strong>. When a sell order is created using Auction House, the asset being listed remains in the wallet of the seller. This is a very important feature of Auction House as it allows users to list assets in an escrow-less fashion and thus users still maintain custody of assets while the assets are listed.</p>
<p>The asset seller can create two types of listings depending on the price at which they list the asset:</p>
<ol class="arabic simple">
<li><p><strong>Listing at price greater than 0</strong>: when a user lists an asset at a price which is greater than 0 SOL (or any other SPL-token). In this case, the seller’s wallet needs to be the signer and thus this wallet should be</p></li>
<li><p><strong>Listing at price of 0</strong>: when a user lists an asset for 0 SOL (or any other SPL-token). In this case, the authority can sign on behalf of the seller if <cite>canChangeSalePrice</cite> option is set to <cite>true</cite> which was discussed in the [Auction House settings page](/programs/auction-house/getting-started). When this happens, the Auction House finds a non-0 matching bid on behalf of the seller. The asset can only be listed and sold for a price of 0 if the seller acts as the signer. There must be one and only one signer; authority or seller must sign.</p></li>
</ol>
<p>Depending on the type of token being listed, the number of tokens to be listed can also be specified when creating a sell order:</p>
<ol class="arabic simple">
<li><p>In case of <strong>Non-Fungible Tokens (NFTs)</strong>: due to the non-fungibility and uniqueness of every token, only 1 token can be listed.</p></li>
<li><p>In case of <strong>Fungible Assets</strong>: the seller can list more than 1 tokens per listing. For example: If Alice owns 5 DUST tokens, they can list 1 or more (but less than or equal to 5) of these DUST tokens in the same sell order.</p></li>
</ol>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Let us look at an example for making a listing or sell order on Auction House.</p>
<p>In the following code snippet we are making a sell order for 3 DUST tokens (fungible tokens) for a total price of 5 SOL. Important to note here is that if we were creating a sell order for an NFT, we do not have to specify the number of tokens to be listed as it will default to 1 token. Specifying any other amount will result in an error.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>tsx
await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.createListing({</p>
<blockquote>
<div><p>auctionHouse,                              // A model of the Auction House related to this listing
seller: Keypair.generate(),                // Creator of a listing
authority: Keypair.generate(),             // The Auction House authority
mintAccount: new PublicKey(“DUST…23df”), // The mint account to create a listing for, used to find the metadata
tokenAccount: new PublicKey(“soC…87g4”), // The token account address that’s associated to the asset a listing created is for
price: 5,                                  // The listing price
tokens: 3                                  // The number of tokens to list, for an NFT listing it must be 1 token</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<p>## Bidding on assets</p>
<p>A user looking to buy an asset can make bids, or <strong>Buy Orders</strong> for that asset.</p>
<p>There can be two types of buy orders depending on that whether the asset is listed or not:</p>
<ol class="arabic simple">
<li><p><strong>Private bids</strong>: This is the most common type of bid. A user, interested in a listed asset on an Auction House, creates a private bid on the given asset. This bid is tied to the specific auction and not the asset itself. This means that when the auction is closed (either the bid is rejected and the listing is cancelled, or the bid is accepted and the asset is sold), the bid is also closed.</p></li>
<li><p><strong>Public bids</strong>: A user can post a public bid on a non-listed NFT by skipping seller and tokenAccount properties. Public bids are specific to the token itself and not to any specific auction. This means that a bid can stay active beyond the end of an auction and be resolved if it meets the criteria for subsequent auctions of that token.</p></li>
</ol>
<p>Like in the case of sell orders, buy orders can also specifiy the number of tokens to be bid upon depending on the type of asset listed:</p>
<ol class="arabic simple">
<li><p><strong>Partial Buy Order</strong>: We discussed the case of listing more than 1 token when listing a fungible asset. When such a sell order exists, a user can make a bid to buy only a portion of the listed tokens, or make a partial buy order. For example: if Alice listed <cite>3 DUST</cite> tokens for <cite>5 SOL</cite>, Alice can make a bid to buy <cite>2 DUST</cite> tokens for <cite>2 SOL</cite>. In other words, a user can create a buy order of said assets that is less than the <cite>token_size</cite> of the sell order.</p></li>
<li><p><strong>Complete Buy Order</strong>: This is the case where the buyer creates a bid to buy all the tokens listed in the sell order. In case of non-fungible assets (NFTs) where only 1 token can be listed per sell order, a complete buy order is created. Complete buy orders can also be created in case of fungible tokens.</p></li>
</ol>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Let us look at an example for making a bid or buy order on Auction House.</p>
<p>In the following code snippet we are making a buy order for 3 DUST tokens (fungible tokens) for a total price of 5 SOL. Important to note here is that if we were creating a sell order for an NFT, we do not have to specify the number of tokens to be listed as it will default to 1 token. Specifying any other amount will result in an error.</p>
<p>This is an example of a private bid as we are specifying the seller account and the token account. If either one of them is not specified while creating the bid, the bid will be public.</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>tsx
await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.createBid({</p>
<blockquote>
<div><p>auctionHouse,                              // A model of the Auction House related to this listing
buyer: Keypair.generate(),                 // Creator of a bid
seller: Keypair,generate(),                // The account address that holds the asset a bid created is for, if this or tokenAccount isn’t provided, then the bid will be public.
authority: Keypair.generate(),             // The Auction House authority
mintAccount: new PublicKey(“DUST…23df”), // The mint account to create a bid for
tokenAccount: new PublicKey(“soC…87g4”), // The token account address that’s associated to the asset a bid created is for, if this or seller isn’t provided, then the bid will be public.
price: 5,                                  // The buyer’s price
tokens: 3                                  // The number of tokens to bid on, for an NFT bid it must be 1 token</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<p>## Executing sale of assets</p>
<p>Now that we know how to create a listing (sell order) and a bid (buy order), we can learn how to execute sales of assets. When the sale of an asset is executed:</p>
<ol class="arabic simple">
<li><p>The Auction House transfers the bid amount from the buyer escrow account to the seller’s wallet. We will talk more about the buyer escrow account and how can the marketplace authority manage funds in that account.</p></li>
<li><p>The Auction House transfers the asset from the seller’s wallet to the buyer’s wallet.</p></li>
</ol>
<p>Now that we know what the excution of a sale means, lets explore different trade scenarios in which assets can be sold using Auction House. We have already discussed them in great detail in the [overview page] but here’s a brief explanation in addition to a code snippet for each scenario:</p>
<ol class="arabic">
<li><p><strong>Direct Buy</strong>, or <em>“Buying” at list price</em>: This is the case when the execution of the sale happens when a user bids on a listed asset. In other words, a direct buy operation creates a bid on a given asset and then executes a sale on the created bid and listing.</p>
<blockquote>
<div><p>In most cases, this scenario will occur when the buyer makes a bid at the listed price of the asset. But there can be cases where marketplaces have custom order matching algorithms that work on thresholds. For example: a marketplace may have a rule to execute the sale of a given asset as soon as there is a bid which is within a range of +-20% from the listed price.</p>
</div></blockquote>
</li>
</ol>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Here’s an example of direct buying an asset by a user who is interested in the listed asset.</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>tsx
const listing = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.findListingByReceipt({…}) // we will see how to fetch listings in the coming pages</p>
</div></blockquote>
<dl>
<dt>const directBuyResponse = await metaplex</dt><dd><p>.auctionHouse()
.buy({</p>
<blockquote>
<div><p>auctionHouse,                   // The Auction House in which to create a Bid and execute a Sale
buyer: Keypair.generate(),      // Creator of a bid, should not be the same as seller who creates a Listing
authority: Keypair.generate(),  // The Auction House authority, if this is the Signer the</p>
<blockquote>
<div><p>// transaction fee will be paid from the Auction House Fee Account</p>
</div></blockquote>
<dl class="simple">
<dt>listing: listing,               // The Listing that is used in the sale, we only need a</dt><dd><p>// subset of the <cite>Listing</cite> model but we need enough information
// regarding its settings to know how to execute the sale.</p>
</dd>
</dl>
<p>price: 5,                       // The buyer’s price</p>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<ol class="arabic simple" start="2">
<li><p><strong>Direct Sell</strong>, or <em>“Selling” at bid price</em>: Counterpart to the case of direct buy, this is the case when a user, interested in an unlisted asset, places a bid on it. If the asset owner now lists the asset for the bid amount, the execution of the sale can take place, thus direct selling the asset.</p></li>
</ol>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Here’s an example of direct selling an asset by a user who is interested in a bid on the asset.</p>
<p><a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>tsx
const bid = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.findBidByReceipt({…}) // we will see how to fetch bids in the coming pages</p>
</div></blockquote>
<dl>
<dt>const directSellResponse = await metaplex</dt><dd><p>.auctionHouse()
.sell({</p>
<blockquote>
<div><p>auctionHouse,                              // The Auction House in which to create a listing and execute a Sale
seller: Keypair.generate(),                // Creator of a listing, there must be one and only one signer; Authority or Seller must sign.
authority: Keypair.generate(),             // The Auction House authority, if this is the Signer the</p>
<blockquote>
<div><p>// transaction fee will be paid from the Auction House Fee Account</p>
</div></blockquote>
<dl class="simple">
<dt>bid: bid,                                  // The Public Bid that is used in the sale, we only need a</dt><dd><p>// subset of the <cite>Bid</cite> model but we need enough information
// regarding its settings to know how to execute the sale.</p>
</dd>
<dt>sellerToken: new PublicKey(“DUST…23df”)  // The Token Account of an asset to sell, public Bid doesn’t</dt><dd><p>// contain a token, so it must be provided externally via this parameter</p>
</dd>
</dl>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<ol class="arabic simple" start="3">
<li><p><strong>Independant Sale Execution</strong>, or <em>Lister agreeing to a bid</em>: This is the case when the execution of the sale takes place independantly, after a <strong>Buy Order</strong> (bid) and a <strong>Sell Order</strong> (listing) exist for a given asset.</p></li>
</ol>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Here’s an example of an independant sale execution.</p>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>tsx
const listing = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.findListingByReceipt({…}) // we will see how to fetch listings in the coming pages</p>
</div></blockquote>
<dl>
<dt>const bid = await metaplex</dt><dd><p>.auctionHouse()
.findBidByReceipt({…})     // we will see how to fetch bids in the coming pages</p>
</dd>
<dt>const executeSaleResponse = await metaplex</dt><dd><p>.auctionHouse()
.executeSale({</p>
<blockquote>
<div><p>auctionHouse,                   // The Auction House in which to create a Bid and execute a Sale
authority: Keypair.generate(),  // The Auction House authority, if this is the Signer the</p>
<blockquote>
<div><p>// transaction fee will be paid from the Auction House Fee Account</p>
</div></blockquote>
<dl class="simple">
<dt>listing: listing,               // The Listing that is used in the sale, we only need a</dt><dd><p>// subset of the <cite>Listing</cite> model but we need enough information
// regarding its settings to know how to execute the sale.</p>
</dd>
<dt>bid: bid,                       // The Public Bid that is used in the sale, we only need a</dt><dd><p>// subset of the <cite>Bid</cite> model but we need enough information
// regarding its settings to know how to execute the sale.</p>
</dd>
</dl>
</div></blockquote>
<p>});</p>
</dd>
</dl>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<p>## Cancel Listings and Bids</p>
<p>Till now we have seen how to create bids and listings, and also execute the sales of assets in an Auction House. Once listings and bids are created in an Auction House, they can be cancelled via the authority.</p>
<p>&lt;Accordion&gt;
&lt;AccordionItem title=”JS SDK” open={true}&gt;
&lt;div className=”accordion-item-padding”&gt;</p>
<p>Here’s an example of cancelling a bid and a listing using the JS SDK.</p>
<p><a href="#id41"><span class="problematic" id="id42">``</span></a><a href="#id43"><span class="problematic" id="id44">`</span></a>tsx
const listing = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.findListingByReceipt({…}) // we will see how to fetch listings in the coming pages</p>
</div></blockquote>
<dl class="simple">
<dt>const bid = await metaplex</dt><dd><p>.auctionHouse()
.findBidByReceipt({…})     // we will see how to fetch bids in the coming pages</p>
</dd>
</dl>
<p>// Cancel a bid
const cancelBidResponse = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.cancelBid({</p>
<blockquote>
<div><p>auctionHouse,            // The Auction House in which to cancel Bid
bid: bid,                // The Bid to cancel</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p>// Cancel a listing
const cancelListingResponse = await metaplex</p>
<blockquote>
<div><p>.auctionHouse()
.cancelListing({</p>
<blockquote>
<div><p>auctionHouse,            // The Auction House in which to cancel listing
listing: listing,        // The listing to cancel</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p><a href="#id45"><span class="problematic" id="id46">``</span></a><a href="#id47"><span class="problematic" id="id48">`</span></a></p>
<p>&lt;/div&gt;
&lt;/AccordionItem&gt;
&lt;/Accordion&gt;</p>
<p>## Conclusion</p>
<p>In this page we covered all the components to manage trading of assets on a marketplace.</p>
<p>One key point which we haven’t discussed is the buyer escrow account, which is needed to escrow, or temporarily hold buyer’s funds when the buyer makes a bid on an asset. How are these funds managed in this account and who is responsible for keeping track of these funds? Let’s find out in the [next page](/programs/auction-house/managing-auction-house).</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/01-programs/03-auction-house/04-trading-assets-on-auction-house.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>