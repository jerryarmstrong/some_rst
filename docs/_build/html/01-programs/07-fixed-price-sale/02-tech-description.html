<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/01-programs/07-fixed-price-sale/02-tech-description.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-01-programs-07-fixed-price-sale-02-tech-description-md">
<h1>docs/01-programs/07-fixed-price-sale/02-tech-description.md<a class="headerlink" href="#docs-01-programs-07-fixed-price-sale-02-tech-description-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-08 19:56:25</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>---
</pre></div>
</div>
<p>sidebar_label: “Tech description”
sidebar_position: 2
—</p>
<p># Tech description</p>
<p>## Creators to sell something have to do next:</p>
<ol class="arabic">
<li><p>Create store</p>
<blockquote>
<div><ul class="simple">
<li><p>It’s necessary because we have to filter Markets somehow</p></li>
<li><p>It will contain name, admin key, description</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Initialise Selling resource. It can be either created one or our platform will create it.</p>
<blockquote>
<div><ul class="simple">
<li><p>Once user initialise selling resource we have an object with resource which we can sell</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Create a Market</p>
<blockquote>
<div><ul class="simple">
<li><p>Create object with info about items selling, all apart from max supply such as we defined it in Selling resource</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>## Users to buy tokens have to do next:</p>
<ol class="arabic">
<li><p>Go to store. Also in future we could create some page with all the stores where users can choose what they want to buy</p></li>
<li><p>Choose token and click “Buy”</p>
<blockquote>
<div><ul>
<li><p>Under the hood next things will happen:</p>
<blockquote>
<div><ul class="simple">
<li><p>TradeHistory account will be created where we track how many tokens this user already bought</p></li>
<li><p>Debit and credit operations</p></li>
<li><p>New NFT created(create mint, mint token, create Metadata, create MasterEdition)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Token will be shown in their wallets</p></li>
</ol>
<p># Accounts</p>
<p>## Store</p>
<div class="line-block">
<div class="line">Field      | Type <a href="#id1"><span class="problematic" id="id2">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line">admin      | <cite>Pubkey</cite>       | Admin key who can create selling resources and markets in specific store       |</div>
<div class="line-block">
<div class="line">name  |  <cite>String</cite>  |   |</div>
<div class="line">description  |  <cite>String</cite>  |   |</div>
</div>
</div>
<p>## Selling resource</p>
<div class="line-block">
<div class="line">Field      | Type <a href="#id3"><span class="problematic" id="id4">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">store  |  <cite>Pubkey</cite>  |    |</div>
<div class="line">owner  |  <cite>Pubkey</cite>  |  Owner of resource. This account can receive back resource once sail is ended  |</div>
<div class="line">resource  |  <cite>Pubkey</cite>  |  Mint account Metadata attached to. We don’t need store Metadata key because it’s PDA and we can calculate it knowing the mint key  |</div>
<div class="line">vault  |  <cite>Pubkey</cite>  |  Token account which holds MasterEdition  |</div>
<div class="line">vault_owner  |  <cite>Pubkey</cite>  |  PDA with seeds [“mt_vault“, resource.key(), store.key()]  |</div>
<div class="line">supply  |  <cite>u64</cite>  |  Amount of tokens already sold  |</div>
<div class="line">max_supply  |  <cite>Option&lt;u64&gt;</cite>  |  Max amount of token can be sold  |</div>
<div class="line">state  |  <cite>Enum{Uninitialised, Created, InUse, Exhausted, Stoped,}</cite>  |  State of resource  |</div>
</div>
</div>
<p>## Market</p>
<div class="line-block">
<div class="line">Field      | Type <a href="#id5"><span class="problematic" id="id6">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">store  |  <cite>Pubkey</cite>  |    |</div>
<div class="line">selling_resource  |  <cite>Pubkey</cite>  |    |</div>
<div class="line">treasury_mint  |  <cite>Pubkey</cite>  |  Mint account of tokens which market will accept as a payment  |</div>
<div class="line">treasury_holder  |  <cite>Pubkey</cite>  |  Token account buyers will send tokens to. Only market owner can withdraw assets  |</div>
<div class="line">treasury_owner  |  <cite>Pubkey</cite>  |  PDA[“holder“, treasury_mint.key(), selling_resource.key()]  |</div>
<div class="line">owner  |  <cite>Pubkey</cite>  |  Market owner  |</div>
<div class="line">name  |  <cite>String</cite>  |    |</div>
<div class="line">description  |  <cite>String</cite>  |    |</div>
<div class="line">mutable  |  <cite>bool</cite>  |    |</div>
<div class="line">price  |  <cite>u64</cite>  |    |</div>
<div class="line">pieces_in_one_wallet  |  <cite>Option&lt;u64&gt;</cite>  |  How many tokens we can sell to one wallet  |</div>
<div class="line">start_date  |  <cite>u64</cite>  |    |</div>
<div class="line">end_date  |  <cite>Option&lt;u64&gt;</cite>  |    |</div>
<div class="line">state  |  <cite>Enum {Uninitialised, Created, Active, Ended,}</cite>  |    |</div>
<div class="line">funds_collected  |  <cite>u64</cite>  |    |</div>
</div>
</div>
<p>## TradeHistory</p>
<p>### PDA [“history“, wallet.key(), market.key()]</p>
<div class="line-block">
<div class="line">Field      | Type <a href="#id7"><span class="problematic" id="id8">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  <cite>Pubkey</cite>  |    |</div>
<div class="line">wallet  |  <cite>Pubkey</cite>  |    |</div>
<div class="line">already_bought  |  <cite>u64</cite>  |  How many tokens user already bought from specific Market  |</div>
</div>
</div>
<p>## PrimaryMetadataCreators</p>
<p>### PDA [“primary_creators“, metadata.key()]</p>
<div class="line-block">
<div class="line">Field      | Type <a href="#id9"><span class="problematic" id="id10">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">creators  |  <cite>Vec&lt;mpl_token_metadata::state::Creator&gt;</cite>  |  List of creators to receive primary sales royalties  |</div>
</div>
</div>
<p># Instructions</p>
<p>## CreateStore</p>
<p>Creates new Store account.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id11"><span class="problematic" id="id12">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">admin  |  Key, Signer, Writable  |    |</div>
<div class="line">store  |  Key, Signer, Writable  |  Uninitialized account  |</div>
<div class="line">name  |  <cite>String</cite>  |    |</div>
<div class="line">description  |  <cite>String</cite>  |    |</div>
</div>
</div>
<p>## InitSellingResource</p>
<p>Initialize SellingResource account which will be used by Market.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id13"><span class="problematic" id="id14">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">store  |  Key  |    |</div>
<div class="line">store_admin  |  Key, Signer, Writable  |  Holds resource_token and pays for selling_resource account creating  |</div>
<div class="line">selling_resource  |  Key, Signer, Writable  |  Uninitialized account  |</div>
<div class="line">selling_resource_owner  |  Key  |  Key which can withdraw MasterEdition once sale is ended  |</div>
<div class="line">resource_mint  |  Key  |  Mint account Metadata attached to  |</div>
<div class="line">master_edition  |  Key  |  PDA with seeds [“metadata”, tokenMetadataProgramID, resource_mint, “edition”]  |</div>
<div class="line">metadata  |  Key  |  Master edition’s metadata  |</div>
<div class="line">vault  |  Key, Writable  |  Token account to hold resource  |</div>
<div class="line">vault_owner  |  PDA [“mt_vault“, resource_mint.key(), store.key()]  |  Owner of vault token account  |</div>
<div class="line">resource_token  |  Key, Writable  |  User’s token account which holds token from resource_mint  |</div>
<div class="line">max_supply  |  <cite>Option&lt;u64&gt;</cite>  |  Max amount of tokens to sell  |</div>
</div>
</div>
<p>## CreateMarket</p>
<p>Initialize Market account. Set state to Created, it means that owner can change some data before it will be activated, off course if Market marked as mutable.</p>
<p>:::warning</p>
<p>If user want sell art for native SOL as <cite>treasury_mint</cite> should be set <cite>11111111111111111111111111111111</cite> also treasury_holder and treasury_owner should be the same accounts PDA. It’s necessary for security reasons so only program will be able to spend that SOL.</p>
<p>::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| Parameter      | Type |Description|
| ----------- | ----------- | ------ |
|  market  |  Key, Signer, Writable  |  Uninitialized account  |
|  store  |  Key  |    |
|  selling_resource_owner  |  Key, Signer, Writable  |    |
|  selling_resource  |  Key, Writable  |    |
|  treasury_mint  |  Key  |  Mint of assets which we will take as a payment  |
|  treasury_holder  |  Key  |  Token account  |
|  treasury_owner  |  PDA [“holder“, treasury_mint.key(), selling_resource.key()]  |    |
|  name  |  `String`  |    |
|  description  |  `String`  |    |
|  mutable  |  `bool`  |    |
|  price  |  `u64`  |    |
|  pieces_in_one_wallet  |  `Option&lt;u64&gt;`  |    |
|  start_date  |  `u64`  |    |
|  end_date  |  `Option&lt;u64&gt;`  |    |
|  gating_config  |  `Option&lt;GatingConfig{collection: Pubkey, expire_on_use: bool, gating_time: Option&lt;u64&gt;}&gt;`  |  Gating token. If this value set only users with NFT from pointed collection can buy new NFTs from market.  |
</pre></div>
</div>
<p>## ChangeMarket</p>
<p>Available only if Market::mutable == true. Can change: name, description, mutable, price, pieces_in_one_wallet.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id15"><span class="problematic" id="id16">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key, Writable  |    |</div>
<div class="line">market_owner  |  Key, Signer  |    |</div>
<div class="line">new_name  |  <cite>Option&lt;String&gt;</cite>  |    |</div>
<div class="line">new_description  |  <cite>Option&lt;String&gt;</cite>  |    |</div>
<div class="line">mutable  |  <cite>Option&lt;bool&gt;</cite>  |    |</div>
<div class="line">new_price  |  <cite>Option&lt;u64&gt;</cite>  |    |</div>
<div class="line">new_pieces_in_one_wallet  |  <cite>Option&lt;u64&gt;</cite>  |    |</div>
</div>
</div>
<p>## Buy</p>
<p>User can call only if current date &gt; Market::start_date.</p>
<p>:::warning</p>
<p>If user buy art for native SOL user_token_acc and user_wallet accounts should be the same.</p>
<p>::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| Parameter      | Type |Description|
| ----------- | ----------- | ------ |
|  market  |  Key, Writable  |    |
|  selling_resource  |  Key, Writable  |    |
|  user_token_acc  |  Key, Writable  |  Token account to pay for the member token. Mint of this token acc should be == treasury_mint  |
|  user_wallet  |  Key, Signer, Writable  |    |
|  trade_history  |  Key, Writable  |  Account to track how many NFTs user already bought  |
|  treasury_holder  |  Key, Writable  |    |
|  new_metadata_acc  |  Key, Writable  |    |
|  new_edition_acc  |  Key, Writable  |    |
|  master_edition_acc  |  Key, Writable  |    |
|  new_mint  |  Key, Writable  |    |
|  edition_marker  |  Key, Writable  |  PDA, seeds can be found in token-metadata program  |
|  vault  |  Key  |    |
|  vault_owner  |  PDA [“mt_vault“, resource.key(), store.key()]  |    |
|  master_edition_metadata  |  Key  |    |
|    |  Below accounts are optional and should be passed only if gating feature is enabled ↓  |    |
|  user_collection_token_account  |  Key, Writable  |  User’s token account from collection  |
|  token_account_mint  |  Key, Writable  |  Token’s mint account  |
|  metadata_account  |  Key  |  Metadata account for the mint mentioned above  |
</pre></div>
</div>
<p>## SuspendMarket</p>
<p>Suspend Market so nobody can buy items and market owner can change data. Instruction should be available only if Market::mutable == true because in other case there is no reason to suspend it.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id17"><span class="problematic" id="id18">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key, Writable  |    |</div>
<div class="line">market_owner  |  Key, Signer  |    |</div>
<div class="line">clock  |  Key  |    |</div>
</div>
</div>
<p>## ResumeMarket</p>
<p>Instruction to resume the market after it was suspended. Can be called only if market is in suspended state.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id19"><span class="problematic" id="id20">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key, Writable  |    |</div>
<div class="line">market_owner  |  Key, Signer  |    |</div>
<div class="line">clock  |  Key  |    |</div>
</div>
</div>
<p>## CloseMarket</p>
<p>This instruction can be called only if Market was created with unlimited duration.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id21"><span class="problematic" id="id22">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key, Writable  |    |</div>
<div class="line">market_owner  |  Key, Signer  |    |</div>
<div class="line">clock  |  Key  |    |</div>
</div>
</div>
<p>## Withdraw</p>
<p>Called by Market owner to withdraw collected treasury funds. Available only if Market::state == Ended.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id23"><span class="problematic" id="id24">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key  |    |</div>
<div class="line">selling_resource  |  Key  |    |</div>
<div class="line">metadata  |  Key  |    |</div>
<div class="line">treasury_holder  |  Key, Writable  |  Market::treasury_holder. Token account which holds all the tokens received from users during selling  |</div>
<div class="line">treasury_mint  |  Key  |    |</div>
<div class="line">funder  |  Key  |    |</div>
<div class="line">payer  |  Key, Signer  |    |</div>
<div class="line">payout_ticket  |  Key, Writable  |  PDA[“payout_ticket“, market.key(), funder.key()]  |</div>
<div class="line">treasury_owner  |  Key  |  PDA[“holder“, treasury_mint.key(), selling_resource.key()]  |</div>
<div class="line">destination  |  Key, Writable  |  Token account transfer tokens to  |</div>
<div class="line-block">
<div class="line">|  Below account is optional and should be passed only during primary sale ↓  |    |</div>
</div>
<div class="line">primary_metadata_creators_data  |  Key  |  List of creators who should receive royalties from primary sale  |</div>
</div>
</div>
<p>## ClaimResource</p>
<p>Called by Resource owner. Available only if SellingResource::state == Exhausted of Market::state == Ended.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id25"><span class="problematic" id="id26">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">market  |  Key  |    |</div>
<div class="line">treasury_holder  |  Key  |    |</div>
<div class="line">selling_resource  |  Key  |    |</div>
<div class="line">selling_resource_owner  |  Key, Signer  |    |</div>
<div class="line">source  |  Key, Writable  |  SellingResource::vault. Token account which holds master edition  |</div>
<div class="line">metadata  |  Key  |  Metadata for token which was sold  |</div>
<div class="line">vault_owner  |  Key  |  PDA with seeds [“mt_vault“, resource.key(), store.key()]  |</div>
<div class="line">secondary_metadata_creators  |  Key  |    |</div>
<div class="line">destination  |  Key, Writable  |  Token account transfer master edition to  |</div>
</div>
</div>
<p>## SavePrimaryMetadataCreators</p>
<p>Called before market is created. This list of creators will be used in withdraw instruction to distribute royalties. Take a note that if you are going to sell NFTs from master edition with <cite>primary_sale_happen = true</cite> you don’t need to call this instruction.</p>
<div class="line-block">
<div class="line">Parameter      | Type <a href="#id27"><span class="problematic" id="id28">|Description|</span></a></div>
<div class="line">———– | ———– | —— |</div>
<div class="line-block">
<div class="line">admin  |  Key, Signer, Writable  |  Metadata’s update authority  |</div>
<div class="line">metadata  |  Key, Writable  |    |</div>
<div class="line">primary_metadata_creators  |  Key, Writable  |  PDA with seeds [“primary_creators“, metadata.key()]  |</div>
<div class="line">system_program  |  Key  |    |</div>
<div class="line">primary_metadata_creators  |  <cite>u8</cite>  |  primary_metadata_creators key bump  |</div>
<div class="line">creators  |  <cite>Vec&lt;mpl_token_metadata::state::Creator&gt;</cite>  |  List of creators who will receive primary royalties  |</div>
</div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/01-programs/07-fixed-price-sale/02-tech-description.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>