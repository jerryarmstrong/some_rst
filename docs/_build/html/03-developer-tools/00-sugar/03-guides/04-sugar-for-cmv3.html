<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docs/03-developer-tools/00-sugar/03-guides/04-sugar-for-cmv3.md &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="docs-03-developer-tools-00-sugar-03-guides-04-sugar-for-cmv3-md">
<h1>docs/03-developer-tools/00-sugar/03-guides/04-sugar-for-cmv3.md<a class="headerlink" href="#docs-03-developer-tools-00-sugar-03-guides-04-sugar-for-cmv3-md" title="Permalink to this heading">¶</a></h1>
<p>Last edited: 2023-08-08 19:56:25</p>
<p>Contents:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Sugar for Candy Machine V3</span>
</pre></div>
</div>
<p>:::info
For Candy Machine V3 you have to use a Sugar version &gt; v2.0
::</p>
<p>The Candy Machine V3 is the latest iteration of the Metaplex Protocol’s Candy Machine minting and distribution program. While the deploy of a Candy Machine V3 works largely similar to the previous V2 version, Sugar offers a set of new command to configure and manage a Candy Guard.</p>
<p>The Candy Machine V3 has a modular architecture, where the mint logic is separated from the mint access control &amp;mdash; check the [overview](../../../01-programs/02-candy-machine/00-overview.md) to read more about Candy Machine V3 and Candy Guard.</p>
<p>This guide will walk through the changes in the configuration for a Candy Machine V3 and the commands used to set up and manage a Candy Guard. It assumes that you are already familiar with how Sugar works and have deployed a Candy Machine &amp;mdash; if that is not the case, we recommend to first complete the [My First Candy Machine](../02-tutorials/00-my-first-candy-machine.md) tutorial.</p>
<p>## Configuration</p>
<p>Since the configuration of the mint process has moved to <strong>guards</strong>, Sugar’s config file has changed. A basic configuration without any guards is shown bellow:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>json
{</p>
<blockquote>
<div><p>“number”: 10,
“symbol”: “TEST”,
“sellerFeeBasisPoints”: 500,
“isMutable”: true,
“isSequential”: false,
“creators”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“address”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”,
“share”: 100</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“uploadMethod”: “bundlr”,
“awsConfig”: null,
“nftStorageAuthToken”: null,
“shdwStorageAccount”: null,
“pinataConfig”: null,
“hiddenSettings”: null,
“guards”: null</p>
</div></blockquote>
<section id="id5">
<h2>}<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>There are two new elements in the configuration file:</p>
<ul class="simple">
<li><p><cite>isSequential</cite>: indicates to whether a sequential index generation should be used during mint or not (recommended to set this value to <cite>false</cite>);</p></li>
<li><p><cite>guards</cite>: indicates the configuration for the Candy Guard. If this value is set to <cite>null</cite>, a Candy Guard will not be used and mint will only be possible using the <cite>mint authority</cite> of the Candy Machine.</p></li>
</ul>
<p>:::info
You can use the Sugar’s <cite>create-config</cite> command to create a basic configuration file. The Candy Guard configuration needs to be added manually, further explained below.
::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Available Guards</span>
</pre></div>
</div>
<p>The Candy Guard ships with a total of [16 default guards](../../../programs/candy-machine/available-guards). These guards can be used to define a single guard set, which will applied to every mint transaction, or to define groups. The example below shows a configuration file with 2 groups:</p>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>json
{</p>
<blockquote>
<div><p>“number”: 10,
“symbol”: “TEST”,
“sellerFeeBasisPoints”: 500,
“isMutable”: true,
“isSequential”: false,
“creators”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“address”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”,
“share”: 100</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“uploadMethod”: “bundlr”,
“awsConfig”: null,
“nftStorageAuthToken”: null,
“shdwStorageAccount”: null,
“pinataConfig”: null,
“hiddenSettings”: null,
“guards”: {</p>
<blockquote>
<div><dl>
<dt>“default”: {</dt><dd><dl class="simple">
<dt>“botTax”: {</dt><dd><p>“value”: 0.01,
“lastInstruction”: true</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>},
“groups”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“label”: “OGs”,
“guards”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“startDate”: {</dt><dd><p>“date”: “2022-10-20 12:00:00 +0000”</p>
</dd>
</dl>
<p>},
“tokenGate”: {</p>
<blockquote>
<div><p>“amount”: 1,
“mint”: “7nE1GmnMmDKiycFkpHF7mKtxt356FQzVonZqBWsTWZNf”</p>
</div></blockquote>
<p>},
“solPayment”: {</p>
<blockquote>
<div><p>“value”: 1,
“destination”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“label”: “Public”,
“guards”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“startDate”: {</dt><dd><p>“date”: “2022-10-20 18:00:00 +0000”</p>
</dd>
</dl>
<p>},
“solPayment”: {</p>
<blockquote>
<div><p>“value”: 2,
“destination”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id10">
<h2>}<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h2>
<p>In this example, there are 2 groups <cite>OGs</cite> and <cite>Public</cite>. The <cite>OGs</cite> specifies that only transactions that are from an address which holds <cite>1</cite> token of the the SPL token <cite>7nE1GmnMmDKiycFkpHF7mKtxt356FQzVonZqBWsTWZNf</cite> are allowed to mint from the <cite>2022-10-20 12:00:00 +0000</cite>; the mint will be charged at <cite>1 SOL</cite>.</p>
<p>The <cite>Public</cite> group is open to any address from the <cite>2022-10-20 18:00:00 +0000</cite>; the mint will be charged at <cite>2 SOL</cite>.</p>
<p>For both groups, the <cite>botTax</cite> guard specified in the <cite>default</cite> guard set applies, so any transaction that fails the guard validation will be subject to a <cite>0.01 SOL</cite> fee.</p>
<p>If we wanted to have a single “public” group, all the guard configuration can be added to the <cite>default</cite> guard set:</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a>json
{</p>
<blockquote>
<div><p>“number”: 10,
“symbol”: “TEST”,
“sellerFeeBasisPoints”: 500,
“isMutable”: true,
“isSequential”: false,
“creators”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“address”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”,
“share”: 100</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“uploadMethod”: “bundlr”,
“awsConfig”: null,
“nftStorageAuthToken”: null,
“shdwStorageAccount”: null,
“pinataConfig”: null,
“hiddenSettings”: null,
“guards”: {</p>
<blockquote>
<div><dl>
<dt>“default”: {</dt><dd><dl class="simple">
<dt>“botTax”: {</dt><dd><p>“value”: 0.01,
“lastInstruction”: true</p>
</dd>
</dl>
<p>},
“startDate”: {</p>
<blockquote>
<div><p>“date”: “2022-10-20 18:00:00 +0000”</p>
</div></blockquote>
<p>},
“solPayment”: {</p>
<blockquote>
<div><p>“value”: 2,
“destination”: “PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8”</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>},
“groups”: null</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id15">
<h2>}<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h2>
<p>Below is a list of the available guards and their configuration options.</p>
<p>### Address Gate</p>
<p>The AddressGate guard restricts the mint to a single address — the address must match the payer’s address of the mint transaction.</p>
<p><a href="#id16"><span class="problematic" id="id17">``</span></a><a href="#id18"><span class="problematic" id="id19">`</span></a>json
“addressGate” : {</p>
<blockquote>
<div><p>“address”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id20">
<h2>}<a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h2>
<p>### Allocation</p>
<p>The Allocation guard allows to specify a limit on the overall number of mints for a group, either the default or a specific one. The <cite>id</cite> configuration represents the unique identification for the limit — changing the id has the effect of restarting the limit, since a different tracking account will be created. The <cite>limit</cite> indicates the maximum number of mints allowed within the group.</p>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a>json
“allocation” : {</p>
<blockquote>
<div><p>“id”: number,
“limit”: number</p>
</div></blockquote>
</section>
<section id="id25">
<h2>}<a class="headerlink" href="#id25" title="Permalink to this heading">¶</a></h2>
<p>### Allow List</p>
<p>The AllowList guard validates the payer’s address against a merkle tree-based allow list of addresses. The hash should be specified as a hexadecimal value.</p>
<p><a href="#id26"><span class="problematic" id="id27">``</span></a><a href="#id28"><span class="problematic" id="id29">`</span></a>json
“allowList” : {</p>
<blockquote>
<div><p>“merkleRoot”: “&lt;HASH&gt;”</p>
</div></blockquote>
</section>
<section id="id30">
<h2>}<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h2>
<p>### Bot Tax</p>
<p>The BotTax guard is used to:</p>
<ul class="simple">
<li><p>charge a penalty for invalid transactions. The value of the penalty is specified by the lamports configuration.</p></li>
<li><p>validate that the mint transaction is the last transaction (last_instruction = true).</p></li>
</ul>
<p>The bot_tax is applied to any error that occurs during the validation of the guards.</p>
<p><a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">`</span></a>json
“botTax” : {</p>
<blockquote>
<div><p>“value”: SOL value,
“lastInstruction”: boolean</p>
</div></blockquote>
</section>
<section id="id35">
<h2>}<a class="headerlink" href="#id35" title="Permalink to this heading">¶</a></h2>
<p>### End Date</p>
<p>The End Date guard is used to specify a date to end the mint. Any transaction received after the end date will fail.</p>
<p>The date needs to be specified using [RFC 3339 standard](<a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc3339">https://datatracker.ietf.org/doc/html/rfc3339</a>). In most cases, the format used will be “yyyy-mm-dd`T`hh:mm:ss`Z`”, where <cite>T</cite> is the separator between the full-date and full-time and <cite>Z</cite> is the timezone offset from UTC (use <cite>Z</cite> or +00:00 for UTC time).</p>
<p><a href="#id36"><span class="problematic" id="id37">``</span></a><a href="#id38"><span class="problematic" id="id39">`</span></a>json
“endDate” : {</p>
<blockquote>
<div><p>“date”: “string”,</p>
</div></blockquote>
</section>
<section id="id40">
<h2>}<a class="headerlink" href="#id40" title="Permalink to this heading">¶</a></h2>
<p>### Freeze Sol Payment</p>
<p>The Freeze Sol Payment guard allows minting frozen NFTs by charging the payer an amount in SOL. Frozen NFTs cannot be transferred or listed on any marketplaces until thawed.</p>
<p>Frozen NFTs can be thawed by anyone as long as one of the following conditions is met:</p>
<ul class="simple">
<li><p>The Candy Machine has minted out.</p></li>
<li><p>The Candy Machine was deleted.</p></li>
<li><p>The configured Freeze Period — which can be a maximum of 30 days — has passed.</p></li>
</ul>
<p><a href="#id41"><span class="problematic" id="id42">``</span></a><a href="#id43"><span class="problematic" id="id44">`</span></a>json
“freezeSolPayment” : {</p>
<blockquote>
<div><p>“value”: SOL value,
“destination”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id45">
<h2>}<a class="headerlink" href="#id45" title="Permalink to this heading">¶</a></h2>
<p>### Freeze Token Payment</p>
<p>The Freeze Token Payment guard allows minting frozen NFTs by charging the payer a specific amount of tokens from a certain mint account. Frozen NFTs cannot be transferred or listed on any marketplaces until thawed. The amount determines how many tokens are required.</p>
<p>Frozen NFTs can be thawed by anyone as long as one of the following conditions is met:</p>
<ul class="simple">
<li><p>The Candy Machine has minted out.</p></li>
<li><p>The Candy Machine was deleted.</p></li>
<li><p>The configured Freeze Period — which can be a maximum of 30 days — has passed.</p></li>
</ul>
<p><a href="#id46"><span class="problematic" id="id47">``</span></a><a href="#id48"><span class="problematic" id="id49">`</span></a>json
“freezeTokenPayment” : {</p>
<blockquote>
<div><p>“amount”: number,
“mint”: “&lt;PUBKEY&gt;”,
“destinationAta”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id50">
<h2>}<a class="headerlink" href="#id50" title="Permalink to this heading">¶</a></h2>
<p>### Gatekeeper</p>
<p>The Gatekeeper guard validates if the payer of the transaction has a token from a specified gateway network &amp;mdash; in most cases, a token after completing a captcha challenge. The <cite>expire_on_use</cite> configuration is used to indicate whether or not the token should expire after minting.</p>
<p><a href="#id51"><span class="problematic" id="id52">``</span></a><a href="#id53"><span class="problematic" id="id54">`</span></a>json
“gatekeeper” : {</p>
<blockquote>
<div><p>“gatekeeperNetwork”: “&lt;PUBKEY&gt;”,
“expireOnUse”: boolean</p>
</div></blockquote>
</section>
<section id="id55">
<h2>}<a class="headerlink" href="#id55" title="Permalink to this heading">¶</a></h2>
<p>### Mint Limit</p>
<p>The Mint Limit guard allows to specify a limit on the number of mints for each individual address. The <cite>id</cite> configuration represents the unique identification for the limit — changing the id has the effect of restarting the limit, since a different tracking account will be created. The <cite>limit</cite> indicates the maximum number of mints allowed.</p>
<p><a href="#id56"><span class="problematic" id="id57">``</span></a><a href="#id58"><span class="problematic" id="id59">`</span></a>json
“mintLimit” : {</p>
<blockquote>
<div><p>“id”: number,
“limit”: number</p>
</div></blockquote>
</section>
<section id="id60">
<h2>}<a class="headerlink" href="#id60" title="Permalink to this heading">¶</a></h2>
<p>### NFT Burn</p>
<p>The NFT Burn guard restricts the mint to holders of another NFT (token), requiring that the NFT is burned in exchange of being allowed to mint.</p>
<p><a href="#id61"><span class="problematic" id="id62">``</span></a><a href="#id63"><span class="problematic" id="id64">`</span></a>json
“nftBurn” : {</p>
<blockquote>
<div><p>“requiredCollection”: “&lt;PUBKEY&gt;”,</p>
</div></blockquote>
</section>
<section id="id65">
<h2>}<a class="headerlink" href="#id65" title="Permalink to this heading">¶</a></h2>
<p>### NFT Gate</p>
<p>The NFT Gate guard restricts the mint to holders of a specified <cite>requiredCollection</cite> NFT collection. The payer is required to hold at least one NFT of the collection.</p>
<p><a href="#id66"><span class="problematic" id="id67">``</span></a><a href="#id68"><span class="problematic" id="id69">`</span></a>json
“nftGate” : {</p>
<blockquote>
<div><p>“requiredCollection”: “&lt;PUBKEY&gt;”,</p>
</div></blockquote>
</section>
<section id="id70">
<h2>}<a class="headerlink" href="#id70" title="Permalink to this heading">¶</a></h2>
<p>### NFT Payment</p>
<p>The NFT Payment guard is a payment guard that charges another NFT (token) from a specific collection for the mint. As a requirement of the mint, the specified NFT is transferred to the <cite>destination</cite> address.</p>
<p><a href="#id71"><span class="problematic" id="id72">``</span></a><a href="#id73"><span class="problematic" id="id74">`</span></a>json
“nftPayment” : {</p>
<blockquote>
<div><p>“requiredCollection”: “&lt;PUBKEY&gt;”,
“destination”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id75">
<h2>}<a class="headerlink" href="#id75" title="Permalink to this heading">¶</a></h2>
<p>### Program Gate</p>
<p>The Program Gate guard allows to specify a group of programs (up to 5) that can be present in the same transaction of the mint instruction. This can be used to limit the programs that are allowed to CPI to mint from the Candy Machine.</p>
<p><a href="#id76"><span class="problematic" id="id77">``</span></a><a href="#id78"><span class="problematic" id="id79">`</span></a>json
“programGate” : {</p>
<blockquote>
<div><p>“additional”: [“&lt;PUBKEY 1&gt;”, “&lt;PUBKEY 2&gt;”, …, “&lt;PUBKEY 5&gt;”],</p>
</div></blockquote>
</section>
<section id="id80">
<h2>}<a class="headerlink" href="#id80" title="Permalink to this heading">¶</a></h2>
<p>### Redeemed Amount</p>
<p>The Redeemed Amount guard stops the mint when the number of <cite>items_redeemed</cite> of the Candy Machine reaches the configured <cite>maximum</cite> amount.</p>
<p><a href="#id81"><span class="problematic" id="id82">``</span></a><a href="#id83"><span class="problematic" id="id84">`</span></a>json
“redeemedAmount” : {</p>
<blockquote>
<div><p>“maximum”: number,</p>
</div></blockquote>
</section>
<section id="id85">
<h2>}<a class="headerlink" href="#id85" title="Permalink to this heading">¶</a></h2>
<p>### Sol Payment</p>
<p>The Sol Payment guard is used to charge an amount in SOL for the mint. The funds are transferred to the configured <cite>destination</cite> address.</p>
<p><a href="#id86"><span class="problematic" id="id87">``</span></a><a href="#id88"><span class="problematic" id="id89">`</span></a>json
“solPayment” : {</p>
<blockquote>
<div><p>“value”: SOL value,
“destination”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id90">
<h2>}<a class="headerlink" href="#id90" title="Permalink to this heading">¶</a></h2>
<p>### Start Date</p>
<p>The Start Date guard determines the start date of the mint. If this guard is not specified, mint is allowed — similar to say any date is valid.</p>
<p>The date needs to be specified using [RFC 3339 standard](<a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc3339">https://datatracker.ietf.org/doc/html/rfc3339</a>). In most cases, the format used will be “yyyy-mm-dd`T`hh:mm:ss`Z`”, where <cite>T</cite> is the separator between the full-date and full-time and <cite>Z</cite> is the timezone offset from UTC (use <cite>Z</cite> or +00:00 for UTC time).</p>
<p><a href="#id91"><span class="problematic" id="id92">``</span></a><a href="#id93"><span class="problematic" id="id94">`</span></a>json
“startDate” : {</p>
<blockquote>
<div><p>“date”: “string”,</p>
</div></blockquote>
</section>
<section id="id95">
<h2>}<a class="headerlink" href="#id95" title="Permalink to this heading">¶</a></h2>
<p>### Third Party Signer</p>
<p>The Third Party Signer guard requires an extra signer on the transaction.</p>
<p><a href="#id96"><span class="problematic" id="id97">``</span></a><a href="#id98"><span class="problematic" id="id99">`</span></a>json
“thirdPartySigner” : {</p>
<blockquote>
<div><p>“signerKey”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id100">
<h2>}<a class="headerlink" href="#id100" title="Permalink to this heading">¶</a></h2>
<p>### Token Burn</p>
<p>The Token Burn guard restricts the mint to holders of a specified SPL Token and requires the burn of the tokens. The <cite>amount</cite> determines how many tokens are required.</p>
<p><a href="#id101"><span class="problematic" id="id102">``</span></a><a href="#id103"><span class="problematic" id="id104">`</span></a>json
“tokenBurn” : {</p>
<blockquote>
<div><p>“amount”: number,
“mint”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id105">
<h2>}<a class="headerlink" href="#id105" title="Permalink to this heading">¶</a></h2>
<p>### Token Gate</p>
<p>The Token Gate guard restricts the mint to holders of a specified SPL Token. The <cite>amount</cite> determines how many tokens are required.</p>
<p><a href="#id106"><span class="problematic" id="id107">``</span></a><a href="#id108"><span class="problematic" id="id109">`</span></a>json
“tokenGate” : {</p>
<blockquote>
<div><p>“amount”: number,
“mint”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id110">
<h2>}<a class="headerlink" href="#id110" title="Permalink to this heading">¶</a></h2>
<p>### Token Payment</p>
<p>The Token Payment guard restricts the mint to holders of a specified SPL Token, transferring the required amount to the <cite>destinationAta</cite> address. The amount determines how many tokens are required.</p>
<p><a href="#id111"><span class="problematic" id="id112">``</span></a><a href="#id113"><span class="problematic" id="id114">`</span></a>json
“tokenPayment” : {</p>
<blockquote>
<div><p>“amount”: number,
“mint”: “&lt;PUBKEY&gt;”,
“destinationAta”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id115">
<h2>}<a class="headerlink" href="#id115" title="Permalink to this heading">¶</a></h2>
<p>### Token2022 Payment</p>
<p>The Token2022 Payment guard allows minting by charging the payer some tokens from a configured Token-2022 mint account. Both the amount of tokens and the destination address can also be configured.</p>
<p><a href="#id116"><span class="problematic" id="id117">``</span></a><a href="#id118"><span class="problematic" id="id119">`</span></a>json
“token2022Payment” : {</p>
<blockquote>
<div><p>“amount”: number,
“mint”: “&lt;PUBKEY&gt;”,
“destinationAta”: “&lt;PUBKEY&gt;”</p>
</div></blockquote>
</section>
<section id="id120">
<h2>}<a class="headerlink" href="#id120" title="Permalink to this heading">¶</a></h2>
<p>## Deployment Commands</p>
<p>The deployment of a Candy Machine V3 follows the same steps:</p>
<ol class="arabic simple">
<li><p><cite>sugar validate</cite> to verify that all metadata is in place;</p></li>
<li><p><cite>sugar upload</cite> to upload the metadata to the selected storage;</p></li>
<li><p><cite>sugar deploy</cite> to create and deploy a Candy Machine;</p></li>
<li><p><cite>sugar verify</cite> to verify that all information is on-chain.</p></li>
</ol>
<p>At this point, your Candy Machine is deployed and allows minting only from the <cite>mint authority</cite>, which is the address that created the Candy Machine. The next step is to add a Candy Guard to the Candy Machine to specify the mint configuration (access control).</p>
<p>There are 5 new commands in Sugar to create and interact with a Candy Guard:</p>
<ul class="simple">
<li><p><cite>add</cite> to create a new candy guard over a candy machine;</p></li>
<li><p><cite>update</cite> to update the configuration of an existing candy guard;</p></li>
<li><p><cite>show</cite> to print the current configuration;</p></li>
<li><p><cite>remove</cite> to remove the candy guard from a candy machine;</p></li>
<li><p><cite>withdraw</cite> to close a candy guard account and retrieve the rent funds.</p></li>
</ul>
<p>### <cite>add</cite></p>
<p>Once you completed the guards configuration in your Sugar config file, you can add a Candy Guard using:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sugar</span> <span class="pre">guard</span> <span class="pre">add</span>
<span class="pre">`</span></code></p>
<p>&lt;details&gt;
&lt;summary&gt;Output&lt;/summary&gt;
&lt;p&gt;</p>
<p><a href="#id121"><span class="problematic" id="id122">``</span></a>`
[1/3] 🔍 Looking up candy machine</p>
<p>Candy machine ID: 7W9sWpDW4EJBpw2n8oqgJek4LcYDEM1JDPkoTZ7gPn4A</p>
<p>[2/3] 🛡  Initializing a candy guard
Signature: 4fyVi6xj1a5qEzvVubhhNfEX875GFJZLbKfg2q42JLeTxi2pFQEn8GwWFkAWT31z6VxPTecHKRa5ZnKrt31ZCT8Q</p>
<p>Candy guard ID: Bw66NeQ6FF6bnXopiv8hhvXPLaCQR7RC6UEntqVuzhdL</p>
<p>[3/3] 📦 Wrapping
Signature: 4ACcw1g8G4fE7yZdqqAMXrZtBx96W5zERXnyib694FgvKV9y5TLsuKVViKf8D4GN1jhyP1uqkBpLrwpcgN7Mt9hc</p>
<p>The candy guard is now the mint authority of the candy machine.</p>
<p>✅ Command successful.
<a href="#id123"><span class="problematic" id="id124">``</span></a><a href="#id125"><span class="problematic" id="id126">`</span></a></p>
<p>&lt;/p&gt;
&lt;/details&gt;</p>
<p>At this point, <cite>sugar mint</cite> will stop working since the <cite>mint authority</cite> is now the Candy Guard.</p>
<p>### <cite>update</cite></p>
<p>To update the Candy Guard configuration, you first need to make the required modification in the Sugar config file and the run the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sugar</span> <span class="pre">guard</span> <span class="pre">update</span>
<span class="pre">`</span></code></p>
<p>&lt;details&gt;
&lt;summary&gt;Output&lt;/summary&gt;
&lt;p&gt;</p>
<p><a href="#id127"><span class="problematic" id="id128">``</span></a>`
[1/2] 🔍 Loading candy guard
▪▪▪▪▪ Done
Candy guard ID: Bw66NeQ6FF6bnXopiv8hhvXPLaCQR7RC6UEntqVuzhdL</p>
<p>[2/2] 🖥  Updating configuration
Signature: d8ge5n7rzpeYB68m6VEbJQTYrEmnHo4P3XKXAc5KNYMJnxvq63JegsUMAjMZgBiXAYEqxUrbg9D94D8hT92XH7k</p>
<p>✅ Command successful.
<a href="#id129"><span class="problematic" id="id130">``</span></a><a href="#id131"><span class="problematic" id="id132">`</span></a></p>
<p>&lt;/p&gt;
&lt;/details&gt;</p>
<p>### <cite>show</cite></p>
<p>To print the on-chain configuration of a Candy Guard, use the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sugar</span> <span class="pre">guard</span> <span class="pre">show</span>
<span class="pre">`</span></code></p>
<p>&lt;details&gt;
&lt;summary&gt;Output&lt;/summary&gt;
&lt;p&gt;</p>
<p><a href="#id133"><span class="problematic" id="id134">``</span></a>`
[1/1] 🔍 Loading candy guard
▪▪▪▪▪ Done</p>
<dl>
<dt>🛡  Candy Guard ID: Bw66NeQ6FF6bnXopiv8hhvXPLaCQR7RC6UEntqVuzhdL</dt><dd><p>:
:.. base: 7z6f7mq7qGjWu6dimqdAyYNhjG5iqGQ7DYnFV2ckpzoY
:.. bump: 255
:.. authority: PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8
:.. data:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">.. default<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>:   :.. bot tax:
:   :   :.. lamports: 10000000 (◎ 0.01)
:   :   :.. last instruction: true
:   :.. sol payment: none
:   :.. token payment: none
:   :.. start date: none
:   :.. third party signer: none
:   :.. token gate: none
:   :.. gatekeeper: none
:   :.. end date: none
:   :.. allow list: none
:   :.. mint limit: none
:   :.. nft payment: none
:   :.. redeemed amount: none
:   :.. address gate: none
:   :.. nft gate: none
:   :.. nft burn: none
:   :.. token burn: none
:
:.. groups:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">.. label<span class="colon">:</span></dt>
<dd class="field-odd"><p>OGslic</p>
</dd>
</dl>
<p>:   :.. bot tax: none
:   :.. sol payment:
:   :   :.. lamports: 1 (◎ 0.000000001)
:   :   :.. destination: PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8
:   :.. token payment: none
:   :.. start date:
:   :   :.. date: Thu October 20 2022 12:00:00 UTC
:   :.. third party signer: none
:   :.. token gate:
:   :   :.. amount: 1000000000
:   :   :.. mint: 7nE1GmnMmDKiycFkpHF7mKtxt356FQzVonZqBWsTWZNf
:   :.. gatekeeper: none
:   :.. end date: none
:   :.. allow list: none
:   :.. mint limit: none
:   :.. nft payment: none
:   :.. redeemed amount: none
:   :.. address gate: none
:   :.. nft gate: none
:   :.. nft burn: none
:   :.. token burn: none
:
:.. label: Public</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">.. bot tax<span class="colon">:</span></dt>
<dd class="field-odd"><p>none</p>
</dd>
<dt class="field-even">.. sol payment<span class="colon">:</span></dt>
<dd class="field-even"><p></p></dd>
</dl>
<p>:   :.. lamports: 2000000000 (◎ 2)
:   :.. destination: PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8
:.. token payment: none
:.. start date:
:   :.. date: Thu October 20 2022 18:00:00 UTC
:.. third party signer: none
:.. token gate: none
:.. gatekeeper: none
:.. end date: none
:.. allow list: none
:.. mint limit: none
:.. nft payment: none
:.. redeemed amount: none
:.. address gate: none
:.. nft gate: none
:.. nft burn: none
:.. token burn: none</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
<p>✅ Command successful.
<a href="#id135"><span class="problematic" id="id136">``</span></a><a href="#id137"><span class="problematic" id="id138">`</span></a></p>
<p>&lt;/p&gt;
&lt;/details&gt;</p>
<p>### <cite>remove</cite></p>
<p>To remove a Candy Guard from a Candy Machine, use the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sugar</span> <span class="pre">guard</span> <span class="pre">remove</span>
<span class="pre">`</span></code></p>
<p>&lt;details&gt;
&lt;summary&gt;Output&lt;/summary&gt;
&lt;p&gt;</p>
<p><a href="#id139"><span class="problematic" id="id140">``</span></a>`
[1/1] 🔩 Unwrapping
Signature: 5hbySp2JPuFrdjauDFVu5P4Fa3EkV9pAyqtgqDRs38d6aVwgiSpsBEs33BKQjqPMvdyyteS2W7ApfmcGstRuajNz</p>
<dl class="simple">
<dt>The candy guard is no longer the mint authority of the candy machine.</dt><dd><p>-&gt; New mint authority: PanbgtcTiZ2PveV96t2FHSffiLHXXjMuhvoabUUKKm8</p>
</dd>
</dl>
<p>✅ Command successful.
<a href="#id141"><span class="problematic" id="id142">``</span></a><a href="#id143"><span class="problematic" id="id144">`</span></a></p>
<p>At this point, the <cite>mint authority</cite> is transferred back to the Candy Machine <cite>authority</cite>. The Candy Guard account remains on-chain and can be reused.</p>
<p>&lt;/p&gt;
&lt;/details&gt;</p>
<p>### <cite>withdraw</cite></p>
<p>To close the Candy Guard account and retrieve the rent fee, use the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">sugar</span> <span class="pre">guard</span> <span class="pre">withdraw</span>
<span class="pre">`</span></code></p>
<p>&lt;details&gt;
&lt;summary&gt;Output&lt;/summary&gt;
&lt;p&gt;</p>
<p><a href="#id145"><span class="problematic" id="id146">``</span></a>`
[1/2] 🔍 Loading candy guard
▪▪▪▪▪ Done</p>
<p>[2/2] 🏧 Retrieving funds
Signature: Yfm2kBbs5kygRzH6QDDTXyx2wxqGZ6P6RkTAHEMkHJ7PvpCZKUu2akkZBDHYfdy1TNyUPLywuNSJoPGWAmTSRuK</p>
<p>Received ◎ 0.00268656 from rent fee.</p>
<p>✅ Command successful.
<a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a></p>
<p>&lt;/p&gt;
&lt;/details&gt;</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/03-developer-tools/00-sugar/03-guides/04-sugar-for-cmv3.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>