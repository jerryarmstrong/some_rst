<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../../" id="documentation_options" src="../../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.home_mixer.util.earlybird</p>
<p>import com.twitter.search.common.constants.{thriftscala =&gt; scc}
import com.twitter.search.common.features.{thriftscala =&gt; sc}
import com.twitter.search.common.schema.earlybird.EarlybirdFieldConstants.EarlybirdFieldConstant
import com.twitter.search.common.schema.earlybird.EarlybirdFieldConstants.EarlybirdFieldConstant._
import com.twitter.search.common.util.lang.ThriftLanguageUtil
import com.twitter.search.earlybird.{thriftscala =&gt; eb}
import com.twitter.timelines.earlybird.common.utils.InNetworkEngagement</p>
<p>object EarlybirdResponseUtil {</p>
<blockquote>
<div><p>private[earlybird] val Mentions: String = “mentions”
private[earlybird] val Hashtags: String = “hashtags”
private val CharsToRemoveFromMentions: Set[Char] = “&#64;”.toSet
private val CharsToRemoveFromHashtags: Set[Char] = “#”.toSet</p>
<p>// Default value of settings of ThriftTweetFeatures.
private[earlybird] val DefaultEarlybirdFeatures: sc.ThriftTweetFeatures = sc.ThriftTweetFeatures()
private[earlybird] val DefaultCount = 0
private[earlybird] val DefaultLanguage = 0
private[earlybird] val DefaultScore = 0.0</p>
<dl>
<dt>private[earlybird] def getTweetCountByAuthorId(</dt><dd><p>searchResults: Seq[eb.ThriftSearchResult]</p>
</dd>
<dt>): Map[Long, Int] = {</dt><dd><dl>
<dt>searchResults</dt><dd><dl class="simple">
<dt>.groupBy { result =&gt;</dt><dd><p>result.metadata.map(_.fromUserId).getOrElse(0L)</p>
</dd>
</dl>
<p>}.mapValues(_.size).withDefaultValue(0)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private[earlybird] def getLanguage(uiLanguageCode: Option[String]): Option[scc.ThriftLanguage] = {</dt><dd><dl class="simple">
<dt>uiLanguageCode.flatMap { languageCode =&gt;</dt><dd><p>scc.ThriftLanguage.get(ThriftLanguageUtil.getThriftLanguageOf(languageCode).getValue)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private def getMentions(result: eb.ThriftSearchResult): Seq[String] = {</dt><dd><p>val facetLabels = result.metadata.flatMap(_.facetLabels).getOrElse(Seq.empty)
getFacets(facetLabels, Mentions, CharsToRemoveFromMentions)</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private def getHashtags(result: eb.ThriftSearchResult): Seq[String] = {</dt><dd><p>val facetLabels = result.metadata.flatMap(_.facetLabels).getOrElse(Seq.empty)
getFacets(facetLabels, Hashtags, CharsToRemoveFromHashtags)</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private def getFacets(</dt><dd><p>facetLabels: Seq[eb.ThriftFacetLabel],
facetName: String,
charsToRemove: Set[Char]</p>
</dd>
<dt>): Seq[String] = {</dt><dd><p>facetLabels.filter(_.fieldName == facetName).map(_.label.filterNot(charsToRemove))</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private def isUserMentioned(</dt><dd><p>screenName: Option[String],
mentions: Seq[String],
mentionsInSourceTweet: Seq[String]</p>
</dd>
<dt>): Boolean =</dt><dd><p>isUserMentioned(screenName, mentions) || isUserMentioned(screenName, mentionsInSourceTweet)</p>
</dd>
<dt>private def isUserMentioned(</dt><dd><p>screenName: Option[String],
mentions: Seq[String]</p>
</dd>
<dt>): Boolean = {</dt><dd><dl class="simple">
<dt>screenName</dt><dd><p>.exists { screenName =&gt; mentions.exists(_.equalsIgnoreCase(screenName)) }</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private[earlybird] def isUsersMainLanguage(</dt><dd><p>tweetLanguage: scc.ThriftLanguage,
userLanguages: Seq[scc.ThriftLanguage]</p>
</dd>
<dt>): Boolean = {</dt><dd><dl class="simple">
<dt>(tweetLanguage != scc.ThriftLanguage.Unknown) &amp;&amp; userLanguages.headOption.contains(</dt><dd><p>tweetLanguage)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private[earlybird] def isUsersLanguage(</dt><dd><p>tweetLanguage: scc.ThriftLanguage,
userLanguages: Seq[scc.ThriftLanguage]</p>
</dd>
<dt>): Boolean = {</dt><dd><p>(tweetLanguage != scc.ThriftLanguage.Unknown) &amp;&amp; userLanguages.contains(tweetLanguage)</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private[earlybird] def isUILanguage(</dt><dd><p>tweetLanguage: scc.ThriftLanguage,
uiLanguage: Option[scc.ThriftLanguage]</p>
</dd>
<dt>): Boolean = {</dt><dd><p>(tweetLanguage != scc.ThriftLanguage.Unknown) &amp;&amp; uiLanguage.contains(tweetLanguage)</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def getBooleanOptFeature(</dt><dd><p>featureName: EarlybirdFieldConstant,
resultMapOpt: Option[scala.collection.Map[Int, Boolean]],
defaultValue: Boolean = false,</p>
</dd>
<dt>): Option[Boolean] = {</dt><dd><dl class="simple">
<dt>resultMapOpt.map {</dt><dd><p>_.getOrElse(featureName.getFieldId, defaultValue)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def getDoubleAsIntOptFeature(</dt><dd><p>featureName: EarlybirdFieldConstant,
resultMapOpt: Option[scala.collection.Map[Int, Double]]</p>
</dd>
<dt>): Option[Int] = {</dt><dd><dl>
<dt>if (resultMapOpt.exists(_.contains(featureName.getFieldId)))</dt><dd><dl>
<dt>resultMapOpt</dt><dd><dl class="simple">
<dt>.map {</dt><dd><p>_.get(featureName.getFieldId)</p>
</dd>
</dl>
<p>}
.flatMap { doubleValue =&gt;</p>
<blockquote>
<div><p>doubleValue.map(_.toInt)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>None</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def getIntOptFeature(</dt><dd><p>featureName: EarlybirdFieldConstant,
resultMapOpt: Option[scala.collection.Map[Int, Int]]</p>
</dd>
<dt>): Option[Int] = {</dt><dd><dl>
<dt>if (resultMapOpt.exists(_.contains(featureName.getFieldId)))</dt><dd><dl class="simple">
<dt>resultMapOpt.flatMap {</dt><dd><p>_.get(featureName.getFieldId)</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>else</dt><dd><p>None</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>def getTweetThriftFeaturesByTweetId(</dt><dd><p>searcherUserId: Long,
screenName: Option[String],
userLanguages: Seq[scc.ThriftLanguage],
uiLanguageCode: Option[String] = None,
followedUserIds: Set[Long],
mutuallyFollowingUserIds: Set[Long],
searchResults: Seq[eb.ThriftSearchResult],
sourceTweetSearchResults: Seq[eb.ThriftSearchResult],</p>
</dd>
</dl>
<p>): Map[Long, sc.ThriftTweetFeatures] = {</p>
<blockquote>
<div><p>val allSearchResults = searchResults ++ sourceTweetSearchResults
val sourceTweetSearchResultById =</p>
<blockquote>
<div><p>sourceTweetSearchResults.map(result =&gt; (result.id -&gt; result)).toMap</p>
</div></blockquote>
<dl>
<dt>val inNetworkEngagement =</dt><dd><p>InNetworkEngagement(followedUserIds.toSeq, mutuallyFollowingUserIds, allSearchResults)</p>
</dd>
<dt>searchResults.map { searchResult =&gt;</dt><dd><dl class="simple">
<dt>val features = getThriftTweetFeaturesFromSearchResult(</dt><dd><p>searcherUserId,
screenName,
userLanguages,
getLanguage(uiLanguageCode),
getTweetCountByAuthorId(searchResults),
followedUserIds,
mutuallyFollowingUserIds,
sourceTweetSearchResultById,
inNetworkEngagement,
searchResult</p>
</dd>
</dl>
<p>)
(searchResult.id -&gt; features)</p>
</dd>
</dl>
<p>}.toMap</p>
</div></blockquote>
<p>}</p>
<dl>
<dt>private[earlybird] def getThriftTweetFeaturesFromSearchResult(</dt><dd><p>searcherUserId: Long,
screenName: Option[String],
userLanguages: Seq[scc.ThriftLanguage],
uiLanguage: Option[scc.ThriftLanguage],
tweetCountByAuthorId: Map[Long, Int],
followedUserIds: Set[Long],
mutuallyFollowingUserIds: Set[Long],
sourceTweetSearchResultById: Map[Long, eb.ThriftSearchResult],
inNetworkEngagement: InNetworkEngagement,
searchResult: eb.ThriftSearchResult,</p>
</dd>
<dt>): sc.ThriftTweetFeatures = {</dt><dd><dl>
<dt>val applyFeatures = (applyUserIndependentFeatures(</dt><dd><p>searchResult</p>
</dd>
<dt>)(_)).andThen(</dt><dd><dl class="simple">
<dt>applyUserDependentFeatures(</dt><dd><p>searcherUserId,
screenName,
userLanguages,
uiLanguage,
tweetCountByAuthorId,
followedUserIds,
mutuallyFollowingUserIds,
sourceTweetSearchResultById,
inNetworkEngagement,
searchResult</p>
</dd>
</dl>
<p>)(_)</p>
</dd>
</dl>
<p>)
val tweetFeatures = searchResult.tweetFeatures.getOrElse(DefaultEarlybirdFeatures)
applyFeatures(tweetFeatures)</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>private[earlybird] def applyUserIndependentFeatures(</dt><dd><p>result: eb.ThriftSearchResult</p>
</dd>
<dt>)(</dt><dd><p>thriftTweetFeatures: sc.ThriftTweetFeatures</p>
</dd>
</dl>
<p>): sc.ThriftTweetFeatures = {</p>
<blockquote>
<div><dl>
<dt>val features = result.metadata</dt><dd><dl>
<dt>.map { metadata =&gt;</dt><dd><p>val isRetweet = metadata.isRetweet.getOrElse(false)
val isReply = metadata.isReply.getOrElse(false)</p>
<p>// Facets.
val mentions = getMentions(result)
val hashtags = getHashtags(result)</p>
<p>val searchResultSchemaFeatures = metadata.extraMetadata.flatMap(_.features)
val booleanSearchResultSchemaFeatures = searchResultSchemaFeatures.flatMap(_.boolValues)
val intSearchResultSchemaFeatures = searchResultSchemaFeatures.flatMap(_.intValues)
val doubleSearchResultSchemaFeatures = searchResultSchemaFeatures.flatMap(_.doubleValues)</p>
<dl>
<dt>thriftTweetFeatures.copy(</dt><dd><p>// Info about the Tweet.
isRetweet = isRetweet,
isOffensive = metadata.isOffensive.getOrElse(false),
isReply = isReply,
fromVerifiedAccount = metadata.fromVerifiedAccount.getOrElse(false),
cardType = metadata.cardType,
signature = metadata.signature,
language = metadata.language,
isAuthorNSFW = metadata.isUserNSFW.getOrElse(false),
isAuthorBot = metadata.isUserBot.getOrElse(false),
isAuthorSpam = metadata.isUserSpam.getOrElse(false),
isSensitiveContent =</p>
<blockquote>
<div><p>metadata.extraMetadata.flatMap(_.isSensitiveContent).getOrElse(false),</p>
</div></blockquote>
<p>isAuthorProfileEgg = metadata.extraMetadata.flatMap(_.profileIsEggFlag).getOrElse(false),
isAuthorNew = metadata.extraMetadata.flatMap(_.isUserNewFlag).getOrElse(false),
linkLanguage = metadata.extraMetadata.flatMap(_.linkLanguage).getOrElse(DefaultLanguage),
// Info about Tweet content/media.
hasCard = metadata.hasCard.getOrElse(false),
hasImage = metadata.hasImage.getOrElse(false),
hasNews = metadata.hasNews.getOrElse(false),
hasVideo = metadata.hasVideo.getOrElse(false),
hasConsumerVideo = metadata.hasConsumerVideo.getOrElse(false),
hasProVideo = metadata.hasProVideo.getOrElse(false),
hasVine = metadata.hasVine.getOrElse(false),
hasPeriscope = metadata.hasPeriscope.getOrElse(false),
hasNativeVideo = metadata.hasNativeVideo.getOrElse(false),
hasNativeImage = metadata.hasNativeImage.getOrElse(false),
hasLink = metadata.hasLink.getOrElse(false),
hasVisibleLink = metadata.hasVisibleLink.getOrElse(false),
hasTrend = metadata.hasTrend.getOrElse(false),
hasMultipleHashtagsOrTrends = metadata.hasMultipleHashtagsOrTrends.getOrElse(false),
hasQuote = metadata.extraMetadata.flatMap(_.hasQuote),
urlsList = metadata.tweetUrls.map {</p>
<blockquote>
<div><p>_.map(_.originalUrl)</p>
</div></blockquote>
<p>},
hasMultipleMedia =</p>
<blockquote>
<div><p>metadata.extraMetadata.flatMap(_.hasMultipleMediaFlag).getOrElse(false),</p>
</div></blockquote>
<p>visibleTokenRatio = getIntOptFeature(VISIBLE_TOKEN_RATIO, intSearchResultSchemaFeatures),
// Various counts.
favCount = metadata.favCount.getOrElse(DefaultCount),
replyCount = metadata.replyCount.getOrElse(DefaultCount),
retweetCount = metadata.retweetCount.getOrElse(DefaultCount),
quoteCount = metadata.extraMetadata.flatMap(_.quotedCount),
embedsImpressionCount = metadata.embedsImpressionCount.getOrElse(DefaultCount),
embedsUrlCount = metadata.embedsUrlCount.getOrElse(DefaultCount),
videoViewCount = metadata.videoViewCount.getOrElse(DefaultCount),
numMentions = metadata.extraMetadata.flatMap(_.numMentions).getOrElse(DefaultCount),
numHashtags = metadata.extraMetadata.flatMap(_.numHashtags).getOrElse(DefaultCount),
favCountV2 = metadata.extraMetadata.flatMap(_.favCountV2),
replyCountV2 = metadata.extraMetadata.flatMap(_.replyCountV2),
retweetCountV2 = metadata.extraMetadata.flatMap(_.retweetCountV2),
weightedFavoriteCount = metadata.extraMetadata.flatMap(_.weightedFavCount),
weightedReplyCount = metadata.extraMetadata.flatMap(_.weightedReplyCount),
weightedRetweetCount = metadata.extraMetadata.flatMap(_.weightedRetweetCount),
weightedQuoteCount = metadata.extraMetadata.flatMap(_.weightedQuoteCount),
embedsImpressionCountV2 =</p>
<blockquote>
<div><p>getDoubleAsIntOptFeature(EMBEDS_IMPRESSION_COUNT_V2, doubleSearchResultSchemaFeatures),</p>
</div></blockquote>
<dl class="simple">
<dt>embedsUrlCountV2 =</dt><dd><p>getDoubleAsIntOptFeature(EMBEDS_URL_COUNT_V2, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>decayedFavoriteCount =</dt><dd><p>getDoubleAsIntOptFeature(DECAYED_FAVORITE_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>decayedRetweetCount =</dt><dd><p>getDoubleAsIntOptFeature(DECAYED_RETWEET_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>decayedReplyCount =</dt><dd><p>getDoubleAsIntOptFeature(DECAYED_REPLY_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>decayedQuoteCount =</dt><dd><p>getDoubleAsIntOptFeature(DECAYED_QUOTE_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>fakeFavoriteCount =</dt><dd><p>getDoubleAsIntOptFeature(FAKE_FAVORITE_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>fakeRetweetCount =</dt><dd><p>getDoubleAsIntOptFeature(FAKE_RETWEET_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>fakeReplyCount =</dt><dd><p>getDoubleAsIntOptFeature(FAKE_REPLY_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
<dt>fakeQuoteCount =</dt><dd><p>getDoubleAsIntOptFeature(FAKE_QUOTE_COUNT, doubleSearchResultSchemaFeatures),</p>
</dd>
</dl>
<p>// Scores.
textScore = metadata.textScore.getOrElse(DefaultScore),
earlybirdScore = metadata.score.getOrElse(DefaultScore),
parusScore = metadata.parusScore.getOrElse(DefaultScore),
userRep = metadata.userRep.getOrElse(DefaultScore),
pBlockScore = metadata.extraMetadata.flatMap(_.pBlockScore),
toxicityScore = metadata.extraMetadata.flatMap(_.toxicityScore),
pSpammyTweetScore = metadata.extraMetadata.flatMap(_.pSpammyTweetScore),
pReportedTweetScore = metadata.extraMetadata.flatMap(_.pReportedTweetScore),
pSpammyTweetContent = metadata.extraMetadata.flatMap(_.spammyTweetContentScore),
// Safety Signals
labelAbusiveFlag =</p>
<blockquote>
<div><p>getBooleanOptFeature(LABEL_ABUSIVE_FLAG, booleanSearchResultSchemaFeatures),</p>
</div></blockquote>
<dl class="simple">
<dt>labelAbusiveHiRclFlag =</dt><dd><p>getBooleanOptFeature(LABEL_ABUSIVE_HI_RCL_FLAG, booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>labelDupContentFlag =</dt><dd><p>getBooleanOptFeature(LABEL_DUP_CONTENT_FLAG, booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>labelNsfwHiPrcFlag =</dt><dd><p>getBooleanOptFeature(LABEL_NSFW_HI_PRC_FLAG, booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>labelNsfwHiRclFlag =</dt><dd><p>getBooleanOptFeature(LABEL_NSFW_HI_RCL_FLAG, booleanSearchResultSchemaFeatures),</p>
</dd>
</dl>
<p>labelSpamFlag = getBooleanOptFeature(LABEL_SPAM_FLAG, booleanSearchResultSchemaFeatures),
labelSpamHiRclFlag =</p>
<blockquote>
<div><p>getBooleanOptFeature(LABEL_SPAM_HI_RCL_FLAG, booleanSearchResultSchemaFeatures),</p>
</div></blockquote>
<p>// Periscope Features
periscopeExists =</p>
<blockquote>
<div><p>getBooleanOptFeature(PERISCOPE_EXISTS, booleanSearchResultSchemaFeatures),</p>
</div></blockquote>
<dl class="simple">
<dt>periscopeHasBeenFeatured =</dt><dd><p>getBooleanOptFeature(PERISCOPE_HAS_BEEN_FEATURED, booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>periscopeIsCurrentlyFeatured = getBooleanOptFeature(</dt><dd><p>PERISCOPE_IS_CURRENTLY_FEATURED,
booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>periscopeIsFromQualitySource = getBooleanOptFeature(</dt><dd><p>PERISCOPE_IS_FROM_QUALITY_SOURCE,
booleanSearchResultSchemaFeatures),</p>
</dd>
<dt>periscopeIsLive =</dt><dd><p>getBooleanOptFeature(PERISCOPE_IS_LIVE, booleanSearchResultSchemaFeatures),</p>
</dd>
</dl>
<p>// Last Engagement Features
lastFavSinceCreationHrs =</p>
<blockquote>
<div><p>getIntOptFeature(LAST_FAVORITE_SINCE_CREATION_HRS, intSearchResultSchemaFeatures),</p>
</div></blockquote>
<dl class="simple">
<dt>lastRetweetSinceCreationHrs =</dt><dd><p>getIntOptFeature(LAST_RETWEET_SINCE_CREATION_HRS, intSearchResultSchemaFeatures),</p>
</dd>
<dt>lastReplySinceCreationHrs =</dt><dd><p>getIntOptFeature(LAST_REPLY_SINCE_CREATION_HRS, intSearchResultSchemaFeatures),</p>
</dd>
<dt>lastQuoteSinceCreationHrs =</dt><dd><p>getIntOptFeature(LAST_QUOTE_SINCE_CREATION_HRS, intSearchResultSchemaFeatures),</p>
</dd>
</dl>
<p>likedByUserIds = metadata.extraMetadata.flatMap(_.likedByUserIds),
mentionsList = if (mentions.nonEmpty) Some(mentions) else None,
hashtagsList = if (hashtags.nonEmpty) Some(hashtags) else None,
isComposerSourceCamera =</p>
<blockquote>
<div><p>getBooleanOptFeature(COMPOSER_SOURCE_IS_CAMERA_FLAG, booleanSearchResultSchemaFeatures),</p>
</div></blockquote>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}
.getOrElse(thriftTweetFeatures)</p>
</dd>
</dl>
<p>features</p>
</div></blockquote>
<p>}</p>
<dl>
<dt>private def applyUserDependentFeatures(</dt><dd><p>searcherUserId: Long,
screenName: Option[String],
userLanguages: Seq[scc.ThriftLanguage],
uiLanguage: Option[scc.ThriftLanguage],
tweetCountByAuthorId: Map[Long, Int],
followedUserIds: Set[Long],
mutuallyFollowingUserIds: Set[Long],
sourceTweetSearchResultById: Map[Long, eb.ThriftSearchResult],
inNetworkEngagement: InNetworkEngagement,
result: eb.ThriftSearchResult</p>
</dd>
<dt>)(</dt><dd><p>thriftTweetFeatures: sc.ThriftTweetFeatures</p>
</dd>
<dt>): sc.ThriftTweetFeatures = {</dt><dd><dl>
<dt>result.metadata</dt><dd><dl>
<dt>.map { metadata =&gt;</dt><dd><p>val isRetweet = metadata.isRetweet.getOrElse(false)
val sourceTweet =</p>
<blockquote>
<div><p>if (isRetweet) sourceTweetSearchResultById.get(metadata.sharedStatusId)
else None</p>
</div></blockquote>
<p>val mentionsInSourceTweet = sourceTweet.map(getMentions).getOrElse(Seq.empty)</p>
<p>val isReply = metadata.isReply.getOrElse(false)
val replyToSearcher = isReply &amp;&amp; (metadata.referencedTweetAuthorId == searcherUserId)
val replyOther = isReply &amp;&amp; !replyToSearcher
val retweetOther = isRetweet &amp;&amp; (metadata.referencedTweetAuthorId != searcherUserId)
val tweetLanguage = metadata.language.getOrElse(scc.ThriftLanguage.Unknown)</p>
<dl class="simple">
<dt>val referencedTweetAuthorId =</dt><dd><p>if (metadata.referencedTweetAuthorId &gt; 0) Some(metadata.referencedTweetAuthorId) else None</p>
</dd>
</dl>
<p>val inReplyToUserId = if (!isRetweet) referencedTweetAuthorId else None</p>
<dl>
<dt>thriftTweetFeatures.copy(</dt><dd><p>// Info about the Tweet.
fromSearcher = metadata.fromUserId == searcherUserId,
probablyFromFollowedAuthor = followedUserIds.contains(metadata.fromUserId),
fromMutualFollow = mutuallyFollowingUserIds.contains(metadata.fromUserId),
replySearcher = replyToSearcher,
replyOther = replyOther,
retweetOther = retweetOther,
mentionSearcher = isUserMentioned(screenName, getMentions(result), mentionsInSourceTweet),
// Info about Tweet content/media.
matchesSearcherMainLang = isUsersMainLanguage(tweetLanguage, userLanguages),
matchesSearcherLangs = isUsersLanguage(tweetLanguage, userLanguages),
matchesUILang = isUILanguage(tweetLanguage, uiLanguage),
// Various counts.
prevUserTweetEngagement =</p>
<blockquote>
<div><p>metadata.extraMetadata.flatMap(_.prevUserTweetEngagement).getOrElse(DefaultCount),</p>
</div></blockquote>
<p>tweetCountFromUserInSnapshot = tweetCountByAuthorId(metadata.fromUserId),
bidirectionalReplyCount = inNetworkEngagement.biDirectionalReplyCounts(result.id),
unidirectionalReplyCount = inNetworkEngagement.uniDirectionalReplyCounts(result.id),
bidirectionalRetweetCount = inNetworkEngagement.biDirectionalRetweetCounts(result.id),
unidirectionalRetweetCount = inNetworkEngagement.uniDirectionalRetweetCounts(result.id),
conversationCount = inNetworkEngagement.descendantReplyCounts(result.id),
directedAtUserIdIsInFirstDegree =</p>
<blockquote>
<div><p>if (isReply) inReplyToUserId.map(followedUserIds.contains) else None,</p>
</div></blockquote>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}
.getOrElse(thriftTweetFeatures)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../../_sources/home-mixer/server/src/main/scala/com/twitter/home_mixer/util/earlybird/EarlybirdResponseUtil.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>