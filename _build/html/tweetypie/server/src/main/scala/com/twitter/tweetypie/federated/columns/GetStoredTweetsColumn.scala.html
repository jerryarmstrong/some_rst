<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../../" id="documentation_options" src="../../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.tweetypie.federated.columns</p>
<p>import com.twitter.stitch.MapGroup
import com.twitter.stitch.Stitch
import com.twitter.strato.access.Access.LdapGroup
import com.twitter.strato.catalog.Fetch
import com.twitter.strato.catalog.OpMetadata
import com.twitter.strato.config.AnyOf
import com.twitter.strato.config.ContactInfo
import com.twitter.strato.config.FromColumns
import com.twitter.strato.config.Has
import com.twitter.strato.config.Path
import com.twitter.strato.config.Policy
import com.twitter.strato.data.Conv
import com.twitter.strato.data.Description.PlainText
import com.twitter.strato.data.Lifecycle.Production
import com.twitter.strato.fed.StratoFed
import com.twitter.strato.response.Err
import com.twitter.strato.thrift.ScroogeConv
import com.twitter.tweetypie.{thriftscala =&gt; thrift}
import com.twitter.tweetypie.TweetId
import com.twitter.tweetypie.thriftscala.federated.GetStoredTweetsView
import com.twitter.tweetypie.thriftscala.federated.GetStoredTweetsResponse
import com.twitter.util.Future
import com.twitter.util.Return
import com.twitter.util.Throw
import com.twitter.util.Try</p>
<dl>
<dt>class GetStoredTweetsColumn(</dt><dd><dl class="simple">
<dt>getStoredTweets: thrift.GetStoredTweetsRequest =&gt; Future[Seq[thrift.GetStoredTweetsResult]])</dt><dd><p>extends StratoFed.Column(GetStoredTweetsColumn.Path)
with StratoFed.Fetch.Stitch {</p>
</dd>
</dl>
<p>override val contactInfo: ContactInfo = TweetypieContactInfo
override val metadata: OpMetadata = OpMetadata(</p>
<blockquote>
<div><p>lifecycle = Some(Production),
description = Some(PlainText(“Fetches hydrated Tweets regardless of Tweet state.”))</p>
</div></blockquote>
<p>)
override val policy: Policy = AnyOf(</p>
<blockquote>
<div><dl>
<dt>Seq(</dt><dd><dl class="simple">
<dt>FromColumns(</dt><dd><dl class="simple">
<dt>Set(</dt><dd><p>Path(“tweetypie/data-provider/storedTweets.User”),
Path(“note_tweet/data-provider/noteTweetForZipbird.User”))),</p>
</dd>
</dl>
</dd>
</dl>
<p>Has(LdapGroup(“tweetypie-team”))</p>
</dd>
</dl>
<p>))</p>
</div></blockquote>
<p>override type Key = TweetId
override type View = GetStoredTweetsView
override type Value = GetStoredTweetsResponse</p>
<p>override val keyConv: Conv[Key] = Conv.ofType
override val viewConv: Conv[View] = ScroogeConv.fromStruct[GetStoredTweetsView]
override val valueConv: Conv[Value] = ScroogeConv.fromStruct[GetStoredTweetsResponse]</p>
<dl class="simple">
<dt>override def fetch(key: Key, view: View): Stitch[Result[Value]] = {</dt><dd><p>Stitch.call(key, Group(view))</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private case class Group(view: GetStoredTweetsView)</dt><dd><blockquote>
<div><p>extends MapGroup[TweetId, Fetch.Result[GetStoredTweetsResponse]] {</p>
</div></blockquote>
<dl>
<dt>override protected def run(</dt><dd><p>keys: Seq[TweetId]</p>
</dd>
<dt>): Future[TweetId =&gt; Try[Result[GetStoredTweetsResponse]]] = {</dt><dd><dl class="simple">
<dt>val options = thrift.GetStoredTweetsOptions(</dt><dd><p>bypassVisibilityFiltering = view.bypassVisibilityFiltering,
forUserId = view.forUserId,
additionalFieldIds = view.additionalFieldIds</p>
</dd>
</dl>
<p>)</p>
<dl>
<dt>getStoredTweets(thrift.GetStoredTweetsRequest(keys, Some(options)))</dt><dd><p>.map(transformAndGroupByTweetId)
.handle {</p>
<blockquote>
<div><dl class="simple">
<dt>case _ =&gt;</dt><dd><p>_ =&gt; Throw[Result[GetStoredTweetsResponse]](Err(Err.Internal))</p>
</dd>
</dl>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def transformAndGroupByTweetId(</dt><dd><p>results: Seq[thrift.GetStoredTweetsResult]</p>
</dd>
<dt>): Map[TweetId, Try[Fetch.Result[GetStoredTweetsResponse]]] = {</dt><dd><dl>
<dt>results</dt><dd><p>.map(result =&gt; GetStoredTweetsResponse(result.storedTweet))
.groupBy(_.storedTweet.tweetId)
.map {</p>
<blockquote>
<div><p>case (tweetId, Seq(result)) =&gt; (tweetId, Return(Fetch.Result.found(result)))
case (tweetId, multipleResults) =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>(</dt><dd><p>tweetId,
Throw(Err(Err.BadRequest, s”Got ${multipleResults.size} results for $tweetId”)))</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>object GetStoredTweetsColumn {</dt><dd><p>val Path = “tweetypie/internal/getStoredTweets.Tweet”</p>
</dd>
</dl>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../../_sources/tweetypie/server/src/main/scala/com/twitter/tweetypie/federated/columns/GetStoredTweetsColumn.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>