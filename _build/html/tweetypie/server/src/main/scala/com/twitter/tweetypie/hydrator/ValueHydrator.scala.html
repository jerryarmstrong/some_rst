<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../" id="documentation_options" src="../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.tweetypie
package hydrator</p>
<p>import com.twitter.servo.util.ExceptionCounter
import com.twitter.stitch.Stitch
import com.twitter.tweetypie.core.EditState
import com.twitter.tweetypie.core.ValueState
import com.twitter.util.Try</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>A ValueHydrator hydrates a value of type <cite>A</cite>, with a hydration context of type <cite>C</cite>,</p></li>
<li><p>and produces a value of type ValueState[A] (ValueState encapsulates the value and</p></li>
<li><p>its associated HydrationState).</p></li>
<li></li>
<li><p>Because ValueHydrators take a value and produce a new value, they can easily be run</p></li>
<li><p>in sequence, but not in parallel. To run hydrators in parallel, see [[EditHydrator]].</p></li>
<li></li>
<li><p>A series of ValueHydrators of the same type may be run in sequence via</p></li>
<li><p><cite>ValueHydrator.inSequence</cite>.</p></li>
<li></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
</dl>
<p>class ValueHydrator[A, C] private (val run: (A, C) =&gt; Stitch[ValueState[A]]) {</p>
<blockquote>
<div><dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Apply this hydrator to a value, producing a ValueState.</p></li>
</ul>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
</dd>
</dl>
<p>def apply(a: A, ctx: C): Stitch[ValueState[A]] = run(a, ctx)</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Apply with an empty context: only used in tests.</p></li>
</ul>
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
</dd>
<dt>def apply(a: A)(implicit ev: Unit &lt;:&lt; C): Stitch[ValueState[A]] =</dt><dd><p>apply(a, ev(()))</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Convert this ValueHydrator to the equivalent EditHydrator.</p></li>
</ul>
<p><a href="#id7"><span class="problematic" id="id8">*</span></a>/</p>
</dd>
<dt>def toEditHydrator: EditHydrator[A, C] =</dt><dd><p>EditHydrator[A, C] { (a, ctx) =&gt; this.run(a, ctx).map(value =&gt; EditState(_ =&gt; value)) }</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Chains two ValueHydrators in sequence.</p></li>
</ul>
<p><a href="#id9"><span class="problematic" id="id10">*</span></a>/</p>
</dd>
<dt>def andThen(next: ValueHydrator[A, C]): ValueHydrator[A, C] =</dt><dd><dl>
<dt>ValueHydrator[A, C] { (x0, ctx) =&gt;</dt><dd><dl class="simple">
<dt>for {</dt><dd><p>r1 &lt;- run(x0, ctx)
r2 &lt;- next.run(r1.value, ctx)</p>
</dd>
<dt>} yield {</dt><dd><p>ValueState(r2.value, r1.state ++ r2.state)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Executes this ValueHydrator conditionally based on a Gate.</p></li>
</ul>
<p><a href="#id11"><span class="problematic" id="id12">*</span></a>/</p>
</dd>
<dt>def ifEnabled(gate: Gate[Unit]): ValueHydrator[A, C] =</dt><dd><p>onlyIf((_, _) =&gt; gate())</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Executes this ValueHydrator conditionally based on a boolean function.</p></li>
</ul>
<p><a href="#id13"><span class="problematic" id="id14">*</span></a>/</p>
</dd>
<dt>def onlyIf(cond: (A, C) =&gt; Boolean): ValueHydrator[A, C] =</dt><dd><dl>
<dt>ValueHydrator { (a, c) =&gt;</dt><dd><dl class="simple">
<dt>if (cond(a, c)) {</dt><dd><p>run(a, c)</p>
</dd>
<dt>} else {</dt><dd><p>Stitch.value(ValueState.unit(a))</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Converts a ValueHydrator of input type <cite>A</cite> to input type <cite>Option[A]</cite>.</p></li>
</ul>
<p><a href="#id15"><span class="problematic" id="id16">*</span></a>/</p>
</dd>
<dt>def liftOption: ValueHydrator[Option[A], C] =</dt><dd><p>liftOption(None)</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Converts a ValueHydrator of input type <cite>A</cite> to input type <cite>Option[A]</cite> with a</p></li>
<li><p>default input value.</p></li>
</ul>
<p><a href="#id17"><span class="problematic" id="id18">*</span></a>/</p>
</dd>
<dt>def liftOption(default: A): ValueHydrator[Option[A], C] =</dt><dd><p>liftOption(Some(default))</p>
</dd>
<dt>private def liftOption(default: Option[A]): ValueHydrator[Option[A], C] = {</dt><dd><p>val none = Stitch.value(ValueState.unit(None))</p>
<dl>
<dt>ValueHydrator[Option[A], C] { (a, ctx) =&gt;</dt><dd><dl class="simple">
<dt>a.orElse(default) match {</dt><dd><p>case Some(a) =&gt; this.run(a, ctx).map(s =&gt; s.map(Some.apply))
case None =&gt; none</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Converts a ValueHydrator of input type <cite>A</cite> to input type <cite>Seq[A]</cite>.</p></li>
</ul>
<p><a href="#id19"><span class="problematic" id="id20">*</span></a>/</p>
</dd>
<dt>def liftSeq: ValueHydrator[Seq[A], C] =</dt><dd><dl class="simple">
<dt>ValueHydrator[Seq[A], C] { (as, ctx) =&gt;</dt><dd><p>Stitch.traverse(as)(a =&gt; run(a, ctx)).map(rs =&gt; ValueState.sequence[A](rs))</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Produces a new ValueHydrator that collects stats on the hydration.</p></li>
</ul>
<p><a href="#id21"><span class="problematic" id="id22">*</span></a>/</p>
</dd>
<dt>def observe(</dt><dd><p>stats: StatsReceiver,
mkExceptionCounter: (StatsReceiver, String) =&gt; ExceptionCounter = (stats, scope) =&gt;</p>
<blockquote>
<div><p>new ExceptionCounter(stats, scope)</p>
</div></blockquote>
</dd>
<dt>): ValueHydrator[A, C] = {</dt><dd><p>val callCounter = stats.counter(“calls”)
val noopCounter = stats.counter(“noop”)
val modifiedCounter = stats.counter(“modified”)
val partialCounter = stats.counter(“partial”)
val completedCounter = stats.counter(“completed”)</p>
<p>val exceptionCounter = mkExceptionCounter(stats, “failures”)</p>
<dl>
<dt>ValueHydrator[A, C] { (a, ctx) =&gt;</dt><dd><dl>
<dt>this.run(a, ctx).respond {</dt><dd><dl>
<dt>case Return(ValueState(_, state)) =&gt;</dt><dd><p>callCounter.incr()</p>
<dl class="simple">
<dt>if (state.isEmpty) {</dt><dd><p>noopCounter.incr()</p>
</dd>
<dt>} else {</dt><dd><p>if (state.modified) modifiedCounter.incr()
if (state.failedFields.nonEmpty) partialCounter.incr()
if (state.completedHydrations.nonEmpty) completedCounter.incr()</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>case Throw(ex) =&gt;</dt><dd><p>callCounter.incr()
exceptionCounter(ex)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Produces a new ValueHydrator that uses a lens to extract the value to hydrate,</p></li>
<li><p>using this hydrator, and then to put the updated value back in the enclosing struct.</p></li>
</ul>
<p><a href="#id23"><span class="problematic" id="id24">*</span></a>/</p>
</dd>
<dt>def lensed[B](lens: Lens[B, A]): ValueHydrator[B, C] =</dt><dd><dl>
<dt>ValueHydrator[B, C] { (b, ctx) =&gt;</dt><dd><dl class="simple">
<dt>this.run(lens.get(b), ctx).map {</dt><dd><dl class="simple">
<dt>case ValueState(value, state) =&gt;</dt><dd><p>ValueState(lens.set(b, value), state)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
</div></blockquote>
<p>}</p>
<p>object ValueHydrator {</p>
<blockquote>
<div><dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Create a ValueHydrator from a function that returns Stitch[ValueState[A]]</p></li>
</ul>
<p><a href="#id25"><span class="problematic" id="id26">*</span></a>/</p>
</dd>
<dt>def apply[A, C](f: (A, C) =&gt; Stitch[ValueState[A]]): ValueHydrator[A, C] =</dt><dd><p>new ValueHydrator[A, C](f)</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Produces a ValueState instance with the given value and an empty HydrationState</p></li>
</ul>
<p><a href="#id27"><span class="problematic" id="id28">*</span></a>/</p>
</dd>
<dt>def unit[A, C]: ValueHydrator[A, C] =</dt><dd><p>ValueHydrator { (a, _) =&gt; Stitch.value(ValueState.unit(a)) }</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Runs several ValueHydrators in sequence.</p></li>
</ul>
<p><a href="#id29"><span class="problematic" id="id30">*</span></a>/</p>
</dd>
<dt>def inSequence[A, C](bs: ValueHydrator[A, C]*): ValueHydrator[A, C] =</dt><dd><dl class="simple">
<dt>bs match {</dt><dd><p>case Seq(b) =&gt; b
case Seq(b1, b2) =&gt; b1.andThen(b2)
case _ =&gt; bs.reduceLeft(_.andThen(_))</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Creates a <cite>ValueHydrator</cite> from a Mutation.  If the mutation returns None (indicating</p></li>
<li><p>no change) the hydrator will return an ValueState.unmodified with the input value;</p></li>
<li><p>otherwise, it will return an ValueState.modified with the mutated value.</p></li>
<li><p>If the mutation throws an exception, it will be caught and lifted to Stitch.exception.</p></li>
</ul>
<p><a href="#id31"><span class="problematic" id="id32">*</span></a>/</p>
</dd>
<dt>def fromMutation[A, C](mutation: Mutation[A]): ValueHydrator[A, C] =</dt><dd><dl>
<dt>ValueHydrator[A, C] { (input, _) =&gt;</dt><dd><dl>
<dt>Stitch.const(</dt><dd><dl>
<dt>Try {</dt><dd><dl class="simple">
<dt>mutation(input) match {</dt><dd><p>case None =&gt; ValueState.unmodified(input)
case Some(output) =&gt; ValueState.modified(output)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}</p>
</dd>
<dt>/**</dt><dd><ul class="simple">
<li><p>Creates a Hydrator from a non-<cite>Stitch</cite> producing function. If the function throws</p></li>
<li><p>an error it will be caught and converted to a Throw.</p></li>
</ul>
<p><a href="#id33"><span class="problematic" id="id34">*</span></a>/</p>
</dd>
<dt>def map[A, C](f: (A, C) =&gt; ValueState[A]): ValueHydrator[A, C] =</dt><dd><p>ValueHydrator[A, C] { (a, ctx) =&gt; Stitch.const(Try(f(a, ctx))) }</p>
</dd>
</dl>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../_sources/tweetypie/server/src/main/scala/com/twitter/tweetypie/hydrator/ValueHydrator.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>