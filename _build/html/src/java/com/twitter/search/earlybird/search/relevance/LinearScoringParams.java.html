<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../" id="documentation_options" src="../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.search.earlybird.search.relevance;</p>
<p>import java.util.Arrays;
import java.util.Map;</p>
<p>import com.google.common.annotations.VisibleForTesting;</p>
<p>import com.twitter.search.common.constants.SearchCardType;
import com.twitter.search.common.constants.thriftjava.ThriftLanguage;
import com.twitter.search.common.metrics.SearchCounter;
import com.twitter.search.common.ranking.thriftjava.ThriftAgeDecayRankingParams;
import com.twitter.search.common.ranking.thriftjava.ThriftCardRankingParams;
import com.twitter.search.common.ranking.thriftjava.ThriftRankingParams;
import com.twitter.search.common.util.lang.ThriftLanguageUtil;
import com.twitter.search.earlybird.thrift.ThriftSearchQuery;
import com.twitter.search.earlybird.thrift.ThriftSocialFilterType;</p>
<dl>
<dt>/*</dt><dd><ul class="simple">
<li><p>The class for all query specific parameters, including the parameters from the relevanceOptions and</p></li>
<li><p>values that are extracted from the request itself.</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
</dl>
<p>public class LinearScoringParams {</p>
<blockquote>
<div><p>public static final double DEFAULT_FEATURE_WEIGHT = 0;
public static final double DEFAULT_FEATURE_MIN_VAL = 0;
public static final double DEFAULT_NO_BOOST = 1.0;
&#64;VisibleForTesting
static final SearchCounter NULL_USER_LANGS_KEY =</p>
<blockquote>
<div><p>SearchCounter.export(“linear_scoring_params_null_user_langs_key”);</p>
</div></blockquote>
<p>public final double luceneWeight;
public final double textScoreWeight;
public final double textScoreMinVal;
public final double retweetWeight;
public final double retweetMinVal;
public final double favWeight;
public final double favMinVal;
public final double replyWeight;
public final double multipleReplyWeight;
public final double multipleReplyMinVal;
public final double isReplyWeight;
public final double parusWeight;
public final double embedsImpressionWeight;
public final double embedsUrlWeight;
public final double videoViewWeight;
public final double quotedCountWeight;</p>
<dl class="simple">
<dt>public final double[] rankingOfflineExpWeights =</dt><dd><p>new double[LinearScoringData.MAX_OFFLINE_EXPERIMENTAL_FIELDS];</p>
</dd>
</dl>
<p>public final boolean applyBoosts;</p>
<p>// Storing ranking params for cards, avoid using maps for faster lookup
public final double[] hasCardBoosts = new double[SearchCardType.values().length];
public final double[] cardDomainMatchBoosts = new double[SearchCardType.values().length];
public final double[] cardAuthorMatchBoosts = new double[SearchCardType.values().length];
public final double[] cardTitleMatchBoosts = new double[SearchCardType.values().length];
public final double[] cardDescriptionMatchBoosts = new double[SearchCardType.values().length];</p>
<p>public final double urlWeight;
public final double reputationWeight;
public final double reputationMinVal;
public final double followRetweetWeight;
public final double trustedRetweetWeight;</p>
<p>// Adjustments for specific tweets (tweetId -&gt; score)
public final Map&lt;Long, Double&gt; querySpecificScoreAdjustments;</p>
<p>// Adjustments for tweets posted by specific authors (userId -&gt; score)
public final Map&lt;Long, Double&gt; authorSpecificScoreAdjustments;</p>
<p>public final double offensiveDamping;
public final double spamUserDamping;
public final double nsfwUserDamping;
public final double botUserDamping;
public final double trustedCircleBoost;
public final double directFollowBoost;
public final double minScore;</p>
<p>public final boolean applyFiltersAlways;</p>
<p>public final boolean useLuceneScoreAsBoost;
public final double maxLuceneScoreBoost;</p>
<p>public final double langEnglishTweetDemote;
public final double langEnglishUIDemote;
public final double langDefaultDemote;
public final boolean useUserLanguageInfo;
public final double unknownLanguageBoost;</p>
<p>public final double outOfNetworkReplyPenalty;</p>
<p>public final boolean useAgeDecay;
public final double ageDecayHalflife;
public final double ageDecayBase;
public final double ageDecaySlope;</p>
<p>// hit attribute demotions
public final boolean enableHitDemotion;
public final double noTextHitDemotion;
public final double urlOnlyHitDemotion;
public final double nameOnlyHitDemotion;
public final double separateTextAndNameHitDemotion;
public final double separateTextAndUrlHitDemotion;</p>
<p>// trends related params
public final double tweetHasTrendBoost;
public final double multipleHashtagsOrTrendsDamping;</p>
<p>public final double tweetFromVerifiedAccountBoost;</p>
<p>public final double tweetFromBlueVerifiedAccountBoost;</p>
<p>public final ThriftSocialFilterType socialFilterType;
public final int uiLangId;
// Confidences of the understandability of different languages for this user.
public final double[] userLangs = new double[ThriftLanguage.values().length];</p>
<p>public final long searcherId;
public final double selfTweetBoost;</p>
<p>public final double tweetHasMediaUrlBoost;
public final double tweetHasNewsUrlBoost;</p>
<p>// whether we need meta-data for replies what the reply is to.
public final boolean getInReplyToStatusId;</p>
<p>// Initialize from a ranking parameter
public LinearScoringParams(ThriftSearchQuery searchQuery, ThriftRankingParams params) {</p>
<blockquote>
<div><p>// weights
luceneWeight = params.isSetLuceneScoreParams()</p>
<blockquote>
<div><p>? params.getLuceneScoreParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</div></blockquote>
<dl>
<dt>textScoreWeight = params.isSetTextScoreParams()</dt><dd><p>? params.getTextScoreParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>retweetWeight = params.isSetRetweetCountParams()</dt><dd><p>? params.getRetweetCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>favWeight = params.isSetFavCountParams()</dt><dd><p>? params.getFavCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>replyWeight = params.isSetReplyCountParams()</dt><dd><p>? params.getReplyCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>multipleReplyWeight = params.isSetMultipleReplyCountParams()</dt><dd><p>? params.getMultipleReplyCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>parusWeight = params.isSetParusScoreParams()</dt><dd><p>? params.getParusScoreParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>for (int i = 0; i &lt; LinearScoringData.MAX_OFFLINE_EXPERIMENTAL_FIELDS; i++) {</dt><dd><p>Byte featureTypeByte = (byte) i;
// default weight is 0, thus contribution for unset feature value will be 0.
rankingOfflineExpWeights[i] = params.getOfflineExperimentalFeatureRankingParamsSize() &gt; 0</p>
<blockquote>
<div><dl class="simple">
<dt>&amp;&amp; params.getOfflineExperimentalFeatureRankingParams().containsKey(featureTypeByte)</dt><dd><p>? params.getOfflineExperimentalFeatureRankingParams().get(featureTypeByte).getWeight()
: DEFAULT_FEATURE_WEIGHT;</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>}
embedsImpressionWeight = params.isSetEmbedsImpressionCountParams()</p>
<blockquote>
<div><p>? params.getEmbedsImpressionCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</div></blockquote>
<dl class="simple">
<dt>embedsUrlWeight = params.isSetEmbedsUrlCountParams()</dt><dd><p>? params.getEmbedsUrlCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>videoViewWeight = params.isSetVideoViewCountParams()</dt><dd><p>? params.getVideoViewCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>quotedCountWeight = params.isSetQuotedCountParams()</dt><dd><p>? params.getQuotedCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
</dl>
<p>applyBoosts = params.isApplyBoosts();</p>
<p>// configure card values
Arrays.fill(hasCardBoosts, DEFAULT_NO_BOOST);
Arrays.fill(cardAuthorMatchBoosts, DEFAULT_NO_BOOST);
Arrays.fill(cardDomainMatchBoosts, DEFAULT_NO_BOOST);
Arrays.fill(cardTitleMatchBoosts, DEFAULT_NO_BOOST);
Arrays.fill(cardDescriptionMatchBoosts, DEFAULT_NO_BOOST);
if (params.isSetCardRankingParams()) {</p>
<blockquote>
<div><dl>
<dt>for (SearchCardType cardType<span class="classifier">SearchCardType.values()) {</span></dt><dd><p>byte cardTypeIndex = cardType.getByteValue();
ThriftCardRankingParams rankingParams = params.getCardRankingParams().get(cardTypeIndex);
if (rankingParams != null) {</p>
<blockquote>
<div><p>hasCardBoosts[cardTypeIndex] = rankingParams.getHasCardBoost();
cardAuthorMatchBoosts[cardTypeIndex] = rankingParams.getAuthorMatchBoost();
cardDomainMatchBoosts[cardTypeIndex] = rankingParams.getDomainMatchBoost();
cardTitleMatchBoosts[cardTypeIndex] = rankingParams.getTitleMatchBoost();
cardDescriptionMatchBoosts[cardTypeIndex] = rankingParams.getDescriptionMatchBoost();</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<dl class="simple">
<dt>urlWeight = params.isSetUrlParams()</dt><dd><p>? params.getUrlParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>reputationWeight = params.isSetReputationParams()</dt><dd><p>? params.getReputationParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>isReplyWeight = params.isSetIsReplyParams()</dt><dd><p>? params.getIsReplyParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>followRetweetWeight = params.isSetDirectFollowRetweetCountParams()</dt><dd><p>? params.getDirectFollowRetweetCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
<dt>trustedRetweetWeight = params.isSetTrustedCircleRetweetCountParams()</dt><dd><p>? params.getTrustedCircleRetweetCountParams().getWeight() : DEFAULT_FEATURE_WEIGHT;</p>
</dd>
</dl>
<p>querySpecificScoreAdjustments = params.getQuerySpecificScoreAdjustments();
authorSpecificScoreAdjustments = params.getAuthorSpecificScoreAdjustments();</p>
<p>// min/max filters
textScoreMinVal = params.isSetTextScoreParams()</p>
<blockquote>
<div><p>? params.getTextScoreParams().getMin() : DEFAULT_FEATURE_MIN_VAL;</p>
</div></blockquote>
<dl class="simple">
<dt>reputationMinVal = params.isSetReputationParams()</dt><dd><p>? params.getReputationParams().getMin() : DEFAULT_FEATURE_MIN_VAL;</p>
</dd>
<dt>multipleReplyMinVal = params.isSetMultipleReplyCountParams()</dt><dd><p>? params.getMultipleReplyCountParams().getMin() : DEFAULT_FEATURE_MIN_VAL;</p>
</dd>
<dt>retweetMinVal = params.isSetRetweetCountParams() &amp;&amp; params.getRetweetCountParams().isSetMin()</dt><dd><p>? params.getRetweetCountParams().getMin() : DEFAULT_FEATURE_MIN_VAL;</p>
</dd>
<dt>favMinVal = params.isSetFavCountParams() &amp;&amp; params.getFavCountParams().isSetMin()</dt><dd><p>? params.getFavCountParams().getMin() : DEFAULT_FEATURE_MIN_VAL;</p>
</dd>
</dl>
<p>// boosts
spamUserDamping = params.isSetSpamUserBoost() ? params.getSpamUserBoost() : 1.0;
nsfwUserDamping = params.isSetNsfwUserBoost() ? params.getNsfwUserBoost() : 1.0;
botUserDamping = params.isSetBotUserBoost() ? params.getBotUserBoost() : 1.0;
offensiveDamping = params.getOffensiveBoost();
trustedCircleBoost = params.getInTrustedCircleBoost();
directFollowBoost = params.getInDirectFollowBoost();</p>
<p>// language boosts
langEnglishTweetDemote = params.getLangEnglishTweetBoost();
langEnglishUIDemote = params.getLangEnglishUIBoost();
langDefaultDemote = params.getLangDefaultBoost();
useUserLanguageInfo = params.isUseUserLanguageInfo();
unknownLanguageBoost = params.getUnknownLanguageBoost();</p>
<p>// hit demotions
enableHitDemotion = params.isEnableHitDemotion();
noTextHitDemotion = params.getNoTextHitDemotion();
urlOnlyHitDemotion = params.getUrlOnlyHitDemotion();
nameOnlyHitDemotion = params.getNameOnlyHitDemotion();
separateTextAndNameHitDemotion = params.getSeparateTextAndNameHitDemotion();
separateTextAndUrlHitDemotion = params.getSeparateTextAndUrlHitDemotion();</p>
<p>outOfNetworkReplyPenalty = params.getOutOfNetworkReplyPenalty();</p>
<dl>
<dt>if (params.isSetAgeDecayParams()) {</dt><dd><p>// new age decay settings
ThriftAgeDecayRankingParams ageDecayParams = params.getAgeDecayParams();
ageDecaySlope = ageDecayParams.getSlope();
ageDecayHalflife = ageDecayParams.getHalflife();
ageDecayBase = ageDecayParams.getBase();
useAgeDecay = true;</p>
</dd>
<dt>} else if (params.isSetDeprecatedAgeDecayBase()</dt><dd><blockquote>
<div><p>&amp;&amp; params.isSetDeprecatedAgeDecayHalflife()
&amp;&amp; params.isSetDeprecatedAgeDecaySlope()) {</p>
</div></blockquote>
<p>ageDecaySlope = params.getDeprecatedAgeDecaySlope();
ageDecayHalflife = params.getDeprecatedAgeDecayHalflife();
ageDecayBase = params.getDeprecatedAgeDecayBase();
useAgeDecay = true;</p>
</dd>
<dt>} else {</dt><dd><p>ageDecaySlope = 0.0;
ageDecayHalflife = 0.0;
ageDecayBase = 0.0;
useAgeDecay = false;</p>
</dd>
</dl>
<p>}</p>
<p>// trends
tweetHasTrendBoost = params.getTweetHasTrendBoost();
multipleHashtagsOrTrendsDamping = params.getMultipleHashtagsOrTrendsBoost();</p>
<p>// verified accounts
tweetFromVerifiedAccountBoost = params.getTweetFromVerifiedAccountBoost();
tweetFromBlueVerifiedAccountBoost = params.getTweetFromBlueVerifiedAccountBoost();</p>
<p>// score filter
minScore = params.getMinScore();</p>
<p>applyFiltersAlways = params.isApplyFiltersAlways();</p>
<p>useLuceneScoreAsBoost = params.isUseLuceneScoreAsBoost();
maxLuceneScoreBoost = params.getMaxLuceneScoreBoost();</p>
<p>searcherId = searchQuery.isSetSearcherId() ? searchQuery.getSearcherId() : -1;
selfTweetBoost = params.getSelfTweetBoost();</p>
<p>socialFilterType = searchQuery.getSocialFilterType();</p>
<p>// the UI language and the confidences of the languages user can understand.
if (!searchQuery.isSetUiLang() || searchQuery.getUiLang().isEmpty()) {</p>
<blockquote>
<div><p>uiLangId = ThriftLanguage.UNKNOWN.getValue();</p>
</div></blockquote>
<dl class="simple">
<dt>} else {</dt><dd><p>uiLangId = ThriftLanguageUtil.getThriftLanguageOf(searchQuery.getUiLang()).getValue();</p>
</dd>
</dl>
<p>}
if (searchQuery.getUserLangsSize() &gt; 0) {</p>
<blockquote>
<div><dl>
<dt>for (Map.Entry&lt;ThriftLanguage, Double&gt; lang<span class="classifier">searchQuery.getUserLangs().entrySet()) {</span></dt><dd><p>ThriftLanguage thriftLanguage = lang.getKey();
// SEARCH-13441
if (thriftLanguage != null) {</p>
<blockquote>
<div><p>userLangs[thriftLanguage.getValue()] = lang.getValue();</p>
</div></blockquote>
<dl class="simple">
<dt>} else {</dt><dd><p>NULL_USER_LANGS_KEY.increment();</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>// For now, we will use the same boost for both image, and video.
tweetHasMediaUrlBoost = params.getTweetHasImageUrlBoost();
tweetHasNewsUrlBoost = params.getTweetHasNewsUrlBoost();</p>
<dl class="simple">
<dt>getInReplyToStatusId =</dt><dd><dl class="simple">
<dt>searchQuery.isSetResultMetadataOptions()</dt><dd><p>&amp;&amp; searchQuery.getResultMetadataOptions().isSetGetInReplyToStatusId()
&amp;&amp; searchQuery.getResultMetadataOptions().isGetInReplyToStatusId();</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../_sources/src/java/com/twitter/search/earlybird/search/relevance/LinearScoringParams.java.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>