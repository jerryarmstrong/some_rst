<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../" id="documentation_options" src="../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.search.earlybird.search.relevance;</p>
<p>import java.util.Arrays;
import java.util.List;</p>
<p>import com.google.common.collect.Lists;</p>
<p>import com.twitter.search.common.constants.SearchCardType;
import com.twitter.search.common.constants.thriftjava.ThriftLanguage;</p>
<dl>
<dt>public class LinearScoringData {</dt><dd><p>public static final float NO_BOOST_VALUE = 1.0f;</p>
<p>// A signal value so we can tell if something is unset, also used in explanation.
public static final int UNSET_SIGNAL_VALUE = -999;</p>
<p>//This is somewhat arbitrary, and is here so that we have some limit on
//how many offline experimental features we support per query
public static final int MAX_OFFLINE_EXPERIMENTAL_FIELDS = 5;</p>
<dl class="simple">
<dt>public enum SkipReason {</dt><dd><p>NOT_SKIPPED,
ANTIGAMING,
LOW_REPUTATION,
LOW_TEXT_SCORE,
LOW_RETWEET_COUNT,
LOW_FAV_COUNT,
SOCIAL_FILTER,
LOW_FINAL_SCORE</p>
</dd>
</dl>
<p>}</p>
<p>// When you add fields here, make sure you also update the clear() function.
public double luceneScore;
public double textScore;
//I am not sure why this has to be double…
public double tokenAt140DividedByNumTokensBucket;
public double userRep;
public double parusScore;
public final double[] offlineExpFeatureValues = new double[MAX_OFFLINE_EXPERIMENTAL_FIELDS];</p>
<p>// v1 engagement counters
public double retweetCountPostLog2;
public double favCountPostLog2;
public double replyCountPostLog2;
public double embedsImpressionCount;
public double embedsUrlCount;
public double videoViewCount;</p>
<p>// v2 engagement counters (that have a v1 counter part)
public double retweetCountV2;
public double favCountV2;
public double replyCountV2;
public double embedsImpressionCountV2;
public double embedsUrlCountV2;
public double videoViewCountV2;
// pure v2 engagement counters, they started v2 only
public double quotedCount;
public double weightedRetweetCount;
public double weightedReplyCount;
public double weightedFavCount;
public double weightedQuoteCount;</p>
<p>// card related properties
public boolean hasCard;
public byte cardType;</p>
<p>public boolean hasUrl;
public boolean isReply;
public boolean isRetweet;
public boolean isOffensive;
public boolean hasTrend;
public boolean isFromVerifiedAccount;
public boolean isFromBlueVerifiedAccount;
public boolean isUserSpam;
public boolean isUserNSFW;
public boolean isUserBot;
public boolean isUserAntiSocial;
public boolean hasVisibleLink;</p>
<p>public double luceneContrib;
public double reputationContrib;
public double textScoreContrib;
public double favContrib;
public double replyContrib;
public double multipleReplyContrib;
public double retweetContrib;
public double parusContrib;
public final double[] offlineExpFeatureContributions =</p>
<blockquote>
<div><p>new double[MAX_OFFLINE_EXPERIMENTAL_FIELDS];</p>
</div></blockquote>
<p>public double embedsImpressionContrib;
public double embedsUrlContrib;
public double videoViewContrib;
public double quotedContrib;</p>
<p>public double hasUrlContrib;
public double isReplyContrib;
public double isFollowRetweetContrib;
public double isTrustedRetweetContrib;</p>
<p>// Value passed in the request (ThriftRankingParams.querySpecificScoreAdjustments)
public double querySpecificScore;</p>
<p>// Value passed in the request (ThriftRankingParams.authorSpecificScoreAdjustments)
public double authorSpecificScore;</p>
<p>public double normalizedLuceneScore;</p>
<p>public int tweetLangId;
public double uiLangMult;
public double userLangMult;
public boolean hasDifferentLang;
public boolean hasEnglishTweetAndDifferentUILang;
public boolean hasEnglishUIAndDifferentTweetLang;</p>
<p>public int tweetAgeInSeconds;
public double ageDecayMult;</p>
<p>// Intermediate scores
public double scoreBeforeBoost;
public double scoreAfterBoost;
public double scoreFinal;
public double scoreReturned;</p>
<p>public SkipReason skipReason;</p>
<p>public boolean isTrusted;
public boolean isFollow;
public boolean spamUserDampApplied;
public boolean nsfwUserDampApplied;
public boolean botUserDampApplied;
public boolean trustedCircleBoostApplied;
public boolean directFollowBoostApplied;
public boolean outOfNetworkReplyPenaltyApplied;
public boolean hasMultipleHashtagsOrTrends;</p>
<p>public boolean tweetHasTrendsBoostApplied;
public boolean tweetFromVerifiedAccountBoostApplied;
public boolean tweetFromBlueVerifiedAccountBoostApplied;
public boolean hasCardBoostApplied;
public boolean cardDomainMatchBoostApplied;
public boolean cardAuthorMatchBoostApplied;
public boolean cardTitleMatchBoostApplied;
public boolean cardDescriptionMatchBoostApplied;</p>
<p>public List&lt;String&gt; hitFields;
public boolean hasNoTextHitDemotionApplied;
public boolean hasUrlOnlyHitDemotionApplied;
public boolean hasNameOnlyHitDemotionApplied;
public boolean hasSeparateTextAndNameHitDemotionApplied;
public boolean hasSeparateTextAndUrlHitDemotionApplied;</p>
<p>public long fromUserId;
// This is actually retweet status ID, or the ID of the original tweet being (natively) retweeted
public long sharedStatusId;
public long referenceAuthorId; // SEARCH-8564</p>
<p>public boolean isSelfTweet;
public boolean selfTweetBoostApplied;
public double selfTweetMult;</p>
<p>public boolean hasImageUrl;
public boolean hasVideoUrl;
public boolean hasMedialUrlBoostApplied;
public boolean hasNewsUrl;
public boolean hasNewsUrlBoostApplied;</p>
<p>public boolean hasConsumerVideo;
public boolean hasProVideo;
public boolean hasVine;
public boolean hasPeriscope;
public boolean hasNativeImage;
public boolean isNullcast;
public boolean hasQuote;</p>
<p>public boolean isSensitiveContent;
public boolean hasMultipleMediaFlag;
public boolean profileIsEggFlag;
public boolean isUserNewFlag;</p>
<p>public int numMentions;
public int numHashtags;
public int linkLanguage;
public int prevUserTweetEngagement;</p>
<p>public boolean isComposerSourceCamera;</p>
<p>// health model scores by HML
public double toxicityScore; // go/toxicity
public double pBlockScore; // go/pblock
public double pSpammyTweetScore; // go/pspammytweet
public double pReportedTweetScore; // go/preportedtweet
public double spammyTweetContentScore; // go/spammy-tweet-content
public double experimentalHealthModelScore1;
public double experimentalHealthModelScore2;
public double experimentalHealthModelScore3;
public double experimentalHealthModelScore4;</p>
<dl class="simple">
<dt>public LinearScoringData() {</dt><dd><p>hitFields = Lists.newArrayList();
clear();</p>
</dd>
</dl>
<p>}</p>
<p>// the following three counters were added later and they got denormalized in standard way,
// you can choose to apply scalding (for legacy LinearScoringFunction) or
// not apply (for returning in metadata and display in debug).
public double getEmbedsImpressionCount(boolean scaleForScoring) {</p>
<blockquote>
<div><p>return scaleForScoring ? logWith0(embedsImpressionCount) : embedsImpressionCount;</p>
</div></blockquote>
<p>}
public double getEmbedsUrlCount(boolean scaleForScoring) {</p>
<blockquote>
<div><p>return scaleForScoring ? logWith0(embedsUrlCount) : embedsUrlCount;</p>
</div></blockquote>
<p>}
public double getVideoViewCount(boolean scaleForScoring) {</p>
<blockquote>
<div><p>return scaleForScoring ? logWith0(videoViewCount) : videoViewCount;</p>
</div></blockquote>
<p>}
private static double logWith0(double value) {</p>
<blockquote>
<div><p>return value &gt; 0 ? Math.log(value) : 0.0;</p>
</div></blockquote>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Returns a string description of all data stored in this instance.</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
<dt>public String getPropertyExplanation() {</dt><dd><p>StringBuilder sb = new StringBuilder();
sb.append(hasCard ? “CARD “ + SearchCardType.cardTypeFromByteValue(cardType) : “”);
sb.append(hasUrl ? “URL “ : “”);
sb.append(isReply ? “REPLY “ : “”);
sb.append(isRetweet ? “RETWEET “ : “”);
sb.append(isOffensive ? “OFFENSIVE “ : “”);
sb.append(hasTrend ? “TREND “ : “”);
sb.append(hasMultipleHashtagsOrTrends ? “HASHTAG/TREND+ “ : “”);
sb.append(isFromVerifiedAccount ? “VERIFIED “ : “”);
sb.append(isFromBlueVerifiedAccount ? “BLUE_VERIFIED “ : “”);
sb.append(isUserSpam ? “SPAM “ : “”);
sb.append(isUserNSFW ? “NSFW “ : “”);
sb.append(isUserBot ? “BOT “ : “”);
sb.append(isUserAntiSocial ? “ANTISOCIAL “ : “”);
sb.append(isTrusted ? “TRUSTED “ : “”);
sb.append(isFollow ? “FOLLOW “ : “”);
sb.append(isSelfTweet ? “SELF “ : “”);
sb.append(hasImageUrl ? “IMAGE “ : “”);
sb.append(hasVideoUrl ? “VIDEO “ : “”);
sb.append(hasNewsUrl ? “NEWS “ : “”);
sb.append(isNullcast ? “NULLCAST” : “”);
sb.append(hasQuote ? “QUOTE” : “”);
sb.append(isComposerSourceCamera ? “Composer Source: CAMERA” : “”);
sb.append(favCountPostLog2 &gt; 0 ? “Faves:” + favCountPostLog2 + “ “ : “”);
sb.append(retweetCountPostLog2 &gt; 0 ? “Retweets:” + retweetCountPostLog2 + “ “ : “”);
sb.append(replyCountPostLog2 &gt; 0 ? “Replies:” + replyCountPostLog2 + “ “ : “”);
sb.append(getEmbedsImpressionCount(false) &gt; 0</p>
<blockquote>
<div><p>? “Embedded Imps:” + getEmbedsImpressionCount(false) + “ “ : “”);</p>
</div></blockquote>
<dl class="simple">
<dt>sb.append(getEmbedsUrlCount(false) &gt; 0</dt><dd><p>? “Embedded Urls:” + getEmbedsUrlCount(false) + “ “ : “”);</p>
</dd>
<dt>sb.append(getVideoViewCount(false) &gt; 0</dt><dd><p>? “Video views:” + getVideoViewCount(false) + “ “ : “”);</p>
</dd>
<dt>sb.append(weightedRetweetCount &gt; 0 ? “Weighted Retweets:”</dt><dd><ul class="simple">
<li><p>((int) weightedRetweetCount) + “ “ : “”);</p></li>
</ul>
</dd>
<dt>sb.append(weightedReplyCount &gt; 0</dt><dd><p>? “Weighted Replies:” + ((int) weightedReplyCount) + “ “ : “”);</p>
</dd>
<dt>sb.append(weightedFavCount &gt; 0</dt><dd><p>? “Weighted Faves:” + ((int) weightedFavCount) + “ “ : “”);</p>
</dd>
<dt>sb.append(weightedQuoteCount &gt; 0</dt><dd><p>? “Weighted Quotes:” + ((int) weightedQuoteCount) + “ “ : “”);</p>
</dd>
</dl>
<p>return sb.toString();</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Resets all data stored in this instance.</p></li>
</ul>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
</dd>
<dt>public void clear() {</dt><dd><p>luceneScore = UNSET_SIGNAL_VALUE;
textScore = UNSET_SIGNAL_VALUE;
tokenAt140DividedByNumTokensBucket = UNSET_SIGNAL_VALUE;
userRep = UNSET_SIGNAL_VALUE;
retweetCountPostLog2 = UNSET_SIGNAL_VALUE;
favCountPostLog2 = UNSET_SIGNAL_VALUE;
replyCountPostLog2 = UNSET_SIGNAL_VALUE;
parusScore = UNSET_SIGNAL_VALUE;
Arrays.fill(offlineExpFeatureValues, 0);
embedsImpressionCount = UNSET_SIGNAL_VALUE;
embedsUrlCount = UNSET_SIGNAL_VALUE;
videoViewCount = UNSET_SIGNAL_VALUE;
// v2 engagement, these each have a v1 counterpart
retweetCountV2 = UNSET_SIGNAL_VALUE;
favCountV2 = UNSET_SIGNAL_VALUE;
replyCountV2 = UNSET_SIGNAL_VALUE;
embedsImpressionCountV2 = UNSET_SIGNAL_VALUE;
embedsUrlCountV2 = UNSET_SIGNAL_VALUE;
videoViewCountV2 = UNSET_SIGNAL_VALUE;
// new engagement counters, they only have one version with the v2 normalizer
quotedCount = UNSET_SIGNAL_VALUE;
weightedRetweetCount = UNSET_SIGNAL_VALUE;
weightedReplyCount = UNSET_SIGNAL_VALUE;
weightedFavCount = UNSET_SIGNAL_VALUE;
weightedQuoteCount = UNSET_SIGNAL_VALUE;</p>
<p>hasUrl = false;
isReply = false;
isRetweet = false;
isOffensive = false;
hasTrend = false;
isFromVerifiedAccount = false;
isFromBlueVerifiedAccount = false;
isUserSpam = false;
isUserNSFW = false;
isUserBot = false;
isUserAntiSocial = false;
hasVisibleLink = false;
isNullcast = false;</p>
<p>luceneContrib = UNSET_SIGNAL_VALUE;
reputationContrib = UNSET_SIGNAL_VALUE;
textScoreContrib = UNSET_SIGNAL_VALUE;
replyContrib = UNSET_SIGNAL_VALUE;
multipleReplyContrib = UNSET_SIGNAL_VALUE;
retweetContrib = UNSET_SIGNAL_VALUE;
favContrib = UNSET_SIGNAL_VALUE;
parusContrib = UNSET_SIGNAL_VALUE;
Arrays.fill(offlineExpFeatureContributions, 0);
embedsImpressionContrib = UNSET_SIGNAL_VALUE;
embedsUrlContrib = UNSET_SIGNAL_VALUE;
videoViewContrib = UNSET_SIGNAL_VALUE;
hasUrlContrib = UNSET_SIGNAL_VALUE;
isReplyContrib = UNSET_SIGNAL_VALUE;</p>
<p>querySpecificScore = UNSET_SIGNAL_VALUE;
authorSpecificScore = UNSET_SIGNAL_VALUE;</p>
<p>normalizedLuceneScore = NO_BOOST_VALUE;</p>
<p>tweetLangId = ThriftLanguage.UNKNOWN.getValue();
uiLangMult = NO_BOOST_VALUE;
userLangMult = NO_BOOST_VALUE;
hasDifferentLang = false;
hasEnglishTweetAndDifferentUILang = false;
hasEnglishUIAndDifferentTweetLang = false;</p>
<p>tweetAgeInSeconds = 0;
ageDecayMult = NO_BOOST_VALUE;</p>
<p>// Intermediate scores
scoreBeforeBoost = UNSET_SIGNAL_VALUE;
scoreAfterBoost = UNSET_SIGNAL_VALUE;
scoreFinal = UNSET_SIGNAL_VALUE;
scoreReturned = UNSET_SIGNAL_VALUE;</p>
<p>skipReason = SkipReason.NOT_SKIPPED;</p>
<p>isTrusted = false;  // Set later
isFollow = false; // Set later
trustedCircleBoostApplied = false;
directFollowBoostApplied = false;
outOfNetworkReplyPenaltyApplied = false;
hasMultipleHashtagsOrTrends = false;
spamUserDampApplied = false;
nsfwUserDampApplied = false;
botUserDampApplied = false;</p>
<p>tweetHasTrendsBoostApplied = false;
tweetFromVerifiedAccountBoostApplied = false;
tweetFromBlueVerifiedAccountBoostApplied = false;</p>
<p>fromUserId = UNSET_SIGNAL_VALUE;
sharedStatusId = UNSET_SIGNAL_VALUE;
referenceAuthorId = UNSET_SIGNAL_VALUE;</p>
<p>isSelfTweet = false;
selfTweetBoostApplied = false;
selfTweetMult = NO_BOOST_VALUE;</p>
<p>trustedCircleBoostApplied = false;
directFollowBoostApplied = false;</p>
<p>hasImageUrl = false;
hasVideoUrl = false;
hasMedialUrlBoostApplied = false;
hasNewsUrl = false;
hasNewsUrlBoostApplied = false;</p>
<p>hasCard = false;
cardType = SearchCardType.UNKNOWN.getByteValue();
hasCardBoostApplied = false;
cardDomainMatchBoostApplied = false;
cardAuthorMatchBoostApplied = false;
cardTitleMatchBoostApplied = false;
cardDescriptionMatchBoostApplied = false;</p>
<p>hitFields.clear();
hasNoTextHitDemotionApplied = false;
hasUrlOnlyHitDemotionApplied = false;
hasNameOnlyHitDemotionApplied = false;
hasSeparateTextAndNameHitDemotionApplied = false;
hasSeparateTextAndUrlHitDemotionApplied = false;</p>
<p>hasConsumerVideo = false;
hasProVideo = false;
hasVine = false;
hasPeriscope = false;
hasNativeImage = false;</p>
<p>isSensitiveContent = false;
hasMultipleMediaFlag = false;
profileIsEggFlag = false;
numMentions = 0;
numHashtags = 0;
isUserNewFlag = false;
linkLanguage = 0;
prevUserTweetEngagement = 0;</p>
<p>isComposerSourceCamera = false;</p>
<p>// health model scores by HML
toxicityScore = UNSET_SIGNAL_VALUE;
pBlockScore = UNSET_SIGNAL_VALUE;
pSpammyTweetScore = UNSET_SIGNAL_VALUE;
pReportedTweetScore = UNSET_SIGNAL_VALUE;
spammyTweetContentScore = UNSET_SIGNAL_VALUE;
experimentalHealthModelScore1 = UNSET_SIGNAL_VALUE;
experimentalHealthModelScore2 = UNSET_SIGNAL_VALUE;
experimentalHealthModelScore3 = UNSET_SIGNAL_VALUE;
experimentalHealthModelScore4 = UNSET_SIGNAL_VALUE;</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../_sources/src/java/com/twitter/search/earlybird/search/relevance/LinearScoringData.java.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>