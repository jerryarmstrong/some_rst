<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../" id="documentation_options" src="../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.search.common.relevance.features;</p>
<p>import java.util.Map;
import java.util.Set;
import javax.annotation.Nullable;</p>
<p>import com.google.common.base.Preconditions;
import com.google.common.collect.ImmutableMap;
import com.google.common.collect.ImmutableSet;</p>
<p>import com.twitter.search.common.encoding.features.IntNormalizer;
import com.twitter.search.common.schema.earlybird.EarlybirdFieldConstants;</p>
<p>import static com.twitter.search.common.relevance.features.IntNormalizers.BOOLEAN_NORMALIZER;
import static com.twitter.search.common.relevance.features.IntNormalizers.LEGACY_NORMALIZER;
import static com.twitter.search.common.relevance.features.IntNormalizers.PARUS_SCORE_NORMALIZER;
import static com.twitter.search.common.relevance.features.IntNormalizers.SMART_INTEGER_NORMALIZER;
import static com.twitter.search.common.relevance.features.IntNormalizers.TIMESTAMP_SEC_TO_HR_NORMALIZER;
import static com.twitter.search.common.schema.earlybird.EarlybirdFieldConstants.EarlybirdFieldConstant;</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>An enum to represent all dynamic/realtime feature types we can update in the Signal Ingester.</p></li>
<li><p>It provides information for their normalization and their corresponding earlybird feature fields</p></li>
<li><p>and provides utils both producer (Signal Ingester) and consumer (Earlybird) side.</p></li>
<li></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
<dt>public enum TweetFeatureType {</dt><dd><dl class="simple">
<dt>RETWEET                         (true,  0,  LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.RETWEET_COUNT),</p>
</dd>
<dt>REPLY                           (true,  1,  LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.REPLY_COUNT),</p>
</dd>
<dt>FAVORITE                        (true,  4,  LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.FAVORITE_COUNT),</p>
</dd>
<dt>PARUS_SCORE                     (false, 3,  PARUS_SCORE_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PARUS_SCORE),</p>
</dd>
<dt>EMBEDS_IMP_COUNT                (true,  10, LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.EMBEDS_IMPRESSION_COUNT),</p>
</dd>
<dt>EMBEDS_URL_COUNT                (true,  11, LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.EMBEDS_URL_COUNT),</p>
</dd>
<dt>VIDEO_VIEW                      (false, 12, LEGACY_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.VIDEO_VIEW_COUNT),</p>
</dd>
</dl>
<p>// v2 engagement counters, they will eventually replace v1 counters above
RETWEET_V2                      (true,  13, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.RETWEET_COUNT_V2),</p>
</div></blockquote>
<dl class="simple">
<dt>REPLY_V2                        (true,  14, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.REPLY_COUNT_V2),</p>
</dd>
<dt>FAVORITE_V2                     (true,  15, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.FAVORITE_COUNT_V2),</p>
</dd>
<dt>EMBEDS_IMP_COUNT_V2             (true,  16, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.EMBEDS_IMPRESSION_COUNT_V2),</p>
</dd>
<dt>EMBEDS_URL_COUNT_V2             (true,  17, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.EMBEDS_URL_COUNT_V2),</p>
</dd>
<dt>VIDEO_VIEW_V2                   (false, 18, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.VIDEO_VIEW_COUNT_V2),</p>
</dd>
</dl>
<p>// other new items
QUOTE                           (true,  19, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.QUOTE_COUNT),</p>
</div></blockquote>
<p>// weighted engagement counters
WEIGHTED_RETWEET                (true,  20, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.WEIGHTED_RETWEET_COUNT),</p>
</div></blockquote>
<dl class="simple">
<dt>WEIGHTED_REPLY                  (true,  21, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.WEIGHTED_REPLY_COUNT),</p>
</dd>
<dt>WEIGHTED_FAVORITE               (true,  22, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.WEIGHTED_FAVORITE_COUNT),</p>
</dd>
<dt>WEIGHTED_QUOTE                  (true,  23, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.WEIGHTED_QUOTE_COUNT),</p>
</dd>
</dl>
<p>// tweet-level safety labels
LABEL_ABUSIVE                   (false, 24, BOOLEAN_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.LABEL_ABUSIVE_FLAG),</p>
</div></blockquote>
<dl class="simple">
<dt>LABEL_ABUSIVE_HI_RCL            (false, 25, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_ABUSIVE_HI_RCL_FLAG),</p>
</dd>
<dt>LABEL_DUP_CONTENT               (false, 26, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_DUP_CONTENT_FLAG),</p>
</dd>
<dt>LABEL_NSFW_HI_PRC               (false, 27, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_NSFW_HI_PRC_FLAG),</p>
</dd>
<dt>LABEL_NSFW_HI_RCL               (false, 28, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_NSFW_HI_RCL_FLAG),</p>
</dd>
<dt>LABEL_SPAM                      (false, 29, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_SPAM_FLAG),</p>
</dd>
<dt>LABEL_SPAM_HI_RCL               (false, 30, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LABEL_SPAM_HI_RCL_FLAG),</p>
</dd>
<dt>PERISCOPE_EXISTS                (false, 32, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PERISCOPE_EXISTS),</p>
</dd>
<dt>PERISCOPE_HAS_BEEN_FEATURED     (false, 33, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PERISCOPE_HAS_BEEN_FEATURED),</p>
</dd>
<dt>PERISCOPE_IS_CURRENTLY_FEATURED (false, 34, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PERISCOPE_IS_CURRENTLY_FEATURED),</p>
</dd>
<dt>PERISCOPE_IS_FROM_QUALITY_SOURCE(false, 35, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PERISCOPE_IS_FROM_QUALITY_SOURCE),</p>
</dd>
<dt>PERISCOPE_IS_LIVE               (false, 36, BOOLEAN_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.PERISCOPE_IS_LIVE),</p>
</dd>
</dl>
<p>// decayed engagement counters
DECAYED_RETWEET                 (true,  37, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.DECAYED_RETWEET_COUNT),</p>
</div></blockquote>
<dl class="simple">
<dt>DECAYED_REPLY                   (true,  38, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.DECAYED_REPLY_COUNT),</p>
</dd>
<dt>DECAYED_FAVORITE                (true,  39, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.DECAYED_FAVORITE_COUNT),</p>
</dd>
<dt>DECAYED_QUOTE                   (true,  40, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.DECAYED_QUOTE_COUNT),</p>
</dd>
</dl>
<p>// timestamp of last engagement types
LAST_RETWEET_SINCE_CREATION_HR  (false, 41, TIMESTAMP_SEC_TO_HR_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.LAST_RETWEET_SINCE_CREATION_HRS),</p>
</div></blockquote>
<dl class="simple">
<dt>LAST_REPLY_SINCE_CREATION_HR    (false, 42, TIMESTAMP_SEC_TO_HR_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LAST_REPLY_SINCE_CREATION_HRS),</p>
</dd>
<dt>LAST_FAVORITE_SINCE_CREATION_HR (false, 43, TIMESTAMP_SEC_TO_HR_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LAST_FAVORITE_SINCE_CREATION_HRS),</p>
</dd>
<dt>LAST_QUOTE_SINCE_CREATION_HR    (false, 44, TIMESTAMP_SEC_TO_HR_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.LAST_QUOTE_SINCE_CREATION_HRS),</p>
</dd>
</dl>
<p>// fake engagement counters
FAKE_RETWEET                    (true,  45, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.FAKE_RETWEET_COUNT),</p>
</div></blockquote>
<dl class="simple">
<dt>FAKE_REPLY                      (true,  46, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.FAKE_REPLY_COUNT),</p>
</dd>
<dt>FAKE_FAVORITE                   (true,  47, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.FAKE_FAVORITE_COUNT),</p>
</dd>
<dt>FAKE_QUOTE                      (true,  48, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.FAKE_QUOTE_COUNT),</p>
</dd>
</dl>
<p>// blink engagement counters
BLINK_RETWEET                   (true,  49, SMART_INTEGER_NORMALIZER,</p>
<blockquote>
<div><p>EarlybirdFieldConstant.BLINK_RETWEET_COUNT),</p>
</div></blockquote>
<dl class="simple">
<dt>BLINK_REPLY                     (true,  50, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.BLINK_REPLY_COUNT),</p>
</dd>
<dt>BLINK_FAVORITE                  (true,  51, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.BLINK_FAVORITE_COUNT),</p>
</dd>
<dt>BLINK_QUOTE                     (true,  52, SMART_INTEGER_NORMALIZER,</dt><dd><p>EarlybirdFieldConstant.BLINK_QUOTE_COUNT),</p>
</dd>
</dl>
<p>/* semicolon in a single line to avoid polluting git blame <a href="#id3"><span class="problematic" id="id4">*</span></a>/;</p>
<dl>
<dt>private static final Map&lt;TweetFeatureType, TweetFeatureType&gt; V2_COUNTER_MAP =</dt><dd><dl class="simple">
<dt>ImmutableMap.&lt;TweetFeatureType, TweetFeatureType&gt;builder()</dt><dd><p>.put(RETWEET,          RETWEET_V2)
.put(REPLY,            REPLY_V2)
.put(FAVORITE,         FAVORITE_V2)
.put(EMBEDS_IMP_COUNT, EMBEDS_IMP_COUNT_V2)
.put(EMBEDS_URL_COUNT, EMBEDS_URL_COUNT_V2)
.put(VIDEO_VIEW,       VIDEO_VIEW_V2)</p>
</dd>
</dl>
<p>.build();</p>
</dd>
<dt>private static final Map&lt;TweetFeatureType, TweetFeatureType&gt; WEIGHTED_COUNTER_MAP =</dt><dd><dl class="simple">
<dt>ImmutableMap.&lt;TweetFeatureType, TweetFeatureType&gt;builder()</dt><dd><p>.put(RETWEET,          WEIGHTED_RETWEET)
.put(REPLY,            WEIGHTED_REPLY)
.put(FAVORITE,         WEIGHTED_FAVORITE)
.put(QUOTE,            WEIGHTED_QUOTE)
.build();</p>
</dd>
</dl>
</dd>
<dt>private static final Map&lt;TweetFeatureType, TweetFeatureType&gt; DECAYED_COUNTER_MAP =</dt><dd><dl class="simple">
<dt>ImmutableMap.&lt;TweetFeatureType, TweetFeatureType&gt;builder()</dt><dd><p>.put(RETWEET,          DECAYED_RETWEET)
.put(REPLY,            DECAYED_REPLY)
.put(FAVORITE,         DECAYED_FAVORITE)
.put(QUOTE,            DECAYED_QUOTE)
.build();</p>
</dd>
</dl>
</dd>
<dt>private static final Map&lt;TweetFeatureType, TweetFeatureType&gt; DECAYED_COUNTER_TO_ELAPSED_TIME =</dt><dd><dl class="simple">
<dt>ImmutableMap.&lt;TweetFeatureType, TweetFeatureType&gt;builder()</dt><dd><p>.put(DECAYED_RETWEET,  LAST_RETWEET_SINCE_CREATION_HR)
.put(DECAYED_REPLY,    LAST_REPLY_SINCE_CREATION_HR)
.put(DECAYED_FAVORITE, LAST_FAVORITE_SINCE_CREATION_HR)
.put(DECAYED_QUOTE,    LAST_QUOTE_SINCE_CREATION_HR)
.build();</p>
</dd>
</dl>
</dd>
<dt>private static final Set&lt;TweetFeatureType&gt; DECAYED_FEATURES =</dt><dd><p>ImmutableSet.of(DECAYED_RETWEET, DECAYED_REPLY, DECAYED_FAVORITE, DECAYED_QUOTE);</p>
</dd>
<dt>private static final Set&lt;TweetFeatureType&gt; FAKE_ENGAGEMENT_FEATURES =</dt><dd><p>ImmutableSet.of(FAKE_RETWEET, FAKE_REPLY, FAKE_FAVORITE, FAKE_QUOTE);</p>
</dd>
<dt>private static final Set&lt;TweetFeatureType&gt; BLINK_ENGAGEMENT_FEATURES =</dt><dd><p>ImmutableSet.of(BLINK_RETWEET, BLINK_REPLY, BLINK_FAVORITE, BLINK_QUOTE);</p>
</dd>
</dl>
<p>&#64;Nullable
public TweetFeatureType getV2Type() {</p>
<blockquote>
<div><p>return V2_COUNTER_MAP.get(this);</p>
</div></blockquote>
<p>}</p>
<p>&#64;Nullable
public static TweetFeatureType getWeightedType(TweetFeatureType type) {</p>
<blockquote>
<div><p>return WEIGHTED_COUNTER_MAP.get(type);</p>
</div></blockquote>
<p>}</p>
<p>&#64;Nullable
public static TweetFeatureType getDecayedType(TweetFeatureType type) {</p>
<blockquote>
<div><p>return DECAYED_COUNTER_MAP.get(type);</p>
</div></blockquote>
<p>}</p>
<p>// Whether this feature is incremental or direct value.
private final boolean incremental;</p>
<p>// This normalizer is used to (1) normalize the output value in DLIndexEventOutputBolt,
// (2) check value change.
private final IntNormalizer normalizer;</p>
<p>// value for composing cache key. It has to be unique and in increasing order.
private final int typeInt;</p>
<p>private final EarlybirdFieldConstants.EarlybirdFieldConstant earlybirdField;</p>
<p>private final IncrementChecker incrementChecker;</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Constructing an enum for a type. The earlybirdField can be null if it’s not prepared, they</p></li>
<li><p>can be here as placeholders but they can’t be outputted.</p></li>
<li><p>The normalizer is null for the timestamp features that do not require normalization</p></li>
</ul>
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
</dd>
<dt>TweetFeatureType(boolean incremental,</dt><dd><blockquote>
<div><p>int typeInt,
IntNormalizer normalizer,
&#64;Nullable EarlybirdFieldConstant earlybirdField) {</p>
</div></blockquote>
<p>this.incremental = incremental;
this.typeInt = typeInt;
this.normalizer = normalizer;
this.earlybirdField = earlybirdField;
this.incrementChecker = new IncrementChecker(this);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public boolean isIncremental() {</dt><dd><p>return incremental;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public IntNormalizer getNormalizer() {</dt><dd><p>return normalizer;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public int getTypeInt() {</dt><dd><p>return typeInt;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public int normalize(double value) {</dt><dd><p>return normalizer.normalize(value);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public IncrementChecker getIncrementChecker() {</dt><dd><p>return incrementChecker;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public EarlybirdFieldConstant getEarlybirdField() {</dt><dd><p>return Preconditions.checkNotNull(earlybirdField);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public boolean hasEarlybirdField() {</dt><dd><p>return earlybirdField != null;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public boolean isDecayed() {</dt><dd><p>return DECAYED_FEATURES.contains(this);</p>
</dd>
</dl>
<p>}</p>
<p>&#64;Nullable
public TweetFeatureType getElapsedTimeFeatureType() {</p>
<blockquote>
<div><p>return DECAYED_COUNTER_TO_ELAPSED_TIME.get(this);</p>
</div></blockquote>
<p>}</p>
<dl class="simple">
<dt>public boolean isFakeEngagement() {</dt><dd><p>return FAKE_ENGAGEMENT_FEATURES.contains(this);</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>public boolean isBlinkEngagement() {</dt><dd><p>return BLINK_ENGAGEMENT_FEATURES.contains(this);</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Check if an increment is eligible for emitting</p></li>
</ul>
<p><a href="#id7"><span class="problematic" id="id8">*</span></a>/</p>
</dd>
<dt>public static class IncrementChecker {</dt><dd><p>private final IntNormalizer normalizer;</p>
<dl class="simple">
<dt>public IncrementChecker(IntNormalizer normalizer) {</dt><dd><p>this.normalizer = normalizer;</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>IncrementChecker(TweetFeatureType type) {</dt><dd><p>this(type.getNormalizer());</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>Check if a value change is eligible for output</p></li>
</ul>
<p><a href="#id9"><span class="problematic" id="id10">*</span></a>/</p>
</dd>
<dt>public boolean eligibleForEmit(int oldValue, int newValue) {</dt><dd><p>return normalizer.normalize(oldValue) != normalizer.normalize(newValue);</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../_sources/src/java/com/twitter/search/common/relevance/features/TweetFeatureType.java.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>