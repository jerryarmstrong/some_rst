<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../" id="documentation_options" src="../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.cr_mixer.candidate_generation</p>
<p>import com.twitter.cr_mixer.model.CandidateGenerationInfo
import com.twitter.cr_mixer.model.TweetWithCandidateGenerationInfo
import com.twitter.cr_mixer.model.TweetWithScore
import com.twitter.cr_mixer.param.GlobalParams
import com.twitter.cr_mixer.param.InterestedInParams
import com.twitter.cr_mixer.param.SimClustersANNParams
import com.twitter.cr_mixer.similarity_engine.EngineQuery
import com.twitter.cr_mixer.similarity_engine.SimClustersANNSimilarityEngine
import com.twitter.cr_mixer.similarity_engine.StandardSimilarityEngine
import com.twitter.finagle.stats.StatsReceiver
import com.twitter.frigate.common.base.CandidateSource
import com.twitter.frigate.common.util.StatsUtil
import com.twitter.simclusters_v2.common.ModelVersions
import com.twitter.simclusters_v2.thriftscala.InternalId
import com.twitter.timelines.configapi
import com.twitter.util.Future
import javax.inject.Inject
import javax.inject.Singleton
import javax.inject.Named
import com.twitter.cr_mixer.model.ModuleNames</p>
<dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>This store looks for similar tweets for a given UserId that generates UserInterestedIn</p></li>
<li><p>from SimClustersANN. It will be a standalone CandidateGeneration class moving forward.</p></li>
<li></li>
<li><p>After the abstraction improvement (apply SimilarityEngine trait)</p></li>
<li><p>these CG will be subjected to change.</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
</dl>
<p>&#64;Singleton
case class SimClustersInterestedInCandidateGeneration &#64;Inject() (</p>
<blockquote>
<div><p>&#64;Named(ModuleNames.SimClustersANNSimilarityEngine)
simClustersANNSimilarityEngine: StandardSimilarityEngine[</p>
<blockquote>
<div><p>SimClustersANNSimilarityEngine.Query,
TweetWithScore</p>
</div></blockquote>
<p>],
statsReceiver: StatsReceiver)</p>
<blockquote>
<div><dl class="simple">
<dt>extends CandidateSource[</dt><dd><p>SimClustersInterestedInCandidateGeneration.Query,
Seq[TweetWithCandidateGenerationInfo]</p>
</dd>
</dl>
<p>] {</p>
</div></blockquote>
<p>override def name: String = this.getClass.getSimpleName
private val stats = statsReceiver.scope(name)
private val fetchCandidatesStat = stats.scope(“fetchCandidates”)</p>
<dl class="simple">
<dt>override def get(</dt><dd><p>query: SimClustersInterestedInCandidateGeneration.Query</p>
</dd>
</dl>
<p>): Future[Option[Seq[Seq[TweetWithCandidateGenerationInfo]]]] = {</p>
<blockquote>
<div><dl>
<dt>query.internalId match {</dt><dd><dl>
<dt>case _: InternalId.UserId =&gt;</dt><dd><dl>
<dt>StatsUtil.trackOptionItemsStats(fetchCandidatesStat) {</dt><dd><p>// UserInterestedIn Queries
val userInterestedInCandidateResultFut =</p>
<blockquote>
<div><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableProdSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val userInterestedInExperimentalSANNCandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableExperimentalSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInExperimentalSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userInterestedInSANN1CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableSimClustersANN1SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANN1Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userInterestedInSANN2CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableSimClustersANN2SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANN2Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userInterestedInSANN3CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableSimClustersANN3SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANN3Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userInterestedInSANN5CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableSimClustersANN5SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANN5Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userInterestedInSANN4CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserInterestedIn &amp;&amp; query.enableSimClustersANN4SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.interestedInSimClustersANN4Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
</dl>
<p>// UserNextInterestedIn Queries
val userNextInterestedInCandidateResultFut =</p>
<blockquote>
<div><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableProdSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val userNextInterestedInExperimentalSANNCandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableExperimentalSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInExperimentalSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userNextInterestedInSANN1CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableSimClustersANN1SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANN1Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userNextInterestedInSANN2CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableSimClustersANN2SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANN2Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userNextInterestedInSANN3CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableSimClustersANN3SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANN3Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userNextInterestedInSANN5CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableSimClustersANN5SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANN5Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userNextInterestedInSANN4CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableUserNextInterestedIn &amp;&amp; query.enableSimClustersANN4SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.nextInterestedInSimClustersANN4Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
</dl>
<p>// AddressBookInterestedIn Queries
val userAddressBookInterestedInCandidateResultFut =</p>
<blockquote>
<div><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableProdSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>val userAddressBookExperimentalSANNCandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableExperimentalSimClustersANNSimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInExperimentalSimClustersANNQuery,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userAddressBookSANN1CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableSimClustersANN1SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANN1Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userAddressBookSANN2CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableSimClustersANN2SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANN2Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userAddressBookSANN3CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableSimClustersANN3SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANN3Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userAddressBookSANN5CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableSimClustersANN5SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANN5Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>val userAddressBookSANN4CandidateResultFut =</dt><dd><dl class="simple">
<dt>if (query.enableAddressBookNextInterestedIn &amp;&amp; query.enableSimClustersANN4SimilarityEngine)</dt><dd><dl class="simple">
<dt>getInterestedInCandidateResult(</dt><dd><p>simClustersANNSimilarityEngine,
query.addressbookInterestedInSimClustersANN4Query,
query.simClustersInterestedInMinScore)</p>
</dd>
</dl>
</dd>
<dt>else</dt><dd><p>Future.None</p>
</dd>
</dl>
</dd>
<dt>Future</dt><dd><dl>
<dt>.collect(</dt><dd><dl class="simple">
<dt>Seq(</dt><dd><p>userInterestedInCandidateResultFut,
userNextInterestedInCandidateResultFut,
userAddressBookInterestedInCandidateResultFut,
userInterestedInExperimentalSANNCandidateResultFut,
userNextInterestedInExperimentalSANNCandidateResultFut,
userAddressBookExperimentalSANNCandidateResultFut,
userInterestedInSANN1CandidateResultFut,
userNextInterestedInSANN1CandidateResultFut,
userAddressBookSANN1CandidateResultFut,
userInterestedInSANN2CandidateResultFut,
userNextInterestedInSANN2CandidateResultFut,
userAddressBookSANN2CandidateResultFut,
userInterestedInSANN3CandidateResultFut,
userNextInterestedInSANN3CandidateResultFut,
userAddressBookSANN3CandidateResultFut,
userInterestedInSANN5CandidateResultFut,
userNextInterestedInSANN5CandidateResultFut,
userAddressBookSANN5CandidateResultFut,
userInterestedInSANN4CandidateResultFut,
userNextInterestedInSANN4CandidateResultFut,
userAddressBookSANN4CandidateResultFut</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>).map { candidateResults =&gt;</dt><dd><dl class="simple">
<dt>Some(</dt><dd><p>candidateResults.map(candidateResult =&gt; candidateResult.getOrElse(Seq.empty))</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</dd>
<dt>case _ =&gt;</dt><dd><p>stats.counter(“sourceId_is_not_userId_cnt”).incr()
Future.None</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<dl>
<dt>private def simClustersCandidateMinScoreFilter(</dt><dd><p>simClustersAnnCandidates: Seq[TweetWithScore],
simClustersInterestedInMinScore: Double,
simClustersANNConfigId: String</p>
</dd>
<dt>): Seq[TweetWithScore] = {</dt><dd><dl>
<dt>val filteredCandidates = simClustersAnnCandidates</dt><dd><dl class="simple">
<dt>.filter { candidate =&gt;</dt><dd><p>candidate.score &gt; simClustersInterestedInMinScore</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>stats.stat(simClustersANNConfigId, “simClustersAnnCandidates_size”).add(filteredCandidates.size)
stats.counter(simClustersANNConfigId, “simClustersAnnRequests”).incr()
if (filteredCandidates.isEmpty)</p>
<blockquote>
<div><p>stats.counter(simClustersANNConfigId, “emptyFilteredSimClustersAnnCandidates”).incr()</p>
</div></blockquote>
<dl class="simple">
<dt>filteredCandidates.map { candidate =&gt;</dt><dd><p>TweetWithScore(candidate.tweetId, candidate.score)</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def getInterestedInCandidateResult(</dt><dd><dl class="simple">
<dt>simClustersANNSimilarityEngine: StandardSimilarityEngine[</dt><dd><p>SimClustersANNSimilarityEngine.Query,
TweetWithScore</p>
</dd>
</dl>
<p>],
simClustersANNQuery: EngineQuery[SimClustersANNSimilarityEngine.Query],
simClustersInterestedInMinScore: Double,</p>
</dd>
<dt>): Future[Option[Seq[TweetWithCandidateGenerationInfo]]] = {</dt><dd><dl>
<dt>val interestedInCandidatesFut =</dt><dd><p>simClustersANNSimilarityEngine.getCandidates(simClustersANNQuery)</p>
</dd>
<dt>val interestedInCandidateResultFut = interestedInCandidatesFut.map { interestedInCandidates =&gt;</dt><dd><p>stats.stat(“candidateSize”).add(interestedInCandidates.size)</p>
<dl class="simple">
<dt>val embeddingCandidatesStat = stats.scope(</dt><dd><p>simClustersANNQuery.storeQuery.simClustersANNQuery.sourceEmbeddingId.embeddingType.name)</p>
</dd>
</dl>
<p>embeddingCandidatesStat.stat(“candidateSize”).add(interestedInCandidates.size)
if (interestedInCandidates.isEmpty) {</p>
<blockquote>
<div><p>embeddingCandidatesStat.counter(“empty_results”).incr()</p>
</div></blockquote>
<p>}
embeddingCandidatesStat.counter(“requests”).incr()</p>
<dl>
<dt>val filteredTweets = simClustersCandidateMinScoreFilter(</dt><dd><p>interestedInCandidates.toSeq.flatten,
simClustersInterestedInMinScore,
simClustersANNQuery.storeQuery.simClustersANNConfigId)</p>
</dd>
<dt>val interestedInTweetsWithCGInfo = filteredTweets.map { tweetWithScore =&gt;</dt><dd><dl>
<dt>TweetWithCandidateGenerationInfo(</dt><dd><p>tweetWithScore.tweetId,
CandidateGenerationInfo(</p>
<blockquote>
<div><p>None,
SimClustersANNSimilarityEngine</p>
<blockquote>
<div><p>.toSimilarityEngineInfo(simClustersANNQuery, tweetWithScore.score),</p>
</div></blockquote>
<p>Seq.empty // SANN is an atomic SE, and hence it has no contributing SEs</p>
</div></blockquote>
<p>)</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>val interestedInResults = if (interestedInTweetsWithCGInfo.nonEmpty) {</dt><dd><p>Some(interestedInTweetsWithCGInfo)</p>
</dd>
</dl>
<p>} else None
interestedInResults</p>
</dd>
</dl>
<p>}
interestedInCandidateResultFut</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>object SimClustersInterestedInCandidateGeneration {</p>
<blockquote>
<div><dl>
<dt>case class Query(</dt><dd><p>internalId: InternalId,
enableUserInterestedIn: Boolean,
enableUserNextInterestedIn: Boolean,
enableAddressBookNextInterestedIn: Boolean,
enableProdSimClustersANNSimilarityEngine: Boolean,
enableExperimentalSimClustersANNSimilarityEngine: Boolean,
enableSimClustersANN1SimilarityEngine: Boolean,
enableSimClustersANN2SimilarityEngine: Boolean,
enableSimClustersANN3SimilarityEngine: Boolean,
enableSimClustersANN5SimilarityEngine: Boolean,
enableSimClustersANN4SimilarityEngine: Boolean,
simClustersInterestedInMinScore: Double,
simClustersNextInterestedInMinScore: Double,
simClustersAddressBookInterestedInMinScore: Double,
interestedInSimClustersANNQuery: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANNQuery: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANNQuery: EngineQuery[SimClustersANNSimilarityEngine.Query],
interestedInExperimentalSimClustersANNQuery: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInExperimentalSimClustersANNQuery: EngineQuery[</p>
<blockquote>
<div><p>SimClustersANNSimilarityEngine.Query</p>
</div></blockquote>
<p>],
addressbookInterestedInExperimentalSimClustersANNQuery: EngineQuery[</p>
<blockquote>
<div><p>SimClustersANNSimilarityEngine.Query</p>
</div></blockquote>
<p>],
interestedInSimClustersANN1Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANN1Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANN1Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
interestedInSimClustersANN2Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANN2Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANN2Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
interestedInSimClustersANN3Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANN3Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANN3Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
interestedInSimClustersANN5Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANN5Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANN5Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
interestedInSimClustersANN4Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
nextInterestedInSimClustersANN4Query: EngineQuery[SimClustersANNSimilarityEngine.Query],
addressbookInterestedInSimClustersANN4Query: EngineQuery[SimClustersANNSimilarityEngine.Query],</p>
</dd>
</dl>
<p>)</p>
<dl>
<dt>def fromParams(</dt><dd><p>internalId: InternalId,
params: configapi.Params,</p>
</dd>
<dt>): Query = {</dt><dd><p>// SimClusters common configs
val simClustersModelVersion =</p>
<blockquote>
<div><p>ModelVersions.Enum.enumToSimClustersModelVersionMap(params(GlobalParams.ModelVersionParam))</p>
</div></blockquote>
<p>val simClustersANNConfigId = params(SimClustersANNParams.SimClustersANNConfigId)
val experimentalSimClustersANNConfigId = params(</p>
<blockquote>
<div><p>SimClustersANNParams.ExperimentalSimClustersANNConfigId)</p>
</div></blockquote>
<p>val simClustersANN1ConfigId = params(SimClustersANNParams.SimClustersANN1ConfigId)
val simClustersANN2ConfigId = params(SimClustersANNParams.SimClustersANN2ConfigId)
val simClustersANN3ConfigId = params(SimClustersANNParams.SimClustersANN3ConfigId)
val simClustersANN5ConfigId = params(SimClustersANNParams.SimClustersANN5ConfigId)
val simClustersANN4ConfigId = params(SimClustersANNParams.SimClustersANN4ConfigId)</p>
<p>val simClustersInterestedInMinScore = params(InterestedInParams.MinScoreParam)
val simClustersNextInterestedInMinScore = params(</p>
<blockquote>
<div><p>InterestedInParams.MinScoreSequentialModelParam)</p>
</div></blockquote>
<dl class="simple">
<dt>val simClustersAddressBookInterestedInMinScore = params(</dt><dd><p>InterestedInParams.MinScoreAddressBookParam)</p>
</dd>
</dl>
<p>// InterestedIn embeddings parameters
val interestedInEmbedding = params(InterestedInParams.InterestedInEmbeddingIdParam)
val nextInterestedInEmbedding = params(InterestedInParams.NextInterestedInEmbeddingIdParam)
val addressbookInterestedInEmbedding = params(</p>
<blockquote>
<div><p>InterestedInParams.AddressBookInterestedInEmbeddingIdParam)</p>
</div></blockquote>
<p>// Prod SimClustersANN Query
val interestedInSimClustersANNQuery =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANNConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val nextInterestedInSimClustersANNQuery =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANNConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANNQuery =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANNConfigId,
params)</p>
</dd>
</dl>
</dd>
</dl>
<p>// Experimental SANN cluster Query
val interestedInExperimentalSimClustersANNQuery =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
experimentalSimClustersANNConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val nextInterestedInExperimentalSimClustersANNQuery =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
experimentalSimClustersANNConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInExperimentalSimClustersANNQuery =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
experimentalSimClustersANNConfigId,
params)</p>
</dd>
</dl>
</dd>
</dl>
<p>// SimClusters ANN cluster 1 Query
val interestedInSimClustersANN1Query =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN1ConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val nextInterestedInSimClustersANN1Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN1ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANN1Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN1ConfigId,
params)</p>
</dd>
</dl>
</dd>
</dl>
<p>// SimClusters ANN cluster 2 Query
val interestedInSimClustersANN2Query =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN2ConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val nextInterestedInSimClustersANN2Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN2ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANN2Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN2ConfigId,
params)</p>
</dd>
</dl>
</dd>
</dl>
<p>// SimClusters ANN cluster 3 Query
val interestedInSimClustersANN3Query =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN3ConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>val nextInterestedInSimClustersANN3Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN3ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANN3Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN3ConfigId,
params)</p>
</dd>
</dl>
</dd>
</dl>
<p>// SimClusters ANN cluster 5 Query
val interestedInSimClustersANN5Query =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN5ConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<p>// SimClusters ANN cluster 4 Query
val interestedInSimClustersANN4Query =</p>
<blockquote>
<div><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
interestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN4ConfigId,
params)</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>val nextInterestedInSimClustersANN5Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN5ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val nextInterestedInSimClustersANN4Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
nextInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN4ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANN5Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN5ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>val addressbookInterestedInSimClustersANN4Query =</dt><dd><dl class="simple">
<dt>SimClustersANNSimilarityEngine.fromParams(</dt><dd><p>internalId,
addressbookInterestedInEmbedding.embeddingType,
simClustersModelVersion,
simClustersANN4ConfigId,
params)</p>
</dd>
</dl>
</dd>
<dt>Query(</dt><dd><p>internalId = internalId,
enableUserInterestedIn = params(InterestedInParams.EnableSourceParam),
enableUserNextInterestedIn = params(InterestedInParams.EnableSourceSequentialModelParam),
enableAddressBookNextInterestedIn = params(InterestedInParams.EnableSourceAddressBookParam),
enableProdSimClustersANNSimilarityEngine =</p>
<blockquote>
<div><p>params(InterestedInParams.EnableProdSimClustersANNParam),</p>
</div></blockquote>
<dl class="simple">
<dt>enableExperimentalSimClustersANNSimilarityEngine =</dt><dd><p>params(InterestedInParams.EnableExperimentalSimClustersANNParam),</p>
</dd>
</dl>
<p>enableSimClustersANN1SimilarityEngine = params(InterestedInParams.EnableSimClustersANN1Param),
enableSimClustersANN2SimilarityEngine = params(InterestedInParams.EnableSimClustersANN2Param),
enableSimClustersANN3SimilarityEngine = params(InterestedInParams.EnableSimClustersANN3Param),
enableSimClustersANN5SimilarityEngine = params(InterestedInParams.EnableSimClustersANN5Param),
enableSimClustersANN4SimilarityEngine = params(InterestedInParams.EnableSimClustersANN4Param),
simClustersInterestedInMinScore = simClustersInterestedInMinScore,
simClustersNextInterestedInMinScore = simClustersNextInterestedInMinScore,
simClustersAddressBookInterestedInMinScore = simClustersAddressBookInterestedInMinScore,
interestedInSimClustersANNQuery = interestedInSimClustersANNQuery,
nextInterestedInSimClustersANNQuery = nextInterestedInSimClustersANNQuery,
addressbookInterestedInSimClustersANNQuery = addressbookInterestedInSimClustersANNQuery,
interestedInExperimentalSimClustersANNQuery = interestedInExperimentalSimClustersANNQuery,
nextInterestedInExperimentalSimClustersANNQuery =</p>
<blockquote>
<div><p>nextInterestedInExperimentalSimClustersANNQuery,</p>
</div></blockquote>
<dl class="simple">
<dt>addressbookInterestedInExperimentalSimClustersANNQuery =</dt><dd><p>addressbookInterestedInExperimentalSimClustersANNQuery,</p>
</dd>
</dl>
<p>interestedInSimClustersANN1Query = interestedInSimClustersANN1Query,
nextInterestedInSimClustersANN1Query = nextInterestedInSimClustersANN1Query,
addressbookInterestedInSimClustersANN1Query = addressbookInterestedInSimClustersANN1Query,
interestedInSimClustersANN2Query = interestedInSimClustersANN2Query,
nextInterestedInSimClustersANN2Query = nextInterestedInSimClustersANN2Query,
addressbookInterestedInSimClustersANN2Query = addressbookInterestedInSimClustersANN2Query,
interestedInSimClustersANN3Query = interestedInSimClustersANN3Query,
nextInterestedInSimClustersANN3Query = nextInterestedInSimClustersANN3Query,
addressbookInterestedInSimClustersANN3Query = addressbookInterestedInSimClustersANN3Query,
interestedInSimClustersANN5Query = interestedInSimClustersANN5Query,
nextInterestedInSimClustersANN5Query = nextInterestedInSimClustersANN5Query,
addressbookInterestedInSimClustersANN5Query = addressbookInterestedInSimClustersANN5Query,
interestedInSimClustersANN4Query = interestedInSimClustersANN4Query,
nextInterestedInSimClustersANN4Query = nextInterestedInSimClustersANN4Query,
addressbookInterestedInSimClustersANN4Query = addressbookInterestedInSimClustersANN4Query,</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../index.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../_sources/cr-mixer/server/src/main/scala/com/twitter/cr_mixer/candidate_generation/SimClustersInterestedInCandidateGeneration.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>