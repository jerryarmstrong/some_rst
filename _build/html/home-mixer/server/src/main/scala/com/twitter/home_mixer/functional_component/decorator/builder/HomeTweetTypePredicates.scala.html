<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../../../" id="documentation_options" src="../../../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.home_mixer.functional_component.decorator.builder</p>
<p>import com.twitter.conversions.DurationOps._
import com.twitter.home_mixer.model.HomeFeatures._
import com.twitter.product_mixer.core.feature.featuremap.FeatureMap
import com.twitter.product_mixer.core.model.marshalling.response.urt.metadata.BasicTopicContextFunctionalityType
import com.twitter.product_mixer.core.model.marshalling.response.urt.metadata.RecommendationTopicContextFunctionalityType
import com.twitter.timelinemixer.injection.model.candidate.SemanticCoreFeatures
import com.twitter.tweetypie.{thriftscala =&gt; tpt}</p>
<p>object HomeTweetTypePredicates {</p>
<blockquote>
<div><dl>
<dt>/**</dt><dd><ul class="simple">
<li><p>IMPORTANT: Please avoid logging tweet types that are tied to sensitive</p></li>
<li><p>internal author information / labels (e.g. blink labels, abuse labels, or geo-location).</p></li>
</ul>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
<dt>private[this] val CandidatePredicates: Seq[(String, FeatureMap =&gt; Boolean)] = Seq(</dt><dd><p>(“with_candidate”, _ =&gt; true),
(“retweet”, _.getOrElse(IsRetweetFeature, false)),
(“reply”, _.getOrElse(InReplyToTweetIdFeature, None).nonEmpty),
(“image”, _.getOrElse(EarlybirdFeature, None).exists(_.hasImage)),
(“video”, _.getOrElse(EarlybirdFeature, None).exists(_.hasVideo)),
(“link”, _.getOrElse(EarlybirdFeature, None).exists(_.hasVisibleLink)),
(“quote”, _.getOrElse(EarlybirdFeature, None).exists(_.hasQuote.contains(true))),
(“like_social_context”, _.getOrElse(NonSelfFavoritedByUserIdsFeature, Seq.empty).nonEmpty),
(“protected”, _.getOrElse(EarlybirdFeature, None).exists(_.isProtected)),
(</p>
<blockquote>
<div><p>“has_exclusive_conversation_author_id”,
_.getOrElse(ExclusiveConversationAuthorIdFeature, None).nonEmpty),</p>
</div></blockquote>
<p>(“is_eligible_for_connect_boost”, _ =&gt; false),
(“hashtag”, _.getOrElse(EarlybirdFeature, None).exists(_.numHashtags &gt; 0)),
(“has_scheduled_space”, _.getOrElse(AudioSpaceMetaDataFeature, None).exists(_.isScheduled)),
(“has_recorded_space”, _.getOrElse(AudioSpaceMetaDataFeature, None).exists(_.isRecorded)),
(“is_read_from_cache”, _.getOrElse(IsReadFromCacheFeature, false)),
(“get_initial”, _.getOrElse(GetInitialFeature, false)),
(“get_newer”, _.getOrElse(GetNewerFeature, false)),
(“get_middle”, _.getOrElse(GetMiddleFeature, false)),
(“get_older”, _.getOrElse(GetOlderFeature, false)),
(“pull_to_refresh”, _.getOrElse(PullToRefreshFeature, false)),
(“polling”, _.getOrElse(PollingFeature, false)),
(“near_empty”, _.getOrElse(ServedSizeFeature, None).exists(_ &lt; 3)),
(“is_request_context_launch”, _.getOrElse(IsLaunchRequestFeature, false)),
(“mutual_follow”, _.getOrElse(EarlybirdFeature, None).exists(_.fromMutualFollow)),
(</p>
<blockquote>
<div><p>“less_than_10_mins_since_lnpt”,
_.getOrElse(LastNonPollingTimeFeature, None).exists(_.untilNow &lt; 10.minutes)),</p>
</div></blockquote>
<p>(“served_in_conversation_module”, _.getOrElse(ServedInConversationModuleFeature, false)),
(“has_ticketed_space”, _.getOrElse(AudioSpaceMetaDataFeature, None).exists(_.hasTickets)),
(“in_utis_top5”, _.getOrElse(PositionFeature, None).exists(_ &lt; 5)),
(</p>
<blockquote>
<div><p>“conversation_module_has_2_displayed_tweets”,
_.getOrElse(ConversationModule2DisplayedTweetsFeature, false)),</p>
</div></blockquote>
<p>(“empty_request”, _.getOrElse(ServedSizeFeature, None).exists(_ == 0)),
(“served_size_less_than_50”, _.getOrElse(ServedSizeFeature, None).exists(_ &lt; 50)),
(</p>
<blockquote>
<div><p>“served_size_between_50_and_100”,
_.getOrElse(ServedSizeFeature, None).exists(size =&gt; size &gt;= 50 &amp;&amp; size &lt; 100)),</p>
</div></blockquote>
<p>(“authored_by_contextual_user”, _.getOrElse(AuthoredByContextualUserFeature, false)),
(</p>
<blockquote>
<div><p>“is_self_thread_tweet”,
_.getOrElse(ConversationFeature, None).exists(_.isSelfThreadTweet.contains(true))),</p>
</div></blockquote>
<p>(“has_ancestors”, _.getOrElse(AncestorsFeature, Seq.empty).nonEmpty),
(“full_scoring_succeeded”, _.getOrElse(FullScoringSucceededFeature, false)),
(“served_size_less_than_20”, _.getOrElse(ServedSizeFeature, None).exists(_ &lt; 20)),
(“served_size_less_than_10”, _.getOrElse(ServedSizeFeature, None).exists(_ &lt; 10)),
(“served_size_less_than_5”, _.getOrElse(ServedSizeFeature, None).exists(_ &lt; 5)),
(</p>
<blockquote>
<div><p>“account_age_less_than_30_minutes”,
_.getOrElse(AccountAgeFeature, None).exists(_.untilNow &lt; 30.minutes)),</p>
</div></blockquote>
<p>(“conversation_module_has_gap”, _.getOrElse(ConversationModuleHasGapFeature, false)),
(</p>
<blockquote>
<div><p>“directed_at_user_is_in_first_degree”,
_.getOrElse(EarlybirdFeature, None).exists(_.directedAtUserIdIsInFirstDegree.contains(true))),</p>
</div></blockquote>
<dl class="simple">
<dt>(</dt><dd><p>“has_semantic_core_annotation”,
_.getOrElse(EarlybirdFeature, None).exists(_.semanticCoreAnnotations.nonEmpty)),</p>
</dd>
</dl>
<p>(“is_request_context_foreground”, _.getOrElse(IsForegroundRequestFeature, false)),
(</p>
<blockquote>
<div><p>“account_age_less_than_1_day”,
_.getOrElse(AccountAgeFeature, None).exists(_.untilNow &lt; 1.day)),</p>
</div></blockquote>
<dl class="simple">
<dt>(</dt><dd><p>“account_age_less_than_7_days”,
_.getOrElse(AccountAgeFeature, None).exists(_.untilNow &lt; 7.days)),</p>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“part_of_utt”,
_.getOrElse(EarlybirdFeature, None)</p>
<blockquote>
<div><dl class="simple">
<dt>.exists(_.semanticCoreAnnotations.exists(_.exists(annotation =&gt;</dt><dd><p>annotation.domainId == SemanticCoreFeatures.UnifiedTwitterTaxonomy)))),</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<dl class="simple">
<dt>(</dt><dd><p>“has_home_latest_request_past_week”,
_.getOrElse(FollowingLastNonPollingTimeFeature, None).exists(_.untilNow &lt; 7.days)),</p>
</dd>
</dl>
<p>(“is_utis_pos0”, _.getOrElse(PositionFeature, None).exists(_ == 0)),
(“is_utis_pos1”, _.getOrElse(PositionFeature, None).exists(_ == 1)),
(“is_utis_pos2”, _.getOrElse(PositionFeature, None).exists(_ == 2)),
(“is_utis_pos3”, _.getOrElse(PositionFeature, None).exists(_ == 3)),
(“is_utis_pos4”, _.getOrElse(PositionFeature, None).exists(_ == 4)),
(“is_random_tweet”, _.getOrElse(IsRandomTweetFeature, false)),
(“has_random_tweet_in_response”, _.getOrElse(HasRandomTweetFeature, false)),
(“is_random_tweet_above_in_utis”, _.getOrElse(IsRandomTweetAboveFeature, false)),
(</p>
<blockquote>
<div><p>“has_ancestor_authored_by_viewer”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate</dt><dd><dl class="simple">
<dt>.getOrElse(AncestorsFeature, Seq.empty).exists(ancestor =&gt;</dt><dd><p>candidate.getOrElse(ViewerIdFeature, 0L) == ancestor.userId)),</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>(“ancestor”, _.getOrElse(IsAncestorCandidateFeature, false)),
(</p>
<blockquote>
<div><p>“deep_reply”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate.getOrElse(InReplyToTweetIdFeature, None).nonEmpty &amp;&amp; candidate</dt><dd><p>.getOrElse(AncestorsFeature, Seq.empty).size &gt; 2),</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“has_simcluster_embeddings”,
_.getOrElse(</p>
<blockquote>
<div><p>SimclustersTweetTopKClustersWithScoresFeature,
Map.empty[String, Double]).nonEmpty),</p>
</div></blockquote>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“tweet_age_less_than_15_seconds”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &lt;= 15.seconds)),</p>
</div></blockquote>
</dd>
</dl>
<dl class="simple">
<dt>(</dt><dd><p>“less_than_1_hour_since_lnpt”,
_.getOrElse(LastNonPollingTimeFeature, None).exists(_.untilNow &lt; 1.hour)),</p>
</dd>
</dl>
<p>(“has_gte_10_favs”, _.getOrElse(EarlybirdFeature, None).exists(_.favCountV2.exists(_ &gt;= 10))),
(</p>
<blockquote>
<div><p>“device_language_matches_tweet_language”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate.getOrElse(TweetLanguageFeature, None) ==</dt><dd><p>candidate.getOrElse(DeviceLanguageFeature, None)),</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“root_ancestor”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate.getOrElse(IsAncestorCandidateFeature, false) &amp;&amp; candidate</dt><dd><p>.getOrElse(InReplyToTweetIdFeature, None).isEmpty),</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>(“question”, _.getOrElse(EarlybirdFeature, None).exists(_.hasQuestion.contains(true))),
(“in_network”, _.getOrElse(InNetworkFeature, true)),
(</p>
<blockquote>
<div><p>“has_political_annotation”,
_.getOrElse(EarlybirdFeature, None).exists(</p>
<blockquote>
<div><dl class="simple">
<dt>_.semanticCoreAnnotations.exists(</dt><dd><dl class="simple">
<dt>_.exists(annotation =&gt;</dt><dd><dl class="simple">
<dt>SemanticCoreFeatures.PoliticalDomains.contains(annotation.domainId) ||</dt><dd><dl class="simple">
<dt>(annotation.domainId == SemanticCoreFeatures.UnifiedTwitterTaxonomy &amp;&amp;</dt><dd><p>annotation.entityId == SemanticCoreFeatures.UttPoliticsEntityId))))),</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“is_dont_at_me_by_invitation”,
_.getOrElse(EarlybirdFeature, None).exists(</p>
<blockquote>
<div><p>_.conversationControl.exists(_.isInstanceOf[tpt.ConversationControl.ByInvitation]))),</p>
</div></blockquote>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“is_dont_at_me_community”,
_.getOrElse(EarlybirdFeature, None)</p>
<blockquote>
<div><p>.exists(_.conversationControl.exists(_.isInstanceOf[tpt.ConversationControl.Community]))),</p>
</div></blockquote>
</dd>
</dl>
<p>(“has_zero_score”, _.getOrElse(ScoreFeature, None).exists(_ == 0.0)),
(</p>
<blockquote>
<div><p>“is_followed_topic_tweet”,
_.getOrElse(TopicContextFunctionalityTypeFeature, None)</p>
<blockquote>
<div><p>.exists(_ == BasicTopicContextFunctionalityType)),</p>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“is_recommended_topic_tweet”,
_.getOrElse(TopicContextFunctionalityTypeFeature, None)</p>
<blockquote>
<div><p>.exists(_ == RecommendationTopicContextFunctionalityType)),</p>
</div></blockquote>
</dd>
</dl>
<p>(“has_gte_100_favs”, _.getOrElse(EarlybirdFeature, None).exists(_.favCountV2.exists(_ &gt;= 100))),
(“has_gte_1k_favs”, _.getOrElse(EarlybirdFeature, None).exists(_.favCountV2.exists(_ &gt;= 1000))),
(</p>
<blockquote>
<div><p>“has_gte_10k_favs”,
_.getOrElse(EarlybirdFeature, None).exists(_.favCountV2.exists(_ &gt;= 10000))),</p>
</div></blockquote>
<dl class="simple">
<dt>(</dt><dd><p>“has_gte_100k_favs”,
_.getOrElse(EarlybirdFeature, None).exists(_.favCountV2.exists(_ &gt;= 100000))),</p>
</dd>
</dl>
<p>(“has_audio_space”, _.getOrElse(AudioSpaceMetaDataFeature, None).exists(_.hasSpace)),
(“has_live_audio_space”, _.getOrElse(AudioSpaceMetaDataFeature, None).exists(_.isLive)),
(</p>
<blockquote>
<div><p>“has_gte_10_retweets”,
_.getOrElse(EarlybirdFeature, None).exists(_.retweetCountV2.exists(_ &gt;= 10))),</p>
</div></blockquote>
<dl class="simple">
<dt>(</dt><dd><p>“has_gte_100_retweets”,
_.getOrElse(EarlybirdFeature, None).exists(_.retweetCountV2.exists(_ &gt;= 100))),</p>
</dd>
</dl>
<dl class="simple">
<dt>(</dt><dd><p>“has_gte_1k_retweets”,
_.getOrElse(EarlybirdFeature, None).exists(_.retweetCountV2.exists(_ &gt;= 1000))),</p>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“has_us_political_annotation”,
_.getOrElse(EarlybirdFeature, None)</p>
<blockquote>
<div><dl class="simple">
<dt>.exists(_.semanticCoreAnnotations.exists(_.exists(annotation =&gt;</dt><dd><dl class="simple">
<dt>annotation.domainId == SemanticCoreFeatures.UnifiedTwitterTaxonomy &amp;&amp;</dt><dd><p>annotation.entityId == SemanticCoreFeatures.usPoliticalTweetEntityId &amp;&amp;
annotation.groupId == SemanticCoreFeatures.UsPoliticalTweetAnnotationGroupIds.BalancedV0)))),</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<dl class="simple">
<dt>(</dt><dd><p>“has_toxicity_score_above_threshold”,
_.getOrElse(EarlybirdFeature, None).exists(_.toxicityScore.exists(_ &gt; 0.91))),</p>
</dd>
</dl>
<p>(“is_topic_tweet”, _.getOrElse(TopicIdSocialContextFeature, None).isDefined),
(</p>
<blockquote>
<div><p>“text_only”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate.getOrElse(HasDisplayedTextFeature, false) &amp;&amp;</dt><dd><dl class="simple">
<dt>!(candidate.getOrElse(EarlybirdFeature, None).exists(_.hasImage) ||</dt><dd><p>candidate.getOrElse(EarlybirdFeature, None).exists(_.hasVideo) ||
candidate.getOrElse(EarlybirdFeature, None).exists(_.hasCard))),</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“image_only”,
candidate =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidate.getOrElse(EarlybirdFeature, None).exists(_.hasImage) &amp;&amp;</dt><dd><p>!candidate.getOrElse(HasDisplayedTextFeature, false)),</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>(“has_1_image”, _.getOrElse(NumImagesFeature, None).exists(_ == 1)),
(“has_2_images”, _.getOrElse(NumImagesFeature, None).exists(_ == 2)),
(“has_3_images”, _.getOrElse(NumImagesFeature, None).exists(_ == 3)),
(“has_4_images”, _.getOrElse(NumImagesFeature, None).exists(_ == 4)),
(“has_card”, _.getOrElse(EarlybirdFeature, None).exists(_.hasCard)),
(“user_follow_count_gte_50”, _.getOrElse(UserFollowingCountFeature, None).exists(_ &gt; 50)),
(</p>
<blockquote>
<div><p>“has_liked_by_social_context”,
candidateFeatures =&gt;</p>
<blockquote>
<div><dl>
<dt>candidateFeatures</dt><dd><p>.getOrElse(SGSValidLikedByUserIdsFeature, Seq.empty)
.exists(candidateFeatures</p>
<blockquote>
<div><p>.getOrElse(PerspectiveFilteredLikedByUserIdsFeature, Seq.empty).toSet.contains)),</p>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>(</dt><dd><p>“has_followed_by_social_context”,
_.getOrElse(SGSValidFollowedByUserIdsFeature, Seq.empty).nonEmpty),</p>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“has_topic_social_context”,
candidateFeatures =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>candidateFeatures</dt><dd><p>.getOrElse(TopicIdSocialContextFeature, None)
.isDefined &amp;&amp;
candidateFeatures.getOrElse(TopicContextFunctionalityTypeFeature, None).isDefined),</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>(“video_lte_10_sec”, _.getOrElse(VideoDurationMsFeature, None).exists(_ &lt;= 10000)),
(</p>
<blockquote>
<div><p>“video_bt_10_60_sec”,
_.getOrElse(VideoDurationMsFeature, None).exists(duration =&gt;</p>
<blockquote>
<div><p>duration &gt; 10000 &amp;&amp; duration &lt;= 60000)),</p>
</div></blockquote>
</div></blockquote>
<p>(“video_gt_60_sec”, _.getOrElse(VideoDurationMsFeature, None).exists(_ &gt; 60000)),
(</p>
<blockquote>
<div><p>“tweet_age_lte_30_minutes”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &lt;= 30.minutes)),</p>
</div></blockquote>
</div></blockquote>
<dl>
<dt>(</dt><dd><p>“tweet_age_lte_1_hour”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &lt;= 1.hour)),</p>
</div></blockquote>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“tweet_age_lte_6_hours”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &lt;= 6.hours)),</p>
</div></blockquote>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“tweet_age_lte_12_hours”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &lt;= 12.hours)),</p>
</div></blockquote>
</dd>
</dl>
<dl>
<dt>(</dt><dd><p>“tweet_age_gte_24_hours”,
_.getOrElse(OriginalTweetCreationTimeFromSnowflakeFeature, None)</p>
<blockquote>
<div><p>.exists(_.untilNow &gt;= 24.hours)),</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
<p>)</p>
<p>val PredicateMap = CandidatePredicates.toMap</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../../../_sources/home-mixer/server/src/main/scala/com/twitter/home_mixer/functional_component/decorator/builder/HomeTweetTypePredicates.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>