<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../" id="documentation_options" src="../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>“””
Different type of convolution layers to be used in the ClemNet.
“””
from typing import Any</p>
<p>import tensorflow as tf</p>
<dl>
<dt>class KerasConv1D(tf.keras.layers.Layer):</dt><dd><p>“””
Basic Conv1D layer in a wrapper to be compatible with ClemNet.
“””</p>
<dl>
<dt>def __init__(</dt><dd><p>self,
kernel_size: int,
filters: int,
strides: int,
padding: str,
use_bias: bool = True,
kernel_initializer: str = “glorot_uniform”,
bias_initializer: str = “zeros”,
<a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs: Any,</p>
</dd>
<dt>):</dt><dd><p>super(KerasConv1D, self).__init__(<a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs)
self.kernel_size = kernel_size
self.filters = filters
self.use_bias = use_bias
self.kernel_initializer = kernel_initializer
self.bias_initializer = bias_initializer
self.strides = strides
self.padding = padding</p>
</dd>
<dt>def build(self, input_shape: tf.TensorShape) -&gt; None:</dt><dd><dl class="simple">
<dt>assert (</dt><dd><p>len(input_shape) == 3</p>
</dd>
</dl>
<p>), f”Tensor shape must be of length 3. Passed tensor of shape {input_shape}.”</p>
<p>self.features = input_shape[1]</p>
<dl class="simple">
<dt>self.w = tf.keras.layers.Conv1D(</dt><dd><p>kernel_size=self.kernel_size,
filters=self.filters,
strides=self.strides,
padding=self.padding,
use_bias=self.use_bias,
kernel_initializer=self.kernel_initializer,
bias_initializer=self.bias_initializer,
name=self.name,</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>def call(self, inputs: tf.Tensor, <a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs: Any) -&gt; tf.Tensor:</dt><dd><p>return self.w(inputs)</p>
</dd>
</dl>
</dd>
<dt>class ChannelWiseDense(tf.keras.layers.Layer):</dt><dd><p>“””
Dense layer is applied to each channel separately. This is more memory and computationally
efficient than flattening the channels and performing single dense layers over it which is the
default behavior in tf1.
“””</p>
<dl>
<dt>def __init__(</dt><dd><p>self,
output_size: int,
use_bias: bool,
kernel_initializer: str = “uniform_glorot”,
bias_initializer: str = “zeros”,
<a href="#id7"><span class="problematic" id="id8">**</span></a>kwargs: Any,</p>
</dd>
<dt>):</dt><dd><p>super(ChannelWiseDense, self).__init__(<a href="#id9"><span class="problematic" id="id10">**</span></a>kwargs)
self.output_size = output_size
self.use_bias = use_bias
self.kernel_initializer = kernel_initializer
self.bias_initializer = bias_initializer</p>
</dd>
<dt>def build(self, input_shape: tf.TensorShape) -&gt; None:</dt><dd><dl class="simple">
<dt>assert (</dt><dd><p>len(input_shape) == 3</p>
</dd>
</dl>
<p>), f”Tensor shape must be of length 3. Passed tensor of shape {input_shape}.”</p>
<p>input_size = input_shape[1]
channels = input_shape[2]</p>
<dl class="simple">
<dt>self.kernel = self.add_weight(</dt><dd><p>name=”kernel”,
shape=(channels, input_size, self.output_size),
initializer=self.kernel_initializer,
trainable=True,</p>
</dd>
</dl>
<p>)</p>
<dl class="simple">
<dt>self.bias = self.add_weight(</dt><dd><p>name=”bias”,
shape=(channels, self.output_size),
initializer=self.bias_initializer,
trainable=self.use_bias,</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>def call(self, inputs: tf.Tensor, <a href="#id11"><span class="problematic" id="id12">**</span></a>kwargs: Any) -&gt; tf.Tensor:</dt><dd><p>x = inputs</p>
<p>transposed_x = tf.transpose(x, perm=[2, 0, 1])
transposed_residual = (</p>
<blockquote>
<div><p>tf.transpose(tf.matmul(transposed_x, self.kernel), perm=[1, 0, 2]) + self.bias</p>
</div></blockquote>
<p>)
output = tf.transpose(transposed_residual, perm=[0, 2, 1])</p>
<p>return output</p>
</dd>
</dl>
</dd>
<dt>class ResidualLayer(tf.keras.layers.Layer):</dt><dd><p>“””
Layer implementing a 3D-residual connection.
“””</p>
<dl>
<dt>def build(self, input_shape: tf.TensorShape) -&gt; None:</dt><dd><dl class="simple">
<dt>assert (</dt><dd><p>len(input_shape) == 3</p>
</dd>
</dl>
<p>), f”Tensor shape must be of length 3. Passed tensor of shape {input_shape}.”</p>
</dd>
<dt>def call(self, inputs: tf.Tensor, residual: tf.Tensor, <a href="#id13"><span class="problematic" id="id14">**</span></a>kwargs: Any) -&gt; tf.Tensor:</dt><dd><dl class="simple">
<dt>shortcut = tf.keras.layers.Conv1D(</dt><dd><p>filters=int(residual.shape[2]), strides=1, kernel_size=1, padding=”SAME”, use_bias=False</p>
</dd>
</dl>
<p>)(inputs)</p>
<p>output = tf.add(shortcut, residual)</p>
<p>return output</p>
</dd>
</dl>
</dd>
</dl>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../_sources/pushservice/src/main/python/models/heavy_ranking/lib/layers.py.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>