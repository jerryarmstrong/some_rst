<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../../" id="documentation_options" src="../../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.frigate.pushservice.predicate.magic_fanout</p>
<p>import com.twitter.datatools.entityservice.entities.sports.thriftscala.NflFootballGameLiveUpdate
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SoccerMatchLiveUpdate
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SoccerPeriod
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SportsEventHomeAwayTeamScore
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SportsEventStatus
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SportsEventTeamAlignment.Away
import com.twitter.datatools.entityservice.entities.sports.thriftscala.SportsEventTeamAlignment.Home
import com.twitter.escherbird.metadata.thriftscala.EntityMegadata
import com.twitter.frigate.pushservice.params.SportGameEnum
import com.twitter.frigate.common.base.GenericGameScore
import com.twitter.frigate.common.base.NflGameScore
import com.twitter.frigate.common.base.SoccerGameScore
import com.twitter.frigate.common.base.TeamInfo
import com.twitter.frigate.common.base.TeamScore
import com.twitter.hermit.store.semantic_core.SemanticEntityForQuery
import com.twitter.storehaus.ReadableStore
import com.twitter.util.Future</p>
<p>object MagicFanoutSportsUtil {</p>
<blockquote>
<div><dl>
<dt>def transformSoccerGameScore(game: SoccerMatchLiveUpdate): Option[SoccerGameScore] = {</dt><dd><p>require(game.status.isDefined)
val gameScore = transformToGameScore(game.score, game.status.get)
val _penaltyKicks = transformToGameScore(game.penaltyScore, game.status.get)
gameScore.map { score =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>val _isGameEnd = game.status.get match {</dt><dd><p>case SportsEventStatus.Completed(_) =&gt; true
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val _isHalfTime = game.period.exists { period =&gt;</dt><dd><dl class="simple">
<dt>period match {</dt><dd><p>case SoccerPeriod.Halftime(_) =&gt; true
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val _isOvertime = game.period.exists { period =&gt;</dt><dd><dl class="simple">
<dt>period match {</dt><dd><p>case SoccerPeriod.PreOvertime(_) =&gt; true
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val _isPenaltyKicks = game.period.exists { period =&gt;</dt><dd><dl class="simple">
<dt>period match {</dt><dd><p>case SoccerPeriod.PrePenalty(_) =&gt; true
case SoccerPeriod.Penalty(_) =&gt; true
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val _gameMinute = game.gameMinute.map { soccerGameMinute =&gt;</dt><dd><dl class="simple">
<dt>game.minutesInInjuryTime match {</dt><dd><p>case Some(injuryTime) =&gt; s”($soccerGameMinute+$injuryTime′)”
case None =&gt; s”($soccerGameMinute′)”</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>SoccerGameScore(</dt><dd><p>score.home,
score.away,
isGameOngoing = score.isGameOngoing,
penaltyKicks = _penaltyKicks,
gameMinute = _gameMinute,
isHalfTime = _isHalfTime,
isOvertime = _isOvertime,
isPenaltyKicks = _isPenaltyKicks,
isGameEnd = _isGameEnd</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>def transformNFLGameScore(game: NflFootballGameLiveUpdate): Option[NflGameScore] = {</dt><dd><p>require(game.status.isDefined)</p>
<p>val gameScore = transformToGameScore(game.score, game.status.get)
gameScore.map { score =&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>val _isGameEnd = game.status.get match {</dt><dd><p>case SportsEventStatus.Completed(_) =&gt; true
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val _matchTime = (game.quarter, game.remainingSecondsInQuarter) match {</dt><dd><dl class="simple">
<dt>case (Some(quarter), Some(remainingSeconds)) if remainingSeconds != 0L =&gt;</dt><dd><p>val m = (remainingSeconds / 60) % 60
val s = remainingSeconds % 60
val formattedSeconds = “%02d:%02d”.format(m, s)
s”(Q$quarter - $formattedSeconds)”</p>
</dd>
</dl>
<p>case (Some(quarter), None) =&gt; s”(Q$quarter)”
case _ =&gt; “”</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>NflGameScore(</dt><dd><p>score.home,
score.away,
isGameOngoing = score.isGameOngoing,
isGameEnd = _isGameEnd,
matchTime = _matchTime</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/**</dt><dd><p>Takes a score from Strato columns and turns it into an easier to handle structure (GameScore class)
We do this to easily access the home/away scenario for copy setting
<a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</dd>
<dt>def transformToGameScore(</dt><dd><p>scoreOpt: Option[SportsEventHomeAwayTeamScore],
status: SportsEventStatus</p>
</dd>
<dt>): Option[GenericGameScore] = {</dt><dd><dl class="simple">
<dt>val isGameOngoing = status match {</dt><dd><p>case SportsEventStatus.InProgress(_) =&gt; true
case SportsEventStatus.Completed(_) =&gt; false
case _ =&gt; false</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val scoresWithTeam = scoreOpt</dt><dd><dl class="simple">
<dt>.map { score =&gt;</dt><dd><p>score.scores.map { score =&gt; (score.score, score.participantAlignment, score.participantId) }</p>
</dd>
</dl>
<p>}.getOrElse(Seq())</p>
</dd>
<dt>val tuple = scoresWithTeam match {</dt><dd><p>case Seq(teamOne, teamTwo, _*) =&gt; Some((teamOne, teamTwo))
case _ =&gt; None</p>
</dd>
</dl>
<p>}
tuple.flatMap {</p>
<blockquote>
<div><dl>
<dt>case ((Some(teamOneScore), teamOneAlignment, teamOne), (Some(teamTwoScore), _, teamTwo)) =&gt;</dt><dd><dl>
<dt>teamOneAlignment.flatMap {</dt><dd><dl class="simple">
<dt>case Home(_) =&gt;</dt><dd><p>val home = TeamScore(teamOneScore, teamOne.entityId, teamOne.domainId)
val away = TeamScore(teamTwoScore, teamTwo.entityId, teamTwo.domainId)
Some(GenericGameScore(home, away, isGameOngoing))</p>
</dd>
<dt>case Away(_) =&gt;</dt><dd><p>val away = TeamScore(teamOneScore, teamOne.entityId, teamOne.domainId)
val home = TeamScore(teamTwoScore, teamTwo.entityId, teamTwo.domainId)
Some(GenericGameScore(home, away, isGameOngoing))</p>
</dd>
</dl>
<p>case _ =&gt; None</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>case _ =&gt; None</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>def getTeamInfo(</dt><dd><p>team: TeamScore,
semanticCoreMegadataStore: ReadableStore[SemanticEntityForQuery, EntityMegadata]</p>
</dd>
<dt>): Future[Option[TeamInfo]] = {</dt><dd><dl>
<dt>semanticCoreMegadataStore</dt><dd><dl>
<dt>.get(SemanticEntityForQuery(team.teamDomainId, team.teamEntityId)).map {</dt><dd><dl>
<dt>_.flatMap {</dt><dd><dl class="simple">
<dt>_.basicMetadata.map { metadata =&gt;</dt><dd><dl class="simple">
<dt>TeamInfo(</dt><dd><p>name = metadata.name,
twitterUserId = metadata.twitter.flatMap(_.preferredTwitterUserId))</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<dl>
<dt>def getNFLReadableName(name: String): String = {</dt><dd><dl class="simple">
<dt>val teamNames =</dt><dd><p>Seq(“”)</p>
</dd>
</dl>
<p>teamNames.find(teamName =&gt; name.contains(teamName)).getOrElse(name)</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>def getSoccerIbisMap(game: SoccerGameScore): Map[String, String] = {</dt><dd><dl class="simple">
<dt>val gameMinuteMap = game.gameMinute</dt><dd><p>.map { gameMinute =&gt; Map(“match_time” -&gt; gameMinute) }
.getOrElse(Map.empty)</p>
</dd>
<dt>val updateTypeMap = {</dt><dd><p>if (game.isGameEnd) Map(“is_game_end” -&gt; “true”)
else if (game.isHalfTime) Map(“is_half_time” -&gt; “true”)
else if (game.isOvertime) Map(“is_overtime” -&gt; “true”)
else if (game.isPenaltyKicks) Map(“is_penalty_kicks” -&gt; “true”)
else Map(“is_score_update” -&gt; “true”)</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val awayScore = game match {</dt><dd><dl class="simple">
<dt>case SoccerGameScore(_, away, _, None, _, _, _, _, _) =&gt;</dt><dd><p>away.score.toString</p>
</dd>
<dt>case SoccerGameScore(_, away, _, Some(penaltyKick), _, _, _, _, _) =&gt;</dt><dd><p>s”${away.score} (${penaltyKick.away.score}) “</p>
</dd>
</dl>
<p>case _ =&gt; “”</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>val homeScore = game match {</dt><dd><dl class="simple">
<dt>case SoccerGameScore(home, _, _, None, _, _, _, _, _) =&gt;</dt><dd><p>home.score.toString</p>
</dd>
<dt>case SoccerGameScore(home, _, _, Some(penaltyKick), _, _, _, _, _) =&gt;</dt><dd><p>s”${home.score} (${penaltyKick.home.score}) “</p>
</dd>
</dl>
<p>case _ =&gt; “”</p>
</dd>
</dl>
<p>}</p>
<dl class="simple">
<dt>val scoresMap = Map(</dt><dd><p>“away_score” -&gt; awayScore,
“home_score” -&gt; homeScore,</p>
</dd>
</dl>
<p>)</p>
<p>gameType(SportGameEnum.Soccer) ++ updateTypeMap ++ gameMinuteMap ++ scoresMap</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>def getNflIbisMap(game: NflGameScore): Map[String, String] = {</dt><dd><p>val gameMinuteMap = Map(“match_time” -&gt; game.matchTime)</p>
<dl class="simple">
<dt>val updateTypeMap = {</dt><dd><p>if (game.isGameEnd) Map(“is_game_end” -&gt; “true”)
else Map(“is_score_update” -&gt; “true”)</p>
</dd>
</dl>
<p>}</p>
<p>val awayScore = game.away.score
val homeScore = game.home.score</p>
<dl class="simple">
<dt>val scoresMap = Map(</dt><dd><p>“away_score” -&gt; awayScore.toString,
“home_score” -&gt; homeScore.toString,</p>
</dd>
</dl>
<p>)</p>
<p>gameType(SportGameEnum.Nfl) ++ updateTypeMap ++ gameMinuteMap ++ scoresMap</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>private def gameType(game: SportGameEnum.Value): Map[String, String] = {</dt><dd><dl class="simple">
<dt>game match {</dt><dd><p>case SportGameEnum.Soccer =&gt; Map(“is_soccer_game” -&gt; “true”)
case SportGameEnum.Nfl =&gt; Map(“is_nfl_game” -&gt; “true”)
case _ =&gt; Map.empty</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../../_sources/pushservice/src/main/scala/com/twitter/frigate/pushservice/predicate/magic_fanout/MagicFanoutSportsUtil.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>