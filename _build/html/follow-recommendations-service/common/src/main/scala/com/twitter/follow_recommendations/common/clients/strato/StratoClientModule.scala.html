<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; twit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../../_static/alabaster.css?v=039e1c02" />
    <script data-url_root="../../../../../../../../../../../" id="documentation_options" src="../../../../../../../../../../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../../../../../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../../../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>package com.twitter.follow_recommendations.common.clients.strato</p>
<p>import com.google.inject.name.Named
import com.google.inject.Provides
import com.google.inject.Singleton
import com.twitter.conversions.DurationOps._
import com.twitter.core_workflows.user_model.thriftscala.CondensedUserState
import com.twitter.search.account_search.extended_network.thriftscala.ExtendedNetworkUserKey
import com.twitter.search.account_search.extended_network.thriftscala.ExtendedNetworkUserVal
import com.twitter.finagle.ThriftMux
import com.twitter.finagle.mtls.authentication.ServiceIdentifier
import com.twitter.finagle.thrift.Protocols
import com.twitter.follow_recommendations.common.constants.GuiceNamedConstants
import com.twitter.follow_recommendations.common.constants.ServiceConstants._
import com.twitter.frigate.data_pipeline.candidate_generation.thriftscala.LatestEvents
import com.twitter.hermit.candidate.thriftscala.{Candidates =&gt; HermitCandidates}
import com.twitter.hermit.pop_geo.thriftscala.PopUsersInPlace
import com.twitter.onboarding.relevance.relatable_accounts.thriftscala.RelatableAccounts
import com.twitter.inject.TwitterModule
import com.twitter.onboarding.relevance.candidates.thriftscala.InterestBasedUserRecommendations
import com.twitter.onboarding.relevance.candidates.thriftscala.UTTInterest
import com.twitter.onboarding.relevance.store.thriftscala.WhoToFollowDismissEventDetails
import com.twitter.recos.user_user_graph.thriftscala.RecommendUserRequest
import com.twitter.recos.user_user_graph.thriftscala.RecommendUserResponse
import com.twitter.service.metastore.gen.thriftscala.UserRecommendabilityFeatures
import com.twitter.strato.catalog.Scan.Slice
import com.twitter.strato.client.Strato.{Client =&gt; StratoClient}
import com.twitter.strato.client.Client
import com.twitter.strato.client.Fetcher
import com.twitter.strato.client.Scanner
import com.twitter.strato.thrift.ScroogeConvImplicits._
import com.twitter.wtf.candidate.thriftscala.CandidateSeq
import com.twitter.wtf.ml.thriftscala.CandidateFeatures
import com.twitter.wtf.real_time_interaction_graph.thriftscala.Interaction
import com.twitter.wtf.triangular_loop.thriftscala.{Candidates =&gt; TriangularLoopCandidates}
import com.twitter.strato.opcontext.Attribution._</p>
<p>object StratoClientModule extends TwitterModule {</p>
<blockquote>
<div><p>// column paths
val CosineFollowPath = “recommendations/similarity/similarUsersByFollowGraph.User”
val CosineListPath = “recommendations/similarity/similarUsersByListGraph.User”
val CuratedCandidatesPath = “onboarding/curatedAccounts”
val CuratedFilteredAccountsPath = “onboarding/filteredAccountsFromRecommendations”
val PopUsersInPlacePath = “onboarding/userrecs/popUsersInPlace”
val ProfileSidebarBlacklistPath = “recommendations/hermit/profile-sidebar-blacklist”
val RealTimeInteractionsPath = “hmli/realTimeInteractions”
val SimsPath = “recommendations/similarity/similarUsersBySims.User”
val DBV2SimsPath = “onboarding/userrecs/newSims.User”
val TriangularLoopsPath = “onboarding/userrecs/triangularLoops.User”
val TwoHopRandomWalkPath = “onboarding/userrecs/twoHopRandomWalk.User”
val UserRecommendabilityPath = “onboarding/userRecommendabilityWithLongKeys.User”
val UTTAccountRecommendationsPath = “onboarding/userrecs/utt_account_recommendations”
val UttSeedAccountsRecommendationPath = “onboarding/userrecs/utt_seed_accounts”
val UserStatePath = “onboarding/userState.User”
val WTFPostNuxFeaturesPath = “ml/featureStore/onboarding/wtfPostNuxFeatures.User”
val ElectionCandidatesPath = “onboarding/electionAccounts”
val UserUserGraphPath = “recommendations/userUserGraph”
val WtfDissmissEventsPath = “onboarding/wtfDismissEvents”
val RelatableAccountsPath = “onboarding/userrecs/relatableAccounts”
val ExtendedNetworkCandidatesPath = “search/account_search/extendedNetworkCandidatesMH”
val LabeledNotificationPath = “frigate/magicrecs/labeledPushRecsAggregated.User”</p>
<p>&#64;Provides
&#64;Singleton
def stratoClient(serviceIdentifier: ServiceIdentifier): Client = {</p>
<blockquote>
<div><p>val timeoutBudget = 500.milliseconds
StratoClient(</p>
<blockquote>
<div><dl>
<dt>ThriftMux.client</dt><dd><p>.withRequestTimeout(timeoutBudget)
.withProtocolFactory(Protocols.binaryFactory(</p>
<blockquote>
<div><p>stringLengthLimit = StringLengthLimit,
containerLengthLimit = ContainerLengthLimit)))</p>
</div></blockquote>
</dd>
</dl>
<p>.withMutualTls(serviceIdentifier)
.build()</p>
</div></blockquote>
</div></blockquote>
<p>}</p>
<p>// add strato putters, fetchers, scanners below:
&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.COSINE_FOLLOW_FETCHER)
def cosineFollowFetcher(stratoClient: Client): Fetcher[Long, Unit, HermitCandidates] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, HermitCandidates](CosineFollowPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.COSINE_LIST_FETCHER)
def cosineListFetcher(stratoClient: Client): Fetcher[Long, Unit, HermitCandidates] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, HermitCandidates](CosineListPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.CURATED_COMPETITOR_ACCOUNTS_FETCHER)
def curatedBlacklistedAccountsFetcher(stratoClient: Client): Fetcher[String, Unit, Seq[Long]] =</p>
<blockquote>
<div><p>stratoClient.fetcher[String, Unit, Seq[Long]](CuratedFilteredAccountsPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.CURATED_CANDIDATES_FETCHER)
def curatedCandidatesFetcher(stratoClient: Client): Fetcher[String, Unit, Seq[Long]] =</p>
<blockquote>
<div><p>stratoClient.fetcher[String, Unit, Seq[Long]](CuratedCandidatesPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.POP_USERS_IN_PLACE_FETCHER)
def popUsersInPlaceFetcher(stratoClient: Client): Fetcher[String, Unit, PopUsersInPlace] =</p>
<blockquote>
<div><p>stratoClient.fetcher[String, Unit, PopUsersInPlace](PopUsersInPlacePath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.RELATABLE_ACCOUNTS_FETCHER)
def relatableAccountsFetcher(stratoClient: Client): Fetcher[String, Unit, RelatableAccounts] =</p>
<blockquote>
<div><p>stratoClient.fetcher[String, Unit, RelatableAccounts](RelatableAccountsPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.PROFILE_SIDEBAR_BLACKLIST_SCANNER)
def profileSidebarBlacklistScanner(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Scanner[(Long, Slice[Long]), Unit, (Long, Long), Unit] =</dt><dd><p>stratoClient.scanner[(Long, Slice[Long]), Unit, (Long, Long), Unit](ProfileSidebarBlacklistPath)</p>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.REAL_TIME_INTERACTIONS_FETCHER)
def realTimeInteractionsFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[(Long, Long), Unit, Seq[Interaction]] =</dt><dd><p>stratoClient.fetcher[(Long, Long), Unit, Seq[Interaction]](RealTimeInteractionsPath)</p>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.SIMS_FETCHER)
def simsFetcher(stratoClient: Client): Fetcher[Long, Unit, HermitCandidates] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, HermitCandidates](SimsPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.DBV2_SIMS_FETCHER)
def dbv2SimsFetcher(stratoClient: Client): Fetcher[Long, Unit, HermitCandidates] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, HermitCandidates](DBV2SimsPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.TRIANGULAR_LOOPS_FETCHER)
def triangularLoopsFetcher(stratoClient: Client): Fetcher[Long, Unit, TriangularLoopCandidates] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, TriangularLoopCandidates](TriangularLoopsPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.TWO_HOP_RANDOM_WALK_FETCHER)
def twoHopRandomWalkFetcher(stratoClient: Client): Fetcher[Long, Unit, CandidateSeq] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, CandidateSeq](TwoHopRandomWalkPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.USER_RECOMMENDABILITY_FETCHER)
def userRecommendabilityFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[Long, Unit, UserRecommendabilityFeatures] =</dt><dd><p>stratoClient.fetcher[Long, Unit, UserRecommendabilityFeatures](UserRecommendabilityPath)</p>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.USER_STATE_FETCHER)
def userStateFetcher(stratoClient: Client): Fetcher[Long, Unit, CondensedUserState] =</p>
<blockquote>
<div><p>stratoClient.fetcher[Long, Unit, CondensedUserState](UserStatePath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.UTT_ACCOUNT_RECOMMENDATIONS_FETCHER)
def uttAccountRecommendationsFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[UTTInterest, Unit, InterestBasedUserRecommendations] =</dt><dd><dl class="simple">
<dt>stratoClient.fetcher[UTTInterest, Unit, InterestBasedUserRecommendations](</dt><dd><p>UTTAccountRecommendationsPath)</p>
</dd>
</dl>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.UTT_SEED_ACCOUNTS_FETCHER)
def uttSeedAccountRecommendationsFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[UTTInterest, Unit, InterestBasedUserRecommendations] =</dt><dd><dl class="simple">
<dt>stratoClient.fetcher[UTTInterest, Unit, InterestBasedUserRecommendations](</dt><dd><p>UttSeedAccountsRecommendationPath)</p>
</dd>
</dl>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.ELECTION_CANDIDATES_FETCHER)
def electionCandidatesFetcher(stratoClient: Client): Fetcher[String, Unit, Seq[Long]] =</p>
<blockquote>
<div><p>stratoClient.fetcher[String, Unit, Seq[Long]](ElectionCandidatesPath)</p>
</div></blockquote>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.USER_USER_GRAPH_FETCHER)
def userUserGraphFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[RecommendUserRequest, Unit, RecommendUserResponse] =</dt><dd><p>stratoClient.fetcher[RecommendUserRequest, Unit, RecommendUserResponse](UserUserGraphPath)</p>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.POST_NUX_WTF_FEATURES_FETCHER)
def wtfPostNuxFeaturesFetcher(stratoClient: Client): Fetcher[Long, Unit, CandidateFeatures] = {</p>
<blockquote>
<div><p>val attribution = ManhattanAppId(“starbuck”, “wtf_starbuck”)
stratoClient</p>
<blockquote>
<div><p>.fetcher[Long, Unit, CandidateFeatures](WTFPostNuxFeaturesPath)
.withAttribution(attribution)</p>
</div></blockquote>
</div></blockquote>
<p>}</p>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.EXTENDED_NETWORK)
def extendedNetworkFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[ExtendedNetworkUserKey, Unit, ExtendedNetworkUserVal] = {</dt><dd><dl class="simple">
<dt>stratoClient</dt><dd><p>.fetcher[ExtendedNetworkUserKey, Unit, ExtendedNetworkUserVal](ExtendedNetworkCandidatesPath)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.DISMISS_STORE_SCANNER)
def dismissStoreScanner(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl>
<dt>): Scanner[</dt><dd><p>(Long, Slice[(Long, Long)]),
Unit,
(Long, (Long, Long)),
WhoToFollowDismissEventDetails</p>
</dd>
<dt>] =</dt><dd><dl class="simple">
<dt>stratoClient.scanner[</dt><dd><p>(Long, Slice[(Long, Long)]), // PKEY: userId, LKEY: (-ts, candidateId)
Unit,
(Long, (Long, Long)),
WhoToFollowDismissEventDetails</p>
</dd>
</dl>
<p>](WtfDissmissEventsPath)</p>
</dd>
</dl>
<p>&#64;Provides
&#64;Singleton
&#64;Named(GuiceNamedConstants.LABELED_NOTIFICATION_FETCHER)
def labeledNotificationFetcher(</p>
<blockquote>
<div><p>stratoClient: Client</p>
</div></blockquote>
<dl class="simple">
<dt>): Fetcher[Long, Unit, LatestEvents] = {</dt><dd><dl class="simple">
<dt>stratoClient</dt><dd><p>.fetcher[Long, Unit, LatestEvents](LabeledNotificationPath)</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../../../../../../../index2.rst.html">twit</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../../../../../../../index2.rst.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../../../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, jare.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../../../../../../../../../_sources/follow-recommendations-service/common/src/main/scala/com/twitter/follow_recommendations/common/clients/strato/StratoClientModule.scala.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>